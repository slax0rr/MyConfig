
if(typeof Events==='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt,args){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve(args);},subscribe:function(evt,callback,group){if(typeof group==='string'){return Events.addEvent(group,evt,callback);}
$(document).unbind(evt,callback).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof group!=='string'||typeof evt!=='string'||typeof callback!=='function'){return false;}
if(typeof Events.evts[group]==='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof group!=='string'||typeof Events.evts[group]==='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback,group){if(typeof group!=='string'){group=null;}
Events.subscribe(evt,function(event,args){if(typeof callback==='function'){callback(event,args);}
Events.unsubscribe(evt,event.handleObj.handler);},group);},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof args=='undefined'){args=null;}
$(document).trigger(evt,[args]);},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',fading:'EVENT.PLAYER.fading',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',seek:'EVENT.PLAYER.seek',prcPosition:'EVENT.PLAYER.prcPosition',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',track_end:'EVENT.PLAYER.track_end',finish:'EVENT.PLAYER.finish',finishPreview:'EVENT.PLAYER.finishPreview',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',setTrackList:'EVENT.PLAYER.setTrackList',fade:'EVENT.PLAYER.fade',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted',tracklist_changed:'EVENT.PLAYER.tracklist_changed',blind_test_mode_changed:'EVENT.PLAYER.blind_test_mode_changed',seekCompleted:'EVENT.PLAYER.seekCompleted',setBookmark:'EVENT.PLAYER.setBookmark'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer',removeOverlay:'EVENT.PLAYER_WIDGET.removeOverlay'},flow:{playerDisplay:'DEFERRED.FLOW.playerDisplay'},menu:{contextMenu:'EVENT.MENU.contextMenu',contextMenuOpen:'EVENT.MENU.contextMenuOpen',contextMenuClose:'EVENT.MENU.contextMenuClose',resize:'EVENT.MENU.resize',panel_mounted:'EVENT.MENU.panel_mounted',closeAllPanels:'EVENT.MENU.closeAllPanels',openPanel:'EVENT.MENU.openPanel',togglePanel:'EVENT.MENU.togglePanel'},user:{initialized:'DEFERRED.USER.initialized',loaded:'DEFERRED.USER.loaded',clickFavorite:'EVENT.USER.clickFavorite',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',shareClick:'EVENT.USER.shareClick',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChanged:'EVENT.USER.settingChanged',blockFriend:'EVENT.USER.blockFriend',unblockFriend:'EVENT.USER.unblockFriend',updatePicture:'EVENT.USER.updatePicture',uploadPicture:'EVENT.USER.uploadPicture',updateName:'EVENT.USER.updateName',updateSearchHistory:'EVENT.USER.updateSearchHistory',userLoadData:'EVENT.USER.userLoadData',updateEpisodeBookmark:'EVENT.USER.updateEpisodeBookmark',addPersonalSong:'EVENT.USER.addPersonalSong',updatePersonalSong:'EVENT.USER.updatePersonalSong',sendPersonalSong:'EVENT.USER.sendPersonalSong',progressPersonalSong:'EVENT.USER.progressPersonalSong'},genre:{loaded:'EVENT.GENRE.loaded'},live:{connected:'EVENT.LIVE.connected',simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',device_sync:'EVENT.LIVE.device_sync',pagefeed:'EVENT.LIVE.pagefeed',events:'EVENT.LIVE.events'},offline:{reminder:'EVENT.OFFLINE.reminder'},playlist:{addSong:'EVENT.PLAYLIST.addSong',removeSong:'EVENT.PLAYLIST.removeSong',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed',updated:'EVENT.PLAYLIST.updated',trackListUpdated:'EVENT.PLAYLIST.trackListUpdated',seen:'EVENT.PLAYLIST.seen',uploadPicture:'EVENT.PLAYLIST.uploadPicture',updatePicture:'EVENT.PLAYLIST.updatePicture',assistantValidation:'EVENT.PLAYLIST.assistantValidation',assistantSuggestFinish:'EVENT.PLAYLIST.assistantSuggestFinish',assistantSuggestEmpty:'EVENT.PLAYLIST.assistantSuggestEmpty',assistantToggleValidation:'EVENT.PLAYLIST.assistantToggleValidation',assistantAddedTrack:'EVENT.PLAYLIST.assistantAddedTrack'},profile:{allCoverLoaded:'EVENT.PROFILE.allCoverLoaded'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',adsBanner:'EVENT.LAYOUT.adsBanner'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_loaded:'EVENT.NAVIGATION.page_loaded',page_displayed:'EVENT.NAVIGATION.page_displayed',modal_displayed:'EVENT.NAVIGATION.modal_displayed',modal_open:'EVENT.NAVIGATION.modal_open',modal_close:'EVENT.NAVIGATION.modal_close',context_menu_close:'EVENT.NAVIGATION.context_menu_close',tab_displayed:'EVENT.NAVIGATION.tab_displayed',page_updated:'EVENT.NAVIGATION.page_updated',page_initialized:'DEFERRED.NAVIGATION.page_initialized'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',allTracksSelected:'EVENT.DATAGRID.allTracksSelected',removedTrack:'EVENT.DATAGRID.removedTrack',replacedTrack:'EVENT.DATAGRID.replacedTrack',addedItems:'EVENT.DATAGRID.addedItems'},album:{checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},radio:{start:'EVENT.RADIO.start'},lightbox:{close:'EVENT.LIGHTBOX.close'},search:{loaded:'EVENT.SEARCH.loaded',suggestDisplayed:'EVENT.SEARCH.suggestDisplayed',suggestClicked:'EVENT.SEARCH.suggestClicked'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'},facebook:{user_status:'EVENT.FACEBOOK.user_status'},chromecast:{status:'EVENT.CHROMECAST.status',removeFocus:'EVENT.CHROMECAST.removeFocus',closeIntro:'EVENT.CHROMECAST.closeIntro'},lyrics:{load:'EVENT.LYRICS.load',seek:'EVENT.LYRICS.seek'},gigs:{display:'EVENT.GIGS.display'},copy:{after:'EVENT.COPY.after'},tag:{select:'EVENT.TAG.select'},talk:{bookmarkSet:'EVENT.TALK.bookmarkSet'},tips:{close:'EVENT.TIPS.close',draw:'EVENT.TIPS.draw'},tooltip:{show:'EVENT.TOOLTIP.show',hide:'EVENT.TOOLTIP.hide'}};};
require=function e(t,s,a){function i(n,o){if(!s[n]){if(!t[n]){var l="function"==typeof require&&require;if(!o&&l)return l(n,!0);if(r)return r(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var p=s[n]={exports:{}};t[n][0].call(p.exports,function(e){var s=t[n][1][e];return i(s?s:e)},p,p.exports,e,t,s,a)}return s[n].exports}for(var r="function"==typeof require&&require,n=0;n<a.length;n++)i(a[n]);return i}({252:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/get")["default"],i=e("babel-runtime/helpers/inherits")["default"],r=e("babel-runtime/helpers/create-class")["default"],n=e("babel-runtime/helpers/class-call-check")["default"],o=e("./model"),l=function(e){function t(){n(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return i(t,e),r(t,[{key:"getFallback",value:function(){return this.hasFallback()?new t(this.FALLBACK).set({ORIGIN_ID:Number(this.SNG_ID||this.EPISODE_ID),UNSEEN:this.UNSEEN,DATE_ADD:this.DATE_ADD}):void 0}},{key:"hasFallback",value:function(){return this.FALLBACK}},{key:"isUnseen",value:function(e){return this.DATE_ADD?this.DATE_ADD>e:null}}],[{key:"hydrate",value:function(e){for(var t=[],s=0,a=e.length;a>s;++s)t[s]=new this(e[s]);return t}}]),t}(o);t.exports=l},{"./model":251,"babel-runtime/helpers/class-call-check":291,"babel-runtime/helpers/create-class":292,"babel-runtime/helpers/get":295,"babel-runtime/helpers/inherits":296}],296:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/create")["default"],i=e("babel-runtime/core-js/object/set-prototype-of")["default"];s["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=a(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i?i(e,t):e.__proto__=t)},s.__esModule=!0},{"babel-runtime/core-js/object/create":286,"babel-runtime/core-js/object/set-prototype-of":290}],290:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":303}],303:[function(e,t,s){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/$.core").Object.setPrototypeOf},{"../../modules/$.core":307,"../../modules/es6.object.set-prototype-of":324}],324:[function(e,t,s){var a=e("./$.export");a(a.S,"Object",{setPrototypeOf:e("./$.set-proto").set})},{"./$.export":310,"./$.set-proto":318}],318:[function(e,t,s){var a=e("./$").getDesc,i=e("./$.is-object"),r=e("./$.an-object"),n=function(e,t){if(r(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,s,i){try{i=e("./$.ctx")(Function.call,a(Object.prototype,"__proto__").set,2),i(t,[]),s=!(t instanceof Array)}catch(r){s=!0}return function(e,t){return n(e,t),s?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:n}},{"./$":315,"./$.an-object":305,"./$.ctx":308,"./$.is-object":314}],305:[function(e,t,s){var a=e("./$.is-object");t.exports=function(e){if(!a(e))throw TypeError(e+" is not an object!");return e}},{"./$.is-object":314}],314:[function(e,t,s){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],286:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":299}],299:[function(e,t,s){var a=e("../../modules/$");t.exports=function(e,t){return a.create(e,t)}},{"../../modules/$":315}],295:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/get-own-property-descriptor")["default"];s["default"]=function(e,t,s){for(var i=!0;i;){var r=e,n=t,o=s;i=!1,null===r&&(r=Function.prototype);var l=a(r,n);if(void 0!==l){if("value"in l)return l.value;var c=l.get;if(void 0===c)return;return c.call(o)}var p=Object.getPrototypeOf(r);if(null===p)return;e=p,t=n,s=o,i=!0,l=p=void 0}},s.__esModule=!0},{"babel-runtime/core-js/object/get-own-property-descriptor":288}],288:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":301}],301:[function(e,t,s){var a=e("../../modules/$");e("../../modules/es6.object.get-own-property-descriptor"),t.exports=function(e,t){return a.getDesc(e,t)}},{"../../modules/$":315,"../../modules/es6.object.get-own-property-descriptor":322}],322:[function(e,t,s){var a=e("./$.to-iobject");e("./$.object-sap")("getOwnPropertyDescriptor",function(e){return function(t,s){return e(a(t),s)}})},{"./$.object-sap":317,"./$.to-iobject":319}],319:[function(e,t,s){var a=e("./$.iobject"),i=e("./$.defined");t.exports=function(e){return a(i(e))}},{"./$.defined":309,"./$.iobject":313}],251:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/create-class")["default"],i=e("babel-runtime/helpers/class-call-check")["default"],r=function(){function e(t){i(this,e),this.set(t)}return a(e,[{key:"set",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);return this}}]),e}();t.exports=r},{"babel-runtime/helpers/class-call-check":291,"babel-runtime/helpers/create-class":292}],292:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/define-property")["default"];s["default"]=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),a(e,i.key,i)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),s.__esModule=!0},{"babel-runtime/core-js/object/define-property":287}],287:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":300}],300:[function(e,t,s){var a=e("../../modules/$");t.exports=function(e,t,s){return a.setDesc(e,t,s)}},{"../../modules/$":315}],291:[function(e,t,s){"use strict";s["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s.__esModule=!0},{}],242:[function(e,t,s){"use strict";var a=e("react"),i=e("react-dom"),r=e("jquery"),n=e("../components/common/ContextMenu"),o={initialized:!1,init:function(){Events.ready(Events.user.userReady,function(){i.render(a.createElement(n,null),document.getElementById("page_context_menu")),o.initialized=!0}),Events.subscribe(Events.navigation.context_menu_close,o.close)},close:function(e){return o.initialized&&0!==USER.USER_ID?void Events.trigger(Events.menu.contextMenuClose,e):!1},open:function(e){var t=e;return 0===USER.USER_ID?(www.goToConnection(),!1):("object"==typeof e.currentTarget&&(t=r.extend({},e.currentTarget.dataset),t.target=e.currentTarget),void Events.trigger(Events.menu.contextMenuOpen,t))}};t.exports=o},{"../components/common/ContextMenu":59,jquery:"jquery",react:"react","react-dom":"react-dom"}],59:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/keys")["default"],i=e("react"),r=e("classnames"),n=e("jquery"),o=e("../../core/i18n"),l=o.gettext,c=o.ngettext,p=e("../../core/modal"),d=e("../../core/favorite"),u=e("./Thumbnail"),h=e("../_mixins/sort"),m=e("../_mixins/tracking"),_=i.createClass({displayName:"ContextMenu",propTypes:{context:i.PropTypes.string},mixins:[h,m],getInitialState:function(){return{opened:!1,view:"home",playlist_list:this._getPlaylistList(),blocked:profile.data&&profile.data.DATA?profile.data.DATA.HAS_BLOCKED:!1,id:[0],type:"",cover_type:"",image:"",is_thumbnail:!1,excludes:[]}},componentDidMount:function(){Events.subscribe(Events.playlist.created,function(e,t){this.setState({playlist_list:this._getPlaylistList()}),"playlist"===this.state.view&&this._action({type:"add_track_to_playlist",id:t.PLAYLIST_ID})}.bind(this),"panel_playlist"),Events.subscribe(Events.playlist.removed,function(){this.setState({playlist_list:this._getPlaylistList()})}.bind(this),"panel_playlist"),Events.subscribe(Events.playlist.updated,function(){this.setState({playlist_list:this._getPlaylistList()})}.bind(this),"panel_playlist"),Events.subscribe(Events.navigation.page_displayed,function(){this._onClose(),profile.data&&profile.data.DATA&&this.setState({blocked:profile.data.DATA.HAS_BLOCKED})}.bind(this),"panel_playlist"),Events.subscribe(Events.layout.adsBackground,function(){this.state.opened&&this._setPosition()}.bind(this),"panel_playlist"),Events.subscribe(Events.user.blockFriend,function(){this.setState({blocked:!0})}.bind(this)),Events.subscribe(Events.user.unblockFriend,function(){this.setState({blocked:!1})}.bind(this)),Events.subscribe(Events.menu.contextMenuOpen,function(e,t){this._onOpen(t)}.bind(this)),Events.subscribe(Events.menu.contextMenuClose,function(e,t){this._onClose(t)}.bind(this))},getTrackingParams:function(){return{instance:this.state.type}},render:function(){var e,t=this._getFeatureList(),s=r({"menu-main":!0,opened:"home"===this.state.view,closed:"home"!==this.state.view}),n=r({"menu-playlist":!0,opened:"playlist"===this.state.view,closed:"playlist"!==this.state.view}),o=r({"popover-body":!0,"menu-extended":"playlist"===this.state.view});return i.createElement("section",{className:"page-contextmenu"+(this.state.opened?" opened":""),ref:"context_menu"},i.createElement("div",{className:"popover popover-"+this.state.position},this.state.is_thumbnail?"":this._renderHeader(),i.createElement("div",{className:o},i.createElement("div",{className:s},"talk"===this.state.type?i.createElement("div",null,i.createElement("div",{className:"episodes-headings"},i.createElement("h4",{className:"heading-4"},this.state.data.EPISODE_TITLE),i.createElement("h5",{className:"heading-4-sub"},window.secToMin(this.state.data.DURATION)," - ",formatDate(this.state.data.EPISODE_PUBLISHED_TIMESTAMP.split(" ")[0],"/"))),i.createElement("div",{className:"episodes-container nano",ref:"scroll_description"},i.createElement("div",{className:"nano-content"},this.state.data.EPISODE_DESCRIPTION))):!1,i.createElement("ul",null,a(t).map(function(s,a){var n=t[s];return e=r({"menu-item":!0,link:n.link,"no-icon":!n.icon}),this._isAvailableFeature(s)?"modify_avatar"===s||"modify_image"===s?i.createElement("li",{key:"context_menu_"+s+a,onClick:this._action,"data-type":s,className:e},i.createElement("a",{className:"evt-click",href:"#","data-link":"0","data-change-picture":"1","data-type":this.state.type,"data-id":this._getElementId()},i.createElement("span",{className:"label"},n.wording))):"delete_avatar"===s||"delete_image"===s?i.createElement("li",{key:"context_menu_"+s+a,onClick:this._action,"data-type":s,className:e},i.createElement("a",{className:"evt-click",href:"#","data-link":"0","data-delete-picture":"1","data-type":this.state.type,"data-id":this._getElementId()},i.createElement("span",{className:"label"},n.wording))):i.createElement("li",{key:"context_menu_"+s+a,onClick:this._action,"data-type":s,className:e},n.icon?i.createElement("span",{className:"icon icon-"+n.icon}):"",i.createElement("span",{className:"label"},n.wording)):!1}.bind(this)))),i.createElement("div",{className:n},i.createElement("h2",{className:"heading-5"},i.createElement("a",{"data-menu":"main",onClick:this._action,"data-type":"add_to_playlist"},i.createElement("span",{className:"icon icon-before icon-chevron-left"}),l("Retour"))),i.createElement("h3",{className:"heading-5-sub"},l("Sélectionner")),i.createElement("ul",{className:"playlists"},i.createElement("li",{className:"menu-item playlist-create",onClick:this._onOpenPlaylistAssistant,role:"button"},i.createElement("span",{className:"icon icon-add"}),i.createElement("span",{className:"label"},l("Nouvelle playlist")))),i.createElement("div",{className:"playlist-container nano",ref:"scroll_playlist"},i.createElement("div",{className:"nano-content"},i.createElement("ul",{className:"playlists"},this.state.playlist_list.map(function(e,t){return i.createElement("li",{className:"menu-item",key:"context_menu_"+e.PLAYLIST_ID+t,onClick:this._action,"data-type":"add_track_to_playlist","data-id":e.PLAYLIST_ID,"data-position":t},i.createElement("span",{className:"icon icon-playlist"}),i.createElement("span",{className:"label ellipsis"},e.TITLE))}.bind(this)))))))))},_renderHeader:function(){var e={type:this.state.type,cover:"",picture_type:"",title1:"",url1:"",title2:"",url2:""};return"song"===this.state.type&&(e.type="track",this.state.id.length>1?e.title1=this.state.id.length+" "+c("titre","titres",{count:this.state.id.length}):(e.cover=this.state.data.SONG.ALB_PICTURE,e.title1=this.state.data.SONG.SNG_TITLE,e.url1=this.state.data.SONG.SNG_ID>0?"/album/"+this.state.data.SONG.ALB_ID:"",e.title2=this._getArtistName(this.state.data.SONG))),"playlist"===this.state.type&&(e.cover=this.state.data.PLAYLIST_PICTURE,e.picture_type=this.state.data.PICTURE_TYPE,e.title1=this.state.data.TITLE,e.url1="/playlist/"+this.state.data.PLAYLIST_ID,e.title2=i.createElement("a",{className:"evt-click",href:"/profile/"+(this.state.data.PARENT_USER_ID||USER.USER_ID)},this.state.data.PARENT_USERNAME||USER.BLOG_NAME)),"album"===this.state.type&&(e.cover=this.state.data.ALB_PICTURE,e.title1=this.state.data.ALB_TITLE,e.url1="/album/"+this.state.data.ALB_ID,e.title2=this._getArtistName(this.state.data)),"artist"===this.state.type&&(e.cover=this.state.data.ART_PICTURE,e.title1=this.state.data.ART_NAME,e.url1="/artist/"+this.state.data.ART_ID),"app"===this.state.type&&(e.cover=this.state.data.APP_PICTURE,e.title1=this.state.data.NAME,e.url1="/app/"+this.state.data.APP_ID),"talk"===this.state.type&&(e.cover=this.state.data.SHOW_ART_MD5,e.url1=this.state.data.SHOW_ID>0?"/show/"+this.state.data.SHOW_ID:"",e.title1=this.state.data.SHOW_NAME),"episode"===this.state.type&&(e.title1=this.state.data.EPISODE.EPISODE_TITLE,e.title2=i.createElement("a",{className:"evt-click",href:"/show/"+this.state.data.EPISODE.SHOW_ID},this.state.data.EPISODE.SHOW_NAME),e.cover=this.state.data.EPISODE.SHOW_ART_MD5,e.picture_type="talk"),i.createElement("div",{className:"popover-header"},!e.type||"song"===this.state.type&&this.state.id.length>1?!1:i.createElement("div",{className:"cell cell-thumbnail"},i.createElement(u,{type:e.type,md5:e.cover,picture_type:e.picture_type,height:56,width:56,onClick:function(){www.navigate(e.url1)}})),i.createElement("div",{className:"cell cell-infos"},i.createElement("h2",{className:"heading-4 ellipsis"},1===this.state.id.length?i.createElement("a",{className:"evt-click",href:e.url1},e.title1):e.title1),""===e.title2?!1:i.createElement("h3",{className:"heading-4-sub ellipsis"},l("par")," ",e.title2)))},_onOpen:function(e){"object"!=typeof e.id&&(e.id=[e.id]),"rtl"!==window.DIRECTION||"left"!==e.position&&"right"!==e.position||(e.position="left"===e.position?"right":"left"),n(this.refs.context_menu).show(),this.setState({id:e.id||[0],view:e.view||"home",target:e.target,position:e.position||"right",type:e.type||"",context:e.context||"",listen_context:e.listen_context||{},data:e.data||{},share_context:e.share_context||null,create_playlist:!1,changed_position:!1,is_thumbnail:e.is_thumbnail,cover_type:e.cover_type,image:e.image,excludes:e.excludes||[],private_status:e.private_status||0,zoom_on_cover:e.zoom_on_cover||!1},function(){this._setPosition(),n(this.refs["talk"===this.state.type?"scroll_description":"scroll_playlist"]).nanoScroller(),n(this.state.target).parents("figure").addClass("has-contextmenu"),this.state.opened===!1&&this.setState({opened:!0})}.bind(this)),n("body").on("click",this._close),n(".page-scroll").on("scroll",this._closeOnScroll)},_onClose:function(e){e&&this.state.context!==e||(this.setState({opened:!1,view:"home"},function(){window.setTimeout(function(){this.state.opened===!1&&n(this.refs.context_menu).css({left:"",top:""}).hide()}.bind(this),150)}.bind(this)),n("body").off("click",this._close),n(".page-scroll").off("scroll",this._closeOnScroll),setTimeout(function(){n(this.state.target).removeClass("has-contextmenu"),n(this.state.target).parents("figure").removeClass("has-contextmenu")}.bind(this),200))},_onOpenPlaylistAssistant:function(){p.open("/lightbox/playlist_assistant?type=create&sng_id="+this.state.id.join("|")),Events.trigger(Events.menu.contextMenuClose)},_onPersonalSongDeleted:function(e,t){e===!0&&userData.removePlaylistSong(window.USER.USER_ID,t.sng_list)},_getPlaylistList:function(){for(var e=userData.data.PLAYLISTS.data.slice(0),t=0,s=userData.data.FAVORITES_PLAYLISTS.data.length;s>t;t++)2===Number(userData.data.FAVORITES_PLAYLISTS.data[t].STATUS)&&e.push(userData.data.FAVORITES_PLAYLISTS.data[t]);return this.sort(e,"DATE_UPDATE")},_getFeatureList:function(){return{play_radio:{icon:"play",wording:l("Lancer le mix")},play_next:{icon:"play-next",wording:l("Écouter juste après")},add_to_queue:{icon:"qlist-add",wording:l("Ajouter à la file d'attente")},add_to_library:{icon:"love",wording:button_multi_state.getWording({type:this.state.type,action:"favorite"},"add","full")},add_to_playlist:{icon:"playlist-add",wording:l("Ajouter à une playlist")+"..."},go_to_lyrics:{icon:"lyrics",wording:l("Écouter avec les paroles")},share:{icon:"share",wording:l("Partager")},edit_mp3:{icon:"edit",wording:l("Modifier")},edit_tags:{icon:"edit",wording:"Edit tags"},remove_from_queue:{icon:"trash",wording:l("Retirer de la file d'attente")},push_to_mobile:{icon:"phone",wording:l("Écouter sur mobile")},remove_from_library:{icon:"cancel",wording:button_multi_state.getWording({type:this.state.type,action:"favorite"},"hover","full")},delete_track:{icon:"trash",wording:l("Retirer de la playlist")},delete_mp3:{icon:"trash",wording:l("Retirer de mes MP3")},zoom_on_cover:{icon:"resize-up",wording:l("Zoomer sur la pochette")},promote_album:{wording:l("Mettre en avant")},change_genre:{wording:l("Changer les genres")},go_to_playlist:{link:!0,icon:"arrow-right",wording:l("Page playlist")},go_to_user:{link:!0,icon:"arrow-right",wording:l("Profil utilisateur")},go_to_show:{link:!0,icon:"arrow-right",wording:l("Page show")},edit_profile:{wording:l("Modifier mes informations")},switch_account:{wording:l(user.getMultiAccountOptions().CHILD_COUNT?"Changer de profil":"Nouveau profil")},modify_avatar:{wording:l("Modifier mon avatar")},delete_avatar:{wording:l("Supprimer mon avatar")},modify_image:{wording:l("Modifier l'image")},delete_image:{wording:l("Supprimer l'image")},message_user:{wording:l("Message")},block_user:{wording:l("Bloquer")},unblock_user:{wording:l("Débloquer")}}},_isAvailableFeature:function(e){var t={},s=userData.isFavorite(this.state.type,this._getElementId()),a=dzPlayer.isRadio()||"feed_user_radio"===this.state.context,i=gatekeeper.isAllowed("curator_feature")&&USER.SETTING.curator.push_album_limit&&Number(USER.SETTING.curator.push_album_limit)>0;if("song"===this.state.type){var r=1===this.state.id.length,o="undefined"!=typeof this.state.data.SONG&&"undefined"!=typeof this.state.data.SONG.LYRICS_ID&&0!==this.state.data.SONG.LYRICS_ID;t={play_next:!a,add_to_queue:!a,add_to_playlist:!0,add_to_library:r&&!s,remove_from_library:r&&s,share:r&&this._getElementId()>0&&(0===this.state.private_status||2===this.state.private_status),go_to_lyrics:r&&this._getElementId()>0&&o,push_to_mobile:this.state.is_thumbnail&&!USER.DEVICES_COUNT,edit_tags:gatekeeper.isAllowed("employee_feature"),queuelist:{remove_from_queue:r&&dzPlayer.getTrackList().length>1&&!a},playlist:{delete_track:this.state.data.PLAYLIST_PERSONNAL},player:{go_to_playlist:"playlist"===LOG_CONTEXT[dzPlayer.getContext("TYPE")]&&r&&this._getElementId()>0},personal_song:{edit_mp3:r,delete_mp3:!0,edit_tags:!1},lovedpersonal:{remove_from_library:!0}}}else if("album"===this.state.type)t={play_next:!a,add_to_queue:!a,add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status,promote_album:!1,change_genre:!1,edit_tags:gatekeeper.isAllowed("employee_feature")},this.state.is_thumbnail&&(t=n.extend(t,{promote_album:i,change_genre:gatekeeper.isAllowed("employee_feature"),push_to_mobile:!USER.DEVICES_COUNT,zoom_on_cover:this.state.zoom_on_cover}));else if("artist"===this.state.type)t={play_radio:!0,add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status,edit_tags:gatekeeper.isAllowed("employee_feature")};else if("radio"===this.state.type)t={play_radio:!0,add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status};else if("playlist"===this.state.type){if(t={play_next:!a,add_to_queue:!a,add_to_library:Number(this.state.data.PARENT_USER_ID)!==USER.USER_ID&&!s,remove_from_library:Number(this.state.data.PARENT_USER_ID)!==USER.USER_ID&&s,push_to_mobile:(0===this.state.private_status||2===this.state.private_status)&&!USER.DEVICES_COUNT,share:0===this.state.private_status||2===this.state.private_status,go_to_user:Number(this.state.data.PARENT_USER_ID)!==USER.USER_ID},this.state.is_thumbnail){var l="undefined"!=typeof playlist.data&&"undefined"!=typeof playlist.data.PLAYLIST_PICTURE;t=n.extend(t,{modify_image:l&&Number(this.state.data.PARENT_USER_ID)===USER.USER_ID,delete_image:l&&""!==playlist.data.PLAYLIST_PICTURE&&Number(this.state.data.PARENT_USER_ID)===USER.USER_ID})}}else"app"===this.state.type?t={add_to_library:!userData.isFavorite("application",this._getElementId()),remove_from_library:userData.isFavorite("application",this._getElementId())}:"user"===this.state.type?t={edit_profile:null!==profile.data&&profile.data.DATA.IS_PERSONNAL,modify_avatar:null!==profile.data&&profile.data.DATA.IS_PERSONNAL,switch_account:null!==profile.data&&profile.data.DATA.IS_PERSONNAL&&(user.getMultiAccountOptions().ENABLED||user.getMultiAccountOptions().CHILD_COUNT),delete_avatar:null!==profile.data&&profile.data.DATA.IS_PERSONNAL&&""!==profile.data.DATA.USER.USER_PICTURE,block_user:null!==profile.data&&!profile.data.DATA.IS_PERSONNAL&&!this.state.blocked,unblock_user:null!==profile.data&&!profile.data.DATA.IS_PERSONNAL&&this.state.blocked,message_user:null!==profile.data&&!profile.data.DATA.IS_PERSONNAL}:"show"===this.state.type?t={add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status}:"episode"===this.state.type&&(t={share:0===this.state.private_status||2===this.state.private_status,go_to_show:"talkShow"!==this.state.context});for(var c=0;c<this.state.excludes.length;c++)if(this.state.excludes[c]===e)return!1;return"object"==typeof t[this.state.context]&&"boolean"==typeof t[this.state.context][e]?t[this.state.context][e]:"boolean"==typeof t[e]?t[e]:!1},_setPosition:function(){var e={top:0,left:0},t=n(this.refs.context_menu),s=n(this.state.target),a=10,i=30,r=t[0].offsetWidth,o=t[0].offsetHeight,l=n.extend({},s.offset(),{width:s[0].offsetWidth,height:s[0].offsetHeight});"right"===this.state.position?(e.left=l.left+l.width+a,e.top=l.top+l.height/2-o/2):"right-top"===this.state.position?(e.left=l.left+l.width+a,e.top=l.top+l.height/2-o+i):"right-bottom"===this.state.position?(e.left=l.left+l.width+a,e.top=l.top+l.height/2-i):"left"===this.state.position?(e.left=l.left-r-a,e.top=l.top+l.height/2-o/2):"left-top"===this.state.position?(e.left=l.left-r-a,e.top=l.top+l.height/2-o+i):"left-bottom"===this.state.position?(e.left=l.left-r-a,e.top=l.top+l.height/2-i):"bottom"===this.state.position?(e.left=l.left+l.width/2-r/2,e.top=l.top+l.height+a):"top"===this.state.position?(e.left=l.left+l.width/2-r/2,e.top=l.top-o-a):"object"==typeof this.state.position&&(e=this.state.position);var c=e.top<0,p=e.top+o>n(window).height(),d=r+e.left-n(window).width()>0;if((c||p||d)&&!this.state.changed_position){if("left"===this.state.position||"right"===this.state.position||"bottom"===this.state.position){var u={left:{isOverTop:"left-bottom",isOverBottom:"left-top",isOverRight:"left"},right:{isOverTop:"right-bottom",isOverBottom:"right-top",isOverRight:"left"},bottom:{isOverTop:"bottom",isOverBottom:"top",isOverRight:"left-bottom"},top:{isOverTop:"top",isOverBottom:"bottom",isOverRight:"left-top"}};if(u[this.state.position]){var h=this.state.position;c?h=u[this.state.position].isOverTop:p&&(h=u[this.state.position].isOverBottom),d&&(h=u[h]?u[h].isOverRight:u[this.state.position].isOverRight),this.setState({position:h,changed_position:!0},function(){this._setPosition()}.bind(this))}return!1}"object"==typeof this.state.position&&(e.top-=e.top+o-n(window).height())}t.css(e)},_getArtistName:function(e){return e.ARTISTS?e.ARTISTS.map(function(e,t){return 0===Number(e.ROLE_ID)||5===Number(e.ROLE_ID)?[t>0?", ":"",i.createElement("a",{className:"evt-click",href:"/artist/"+e.ART_ID},e.ART_NAME)]:void 0}):i.createElement("a",{className:"evt-click",href:"/artist/"+e.ART_ID},e.ART_NAME)},_getSongIdList:function(){for(var e=[],t=0;t<this.state.id.length;t++)e.push([this.state.id[t],this.state.id[t]>0?0:1]);return e},_getElementId:function(){return this.state.id[0]},_action:function(e){var t=e;if("object"==typeof t.currentTarget&&(t=dom.dataset(t.currentTarget)),"string"!=typeof t.type)return void e.preventDefault();var s=!0;switch(t.type){case"play_next":case"play_radio":case"add_to_queue":"queue_list"===this.state.context&&"play"===t.type?dzPlayer.playTrackAtIndex(this.state.data.INDEX):(dzPlayer.play({type:"song"===this.state.type?"track":this.state.type,id:"song"===this.state.type?this.state.id:this._getElementId(),radio:"play_radio"===t.type,addNext:"play_next"===t.type,addQueue:"add_to_queue"===t.type,context:this.state.listen_context}),"artist"===this.state.type&&"play_radio"===t.type&&loadBox("/artist/"+this._getElementId())),("play_next"===t.type||"add_to_queue"===t.type)&&this.tracking("context_menu_click",e.currentTarget);break;case"remove_from_queue":dzPlayer.removeTracks(this.state.data.INDEX);break;case"add_to_library":case"remove_from_library":for(var a=this.state.id,i=0;i<a.length;i++){var r={id:a[i],type:"app"===this.state.type?"application":this.state.type,context:this.state.context};userData.isFavorite(r.type,r.id)?d.remove(r):d.add(r)}break;case"add_to_playlist":this._toggleView(),s=!1;break;case"add_track_to_playlist":userData.addPlaylistSong(t.id,this._getSongIdList(),{context:this.state.context,position:t.position});break;case"share":sharebox.load(this.state.type,this._getElementId(),this.state.share_context);break;case"go_to_lyrics":if("queue_list"===this.props.context)Events.subscribeOnce(Events.player.displayCurrentSong,function(){Events.trigger(Events.menu.togglePanel,"lyrics")}),dzPlayer.playTrackAtIndex(this.state.data.INDEX);else{Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong(),Events.trigger(Events.menu.togglePanel,"lyrics")});var o={type:"track",id:this.state.id,radio:!1,context:this.state.listen_context};"radio"!==dzPlayer.getPlayerType()&&(o.addNext=!0),dzPlayer.play(o)}break;case"go_to_playlist":loadBox("/playlist/"+("playlist"===this.state.type?this._getElementId():this.state.data.PLAYLIST_ID));break;case"go_to_user":"user"===this.state.type?loadBox("/profile/"+this.getElementId()):loadBox("/profile/"+("show"===this.state.type?this.state.data.SHOW_ID:this.state.data.PARENT_USER_ID));break;case"go_to_show":loadBox("/show/"+this.state.data.SHOW_ID);break;case"delete_track":var l=this._getSongIdList();api.call({method:"playlist.deleteSongs",data:{playlist_id:this.state.data.PLAYLIST_ID,songs:l},success:function(e){if(e===!0){userData.removePlaylistSong(this.state.data.PLAYLIST_ID,l);for(var t=0,s=l.length;s>t;t++){var a="object"==typeof l[t]?Number(l[t][0]):Number(l[t]);"loved"===this.state.type&&userData.isFavorite("song",a)&&userData.deleteFavorite({type:"song",id:a})}}}.bind(this)});break;case"delete_mp3":for(var c,u=0;u<this.state.id.length;u++)c={upload_id:this.state.id[u]},api.call("personal_song.delete",c,this._onPersonalSongDeleted,{sng_list:this.state.id[u]});break;case"edit_mp3":p.open("/lightbox/edit_personal_song.php?sng_id="+this._getElementId());break;case"edit_tags":p.open("/lightbox/curators/edit_tag/"+this.state.type+"/"+this._getElementId());break;case"promote_album":p.open("/lightbox/curators/push_album/"+this._getElementId());break;case"change_genre":p.open("/lightbox/curators/update_genre/"+this._getElementId());break;case"edit_profile":loadBox("/account");break;case"modify_avatar":n("#profile_avatar_upload").trigger("click");break;case"switch_account":p.open("/lightbox/multi_account/switch");break;case"modify_image":n("#naboo_playlist_image_upload").trigger("click");break;case"message_user":p.open("/lightbox/instant_messenger.php?friend_id="+this._getElementId());break;case"block_user":user.block(null,this._getElementId());break;case"unblock_user":user.unblock(null,this._getElementId());break;case"zoom_on_cover":p.open("/lightbox/picture_zoom.php?type="+this.state.cover_type+"&md5="+this.state.image);break;case"push_to_mobile":if(USER.DEVICES_COUNT>0)break;p.open("/lightbox/push_mobile?context=ticker&type="+this.state.cover_type+"&id="+this.state.image)}s===!0&&Events.trigger(Events.menu.contextMenuClose)},_toggleView:function(){this.setState({view:"home"===this.state.view?"playlist":"home"},function(){"song"===this.state.type&&this.state.id.length>1&&(this._setPosition(),n(this.refs.scroll_playlist).nanoScroller())})},_close:function(e){return n(e.target).parents("#page_context_menu").length?!0:(e.stopPropagation(),e.preventDefault(),void Events.trigger(Events.menu.contextMenuClose))},_closeOnScroll:function(){this.state.opened&&Events.trigger(Events.menu.contextMenuClose)}});t.exports=_},{"../../core/favorite":243,"../../core/i18n":245,"../../core/modal":247,"../_mixins/sort":43,"../_mixins/tracking":45,"./Thumbnail":130,"babel-runtime/core-js/object/keys":289,classnames:"classnames",jquery:"jquery",react:"react"}],243:[function(e,t,s){"use strict";var a=e("jquery"),i=e("./i18n"),r=i.gettext,n={init:function(){Events.subscribe(Events.user.addFavorite,n.onChangeStatus,"favorite"),Events.subscribe(Events.user.deleteFavorite,n.onChangeStatus,"favorite")},action:function(e,t){try{return 0==USER.USER_ID?(www.goToConnection(),!1):(Events.ready(Events.user.userReady,function(){userData.isFavorite(t.type,t.id)?n.remove(t,e):n.add(t,e)}),!0)}catch(s){error.log(s)}},add:function(e,t){try{if(0===USER.USER_ID)return www.goToConnection(),!1;if(t=t||null,userData.isFavorite(e.type,e.id))return!1;var s={type:e.type,id:e.id,context:e.context||"",additionnal_actions:"undefined"!=typeof e.additionnal_actions?e.additionnal_actions:null};switch(e.type){case"artist":api.call("artist.getData",{ART_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"artist.addFavorite",{art_id:e.id},s)});break;case"radio":api.call("radio.getData",{RADIO_ID:e.id,COUNTRY:COUNTRY},function(i){a.extend(s,i),n.addCallback(t,"radio.addFavorite",{radio_id:e.id},s)});break;case"album":api.call("album.getData",{ALB_ID:e.id,COUNTRY:COUNTRY},function(i){a.extend(s,i),n.addCallback(t,"album.addFavorite",{ALB_ID:e.id},s)});break;case"show":api.call("show.getData",{SHOW_ID:e.id,COUNTRY:COUNTRY},function(i){a.extend(s,i),api.call("episode.getListByShow",{SHOW_ID:e.id,COUNTRY:COUNTRY},function(a){s.LATEST_EPISODE=a,n.addCallback(t,"show.addFavorite",{SHOW_ID:e.id},s)})});break;case"application":api.call("application.getPublicData",{APP_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"application.addFavorite",{APP_ID:e.id},s)});break;case"playlist":api.call("playlist.getData",{PLAYLIST_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"playlist.addFavorite",{parent_playlist_id:e.id,title:s.TITLE,parent_user_id:s.PARENT_USER_ID,parent_username:s.PARENT_USERNAME},s)});break;case"song":api.call("song.getData",{SNG_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"favorite_song.add",{SNG_ID:e.id},s)});break;case"disliked_song":api.call("song.getData",{SNG_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"favorite_dislike.add",{SNG_ID:e.id},s)});break;case"friend":api.call("user.getData",{USER_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"friend.follow",{friend_id:e.id},s)});break;case"genre":api.call("genre_getData",{GENRE_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"favorite_genre.add",{GENRE_ID:e.id},s)});break;default:return!1;}return"undefined"!=typeof window.dataLayer&&window.dataLayer.push({event:"favorite.add="+e.id}),!0}catch(i){error.log(i)}},addCallback:function(e,t,s,a){try{var i=[{method:t,data:s,success:function(t){if(t===!1){switch(a.type){case"playlist":alert(r("Impossible d'ajouter cette playlist à votre musique préférée. Vous avez atteint le nombre maximum de playlists ajoutées."));break;case"album":alert(r("Impossible d'ajouter cet album à votre musique préférée. Vous avez atteint le nombre maximum d'albums ajoutés."));break;case"artist":alert(r("Impossible d'ajouter cet artiste à vos favoris. Vous avez atteint le nombre maximum d'artistes favoris."));break;case"radio":alert(r("Impossible d'ajouter ce mix à votre musique préférée. Vous avez atteint le nombre maximum de mix ajoutés."))}return!1}null!=e&&(e.is("a")?n.setRemoveState(e,a):e.is("button")&&e.data("cancel_hover",!0)),userData.addFavorite(a),"song"==a.type&&n.remove({type:"disliked_song",id:a.SNG_ID}),"disliked_song"==a.type&&n.remove({type:"song",id:a.SNG_ID})}}];return null!==a.additionnal_actions&&(i=i.concat(a.additionnal_actions)),api.call(i),!0}catch(o){error.log(o)}},remove:function(e,t){try{if(!userData.isFavorite(e.type,e.id))return!1;t=t||null;var s,a;switch(e.type){case"artist":s="artist.deleteFavorite",a={art_id:e.id};break;case"radio":s="radio.deleteFavorite",a={radio_id:e.id};break;case"album":s="album.deleteFavorite",a={ALB_ID:e.id};break;case"show":s="show.deleteFavorite",a={SHOW_ID:e.id};break;case"playlist":s="playlist.deleteFavorite",a={playlist_id:e.id};break;case"application":s="application.deleteFavorite",a={APP_ID:e.id};break;case"song":s="favorite_song.remove",a={SNG_ID:e.id};break;case"disliked_song":s="favorite_dislike.remove",a={SNG_ID:e.id};break;case"friend":s="friend.unfollow",a={FRIEND_ID:e.id};break;case"genre":s="favorite_genre.remove",a={GENRE_ID:e.id};break;default:return!1}"undefined"!=typeof e.additionnal_actions&&api.call(e.additionnal_actions),api.call(s,a,function(s){s===!0&&(null!=t&&t.is("a")&&n.setAddState(t,e),userData.deleteFavorite(e))})}catch(i){error.log(i)}},drawButton:function(e,t){try{if(0===USER.USER_ID)n.setAddState(e,t);else{var s,a=e.data();Events.ready(Events.user.userReady,function(){userData.isFavorite(t.type,t.id)?(s="click_item",n.setRemoveState(e,t)):(s="add_to_favorite",n.setAddState(e,t)),"feed"===a.tracking&&(a.trackingTag=s)})}}catch(i){error.log(i)}},setAddState:function(e,t){try{if(e.data({favorite:1,type:t.type,id:t.id}).addClass("evt-click").removeClass("selected"),1===a(".label",e).length){var s=button_multi_state.getWording(a.extend({action:"favorite"},t),"add","full");a(".label",e).text(s)}return!0}catch(i){error.log(i)}},setRemoveState:function(e,t){try{if(e.data({favorite:1,type:t.type,id:t.id}).addClass("selected evt-click"),1===a(".label",e).length){var s=button_multi_state.getWording(a.extend({action:"favorite"},t),"hover","full");a(".label",e).text(s)}return!0}catch(i){error.log(i)}},display:function(){},onChangeStatus:function(e,t){try{var s=a('body button[data-favorite="1"][data-type="'+t.type+'"][data-id="'+t.id+'"]');s.each(function(){a(this).replaceWith(button_multi_state.draw(a(this).data()))});var i=a('.thumbnail .options[data-type="'+t.type+'"][data-id="'+t.id+'"] .options-favorite');return i.each(function(){var s=a(this).find(".icon-love"),i="USER.addFavorite"===e.namespace?"addClass":"removeClass";s[i]("active");var n=r("USER.addFavorite"===e.namespace?"Retirer de Ma musique":"Ajouter à Ma musique");"song"===t.type&&(n=r("USER.addFavorite"===e.namespace?"Retirer des Coups de cœur":"Ajouter aux Coups de cœur")),s.attr("title",n)}),!0}catch(n){error.log(n)}}};t.exports=n},{"./i18n":245,jquery:"jquery"}],45:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r={contextTypes:{getTrackingParams:a.PropTypes.func},tags:{player_click:["type"],context_menu_click:["type","instance"],panel_click:["panel","type","id","index","instance"],menu_click:["type"],onboarding_feed_close_click:["context"],lyrics:["ts","action","container","sng","type"],artist_page_click:["type"],discography_click:["type","position","sort","view"]},platform:{lyrics:"deezer_log"},tracking:function(e){function t(t,s){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){if("object"!=typeof this.tags[e])return!1;var s="function"==typeof this.getTrackingParams?this.getTrackingParams():{};"function"==typeof this.context.getTrackingParams&&i.extend(s,this.context.getTrackingParams());var a={};"object"==typeof t&&(a=dom.dataset(t));for(var r=0;r<this.tags[e].length;r++){var n=this.tags[e][r];"ts"!==n?"undefined"!=typeof a[n]&&null!==a[n]&&(s[n]=a[n]):s[n]=SERVER_TIMESTAMP}var o="";return"string"==typeof a.trackingCallback&&(o=this[a.trackingCallback]||""),"string"==typeof this.platform[e]&&"deezer_log"===this.platform[e]?(api.call({method:"log_central.log",data:{BATCH:[{channel:e,params:s}]}}),!0):void tracking.track(e,s,o)})};t.exports=r},{jquery:"jquery",react:"react"}],43:[function(e,t,s){"use strict";var a={sortByUpdateDate:function(e,t){var s=e.DATE_ADD||"0000-00-00 00:00:00",a=t.DATE_ADD||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},sortByCreateDate:function(e,t){var s=e.DATE_FAVORITE||e.DATE_CREATE||"0000-00-00 00:00:00",a=t.DATE_FAVORITE||t.DATE_CREATE||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},sortByReleaseDate:function(e,t){var s=e.PHYSICAL_RELEASE_DATE||"0000-00-00 00:00:00",a=t.PHYSICAL_RELEASE_DATE||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},sortByArtName:function(e,t,s){s="boolean"==typeof s?s:!1;var a=e.ART_NAME.toLowerCase().trim(),i=t.ART_NAME.toLowerCase().trim();return a===i?s?0:this.sortByAlbTitle(e,t,!0):a>i?1:-1},sortByAlbTitle:function(e,t,s){s="boolean"==typeof s?s:!1;var a=e.ALB_TITLE.toLowerCase().trim(),i=t.ALB_TITLE.toLowerCase().trim();return a===i?s?0:this.sortByArtName(e,t,!0):a>i?1:-1},sortByAppName:function(e,t){var s=e.NAME.toLowerCase().trim(),a=t.NAME.toLowerCase().trim();return s===a?0:s>a?1:-1},sortByPlaylistTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},sortByPlaylistType:function(e,t){var s=e.PARENT_USER_ID==USER.USER_ID?0:parseInt(e.STATUS,10)+1,a=t.PARENT_USER_ID==USER.USER_ID?0:parseInt(t.STATUS,10)+1,i=e.TITLE.toLowerCase(),r=t.TITLE.toLowerCase();return s===a?i===r?0:i>r?1:-1:s>a?1:-1},sortByAlbRank:function(e,t){var s=Number(e.RANK),a=Number(t.RANK);return s===a?this.sortByAlbTitle(e,t):a>s?1:-1},sortByAlbType:function(e,t){var s=Number(e.ROLE_ID),a=Number(t.ROLE_ID),i=this._getOrderAlbumType(e.TYPE),r=this._getOrderAlbumType(t.TYPE),n=Number(e.HIGHLIGHT),o=Number(t.HIGHLIGHT);return s===a?i===r?n===o?this.sortByReleaseDate(e,t):n>o?1:-1:i>r?1:-1:s>a?1:-1},sortByTopAlbum:function(e,t){var s=userData.data.TOP_ALBUMS_HASH,a="undefined"!=typeof s[e.ALB_ID]?1/(s[e.ALB_ID]+1):0,i="undefined"!=typeof s[t.ALB_ID]?1/(s[t.ALB_ID]+1):0;return a===i?this.sortByAlbTitle(e,t):i>a?1:-1},sortByTopPlaylist:function(e,t){var s=userData.data.TOP_PLAYLISTS_HASH,a="undefined"!=typeof s[e.PLAYLIST_ID]?1/(s[e.PLAYLIST_ID]+1):0,i="undefined"!=typeof s[t.PLAYLIST_ID]?1/(s[t.PLAYLIST_ID]+1):0;return a===i?this.sortByPlaylistTitle(e,t):i>a?1:-1},sortByShowName:function(e,t){var s=e.SHOW_NAME.toLowerCase().trim(),a=t.SHOW_NAME.toLowerCase().trim();return s===a?0:s>a?1:-1},sort:function i(e,t){e=e.slice(0);var s={ART_NAME:this.sortByArtName,ALB_TITLE:this.sortByAlbTitle,DATE_UPDATE:this.sortByUpdateDate,DATE_CREATE:this.sortByCreateDate,PLAYLIST_TITLE:this.sortByPlaylistTitle,PLAYLIST_TYPE:this.sortByPlaylistType,APP_NAME:this.sortByAppName,TOP_ALBUM:this.sortByTopAlbum,TOP_PLAYLIST:this.sortByTopPlaylist,SHOW_NAME:this.sortByShowName,DATE_FAVORITE:this.sortByCreateDate,RELEASE_DATE:this.sortByReleaseDate,ALB_RANK:this.sortByAlbRank,ALB_TYPE:this.sortByAlbType};if("function"==typeof s[t]){var i=e.sort(s[t]);return i}return e},_getOrderAlbumType:function(e){var t={1:0,0:2,3:1,2:3};return t[Number(e)]}};t.exports=a},{}],247:[function(e,t,s){"use strict";var a=e("react"),i=e("react-dom"),r=e("jquery"),n=e("./util"),o=e("../components/modal/sharebox/Render"),l=e("../components/modal/playlist_assistant/Render"),c=e("../components/modal/curator/tagging/Render"),p=e("../components/modal/curator/playlist/EditTag"),d=e("../components/modal/curator/playlist/EditTop"),u=e("../components/modal/multi_account/Render"),h={ShareBox:o,CuratorTagging:c,PlaylistAssistant:l,CuratorEditPlaylistTag:p,CuratorEditPlaylistTop:d,MultiAccount:u},m={$element:null,$container:null,$overlay:null,opened:!1,ready:!1,react_elem:null,transition:150,init:function(){try{m.$element=r(".modal"),m.$container=r(".modal-wrapper",m.$element),m.$overlay=r(".modal-backdrop",m.$element),m.$element.on("click",function(e){var t=r(e.target);("modal"===t.attr("id")||"modal-wrapper"===t.attr("class"))&&m.close()}),Events.subscribe(Events.navigation.modal_open,function(e,t){var s=document.getElementById("modal_"+t.div);if(s){m.setReactElement(t.div);var r=a.createFactory(h[t.modal_type]);i.render(r(t),s)}}),Events.subscribe(Events.navigation.modal_close,m.close),m.ready=!0}catch(e){error.log(e)}},open:function(e,t,s){try{m.ready!==!0&&m.init(),"/"!==e.charAt(0)&&"http"!==e.substr(0,4)&&(error.log({message:"path not valid",description:"modal.open: / is missing in your path "+e}),e="/"+e),"function"==typeof r.facebox&&r.facebox.close(),"undefined"==typeof t&&(t=!1);var a="GET";if("undefined"!=typeof arguments[2]&&r.isPlainObject(arguments[2])&&(s=arguments[2],a="POST"),m.opened===!0&&t===!1)return!1;m.requesting===!0&&(m.lastRequest.abort(),m.requesting=!1);var i=n.uniqid();return"undefined"!=typeof window.dataLayer&&window.dataLayer.push({event:"modal.open="+e}),LAYOUT.is_standalone||"web"!==PLATFORM?window.location=e:(m.requesting=!0,"GET"===a?m.lastRequest=r.get(e,OFFLINE?{}:{modal:"1"}).done(function(t){m.doneCallback(t,e)}).always(m.alwaysCallback):(e+=(-1===e.indexOf("?")?"?":"&")+"modal=1",m.lastRequest=r.post(e,s).done(function(t){m.doneCallback(t,e)}).always(m.alwaysCallback))),m.$element.data("uniqid",i),i}catch(o){error.log(o)}},close:function(){try{return m.ready!==!0&&m.init(),m.opened===!1&&"web"===PLATFORM?!1:(m.opened=!1,m.$element.removeClass("opened"),window.setTimeout(function(){var e=document.getElementById("modal_"+m.react_elem);e?i.unmountComponentAtNode(e):m.$container.html(""),m.react_elem=null,m.bindBackButton(!1),m.$element.hide()},m.transition),Events.trigger(Events.modal.close,m.$element.data("uniqid")),!0)}catch(e){error.log(e)}},doneCallback:function(e,t){m.opened=!0,m.$container.html(e),m.$element.show(),m.bindBackButton(!0),window.setTimeout(function(){m.$element.addClass("opened")},0),Events.trigger(Events.navigation.modal_displayed,{modal:t})},alwaysCallback:function(){m.requesting=!1},setReactElement:function(e){m.react_elem=String(e||"")},bindBackButton:function(e){e=Boolean(e),r(document).on("keydown",function(t){e&&8===t.which&&!r(t.target).is("input, textarea")&&t.preventDefault()})}};t.exports=m},{"../components/modal/curator/playlist/EditTag":168,"../components/modal/curator/playlist/EditTop":169,"../components/modal/curator/tagging/Render":170,"../components/modal/multi_account/Render":171,"../components/modal/playlist_assistant/Render":172,"../components/modal/sharebox/Render":176,"./util":250,jquery:"jquery",react:"react","react-dom":"react-dom"}],250:[function(e,t,s){"use strict";var a=e("jquery"),i={findPos:function(e){var t=0,s=0;if(e&&e.offsetParent)do t+=e.offsetLeft,s+=e.offsetTop,e=e.offsetParent;while(e);return[t,s]},getPageScroll:function(){var e,t;return self.pageYOffset?(t=self.pageYOffset,e=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,e=document.body.scrollLeft),[e,t]},findPosRelativeToViewport:function(e){var t=this.findPos(e),s=this.getPageScroll();return[t[0]-s[0],t[1]-s[1]]},range:function r(e,t){var r=t-e+1;return Math.floor(Math.random()*r+e)},getOuterHTML:function(e){var t=e.attr("outerHTML");if("undefined"==typeof t){var s=a("<p></p>");s.append(e.clone()),t=s.html(),s.remove()}return t},uniqid:function(e){var t;"undefined"==typeof e&&(e=7),e=Math.max(7,Math.floor(e));var s=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed+=3,t=s(parseInt((new Date).getTime()/1e3,10),10),t+=s(this.php_js.uniqidSeed,7)},detectFlash:function(e,t){var s,a,i,r,n="not_installed",o="blocking",l="too_old";if(document.hasFocus()===!1){var c=function h(){window.removeEventListener("focus",h),window.util.detectFlash(e,t)};return void window.addEventListener("focus",c)}if(i="ActiveXObject"in window&&"Pan"in new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"),a="plugins"in window.navigator&&"Shockwave Flash"in window.navigator.plugins||i,!a)return void t(n);if(!e||!("Pan"in e)&&!i)return void t(o);var p=e.style.cssText,d=document.documentElement,u=function(){d.contains(e)?e.style.cssText!==p&&(r=o):r=o,r||(s=deconcept.SWFObjectUtil.getPlayerVersion(),s=parseFloat(s.major+"."+s.minor),(!s||s<dzPlayer.minimumFlashVersion)&&(r=l)),t(r,s)};setTimeout(u,10)}};t.exports=i},{jquery:"jquery"}],176:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../core/i18n"),n=r.gettext,o=e("./_elements/NavTab"),l=e("./_elements/FriendsView"),c=e("./_elements/SocialButton"),p=e("./_elements/ShareButton"),d=e("../../common/Thumbnail"),u=a.createClass({displayName:"ShareBox",propTypes:{id:a.PropTypes.number.isRequired,type:a.PropTypes.number.isRequired,data:a.PropTypes.object.isRequired,options:a.PropTypes.object},getDefaultProps:function(){return{id:null,type:null,data:{},options:{}}},getInitialState:function(){return{tabs:!1,context:"all",message:"",selected:[],friends:[],display:this._getFriendsMaxDisplay()}},componentWillMount:function(){this._setCurrentRefKey(),this._setClipboardUrl()},componentDidMount:function(){this._setTabsDisplay(),this._renderGGPlus(),this._resizeView()},render:function(){if(!this._getCurrentRefKey())return null;var e=this._getTitle(),t=null,s=null,r={type:this._getCurrentRefKey(),md5:this._getPictureMd5(),picture_type:this._getPictureType()};"sradio"===r.type&&(r.type="artist");var c=i({"share-message":!0,"form-control":!0,"form-control-block":!0,open:Boolean(this.state.message)});return this.props.data.SUBTITLE&&(t=a.createElement("div",{className:"heading-2-sub ellipsis",id:"share-subtitle"},n("par")+" "+this.props.data.SUBTITLE)),this._checkOption("standalone")||(s=a.createElement("div",{className:"share-action"},a.createElement("button",{ref:"copyToClipboard",className:"btn btn-default",type:"button",onMouseEnter:this._instantiateZC},a.createElement("span",{className:"label"},n("Copier l'URL Deezer"))),this._checkOption("embed")?a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onEmbedClick},a.createElement("span",{className:"icon icon-embed"})):null)),a.createElement("div",null,a.createElement("div",{className:"modal-header"},e),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"share-content share-infos"},a.createElement("div",{className:"share-thumbnail"},a.createElement(d,{id:Number(this.props.id),type:r.type,md5:r.md5,overlay:!1,picture_type:r.picture_type,multi_cover:!0,height:120,width:120})),a.createElement("div",{className:"share-thumbnail-infos"},a.createElement("div",{className:"heading-2 ellipsis",id:"share-title"},this.props.data.TITLE),t,s)),a.createElement("div",{className:"share-nav clearfix"},this.state.tabs?this._getTabs().map(function(e,t){return a.createElement(o,{key:e.type+"_"+t,type:e.type,text:e.text,context:this.state.context,switchCurrentTab:this._switchCurrentTab})}.bind(this)):null),a.createElement("div",{className:"share-content share-followers"},this.state.tabs?a.createElement(l,{friends:this.state.friends,display:this.state.display,visible:"friends"===this.state.context,selected:this.state.selected,max:this._getSelectedMaxDisplay(),standalone:this._checkOption("standalone"),removeLastFriend:this._removeLastFriend,displayMoreFriends:this._displayMoreFriends,updateFriendsList:this._updateFriendsList,toggleFriend:this._toggleFriend}):null,a.createElement("textarea",{ref:"shareMessage",maxLength:this._getShareMessageMaxLength(),placeholder:n("Ajouter un message..."),className:c,onKeyPress:this._checkMessageInput,onChange:this._updateMessage}))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},this._renderSocialButton()),a.createElement(p,{enabled:this._isShareEnabled(),shareElement:this._shareElement})))},_renderSocialButton:function(){if(!this._hasAllowedPlatforms())return null;var e=[];return this._checkOption("standalone")||e.push(a.createElement("span",{className:"btn btn-label",key:"social-buttons-label"},n("Partager aussi sur :"))),e.push(this._getPlatforms().map(function(e,t){return a.createElement(c,{key:e.name+"_"+t,platform:e.name,allowed:this._isPlatformAllowed(e.name),enabled:this._isPlatformEnabled(e.key),registered:this._isPlatformRegistered(e.name),togglePlatformBtn:this._togglePlatformBtn.bind(this,e)})}.bind(this))),e},_renderGGPlus:function(){this._checkOption("standalone")||"undefined"==typeof gapi||window.gapi.interactivepost.render("share-btn-publish-google",{contenturl:this.props.data.URL,clientid:window.googleplus.getAppData().client_id,cookiepolicy:window.googleplus.getAppData().cookie_policy,calltoactionlabel:"LISTEN",calltoactionurl:this.props.data.URL+"?autoplay",requestvisibleactions:window.googleplus.getAppData().request_visible_actions})},_onEmbedClick:function(){var e=sharebox.idToType(this.props.type);"song"===e&&(e="tracks"),window.open(SETTING_HOST_DEVELOPERS+"/musicplugins/player?type="+encodeURIComponent(e)+"&id="+encodeURIComponent(this.props.id))},_currentRefKey:null,_shareMessageMaxLength:180,_updateMessageTimeoutFn:null,_updateMessageDelayMs:300,_friendsMaxDisplay:24,_selectedMaxDisplay:8,_resizeViewTimeoutFn:null,_resizeViewDelayMs:500,_clipboardUrl:window.SETTING_HOST_SITE,_getCurrentRefKey:function(){return this._currentRefKey},_getTitle:function(){return this._getRefKeys()[this._getCurrentRefKey()].title},_getConfirmationMessage:function(){return this._getRefKeys()[this._getCurrentRefKey()].confirmation},_getPictureMd5:function(){return this.props.data.PICTURE},_getPictureType:function(){return this.props.data.PICTURE_TYPE},_getFriendsMaxDisplay:function(){return this._friendsMaxDisplay},_getSelectedMaxDisplay:function(){return this._selectedMaxDisplay},_getShareMessageMaxLength:function(){return this._shareMessageMaxLength},_getClipboardUrl:function(){return this._clipboardUrl},_getPlatforms:function(){return[{name:"facebook",key:"facebook",fn:"login"},{name:"twitter",key:"twitter",fn:"link"},{name:"googleplus",key:"google",fn:null}]},_getTabs:function(){return[{type:"all",text:n("Tous mes followers")},{type:"friends",text:n("Choisir des followers")}]},_getRefKeys:function(){return{track:{title:n("Partager ce titre"),confirmation:n("Titre partagé !"),type:0},album:{title:n("Partager cet album"),confirmation:n("Album partagé !"),type:1},artist:{title:n("Partager cette page artiste"),confirmation:n("Page artiste partagée !"),type:2},playlist:{title:n("Partager cette playlist"),confirmation:n("Playlist partagée !"),type:3},radio:{title:n("Partager ce mix"),confirmation:n("Mix partagé !"),type:4},sradio:{title:n("Partager ce mix"),confirmation:n("Mix partagé !"),type:6},show:{title:n("Partager ce podcast"),confirmation:n("Podcast partagé !"),type:7},episode:{title:n("Partager ce podcast"),confirmation:n("Épisode partagé !"),type:8}}},_getPlatformsStatus:function(){var e={};return this._getPlatforms().map(function(t){e[t.name]=Boolean(this._isPlatformAllowed(t.name)&&this._isPlatformEnabled(t.key)&&this._isPlatformRegistered(t.name)&&this._hasAllowedPlatforms())}.bind(this)),e},_switchCurrentTab:function(e){this.setState({context:e},function(){this._resizeView()}.bind(this))},_checkMessageInput:function(e){if(13===e.which)return void e.preventDefault();var t=this.refs.shareMessage.value.trim();return t.length>=this._getShareMessageMaxLength()?void e.preventDefault():void 0},_updateMessage:function(){clearTimeout(this._updateMessageTimeoutFn);var e=this.refs.shareMessage.value.trim();this.state.message.length&&e.length||this.setState({message:e}),this._updateMessageTimeoutFn=setTimeout(function(){this.setState({message:e})}.bind(this),this._updateMessageDelayMs)},_isShareEnabled:function(){return"all"===this.state.context?this.state.tabs||!this.state.tabs&&this._hasCheckedPlatforms():this.state.selected.length||!this.state.selected.length&&this._hasCheckedPlatforms()},_isPlatformAllowed:function(e){return this._checkOption("standalone")&&("googleplus"===e||"facebook"===e&&!facebook.isScopeAllowed("publish_actions"))?!1:"googleplus"!==e||this._isPlatformRegistered(e)?!0:!1},_isPlatformEnabled:function(e){var t=Boolean(USER.SETTING[e]&&USER.SETTING[e].share_share);return t&&"facebook"===e&&!facebook.isScopeAllowed("publish_actions")?!1:t},_isPlatformRegistered:function(e){var t=Boolean(countObject(USER[e.toUpperCase()]));return"facebook"===e?Boolean(facebook.isScopeAllowed("publish_actions")&&t):t},_hasCheckedPlatforms:function(){var e=this._getPlatformsStatus();for(var t in e)if(e.hasOwnProperty(t)&&e[t]===!0)return!0;return!1},_hasAllowedPlatforms:function(){if(window.user.getMultiAccountOptions().PARENT)return!1;var e=this._getPlatforms();return this._isPlatformAllowed(e[0].name)},_togglePlatformBtn:function(e){if(!this._isPlatformRegistered(e.name)||"facebook"===e.name&&!facebook.isScopeAllowed("publish_actions")){if("googleplus"===e.name)return;var t={type:"modal",link:"/lightbox/sharebox?type="+this.props.type+"&id="+this.props.id};return"twitter"===e.name?t=this._checkOption("standalone")?t.link+"&standalone=true":www.getCurrentPath()+"?lb="+t.link:"facebook"===e.name&&(t={redirect:t}),window[e.name.toString()][e.fn.toString()](t)}var s={};s[e.key]={share_share:!USER.SETTING[e.key].share_share},userSetting.set(s,!this._checkOption("standalone")),this.forceUpdate()},_removeLastFriend:function(){var e=this.state.selected;e.length&&(e.pop(),this.setState({selected:e}))},_toggleFriend:function(e){var t=this.state.selected.indexOf(e),s=this.state.selected;return-1===t?s.push(e):s.splice(t,1),this.setState({selected:s}),!0},_displayMoreFriends:function(){if(this.state.display!==this.state.friends.length){var e=this.state.display+this._getFriendsMaxDisplay();e>this.state.friends.length&&(e=this.state.friends.length),this.setState({display:e})}},_updateFriendsList:function(e){e.sort(function(e,t){var s=(e.FIRSTNAME||"").toLowerCase(),a=(t.FIRSTNAME||"").toLowerCase();return a>s?-1:s>a?1:0}),this.setState({friends:e})},_shareElement:function(){var e=this._getPlatformsStatus(),t="all"===this.state.context?"*":this.state.selected,s=JSON.parse(JSON.stringify(this.props.options));for(var a in e)e.hasOwnProperty(a)&&(s[a]=e[a]);var i={type:this.props.type,id:this.props.id,message:this.state.message,friend_list:t,options:s};try{api.call("share.add",i,function(){if(this._checkOption("standalone"))return sharebox.close(!0);if(Events.trigger(Events.user.shareClick,{message:this._getConfirmationMessage()}),e.googleplus===!0){var t=document.getElementById("share-btn-publish-google");null!==t&&t.click()}sharebox.close()}.bind(this))}catch(r){error.log(r)}},_setCurrentRefKey:function(){var e=this._getRefKeys();for(var t in e)e.hasOwnProperty(t)&&e[t].type===this.props.type&&(this._currentRefKey=t);return Boolean(this._currentRefKey)},_checkOption:function(e){return Boolean(this.props.options[e])},_setTabsDisplay:function(){api.call("friend.getFollower",{nb:1,user_id:USER.USER_ID},function(){this.isMounted()&&this.setState({tabs:!0})}.bind(this))},_setClipboardUrl:function(){this._checkOption("standalone")||window.clipboard.getUrl(this.props.type,this.props.id,function(e){this._clipboardUrl=e}.bind(this))},_instantiateZC:function(){window.copyToClipboard(this.refs.copyToClipboard,this._getClipboardUrl(),n("L'URL a bien été copiée."))},_resizeView:function(){this._checkOption("standalone")&&(clearTimeout(this._resizeViewTimeoutFn),this._resizeViewTimeoutFn=setTimeout(function(){window.resizeTo(450,document.getElementById("modal_sharebox").offsetHeight)},this._resizeViewDelayMs))}});t.exports=u},{"../../../core/i18n":245,"../../common/Thumbnail":130,"./_elements/FriendsView":178,"./_elements/NavTab":179,"./_elements/ShareButton":181,"./_elements/SocialButton":182,classnames:"classnames",react:"react"}],182:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=a.createClass({displayName:"SocialButton",getInitialState:function(){return{enabled:this.props.enabled}},render:function(){if(!this.props.allowed)return null;var e={btn:!0,"btn-share":!0,active:this.state.enabled&&this.props.registered};e[this.props.platform]=!0;var t=i(e);return a.createElement("button",{className:t,type:"button",onClick:this._togglePlatformBtn})},_togglePlatformBtn:function(){return this.props.registered?void this.setState({enabled:!this.state.enabled},this.props.togglePlatformBtn):this.props.togglePlatformBtn()}});t.exports=r},{classnames:"classnames",react:"react"}],181:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../../core/i18n"),n=r.gettext,o=a.createClass({displayName:"ShareButton",getInitialState:function(){return{shared:!1}},render:function(){var e=i({btn:!0,"btn-large":!0,"btn-primary":!0});return a.createElement("div",{className:"notice"},a.createElement("button",{className:e,disabled:!this.props.enabled||this.state.shared,onClick:this._shareElement},a.createElement("span",{className:"label"},n("Partager"))),a.createElement("button",{id:"share-btn-publish-google",className:"none"}))},_shareElement:function(){this.props.enabled&&this.setState({shared:!0},function(){this.props.shareElement()}.bind(this))}});t.exports=o},{"../../../../core/i18n":245,classnames:"classnames",react:"react"}],179:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=a.createClass({displayName:"NavTab",render:function(){var e=i({"share-nav-tabs":!0,selected:this.props.context===this.props.type});return a.createElement("a",{className:e,onClick:this._switchCurrentTab},this.props.text)},_switchCurrentTab:function(e){e.preventDefault(),this.props.context!==this.props.type&&this.props.switchCurrentTab(this.props.type)}});t.exports=r},{classnames:"classnames",react:"react"}],178:[function(e,t,s){"use strict";var a=e("react"),i=e("react-dom"),r=e("classnames"),n=e("../../../../core/i18n"),o=n.gettext,l=e("./FriendCell"),c=e("./SelectedCell"),p=a.createClass({displayName:"FriendsView",getInitialState:function(){return{current:0,filter:"",filtered:[],loader:!0}},componentDidUpdate:function(e){this.props.visible&&this.props.visible!==e.visible&&(this.refs.inputFilterFriends.focus(),this.state.filtered.length||this.props.friends.length||!this._isGetFriendsListAllowed()||this._getFriendsList()),this.props.visible!==e.visible||this._isGetFriendsListAllowed()||this.state.filtered.length||!this.props.friends.length||this.state.filter.length||this.setState({filtered:this.props.friends})},render:function(){var e=r({"share-friends-container":!0,visible:this.props.visible}),t=parseInt(this.props.selected.length,10),s=null,i=this.props.max;if(this.props.standalone&&(i/=2),t>=parseInt(i+1,10)){var n=r({"friend-hover friends-more":!0,"cell-limit":Boolean(t-i>=10)});s=a.createElement("div",{className:"friend-thumbnail friend-removable",onClick:this._displaySelectedFriends},a.createElement("span",{className:n},"+"+(t-i>=100?99:t-i)))}return a.createElement("div",{className:e},a.createElement("form",{className:"share-friends-form",autoComplete:"off",onSubmit:this._handleSubmit},a.createElement("div",{className:"share-friends-filter form-control",id:"friends_filter"},a.createElement("div",{className:"share-friends-selected"+(t?" visible":"")},s,this._sliceSelectedFriends(this.props.selected,i).map(function(e,t){var s=this._getSelectedFriendData(e);return s?a.createElement(c,{key:"s_"+e+"_"+t,data:s,standalone:this.props.standalone,toggleFriend:this._toggleFriend}):null}.bind(this))),a.createElement("input",{id:"friends_input",type:"text",ref:"inputFilterFriends",value:this.state.filter,className:"share-friends-input form-control form-control-transparent",placeholder:o("Rechercher")+"...",onKeyUp:this._handleSearchNavigation,onChange:this._handleSearchChanged,autoComplete:"off"})),a.createElement("div",{ref:"friendsList",className:"share-friends-list",onScroll:this._displayMoreFriends},a.createElement("div",{className:"friends-loader",style:{display:this.state.loader?"block":"none"}}),this.state.filtered.slice(0,this.props.display).map(function(e,t){return a.createElement(l,{key:"f_"+e.USER_ID+"_"+t,data:e,selected:this._isFriendSelected(t),checked:this._isFriendChecked(e.USER_ID),toggleFriend:this._toggleFriend})}.bind(this)))))},_allowGetFriendsList:!0,_handleSubmit:function(e){e.preventDefault()},_handleSearchChanged:function(e){var t=e.target.value;return this.setState({current:0,filter:t,filtered:this._filterFriends(this.props.friends,t)},function(){this.refs.friendsList.scrollTop=0}.bind(this)),!0},_handleSearchNavigation:function(e){e.preventDefault();var t=e.keyCode,s=this._getNavKeys()[t],a=0,r=this.refs.friendsList,n=i.findDOMNode(this);if("undefined"!=typeof s){switch(s){case"enter":if(!this.state.filtered.length)return;return this._toggleFriend(this.state.filtered[this.state.current].USER_ID),!0;case"arrowRight":if(a=this.state.current+1,a>this.state.filtered.length-1)return;break;case"arrowLeft":if(a=this.state.current-1,0>a)return;break;case"arrowTop":a=Math.max(0,this.state.current-6);break;case"arrowBottom":a=Math.min(this.state.filtered.length-1,this.state.current+6)}this.setState({current:a},function(){var e=n.querySelector("a.selected");e&&(r.scrollTop=e.getBoundingClientRect().top-n.getBoundingClientRect().top-10)})}},_sliceSelectedFriends:function(e,t){if(e.length<=t)return e;var s=e.length-t,a=e.length-1;return(1===s||a>t&&a<e.length)&&(a=e.length),e.slice(s,a)},_removeLastFriend:function(){this.props.removeLastFriend()},_filterFriends:function(e,t){if(!t)return e;t=t.toLowerCase().trim();for(var s=[],a=-5,i=0,r=e.length;r>i;++i){var n=(e[i].BLOG_NAME||"").toLowerCase().trim(),o=(e[i].FIRSTNAME||"").toLowerCase().trim(),l=(e[i].LASTNAME||"").toLowerCase().trim(),c=n.indexOf(t)+o.indexOf(t)+l.indexOf(t)+(o+" "+l).indexOf(t)+(l+" "+o).indexOf(t);c>a&&s.push(e[i])}return s},_isFriendSelected:function(e){return Boolean(e===this.state.current)},_isFriendChecked:function(e){return Boolean(-1!==this.props.selected.indexOf(e))},_getSelectedFriendData:function(e){for(var t=this.props.friends,s=0,a=t.length;a>s;++s)if(t[s].USER_ID===e)return t[s];return null},_setGetFriendsListAllowStatus:function(e){this._allowGetFriendsList=Boolean(e)},_setFriendsDisplayShareName:function(e){if(!e.length)return e;for(var t=0,s=e.length;s>t;++t)(e[t].FIRSTNAME||"").length+(e[t].LASTNAME||"").length!==0?e[t].DISPLAY_SHARE_NAME=((e[t].FIRSTNAME||"")+" "+(e[t].LASTNAME||"")).trim():e[t].DISPLAY_SHARE_NAME=e[t].BLOG_NAME;return e},_isGetFriendsListAllowed:function(){return this._allowGetFriendsList},_getFriendsList:function(){this._setGetFriendsListAllowStatus(!1),api.call("friend.getList",{start:0,nb:2e3,user_id:USER.USER_ID},function(e){this.isMounted()&&this.setState({loader:!1},function(){e.count&&this.props.updateFriendsList(this._setFriendsDisplayShareName(e.data))})}.bind(this))},_getNavKeys:function(){return{13:"enter",37:"arrowLeft",38:"arrowTop",39:"arrowRight",40:"arrowBottom"}},_displayMoreFriends:function(){var e=this.refs.friendsList;e.scrollHeight===e.scrollTop+e.clientHeight&&this.props.displayMoreFriends()},_displaySelectedFriends:function(e){e.preventDefault()},_toggleFriend:function(e){this.props.toggleFriend(e);var t=this.refs.inputFilterFriends.value,s={filter:"",filtered:this.props.friends};t.length&&(s.current=0),this.setState(s,function(){0===s.current&&(this.refs.friendsList.scrollTop=0)}.bind(this))}});t.exports=p},{"../../../../core/i18n":245,"./FriendCell":177,"./SelectedCell":180,classnames:"classnames",react:"react","react-dom":"react-dom"}],180:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("../../../common/Thumbnail"),n=a.createClass({displayName:"SelectedCell",componentDidMount:function(){this.props.standalone||i(this.refs["tipsyFriend_"+this.props.data.USER_ID]).tipsy({gravity:"s",delayIn:10,delayOut:10,z_index:1e4})},render:function(){return a.createElement("a",{role:"button",className:"friend-thumbnail friend-removable",title:this.props.data.DISPLAY_SHARE_NAME,ref:"tipsyFriend_"+this.props.data.USER_ID,onClick:this._toggleFriend},a.createElement(r,{id:Number(this.props.data.USER_ID),md5:this.props.data.USER_PICTURE,overlay:!1,rounded:!0,type:"user",height:22,width:22}),a.createElement("div",{className:"friend-hover"},a.createElement("span",{className:"icon icon-cancel"})))},_toggleFriend:function(e){e.preventDefault(),this.props.standalone||i(this.refs["tipsyFriend_"+this.props.data.USER_ID]).tipsy("hide"),this.props.toggleFriend(this.props.data.USER_ID)}});t.exports=n},{"../../../common/Thumbnail":130,jquery:"jquery",react:"react"}],177:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../common/Thumbnail"),n=a.createClass({displayName:"FriendsCell",render:function(){var e=i({"friend-item":!0,selected:this.props.selected}),t=i({"friend-hover":!0,check:this.props.checked});return a.createElement("a",{className:e,onClick:this._toggleFriend},a.createElement("span",{className:"friend-thumbnail"},a.createElement(r,{id:Number(this.props.data.USER_ID),md5:this.props.data.USER_PICTURE,overlay:!1,rounded:!0,type:"user",height:44,width:44}),a.createElement("span",{className:t},a.createElement("span",{className:"icon icon-add"}),a.createElement("span",{className:"icon icon-check"}),a.createElement("span",{className:"icon icon-cancel"}))),a.createElement("p",{className:"friend-infos ellipsis"},this.props.data.DISPLAY_SHARE_NAME))},_toggleFriend:function(e){e.preventDefault(),this.props.toggleFriend(this.props.data.USER_ID)}});t.exports=n},{"../../../common/Thumbnail":130,classnames:"classnames",react:"react"}],172:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../core/i18n"),n=r.gettext,o=r.ngettext,l=e("./_elements/Create"),c=e("./_elements/Remove"),p=e("./_elements/Suggest"),d=a.createClass({displayName:"PlaylistAssistant",propTypes:{type:a.PropTypes.string.isRequired,playlist_id:a.PropTypes.number,sng_id:a.PropTypes.array,playlist_data:a.PropTypes.object,song_data:a.PropTypes.object},getDefaultProps:function(){return{playlist_id:null,sng_id:[],type:null,playlist_data:{},song_data:{}}},getInitialState:function(){return{creation:"create"===this.props.type,suggest:"suggest"===this.props.type,remove:!1,suggest_empty:!1,playlist_id:this.props.playlist_id,submit_disabled:!1,close_action:!1,addedTrack:0}},componentDidMount:function(){Events.trigger(Events.tips.close,"playlist_assistant"),Events.trigger(Events.navigation.context_menu_close),Events.subscribe(Events.playlist.assistantToggleValidation,this._toggleButtonStatus),Events.subscribe(Events.playlist.assistantSuggestEmpty,this._emptySuggest),Events.subscribe(Events.playlist.assistantAddedTrack,this._setAddedTrack)},componentWillUnmount:function(){Events.trigger(Events.tips.close,"playlist_assistant_suggest"),Events.unsubscribe(Events.playlist.assistantToggleValidation,this._toggleButtonStatus),Events.unsubscribe(Events.playlist.assistantSuggestEmpty,this._emptySuggest),Events.unsubscribe(Events.playlist.assistantAddedTrack,this._setAddedTrack)},render:function(){return a.createElement("div",{className:"modal-playlist-assistant",role:"dialog","aria-labelledby":"playlist-assistant-header"},a.createElement("div",{className:"modal-header",id:"playlist-assistant-header"},this._getTitle()),this._renderBody(),a.createElement("div",{className:"modal-footer"},this._renderCancelButton(),this._renderAddedTracks(),this._renderRemoveButton(),this._renderSubmitButton()))},_renderCancelButton:function(){return this.state.creation&&0===this.state.playlist_id||this.state.remove?a.createElement("button",{className:"btn btn-default pull-left",type:"button",onClick:this._onCancel},a.createElement("span",{className:"label"},n("Annuler"))):!1},_renderAddedTracks:function(){return this.state.creation||this.state.remove||this.state.suggest_empty?null:a.createElement("h5",{className:"heading-5 notice"},this.state.addedTrack+" ",o("titre sélectionné","titres sélectionnés",{count:this.state.addedTrack}))},_renderSubmitButton:function(){var e=i({"btn pull-right":!0,"btn-primary":!this.state.remove,"btn-danger":this.state.remove,disabled:this.state.submit_disabled}),t=n("Terminé !");if(this.state.creation&&(t=n("Créer"),this.props.playlist_id>0&&(t=n("Enregistrer"))),this.state.remove&&(t=n("Supprimer")),this.state.suggest_empty){if(!this.state.close_action)return!1;t=n("Fermer")}return a.createElement("button",{id:"modal_playlist_assistant_submit",type:"button",className:e,onClick:this._onSubmit},a.createElement("span",{className:"label"},t))},_renderRemoveButton:function(){return this.state.creation&&0!==this.props.playlist_id?a.createElement("button",{type:"button",className:"btn btn-default",onClick:this._onRemove},a.createElement("span",{className:"label"},n("Supprimer cette playlist"))):null},_renderBody:function(){return this.state.creation?a.createElement(l,{playlist_data:this.props.playlist_data,song_data:this.props.song_data,playlist_id:this.props.playlist_id,sng_id:this.props.sng_id}):this.state.remove?a.createElement(c,{playlist_data:this.props.playlist_data,playlist_id:this.props.playlist_id}):a.createElement(p,{playlist_id:this.state.playlist_id,cold_start:0===this.props.playlist_data.NB_SONG})},_onSubmit:function(e){return this.state.submit_disabled?void e.preventDefault():void Events.trigger(Events.playlist.assistantValidation,{})},_onRemove:function(){this.setState({remove:!0,creation:!1})},_onCancel:function(){return this.state.remove?void this.setState({remove:!1,creation:!0}):void Events.trigger(Events.navigation.modal_close)},_getTitle:function(){return n(this.state.creation?0===this.props.playlist_id?"Créer une playlist":"Éditer la playlist":this.state.remove?"Vous êtes sûr ?":"Suggestions de titres")},_setAddedTrack:function(e,t){this.setState({addedTrack:t.nb})},_toggleButtonStatus:function(){this.setState({submit_disabled:!this.state.submit_disabled})},_emptySuggest:function(e,t){this.setState({suggest_empty:!0,close_action:t.close})}});t.exports=d},{"../../../core/i18n":245,"./_elements/Create":173,"./_elements/Remove":174,"./_elements/Suggest":175,classnames:"classnames",react:"react"}],175:[function(e,t,s){"use strict";var a=e("react"),i=e("../../../../core/i18n"),r=i.gettext,n=e("../../../common/Thumbnail"),o=a.createClass({displayName:"Suggest",propTypes:{playlist_id:a.PropTypes.number.isRequired,cold_start:a.PropTypes.bool},getDefaultProps:function(){return{playlist_id:0,cold_start:!1}},getInitialState:function(){return{track_list:null,track_index:0,loading:!1,playing_ads:"ads"===dzPlayer.getPlayerType()}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.player.tracklist_changed,this._onPlaySuggest),USER.OPTIONS.ads_audio&&(Events.subscribe(Events.player.finishAds,this._onAdsFinish),Events.subscribe(Events.player.changePlayerType,this._onChangePlayerType)),this._displaySong()},componentWillUnmount:function(){(this._dislikedSong.length>0||this._likedSong.length>0)&&api.call({method:"deezer.playlist_assistant",data:{playlist_id:this.props.playlist_id,liked_tracks:this._likedSong,banned_tracks:this._dislikedSong,nb:0}}),this._playedSuggest&&dzPlayer.restoreTrackList(),Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.player.tracklist_changed,this._onPlaySuggest),USER.OPTIONS.ads_audio&&(Events.unsubscribe(Events.player.finishAds,this._onAdsFinish),Events.unsubscribe(Events.player.changePlayerType,this._onChangePlayerType))},render:function(){if(null===this.state.track_list||this.state.loading)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"});if(0===this.state.track_list.length)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content suggest-empty"},a.createElement("div",{className:"placeholders-img nocontent"}),a.createElement("div",{className:"placeholders-title"},r("Désolé..."),a.createElement("div",{className:"placeholders-title"},r(0===this._trackListGroup?"Nous n'avons pas encore de suggestions pour vous. Écoutez de la musique et revenez plus tard !":"Nous n'avons plus de suggestions en stock, revenez plus tard !")),this._trackListGroup>0&&this._nbAddedTrack>0?a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._onPlayPlaylist},a.createElement("span",{className:"label"},r("Écouter la playlist"))):!1)));if(this.state.playing_ads)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content suggest-empty"},a.createElement("div",{className:"placeholders-img nocontent"}),a.createElement("div",{className:"placeholders-title"},r("Merci de patienter")),a.createElement("div",{className:"placeholders-title"},r("Publicité"))));var e=this.state.track_list[this.state.track_index];return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement("div",{className:"thumbnail-bg"},a.createElement(n,{type:"track",height:250,width:250,id:Number(e.SNG_ID),play_data:[e],md5:e.ALB_PICTURE,overlay:!1,play:!0,play_force:!0,cover_link:!1,context:"track_assistant"})),a.createElement("div",{className:"playlist-info"},this._renderTrackSource(e),a.createElement("h2",{className:"heading-2 ellipsis",title:e.SNG_TITLE},e.SNG_TITLE),a.createElement("h3",{className:"heading-2-sub ellipsis"},r("par")+" "+e.ART_NAME),a.createElement("a",{className:"suggest-action",onClick:this._dislike,role:"button"},a.createElement("span",{className:"icon-64 icon-stack icon-stack-circle icon-stack-hover icon-stack-cancel"},a.createElement("span",{className:"icon icon-cancel"}))),a.createElement("a",{className:"suggest-action",onClick:this._like,role:"button"},a.createElement("span",{className:"icon-64 icon-stack icon-stack-circle icon-stack-hover icon-stack-check"},a.createElement("span",{className:"icon icon-check-light"}))))))},_renderTrackSource:function(e){var t=r("Recommandé pour cette playlist");return"USER_HISTORY"===e.DATA_SOURCE?t=r("Écouté récemment"):"USER_FAVORITE"===e.DATA_SOURCE&&(t=r("Choisi dans vos coups de cœur")),a.createElement("div",{className:"suggest-source"},t)},_onSubmit:function(){this._nbAddedTrack>0&&Events.trigger(Events.playlist.assistantSuggestFinish,{count:this._nbAddedTrack}),Events.trigger(Events.navigation.modal_close)},_onPlayPlaylist:function(){dzPlayer.play({type:"playlist",id:this.props.playlist_id})},_onPlaySuggest:function(){"track_assistant"===dzPlayer.getContext("TYPE")&&(this._playedSuggest=!0)},_onAdsFinish:function(){this.setState({playing_ads:!1})},_onChangePlayerType:function(e,t){this.setState({playing_ads:"ads"===t})},_likedSong:[],_dislikedSong:[],_nbAddedTrack:0,_trackListGroup:0,_playedSuggest:!1,_like:function(){var e=this.state.track_list[this.state.track_index];this._likedSong.push({SNG_ID:e.SNG_ID,PRODUCT_TRACK_ID:e.PRODUCT_TRACK_ID,DATA_SOURCE:e.DATA_SOURCE,ALGO_VERSION:e.ALGO_VERSION}),userData.addPlaylistSong(this.props.playlist_id,[[this.state.track_list[this.state.track_index].SNG_ID,0]],{notify:!1}),this.props.cold_start===!0&&0===this._nbAddedTrack?this._loadSong():this._displaySong(),this._nbAddedTrack++,Events.trigger(Events.playlist.assistantAddedTrack,{nb:this._nbAddedTrack})},_dislike:function(){var e=this.state.track_list[this.state.track_index];this._dislikedSong.push({SNG_ID:e.SNG_ID,PRODUCT_TRACK_ID:e.PRODUCT_TRACK_ID,DATA_SOURCE:e.DATA_SOURCE,ALGO_VERSION:e.ALGO_VERSION}),this._displaySong()},_displaySong:function(){null===this.state.track_list||this.state.track_list.length-1===this.state.track_index?this._loadSong():this.setState({track_index:this.state.track_index+1},this._displaySongCallback)},_loadSong:function(){this.setState({loading:!0},function(){api.call({method:"deezer.playlist_assistant",data:{playlist_id:this.props.playlist_id,liked_tracks:this._likedSong,banned_tracks:this._dislikedSong},error:function(){Events.trigger(Events.navigation.modal_close)},success:function(e){this.isMounted()&&(this._likedSong=[],this._dislikedSong=[],this._trackListGroup++,0===e.data.length&&Events.trigger(Events.playlist.assistantSuggestEmpty,{close:0===this._trackListGroup}),this.setState({track_index:0,track_list:e.data,loading:!1},this._displaySongCallback))}.bind(this)})}.bind(this))},_displaySongCallback:function(){4===this.state.track_index&&Events.trigger(Events.tips.draw,{name:"playlist_assistant_suggest",check:!0});var e=this.state.track_list[this.state.track_index];this._playedSuggest&&dzPlayer.play({type:"track",autoplay:dzPlayer.playing,id:e.SNG_ID,saveCurrentTrackList:!1,context:{ID:e.SNG_ID,TYPE:"track_assistant"},data:[e]})}});t.exports=o},{"../../../../core/i18n":245,"../../../common/Thumbnail":130,react:"react"}],174:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../../core/i18n"),n=r.gettext,o=e("../../../common/Thumbnail"),l=a.createClass({displayName:"Remove",propTypes:{playlist_id:a.PropTypes.number.isRequired,playlist_data:a.PropTypes.object.isRequired},getDefaultProps:function(){return{playlist_id:0,playlist_data:{}}},getInitialState:function(){return{error:!1}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit)},render:function(){var e=i({"form-group":!0,"has-error":this.state.error!==!1});return a.createElement("div",{className:"modal-body playlist-assistant-create"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement(o,{id:this.props.playlist_id,type:"playlist",md5:this.props.playlist_data.PLAYLIST_PICTURE,picture_type:this.props.playlist_data.PICTURE_TYPE,height:200,width:200,height_img:200,width_img:200,bordered:!0,cover_link:!1,overlay:!1,multi_cover:!0}),a.createElement("div",{className:"playlist-info"},a.createElement("h2",{className:"heading-4"},n("Entrez le nom de votre playlist, nous voulons juste vérifier que vous n'allez pas faire une bêtise.")),a.createElement("div",{className:e},a.createElement("input",{className:"form-control",ref:"confirm_playlist_title",type:"text",placeholder:n("Nom de la playlist")}),this.state.error?a.createElement("label",{className:"control-label"},n("Le nom saisi ne correspond pas à celui de votre playlist.")):null))))},_onSubmit:function(){return this.refs.confirm_playlist_title.value.toLowerCase()!==this.props.playlist_data.TITLE.toLowerCase()?void this.setState({error:!0}):(userData.removePlaylist({id:this.props.playlist_data.PLAYLIST_ID}),void Events.trigger(Events.navigation.modal_close))}});t.exports=l},{"../../../../core/i18n":245,"../../../common/Thumbnail":130,classnames:"classnames",react:"react"}],173:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../../core/i18n"),n=r.gettext,o=e("../../../common/Thumbnail"),l=a.createClass({displayName:"Create",propTypes:{playlist_id:a.PropTypes.number.isRequired,sng_id:a.PropTypes.array,tags:a.PropTypes.array,playlist_data:a.PropTypes.object,song_data:a.PropTypes.object},getDefaultProps:function(){return{playlist_id:0,sng_id:[],tags:[],playlist_data:{},song_data:{}}},getInitialState:function(){return{is_private:1===Number(this.props.playlist_data.STATUS)||3===Number(this.props.playlist_data.STATUS),is_collab:2===Number(this.props.playlist_data.STATUS)||3===Number(this.props.playlist_data.STATUS),title:this.props.playlist_data.TITLE||this._getDefaultTitle(),description:this.props.playlist_data.DESCRIPTION||"",playlist_picture:this.props.playlist_data.PLAYLIST_PICTURE,playlist_picture_type:this.props.playlist_data.PICTURE_TYPE,playlist_picture_data:!1,title_error:!1}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.playlist.updatePicture,this._onUpdatePicture)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.playlist.updatePicture,this._onUpdatePicture)},render:function(){var e=i({"form-control form-control-block playlist-description":!0,open:""===this.state.description?!1:this.state.description.length>0}),t=i({"playlist-info":!0,"has-error":this.state.title_error});return a.createElement("div",{className:"modal-body playlist-assistant-create"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement(o,{id:this.props.playlist_id,type:"playlist",md5:this.state.playlist_picture,picture_type:this.state.playlist_picture_type,height:200,width:200,height_img:200,width_img:200,bordered:!0,upload_cover:!0,multi_cover:!0,overlay_force:!0,data_uri:this.state.playlist_picture_data}),a.createElement("input",{className:"hide",accept:"image/*",id:"naboo_playlist_image_upload",name:"file",type:"file"}),a.createElement("div",{className:t},a.createElement("h2",{className:"heading-4"},n(0===this.props.playlist_id?"Pour lui donner un nom, c'est par ici :":"Pour changer son nom, c'est par ici :")),a.createElement("input",{className:"form-control form-control-block",type:"text",maxLength:"50",placeholder:n("Nom de la playlist"),onChange:this._onChangeTitle,value:this.state.title}),this.state.title_error?a.createElement("div",{className:"alert alert-danger"},n("Votre playlist mérite d'avoir un nom !")):!1,a.createElement("div",{className:"form-inline"},a.createElement("div",{className:"form-group"},a.createElement("span",{className:"form-checkbox playlist-option"},a.createElement("label",{htmlFor:"private"},a.createElement("input",{id:"private",type:"checkbox",checked:this.state.is_private,onChange:this._onChangePrivate}),a.createElement("span",null,n("Privée")," "),a.createElement("span",{className:"playlist-option-help"},n("(cette playlist ne sera visible que par vous)")))))),a.createElement("div",{className:"form-inline"},a.createElement("div",{className:"form-group"},this.props.playlist_id>0?a.createElement("span",{className:"form-checkbox playlist-option"},a.createElement("label",{htmlFor:"collab"},a.createElement("input",{id:"collab",type:"checkbox",checked:this.state.is_collab,onChange:this._onChangeCollab}),n("Collaborative")),this.state.is_collab&&0!==this.props.playlist_id?a.createElement("input",{className:"form-control form-collab",type:"text",readOnly:"readonly",onClick:this._onSelectInput,value:SETTING_HOST_SITE+"/sharedplaylist-"+this.props.playlist_id+"-"+this.props.playlist_data.COLLAB_KEY}):!1):!1)))),a.createElement("div",{className:"playlist-content"},a.createElement("h2",{className:"heading-4"},n("Parlez-nous un peu de cette playlist...")),a.createElement("textarea",{name:"playlist-description",maxLength:"200",className:e,placeholder:n("Saisir une description (optionnel)"),onChange:this._onChangeDescription,value:this.state.description})))},_onUpdatePicture:function(e,t){return"base64"===t.type?(this.setState({playlist_picture_data:t.data}),!0):0===this.props.playlist_id?(www.navigate("/playlist/"+t.element_id),Events.trigger(Events.navigation.modal_close),!0):void this.setState({playlist_picture:t.md5,playlist_picture_type:t.type})},_onChangePrivate:function(e){this.setState({is_private:e.target.checked})},_onChangeCollab:function(e){this.setState({is_collab:e.target.checked})},_onChangeTitle:function(e){this.setState({title:e.target.value})},_onChangeDescription:function(e){this.setState({description:e.target.value})},_onSelectInput:function(e){e.target.select()},_onSubmit:function(){if(this.setState({title_error:""===window.trim(this.state.title)}),""===window.trim(this.state.title))return!1;Events.trigger(Events.playlist.assistantToggleValidation);var e=0;this.state.is_collab&&(e+=2),this.state.is_private&&(e+=1);var t="";this.state.description&&(t+=this.state.description);var s={title:window.trim(this.state.title),description:t,status:e};if(0===this.props.playlist_id){if(s.tags=this.props.tags,this.props.sng_id.length>0){s.songs=[];for(var a=0;a<this.props.sng_id.length;a++)s.songs[a]=[this.props.sng_id[a],this.props.sng_id[a]>0?0:1]}userData.createPlaylist(s,this._validateCallback)}else s.playlist_id=this.props.playlist_id,userData.updatePlaylist(s,this._validateCallback)},_getDefaultTitle:function(){var e="";if(1===this.props.tags.length){for(var t=this.props.tags[0],s=t.split("_"),a=0;a<s.length;a++)s[a]=window.ucfirst(s[a]);e=s.join(" ")}return this.props.sng_id.length>0&&(e=this.props.song_data.ART_NAME),e},_validateCallback:function(e){if("string"==typeof e){if(this.state.playlist_picture_data!==!1)return Events.trigger(Events.playlist.uploadPicture,{id:e}),!1;www.navigate("/playlist/"+e)}return Events.trigger(Events.navigation.modal_close),!1}});t.exports=l},{"../../../../core/i18n":245,"../../../common/Thumbnail":130,classnames:"classnames",react:"react"}],171:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../core/i18n"),n=r.gettext,o=a.createClass({displayName:"MultiAccount",propTypes:{currentView:a.PropTypes.string,maxChildren:a.PropTypes.number,offerEnabled:a.PropTypes.bool,offerActive:a.PropTypes.bool,accountsList:a.PropTypes.array},getDefaultProps:function(){return{currentView:"switch",maxChildren:0,offerEnabled:!1,offerActive:!1,accountsList:[]}},getInitialState:function(){return{currentUserId:user.current(),currentView:this._checkIncomingView(this.props.currentView),accountsList:this.props.accountsList,pendingAction:!1}},render:function(){return 0===this.state.currentUserId||0===this.state.accountsList.length?null:a.createElement("div",{className:"modal-multi-profil-switch",role:"dialog","aria-labelledby":"multi-profile-switch"},a.createElement("div",{id:"multi-profile-switch",className:"modal-header"},n("Changer de profil")),a.createElement("div",{className:"modal-body"},"create"===this.state.currentView?this._renderCreateView():this._renderSwitchView()))},_renderCreateView:function(){return a.createElement("div",{className:"multi-profile-create-view"},a.createElement("form",{onSubmit:this._createChild,className:"family-create-form",method:"post"},a.createElement("div",{className:"form-group"},a.createElement("p",{className:"family-create-label"},n("Nouveau profil"))),a.createElement("div",{className:"form-group"},a.createElement("input",{ref:"newChildName",disabled:this.state.pendingAction,className:"form-control form-control-block",placeholder:n("Nom d'utilisateur"),type:"text"})),a.createElement("div",{className:"form-group"},a.createElement("div",{className:"form-checkbox"},a.createElement("label",null,a.createElement("input",{ref:"forKids",disabled:this.state.pendingAction,type:"checkbox"}),n("Enfant ?")))),a.createElement("div",{className:"family-create-footer clearfix"},a.createElement("button",{disabled:this.state.pendingAction,className:"btn btn-primary pull-right",type:"submit"},a.createElement("span",{className:"label"},n("Créer"))),a.createElement("button",{disabled:this.state.pendingAction,className:"btn btn-default",type:"button",onClick:this._switchCurrentView.bind(this,"switch")},a.createElement("span",{className:"label"},n("Annuler"))))))},_renderSwitchView:function(){return a.createElement("div",{className:"multi-profile-switch-view"},this.props.offerActive?null:a.createElement("div",{className:"family-label"},n("Vous ne bénéficez plus de l'offre %1$s. Pour retrouver l'accès à tous vos profils, réabonnez-vous.",{sprintf:[window.user.getOfferEligibilities().name]})),a.createElement("ul",{className:"family-list"},this.state.accountsList.map(function(e,t){var s={"family-item":!0,"is-main":this._isSameUser(e.USER_ID),"is-kid":e.IS_KID,"is-disabled":null!==e.PARENT_ID&&!this.props.offerActive};return a.createElement("li",{key:"user."+e.USER_ID,className:i(s),onClick:this._switchToProfile.bind(this,e.USER_ID)},a.createElement("span",{className:"family-picture"},a.createElement("img",{src:SETTING_DOMAIN_IMG+"/user/"+e.USER_PICTURE+"/56x56.jpg"})),this.props.offerActive?a.createElement("span",{className:"family-actions"},this._isSameUser(e.USER_ID)?a.createElement("span",{className:"family-action"},a.createElement("span",{className:"icon icon-check"})):a.createElement("span",{className:"family-action modal_family_switch"},a.createElement("span",{className:"icon icon-arrow-right"})),null===e.PARENT_ID||this._isSameUser(e.USER_ID)?null:a.createElement("span",{className:"family-action is-hidden modal_family_delete",onClick:this._deleteChild.bind(this,e.USER_ID,e.BLOG_NAME,t)},a.createElement("span",{className:"icon icon-trash"}))):a.createElement("span",{className:"family-actions"},null===e.PARENT_ID||this._isSameUser(e.USER_ID)?null:a.createElement("span",{className:"family-action is-hidden modal_family_delete",onClick:this._deleteChild.bind(this,e.USER_ID,e.BLOG_NAME,t)},a.createElement("span",{className:"icon icon-trash"}))),this.props.offerActive||null!==e.PARENT_ID?null:a.createElement("span",{className:"family-upgrade"},a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._openOffers},a.createElement("span",{className:"label"},n("Passer à %1$s",{sprintf:[window.user.getOfferEligibilities().name]})))),a.createElement("dl",{className:"family-infos"},a.createElement("dt",null,e.BLOG_NAME),null===e.PARENT_ID?a.createElement("dd",null,n("Compte principal")):a.createElement("dd",null,n(e.IS_KID?"Profil secondaire - Deezer Kids":"Profil secondaire"))))}.bind(this)),this._isCreateAllowed()?a.createElement("li",{className:"family-item",onClick:this._switchCurrentView.bind(this,"create")},a.createElement("span",{className:"family-picture"},a.createElement("span",{className:"icon icon-add"})),a.createElement("span",{className:"family-create"},n("Nouveau profil"))):null),a.createElement("div",{className:"family-help"},a.createElement("a",{href:"http://support.deezer.com/",target:"_blank"},n("Aide"))))},_getErrorMessage:function(e){e=window.isPlainObject(e)?e:{};var t=e.payload||{},s=e.description||"";return t.message?t.message:"blogname_too_short"===s?n("Votre pseudo doit comporter au moins 2 caractères."):s},_checkIncomingView:function(e){return"create"!==e||this._isCreateAllowed()?e:"switch"},_isSameUser:function(e){return isNaN(e)||Number(e)===this.state.currentUserId},_isCreateAllowed:function(){return this.props.offerActive&&this.state.accountsList.length-1<this.props.maxChildren},_switchCurrentView:function(e,t){t.stopPropagation(),this.setState({currentView:this._checkIncomingView(e)})},_switchToProfile:function(e){e=Number(e),this.props.offerActive&&!this._isSameUser(e)&&window.user.loginMulti(e,function(e){return e?void alert(this._getErrorMessage(e)):void window.user.refreshPageAfterLogin({type:"refresh",link:"/"})}.bind(this))},_createChild:function(e){e.preventDefault(),this._isCreateAllowed()&&!this.state.pendingAction&&this.setState({pendingAction:!0},function(){var e=this.refs.newChildName.value.trim();if(!e.length)return this.setState({pendingAction:!1});var t=Boolean(this.refs.forKids.checked);window.user.createChild({blog_name:e,is_kid:t},function(s,a){if(s)return alert(this._getErrorMessage(s)),this.setState({pendingAction:!1});a=Number(a);var i=this.state.accountsList.slice(0);i.push({USER_ID:a,USER_PICTURE:"",BLOG_NAME:e,IS_KID:t}),this.setState({accountsList:i,currentView:this._checkIncomingView("switch"),pendingAction:!1})}.bind(this))}.bind(this))},_deleteChild:function(e,t,s,a){if(a.stopPropagation(),!this._isSameUser(e)&&!this.state.pendingAction){var i=n("Êtes-vous sûr(e) de vouloir supprimer ce profil ?")+"\n"+n("Vous ne pourrez pas revenir en arrière.");confirm(i)&&this.setState({pendingAction:!0},function(){window.user.deleteChild(e,function(e,t){if(e)return alert(this._getErrorMessage(e)),this.setState({pendingAction:!1});var a=this.state.accountsList.slice(0);a.splice(s,1),this.setState({accountsList:a,pendingAction:!1})}.bind(this))}.bind(this))}},_openOffers:function(e){e.stopPropagation(),window.location.href=window.user.getOfferEligibilities().uri}});t.exports=o},{"../../../core/i18n":245,classnames:"classnames",react:"react"}],170:[function(e,t,s){"use strict";var a=e("react"),i=e("../../../common/Thumbnail"),r=e("../../../common/TagList"),n=a.createClass({displayName:"CuratorTagging",propTypes:{item:a.PropTypes.object.isRequired,type:a.PropTypes.oneOf(["song","artist","album"]).isRequired,itemTags:a.PropTypes.array.isRequired,allTags:a.PropTypes.arrayOf(a.PropTypes.shape({TAG_ID:a.PropTypes.string.isRequired,TAG_NAME:a.PropTypes.string.isRequired,TAG_TYPE:a.PropTypes.string.isRequired})).isRequired,hiddenCategories:a.PropTypes.array},getDefaultProps:function(){return{hiddenCategories:["audio_content"]}},getInitialState:function(){return{itemTags:this.props.itemTags,filter:"",category:""}},componentDidMount:function(){Events.subscribe(Events.tag.select,this._onSelect)},componentWillUnmount:function(){Events.unsubscribe(Events.tag.select,this._onSelect)},render:function(){return a.createElement("section",{id:"modal_edit_tag"},this._renderHeader(),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},this._renderItemInfos(),this._renderSelected(),this._renderForm())),this._renderFooter())},_renderHeader:function(){return a.createElement("header",null,a.createElement("h1",{className:"modal-header"},"Edit tags"))},_renderFooter:function(){return a.createElement("footer",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default",type:"button",role:"button",onClick:this._onCancelClick},a.createElement("span",{className:"label"},"Cancel")),a.createElement("button",{className:"btn btn-primary",type:"button",role:"button",onClick:this._onSaveClick},a.createElement("span",{className:"label"},"Save"))))},_renderItemInfos:function(){var e=this._getPictureInfo();return a.createElement("div",{className:"wrapper-table track-infos"},a.createElement("div",{className:"cell cell-thumbnail"},a.createElement(i,{id:e.id,type:e.type,md5:e.md5,height:120,width:120})),a.createElement("div",{className:"cell cell-infos"},a.createElement("div",{className:"heading-2"},a.createElement("div",{className:"ellipsis"},this._getTitle())),a.createElement("div",{className:"heading-2-sub ellipsis",id:"share-subtitle"},this._getSubTitle()),a.createElement(r,{tags:this._getTrackInfosTags(),link:!1,max:1/0,type:"text"})))},_renderSelected:function(){return 0===this.state.itemTags.length?null:[a.createElement("div",{key:"header",className:"heading-3"},"Selected tags"),a.createElement("div",{key:"header-sub",className:"heading-3-sub"},"(may not yet be visible on the site)"),a.createElement("div",{key:"list",className:"wrapper"},a.createElement("div",{className:"selected-tag-list"},this._renderSelectedList()))]},_renderForm:function(){return a.createElement("form",{className:"form-horizontal",role:"form"},a.createElement("div",{className:"heading-3"},"Add tags"),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"control-label",htmlFor:"modal_edit_tag_filter"},"Filter"),a.createElement("input",{id:"modal_edit_tag_filter",type:"search",className:"form-control",onChange:this._onFilterChange,value:this.state.filter})),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"control-label",htmlFor:"modal_edit_tag_categories"},"Category"),a.createElement("div",{className:"form-controls"},this._renderCategoryList())),a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"full-tag-list"},this._renderTagList())))},_renderCategoryList:function(){var e=this.props.allTags.map(function(e){return e.TAG_TYPE});return e=e.reduce(function(e,t){return-1===e.indexOf(t)?e.concat([t]):e},[]),e=e.filter(function(e){return-1===this.props.hiddenCategories.indexOf(e)}.bind(this)),e=e.map(function(e){return a.createElement("option",{key:e,value:e},e)}),e.unshift(a.createElement("option",{key:"all",value:""},"All categories")),a.createElement("select",{id:"modal_edit_tag_categories",className:"form-control",value:this.state.category,onChange:this._onCategoryChange},e)},_renderSelectedList:function(){for(var e,t=[],s=0,i=this.state.itemTags.length;i>s;s++)e=this._getTagFromLabel(this.state.itemTags[s]),"undefined"!=typeof e&&t.push({LABEL:e.TAG_NAME});return a.createElement(r,{tags:t,max:1/0,link:!1,selected:!0,onRemove:this._onRemove})},_renderTagList:function(){for(var e=this._filterTags(this.props.allTags),t=[],s=0,i=e.length;i>s;s++)t.push({LABEL:e[s].TAG_NAME});return a.createElement(r,{tags:t,max:1/0,link:!1,selectable:!0})},_onCategoryChange:function(e){this.setState({category:e.target.value})},_onFilterChange:function(e){this.setState({filter:e.target.value})},_onSelect:function(e,t){"text"!==t.source.props.type&&this._selectTag(t.tag)},_onRemove:function(e){this._deselectTag(e)},_onCancelClick:function(e){e.preventDefault(),Events.trigger(Events.navigation.modal_close)},_onSaveClick:function(e){e.preventDefault();for(var t,s={},a=0,i=this.state.itemTags.length;i>a;a++)this.state.itemTags.hasOwnProperty(a)&&(t=this.state.itemTags[a],s[t]=this._getTagFromLabel(t).TAG_ID);api.call({method:"tag_edito.updateAll",data:{ELEM_ID:this._getId(),TAG_LIST:s,TYPE:this.props.type+"s"}}),Events.trigger(Events.navigation.modal_close)},_selectTag:function(e){var t=this.state.itemTags.slice();t.push(e.replace(/ |-/g,"_")),this.setState({itemTags:t})},_deselectTag:function(e){var t=this.state.itemTags.filter(function(t){return t!==e.replace(/ |-/g,"_")});this.setState({itemTags:t})},_filterTags:function(e){var t=window.rewriting(this.state.filter.toLowerCase()),s=this.state.itemTags.map(function(e){return e}),a=e.filter(function(e){return-1!==s.indexOf(e.TAG_NAME.replace(/ |-/g,"_"))||""!==this.state.category&&this.state.category!==e.TAG_TYPE||-1!==this.props.hiddenCategories.indexOf(e.TAG_TYPE)||""!==this.state.filter&&-1===window.rewriting(e.TAG_NAME.toLowerCase()).indexOf(t)?!1:!0}.bind(this));return a},_getTagFromLabel:function(e){for(var t=0,s=this.props.allTags.length;s>t;t++)if(this.props.allTags[t].TAG_NAME.replace(/ |-/g,"_")===e)return this.props.allTags[t]},_getTrackInfosTags:function(){var e=this.props.item.TAGS.filter(function(e){return-1!==this.props.item.BANNED_TAGS.indexOf(e)?!1:!0}.bind(this));return e=e.map(function(e){return{LABEL:this._getTagFromLabel(e).TAG_NAME}}.bind(this)),e=e.concat(this.props.item.BANNED_TAGS.map(function(e){return{LABEL:a.createElement("del",null,this._getTagFromLabel(e).TAG_NAME)}}.bind(this)))},_getTitle:function(){return"song"===this.props.type?this.props.item.SNG_TITLE:"artist"===this.props.type?this.props.item.ART_NAME:"album"===this.props.type?this.props.item.ALB_TITLE:""},_getSubTitle:function(){return"song"===this.props.type||"album"===this.props.type?"by "+this.props.item.ART_NAME:""},_getPictureInfo:function(){return"song"===this.props.type?{id:this._getId(),type:"cover",md5:this.props.item.ALB_PICTURE}:"artist"===this.props.type?{id:this._getId(),type:"artist",md5:this.props.item.ART_PICTURE}:"album"===this.props.type?{id:this._getId(),type:"cover",md5:this.props.item.ALB_PICTURE}:{}},_getId:function(){return"song"===this.props.type?Number(this.props.item.SNG_ID):"artist"===this.props.type?Number(this.props.item.ART_ID):"album"===this.props.type?Number(this.props.item.ALB_ID):0}});t.exports=n},{"../../../common/TagList":129,"../../../common/Thumbnail":130,react:"react"}],130:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("classnames"),n=e("../../core/i18n"),o=n.gettext,l=e("./Blur"),c=e("./FileUploader"),p=e("./Tooltip/Tooltip"),d=a.createClass({displayName:"Thumbnail",propTypes:{id:a.PropTypes.number,play_data:a.PropTypes.array,type:a.PropTypes.oneOf(["album","track","artist","radio","user","playlist","show","talk","app","generic","episode"]),md5:a.PropTypes.string,height:a.PropTypes.number,width:a.PropTypes.number,height_img:a.PropTypes.oneOfType([a.PropTypes.oneOf([!1]),a.PropTypes.number]),width_img:a.PropTypes.oneOfType([a.PropTypes.oneOf([!1]),a.PropTypes.number]),play:a.PropTypes.bool,play_force:a.PropTypes.bool,play_link:a.PropTypes.bool,preview:a.PropTypes.bool,preview_only:a.PropTypes.bool,bordered:a.PropTypes.bool,rounded:a.PropTypes.bool,sticker:a.PropTypes.bool,release_date:a.PropTypes.string,radio:a.PropTypes.bool,context:a.PropTypes.string,picture_type:a.PropTypes.string,play_index:a.PropTypes.oneOfType([a.PropTypes.oneOf([null]),a.PropTypes.number]),private_status:a.PropTypes.number,multi_cover:a.PropTypes.bool,cover_play:a.PropTypes.bool,cover_link:a.PropTypes.bool,context_menu:a.PropTypes.object,display_size:a.PropTypes.bool,title:a.PropTypes.string,overlay:a.PropTypes.bool,overlay_force:a.PropTypes.bool,upload_cover:a.PropTypes.bool,data_uri:a.PropTypes.oneOfType([a.PropTypes.oneOf([!1]),a.PropTypes.string]),target:a.PropTypes.string,onClick:a.PropTypes.func,lyrics_opened:a.PropTypes.bool,duplicate_picture:a.PropTypes.bool,blur:a.PropTypes.number},getDefaultProps:function(){return{id:0,play_data:[],type:"album",md5:"",height:55,width:55,height_img:!1,width_img:!1,play:!1,preview:!1,preview_only:!1,play_force:!1,play_link:!1,bordered:!1,rounded:!1,sticker:!1,release_date:"",radio:!1,context:"",picture_type:"",play_index:null,private_status:0,multi_cover:!1,cover_play:!1,cover_link:!0,context_menu:null,display_size:!0,title:"",overlay:!0,overlay_force:!1,upload_cover:!1,data_uri:!1,duplicate_picture:!1,blur:0}},getInitialState:function(){var e,t,s=!1;return this.props.context_menu&&(e="user"===this.props.type?this.props.context_menu.__TYPE__:this.props.type,t="user"===this.props.type?this.props.context_menu.SNG_ID:this.props.id,s=userData.isFavorite(e,t)),{context_menu_type:"track"===e?"song":e,context_menu_id:t,context_type:dzPlayer.getContext("TYPE"),is_favorite:s,playing:this._getPlayingStatus(),preview_active:!1}},componentDidMount:function(){Events.ready(Events.user.userReady,this._onFavoriteToggle),Events.subscribe(Events.player.finish,this._updateOnAir),Events.subscribe(Events.player.playing,this._updateOnAir),Events.subscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.subscribe(Events.user.deleteFavorite,this._onFavoriteToggle),Events.subscribe(Events.player.finishPreview,this._onNaturalPreviewEnd),this.props.preview&&setTimeout(function(){this.refs.playIcon&&i(this.refs.playIcon).tipsy({fallback:o("Cliquer longuement pour écouter un extrait"),delayIn:700,delayOut:0,gravity:"s"})}.bind(this),0)},shouldComponentUpdate:function(e,t){return this.props.id!==e.id||this.props.md5!==e.md5||this.props.type!==e.type||this.state.playing!==t.playing||this.state.is_favorite!==t.is_favorite||this.state.preview_active!==t.preview_active},componentDidUpdate:function(){this._updateOnAir(),this.props.preview&&this[this.state.preview_active?"_previewPlay":"_previewStop"]()},componentWillUnmount:function(){Events.unsubscribe(Events.player.finish,this._updateOnAir),Events.unsubscribe(Events.player.playing,this._updateOnAir),Events.unsubscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.user.deleteFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.player.finishPreview,this._onNaturalPreviewEnd)},render:function(){var e=this.props.onClick?this.props.onClick:this._link;return a.createElement("figure",{className:this._getFigureStyle()},a.createElement("div",{className:"picture-link",onClick:e},this._renderDuplicateImage(),this._renderImage(),this._renderOverlay()),this._renderPlayIcon(),this._renderSticker(),this._renderContextMenu(),this._renderTitle(),this._renderUploadIcon())},_renderImage:function(){var e={className:"picture",src:this._getPicturePath(),height:this.props.height,width:this.props.width};return 0===this.props.blur?a.createElement("img",e):a.createElement(l,e)},_renderDuplicateImage:function(){if(!this.props.duplicate_picture)return null;var e={className:"picture-blur active",src:this._getPicturePath(),height:this.props.height,width:this.props.width,blur:5};return a.createElement(l,e)},_renderUploadIcon:function(){return this.props.upload_cover&&c?a.createElement(c,{element_id:this.props.id},a.createElement("span",{className:"play play-force"},a.createElement("span",{className:"icon icon-camera"}))):null},_renderPlayIcon:function(){if(this.props.play){var e=this.props.height<80&&this.props.width<80,t=r({"play evt-click":!0,"play-force":this.props.play_force,"play-32":e,"play-52":!e,active:this.state.playing,preview:this.state.preview_active}),s=r({"icon-stack icon-stack-circle icon-stack-hover":!0,"icon-32":e,"icon-52":!e,active:this.props.lyrics_opened});return a.createElement("span",{className:t,ref:"playIcon",onMouseDown:this._togglePreview.bind(this,!0),onMouseUp:this._togglePreview.bind(this,!1),onMouseLeave:this._togglePreview.bind(this,!1),onClick:this._play},a.createElement("span",{className:s},a.createElement("span",{className:"play-icon play-default"},a.createElement("span",{className:"icon icon-play"})),a.createElement("span",{className:"play-icon play-hover"},a.createElement("span",{className:"icon icon-pause"})),a.createElement("span",{className:"play-icon play-active"},a.createElement("span",{className:"equalizer equalizer-inverse equalizer-16"},a.createElement("span",{className:"equalizer-bar equalizer-bar-1"}),a.createElement("span",{className:"equalizer-bar equalizer-bar-2"}),a.createElement("span",{className:"equalizer-bar equalizer-bar-3"})))))}},_renderSticker:function(){if(this.props.sticker){var e,t=new Date(this.props.release_date).getTime();return t/1e3+2592e3>window.SERVER_TIMESTAMP&&(e="NEW"),a.createElement("span",{className:"sticker sticker-small sticker-red"},e)}},_renderContextMenu:function(){if(!this.props.context_menu)return null;var e=r({"options-item options-favorite":!0,"action-active":this.state.is_favorite});return a.createElement("ul",{className:"options options-react","data-link":"0","data-favorite":"1"},a.createElement("li",{className:e,onClick:this._onFavoriteClick},a.createElement("span",{className:"icon icon-love","data-action":"favorite"})),"track"===this.props.type?a.createElement(p,{text:o("Écouter avec les paroles")},a.createElement("li",{className:"options-item",onClick:this._onLyricsClick},a.createElement("span",{className:"icon icon-lyrics"}))):null,a.createElement("li",{className:"options-item pull-right",onClick:this._onContextMenuClick},a.createElement("span",{className:"icon icon-options","data-action":"options"})))},_renderTitle:function(){if(!this.props.title)return null;var e=this.props.onClick?this.props.onClick:this._link;return a.createElement("span",{className:"mix-title",onClick:e},this.props.title)},_renderOverlay:function(){if(this.props.overlay===!1)return null;var e=r({"options-overlay":!0,"options-overlay-force":this.props.overlay_force});return a.createElement("div",{className:e})},_onFavoriteToggle:function(){if(null!==this.props.context_menu){var e=userData.isFavorite(this.state.context_menu_type,this.state.context_menu_id);e!==this.state.is_favorite&&this.setState({is_favorite:e})}},_onFavoriteClick:function(){var e=this.state.is_favorite?"remove":"add";favorite[e]({type:this.state.context_menu_type,id:this.state.context_menu_id,context:this.props.context})},_onContextMenuClick:function(e){var t=this.props.context_menu;return"song"===this.state.context_menu_type&&(t={SONG:t}),0===USER.USER_ID?void www.goToConnection():void Events.trigger(Events.menu.contextMenuOpen,{is_thumbnail:!0,target:e.currentTarget,id:this.state.context_menu_id,type:this.state.context_menu_type,data:t,position:"bottom",context:this.props.context,listen_context:{ID:this.state.context_menu_id,TYPE:this.props.context}})},_onNaturalPreviewEnd:function(){this.props.preview&&this.state.preview_active&&this._updatePreviewState(!1,!0)},_onLyricsClick:function(){Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong(),Events.trigger(Events.menu.togglePanel,"lyrics")});var e={type:"track",id:this.props.id,radio:!1,context:{TYPE:this.props.context,ID:this.props.id}};"radio"!==dzPlayer.getPlayerType()&&(e.addNext=!0),dzPlayer.play(e)},_previewTimer:null,_previewTimeout:500,_naturalPreviewEnd:!1,_togglePreview:function(e){this.props.preview&&(clearTimeout(this._previewTimer),e=Boolean(e),e&&this.state.preview_active||OFFLINE||"ads"===dzPlayer.getPlayerType()||"jingle"===dzPlayer.getPlayerType()||(this._previewTimer=setTimeout(function(){this._updatePreviewState(e)}.bind(this),this._previewTimeout)))},_previewPlay:function(){var e=this._previewTypeToMethodData();api.call({method:e.method,data:e.data,success:function(e){var t=this._extractPreviewMd5(e);return t?dzPlayer.trigger("audioPlayer_startPreview",[t]):this._updatePreviewState(!1,!0),!0}.bind(this),error:function(){return this._updatePreviewState(!1,!0),!0}.bind(this)})},_previewStop:function(){dzPlayer.trigger("audioPlayer_endPreview")},_updatePreviewState:function(e,t){this.isMounted()&&this.setState({preview_active:e},function(){this.state.preview_active&&this.refs.playIcon&&i(this.refs.playIcon).tipsy("hide"),this._naturalPreviewEnd=Boolean(t)}.bind(this))},_previewTypeToMethodData:function(){var e={album:{method:"song.getListByAlbum",data:{ALB_ID:this.props.id,NB:1}},track:{method:"song.getData",data:{SNG_ID:this.props.id}},playlist:{method:"playlist.getSongs",data:{PLAYLIST_ID:this.props.id,NB:1}},radio:{method:"radio.getSongs",data:{RADIO_ID:this.props.id,NB:1}},artist:{method:"smart.getSmartRadio",data:{ART_ID:this.props.id,LIMIT:1}},show:{method:"episode.getListByShow",data:{SHOW_ID:this.props.id,LIMIT:1}}};return e[this.props.type]},_extractPreviewMd5:function(e){return"track"===this.props.type?e===Object(e)&&e.MD5_ORIGIN&&Number(right.checkSongAvailable(e))===Number(right.READABLE)?e.MD5_ORIGIN:null:e===Object(e)&&Array.isArray(e.data)&&e.data[0].MD5_ORIGIN&&Number(right.checkSongAvailable(e.data[0]))===Number(right.READABLE)?e.data[0].MD5_ORIGIN:null},_getFigureStyle:function(){var e=["thumbnail"];return this.props.bordered&&e.push("thumbnail-bordered"),this.props.rounded&&e.push("thumbnail-rounded"),this.props.title&&e.push("thumbnail-mix"),this.props.play&&e.push("thumbnail-title"),e.join(" ")},_getPicturePath:function(){if(this.props.data_uri)return this.props.data_uri;var e=SETTING_DOMAIN_IMG,t=this.props.multi_cover?this.props.md5:this.props.md5.split("-")[0];if(""!==this.props.picture_type&&""!==t)e+="/"+this.props.picture_type;else if(""!==this.props.type){var s={track:"cover",album:"cover",radio:"misc",playlist:""===t?"playlist":"cover",show:"talk",app:"misc"};e+="/"+("string"==typeof s[this.props.type]?s[this.props.type]:this.props.type)}else e+="/misc";var a=(this.props.height_img===!1?this.props.height:this.props.height_img)+"x"+(this.props.width_img===!1?this.props.width:this.props.width_img);return e+"/"+t+"/"+a+"-000000-80-0-0.jpg"},_getPlayingStatus:function(){if("track"===this.props.type&&this.props.id===Number(dzPlayer.getCurrentSong("MEDIA_ID"))&&null!==this.props.play_index&&Number(this.props.play_index)===dzPlayer.getIndexSong())return dzPlayer.isPlaying();var e=dzPlayer.getContext();if(null!==e){var t="track"===this.props.type?Number(dzPlayer.getCurrentSong("MEDIA_ID")):e.ID;return dzPlayer.isPlaying()&&LOG_CONTEXT[e.TYPE]===LOG_CONTEXT[this.props.context]&&Number(t)===Number(this.props.id)}return!1},_updateOnAir:function(){this.setState({playing:this._getPlayingStatus()})},_play:function(e){if(this.props.preview&&this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(this.props.preview&&this.state.preview_active||!this.props.play)return void e.stopPropagation();if(!this.props.preview_only){var t=dzPlayer.getContext();if(null!==t&&LOG_CONTEXT[t.TYPE]===LOG_CONTEXT[this.props.context]&&Number(t.ID)===Number(this.props.id)||"queue_list"===this.props.context&&Number(this.props.play_index)===dzPlayer.getTrackListIndex())return void dzPlayer.control.togglePause();if(this.props.onClick&&this.props.onClick(),this.props.play_link&&this._link(),"queue_list"===this.props.context)return void dzPlayer.playTrackAtIndex(this.props.play_index);var s={type:this.props.type,id:this.props.id,radio:this.props.radio,context:{ID:this.props.id,TYPE:this.props.context},data:this.props.play_data};null!==this.props.play_index&&(s.index=this.props.play_index),this.props.play_data.length>0&&(s.data=this.props.play_data),dzPlayer.play(s)}},_link:function(){if(this.props.preview&&this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(!(this.props.preview&&this.state.preview_active||!this.props.cover_link&&!this.props.cover_play)){if(this.props.cover_play)return void this._play();var e="";if(this.props.target)e=this.props.target;else{var t={user:"profile/"+this.props.id,radio:"mixes/genre/"+this.props.id};e="/"+("string"==typeof t[this.props.type]?t[this.props.type]:this.props.type+"/"+this.props.id)}loadBox(e)}}});t.exports=d},{"../../core/i18n":245,"./Blur":58,"./FileUploader":120,"./Tooltip/Tooltip":132,classnames:"classnames",jquery:"jquery",react:"react"}],132:[function(e,t,s){"use strict";var a,i=e("babel-runtime/helpers/extends")["default"],r=e("react"),n=e("react-dom"),o=e("react-addons-pure-render-mixin"),l=e("./Portal"),c=r.createClass({displayName:"Tooltip",propTypes:{text:r.PropTypes.string.isRequired,html:r.PropTypes.bool,position:r.PropTypes.oneOf(["top","bottom","left","right"]),relativeTo:r.PropTypes.string,children:r.PropTypes.oneOfType([r.PropTypes.element,r.PropTypes.string]).isRequired},mixins:[o],getDefaultProps:function(){return{html:!1,position:"top"}},componentDidMount:function(){"undefined"==typeof a&&(a=document.createElement("div"),document.body.appendChild(a),n.render(r.createElement(l,null),a))},componentWillUnmount:function(){Events.trigger(Events.tooltip.hide)},render:function(){var e={onMouseEnter:this._onEnter,onMouseLeave:this._onLeave,"aria-describedby":"tooltip-portal"};return"string"==typeof this.props.children.type?r.cloneElement(this.props.children,e):r.createElement("div",i({className:"tooltip-wrapper"},e),this.props.children)},_onEnter:function(){this.props.children.props&&"function"==typeof this.props.children.props.onMouseEnter&&this.props.children.props.onMouseEnter.apply(this.props.children,arguments),Events.trigger(Events.tooltip.show,{text:this.props.text,html:this.props.html,position:this._getPosition(),element:this._getElement()})},_onLeave:function(){this.props.children.props&&"function"==typeof this.props.children.props.onMouseLeave&&this.props.children.props.onMouseLeave.apply(this.props.children,arguments),Events.trigger(Events.tooltip.hide)},_getElement:function(){var e=n.findDOMNode(this);return"string"==typeof this.props.relativeTo&&(e=e.querySelector(this.props.relativeTo)||e),e},_getPosition:function(){return"rtl"===window.DIRECTION&&"right"===this.props.position?"left":"rtl"===window.DIRECTION&&"left"===this.props.position?"right":this.props.position}});t.exports=c},{"./Portal":131,"babel-runtime/helpers/extends":294,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],131:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/extends")["default"],i=e("react"),r=e("classnames"),n=i.createClass({displayName:"Portal",getInitialState:function(){return{displayed:!1}},componentDidMount:function(){Events.subscribe(Events.tooltip.show,this._onShow),Events.subscribe(Events.tooltip.hide,this._onHide)},componentWillUnmount:function(){Events.unsubscribe(Events.tooltip.show,this._onShow),Events.unsubscribe(Events.tooltip.hide,this._onHide)},render:function(){var e={className:r({tooltip:!0,"tooltip-top":"top"===this.state.position,"tooltip-bottom":"bottom"===this.state.position,"tooltip-left":"left"===this.state.position,"tooltip-right":"right"===this.state.position,show:this.state.displayed}),style:this._getPosition(),role:"tooltip",id:"tooltip-portal","aria-hidden":this.state.displayed===!1};return this.state.html===!0?i.createElement("div",a({},e,{dangerouslySetInnerHTML:{__html:this.state.text}})):i.createElement("div",e,this.state.text)},_onShow:function(e,t){this.setState(a({},t,{displayed:!0}))},_onHide:function(){this.setState({displayed:!1})},_getPosition:function(){var e={top:0,left:0};if(!this.state.element)return e;var t=this.state.element.getBoundingClientRect();switch(this.state.position){case"top":e.top=t.top,e.left=t.left+t.width/2;break;case"bottom":e.top=t.top+t.height,e.left=t.left+t.width/2;break;case"left":e.top=t.top+t.height/2,e.left=t.left;break;case"right":e.top=t.top+t.height/2,e.left=t.left+t.width}return e}});t.exports=n},{"babel-runtime/helpers/extends":294,classnames:"classnames",react:"react"}],294:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/assign")["default"];s["default"]=a||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},s.__esModule=!0},{"babel-runtime/core-js/object/assign":285}],285:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":298}],298:[function(e,t,s){e("../../modules/es6.object.assign"),t.exports=e("../../modules/$.core").Object.assign},{"../../modules/$.core":307,"../../modules/es6.object.assign":321}],321:[function(e,t,s){var a=e("./$.export");a(a.S+a.F,"Object",{assign:e("./$.object-assign")})},{"./$.export":310,"./$.object-assign":316}],316:[function(e,t,s){var a=e("./$"),i=e("./$.to-object"),r=e("./$.iobject");t.exports=e("./$.fails")(function(){var e=Object.assign,t={},s={},a=Symbol(),i="abcdefghijklmnopqrst";return t[a]=7,i.split("").forEach(function(e){s[e]=e}),7!=e({},t)[a]||Object.keys(e({},s)).join("")!=i})?function(e,t){for(var s=i(e),n=arguments,o=n.length,l=1,c=a.getKeys,p=a.getSymbols,d=a.isEnum;o>l;)for(var u,h=r(n[l++]),m=p?c(h).concat(p(h)):c(h),_=m.length,f=0;_>f;)d.call(h,u=m[f++])&&(s[u]=h[u]);return s}:Object.assign},{"./$":315,"./$.fails":311,"./$.iobject":313,"./$.to-object":320}],315:[function(e,t,s){var a=Object;t.exports={create:a.create,getProto:a.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:a.getOwnPropertyDescriptor,setDesc:a.defineProperty,setDescs:a.defineProperties,getKeys:a.keys,getNames:a.getOwnPropertyNames,getSymbols:a.getOwnPropertySymbols,each:[].forEach}},{}],313:[function(e,t,s){var a=e("./$.cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==a(e)?e.split(""):Object(e)}},{"./$.cof":306}],306:[function(e,t,s){var a={}.toString;t.exports=function(e){return a.call(e).slice(8,-1)}},{}],120:[function(e,t,s){"use strict";var a=e("react"),i=a.createClass({displayName:"FileUploader",propTypes:{element_id:a.PropTypes.number,children:a.PropTypes.object,accept:a.PropTypes.string,type:a.PropTypes.string,directory:a.PropTypes.string},getDefaultProps:function(){return{element_id:0,children:"",accept:"image/*",type:"picture",directory:"playlist"}},componentDidMount:function(){Events.subscribe(Events.playlist.uploadPicture,this._uploadFile)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.uploadPicture,this._uploadFile)},render:function(){return window.FileReader?a.createElement("div",{onClick:this._onSelectFileClick},a.createElement("input",{type:"file",className:"hide",multiple:!1,ref:"fileInput",accept:this.props.accept,onChange:this._onChangeFile}),this.props.children):!1},_selectedFile:null,_onSelectFileClick:function(){this.refs.fileInput.click()},_onChangeFile:function(e){if(this._selectedFile=e.target.files[0],-1===this._selectedFile.type.indexOf(this.props.accept.split("/")[0]))return!1;if(this.props.element_id>0)return this._uploadFile(null,{id:this.props.element_id});var t=new FileReader;t.onload=function(e){Events.trigger(Events.playlist.updatePicture,{type:"base64",data:e.target.result})},t.readAsDataURL(this._selectedFile)},_uploadFile:function(e,t){if(null===this._selectedFile)return!1;var s="%1/?sid=%2&id=%3&resize=1&directory=%4&type=%5&referer=%6&file=%7",a=s.replace("%1",SETTING_HOST_UPLOAD).replace("%2",SESSION_ID).replace("%3",t.id).replace("%4",this.props.directory).replace("%5",this.props.type).replace("%6",SETTING_REFERER_UPLOAD).replace("%7",this._selectedFile.name),i=new FormData;i.append("file",this._selectedFile);var r=new XMLHttpRequest;return r.addEventListener("load",function(e){if(200===e.target.status){var s=JSON.parse(e.target.response);0===s.error.length&&Events.trigger(Events.playlist.updatePicture,{element_id:t.id,type:this.props.directory,md5:s.results})}}.bind(this),!1),r.addEventListener("error",function(){},!1),r.open("POST",a,!0),r.send(i)}});t.exports=i},{react:"react"}],58:[function(e,t,s){"use strict";var a=e("react"),i=a.createClass({displayName:"Blur",propTypes:{className:a.PropTypes.string,width:a.PropTypes.number.isRequired,height:a.PropTypes.number.isRequired,src:a.PropTypes.string.isRequired,blur:a.PropTypes.number},getDefaultProps:function(){return{blur:3}},componentDidMount:function(){var e=this.refs.canvas;e.height=this.props.height,e.width=this.props.width;var t=new Image;t.crossOrigin="Anonymous",t.onload=function(){var s=e.getContext("2d");s.drawImage(t,this.props.width/2-t.width/2,this.props.height/2-t.height/2),s.globalAlpha=.5;for(var a=-this.props.blur;a<=this.props.blur;a+=2)for(var i=-this.props.blur;i<=this.props.blur;i+=2)s.drawImage(e,i,a),i>=0&&a>=0&&s.drawImage(e,-(i-2.5),-(a-2.5));s.globalAlpha=1}.bind(this),t.src=this.props.src},render:function(){return a.createElement("canvas",{className:this.props.className,ref:"canvas"})}});t.exports=i},{react:"react"}],129:[function(e,t,s){"use strict";var a=e("react"),i=e("../../core/i18n"),r=i.gettext,n=e("./Tag"),o=a.createClass({displayName:"TagList",propTypes:{tags:a.PropTypes.array.isRequired,max:a.PropTypes.number,min:a.PropTypes.number,showLabel:a.PropTypes.bool,query:a.PropTypes.string,type:a.PropTypes.oneOf(["button","text"]),link:a.PropTypes.bool,selected:a.PropTypes.bool,selectable:a.PropTypes.bool,colorScale:a.PropTypes.array,onRemove:a.PropTypes.func},getDefaultProps:function(){return{max:15,min:0,showLabel:!1,query:"",link:!0,selected:!1,selectable:!1,colorScale:["400","600","800"]}},getInitialState:function(){return{tags:this.props.tags,onRemove:this.props.onRemove||this._onRemove}},componentWillReceiveProps:function(e){this.setState({tags:e.tags,onRemove:e.onRemove||this._onRemove})},render:function(){var e,t=this.state.tags.slice(0,this.props.max);if(!t.length)return null;var s=this.props.selected?r("Résultats de recherche pour")+" ":r("Combiner avec :");return a.createElement("ul",{className:"tag-list clearfix"+(this.props.selected?" selected":""),"aria-live":"polite"},this.props.showLabel?a.createElement("li",null,a.createElement("div",{className:"tag"},a.createElement("span",{className:"btn btn-label tag-title"},s))):"",t.map(function(t,s){return e=this.props.colorScale[s%this.props.colorScale.length],a.createElement("li",{key:"panel-tag-"+t.LABEL+s},a.createElement(n,{label:t.LABEL,query:this.props.query,link:this.props.link,type:this.props.type,color:e,selectable:this.props.selectable,selected:this.props.selected,onRemove:this.state.onRemove}))}.bind(this)))},_onRemove:function(e){if(e){var t=this.state.tags;t.length>this.props.min?(t=t.filter(function(t){return t.LABEL!==e}),this.setState({tags:t},this._navigate)):this._openSearchPanel()}},_navigate:function(){if(this.props.link){var e="";this.state.tags.forEach(function(t){e+=t.LABEL.substr(1)+" "}),www.navigate("/tags/"+e.trim())}},_openSearchPanel:function(){if(this.props.link){var e=document.getElementById("menu_search");e.click(),e.focus()}}});t.exports=o},{"../../core/i18n":245,"./Tag":128,react:"react"}],128:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=a.createClass({displayName:"Tag",propTypes:{label:a.PropTypes.node.isRequired,query:a.PropTypes.string,color:a.PropTypes.string,link:a.PropTypes.bool,type:a.PropTypes.oneOf(["button","text"]),selected:a.PropTypes.bool,selectable:a.PropTypes.bool,onRemove:a.PropTypes.func},getDefaultProps:function(){return{color:"400",link:!0,type:"button",selected:!1,selectable:!1,onRemove:function(){}}},shouldComponentUpdate:function(e){return this.props.selected!==e.selected},render:function(){var e={"btn btn-tag":"button"===this.props.type,"txt-tag":"text"===this.props.type,"txt-tag-hover":"text"===this.props.type&&this.props.link,selected:this.props.selected,selectable:this.props.selectable};e["btn-tag-"+this.props.color]="button"===this.props.type?!0:!1;var t=i(e);return this.props.selectable||this.props.selected?a.createElement("div",{className:t},a.createElement("span",{className:"tag-label"},this.props.label),this.props.selectable?this._renderSelectableButton():null,this.props.selected?this._renderSelectedButton():null):this.props.link?a.createElement("a",{className:t,onClick:this._onClick,role:"button"},a.createElement("span",{className:"tag-label"},this.props.label)):a.createElement("span",{className:t,onClick:this._onClick,role:"button"},a.createElement("span",{className:"tag-label"},this.props.label))},_renderSelectableButton:function(){return a.createElement("a",{className:"tag-action",role:"button",onClick:this._onClick},a.createElement("span",{className:"icon icon-add"}))},_renderSelectedButton:function(){return a.createElement("a",{className:"tag-action",role:"button",onClick:this._onRemoveClick},a.createElement("span",{className:"icon icon-cancel"}))},_onRemoveClick:function(e){e.stopPropagation(),this.props.onRemove(this.props.label)},_onClick:function(){if(this.props.link){var e=this.props.label.replace(/^#/,"");this.props.query&&(e=this.props.query+" "+e),www.navigate("/tags/"+e)}Events.trigger(Events.tag.select,{source:this,tag:this.props.label})}});t.exports=r},{classnames:"classnames",react:"react"}],169:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("../../../../core/i18n"),n=r.gettext,o=e("@deezer/components/common/Selectbox"),l=a.createClass({displayName:"CuratorEditPlaylistTop",propTypes:{data:a.PropTypes.object.isRequired},getDefaultProps:function(){return{data:{}}},getInitialState:function(){var e=window.storage.isset("playlist_genre_curator")?Number(window.storage.get("playlist_genre_curator").data):0,t=window.storage.isset("playlist_country_curator")?window.storage.get("playlist_country_curator").data:this.props.data.country[0],s=window.storage.isset("playlist_source_curator")?window.storage.get("playlist_source_curator").data:"charts_playlist";return{available_playlist:[],selected_playlist:[],searched_playlist:[],source_playlist:s,filter:"",genre:e,genre_filter:this.props.data.genre_filter,country:t,sort:"sortTitle",selected_order:!1,load_more:!0}},componentDidMount:function(){this._getPlaylist(),window.setTimeout(function(){this._refreshScrollbar()}.bind(this),0)},componentDidUpdate:function(e,t){(this.state.available_playlist.length!==t.available_playlist.length||this.state.selected_playlist.length!==t.selected_playlist.length)&&this._refreshScrollbar()},render:function(){return a.createElement("div",null,a.createElement("div",{className:"modal-header"},n("Organiser le Top Playlists")),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"columns"},a.createElement("div",{className:"column column-left"},a.createElement("div",{className:"curator-title"},n("Playlists disponibles")),a.createElement("div",{className:"curator-table-search"},a.createElement("div",{className:"form-horizontal",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n("Rechercher"),onChange:this._onFilter,value:this.state.filter}),a.createElement(o,{type:"playlist_curator",position:"center",saveOrder:!1,onChange:this._onChangeSort})),a.createElement("div",{className:"form-group"},a.createElement("div",{className:"form-radio"},a.createElement("label",null,a.createElement("input",{type:"radio",name:"playlist_source",value:"charts_playlist",onChange:this._onSelectPlaylistSource,checked:"charts_playlist"===this.state.source_playlist}),a.createElement("span",null,n("Afficher les Top playlists"))))),a.createElement("div",{className:"form-group"},a.createElement("div",{className:"form-radio"},a.createElement("label",null,a.createElement("input",{type:"radio",name:"playlist_source",value:"user_playlist",onChange:this._onSelectPlaylistSource,checked:"user_playlist"===this.state.source_playlist}),a.createElement("span",null,n("Afficher mes playlists"))))))),a.createElement("div",{className:"curator-table nano",ref:"available_scroll"},a.createElement("div",{className:"nano-content"},this._filterPlaylistSource().map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.filter.toLowerCase())>-1?a.createElement("div",{key:"playlist_available_"+e.PLAYLIST_ID+"_"+t,className:"line line-blue ellipsis",onClick:this._onMove.bind(this,e,"left",t)},a.createElement("span",{className:"icon icon-add pull-right"}),a.createElement("span",null,e.TITLE)):!1}.bind(this)),"charts_playlist"===this.state.source_playlist&&""!==this.state.filter&&this.state.load_more?a.createElement("button",{className:"btn btn-primary pull-right",type:"button",onClick:this._onSearchPlaylist},a.createElement("span",{className:"label"},n("Chercher dans toutes les playlists"))):null))),a.createElement("div",{className:"column column-right"},a.createElement("div",{className:"curator-title"},n("Top Playlists")+" ("+this.state.selected_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-horizontal form-select-genre"},a.createElement("div",{className:"form-group",role:"form"},a.createElement("span",{className:"control-label"},n("Choisis un pays :")),a.createElement("select",{className:"form-control",onChange:this._onChangeTopPlaylist.bind(this,"country"),value:this.state.country},this.props.data.country.map(function(e,t){return a.createElement("option",{key:"country_"+t,value:e},e)}))),a.createElement("div",{className:"form-group form-select-genre",role:"form"},a.createElement("span",{className:"control-label"},n("Choisis un genre :")),a.createElement("select",{className:"form-control",onChange:this._onChangeTopPlaylist.bind(this,"genre"),value:this.state.genre},this.props.data.genre.map(function(e,t){return a.createElement("option",{key:"genre_"+t,value:Number(e.GENRE_ID)},e.GENRE_NAME)}))))),a.createElement("div",{className:"curator-table-search table-order-playlist"},a.createElement("div",{className:"curator-table nano",ref:"selected_scroll"},a.createElement("div",{className:"nano-content"},this.state.selected_playlist.map(function(e,t){return a.createElement("div",{key:"playlist_selected_"+e.PLAYLIST_ID+"_"+t,className:"line"},a.createElement("span",{className:"icon icon-cancel pull-right",onClick:this._onMove.bind(this,e,"right",t)}),a.createElement("div",{className:"form-radio"},a.createElement("label",{htmlFor:e.PLAYLIST_ID,className:"ellipsis"},a.createElement("input",{type:"radio",name:"order",id:e.PLAYLIST_ID,value:e.PLAYLIST_ID,onChange:this._onSelectElement.bind(this,t),checked:t===this.state.selected_order}),e.TITLE)))}.bind(this)))),this.state.selected_order!==!1?a.createElement("div",{className:"order-playlist-actions"},a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onOrder.bind(this,"up")},a.createElement("span",{className:"icon icon-arrow-up-long"})),a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onOrder.bind(this,"down")},a.createElement("span",{className:"icon icon-arrow-down-long"}))):null))))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onClose},a.createElement("span",{className:"label"},n("Fermer"))))))},_onSelectPlaylistSource:function(e){this.setState({source_playlist:e.target.value,searched_playlist:[]},this._getPlaylist),window.storage.set("playlist_source_curator",{data:e.target.value})},_onOrder:function(e){if(this.state.selected_order!==!1&&!(0===this.state.selected_order&&"up"===e||this.state.selected_order===this.state.selected_playlist.length-1&&"down"===e)){var t=this.state.selected_playlist.slice(0),s=this.state.selected_order+("up"===e?-1:1);t.splice(s,0,t.splice(this.state.selected_order,1)[0]),this.setState({selected_playlist:t,selected_order:s},this._onSave)}},_onSelectElement:function(e,t){t.stopPropagation(),this.setState({selected_order:e})},_onMove:function(e,t,s){var a=this.state.selected_playlist.slice(0);"left"===t?(this._hashSelectedPlaylist[e.PLAYLIST_ID]=!0,a.unshift(e)):"right"===t&&(delete this._hashSelectedPlaylist[e.PLAYLIST_ID],a.splice(s,1)),this.setState({selected_order:!1,selected_playlist:a},this._onSave)},_onFilter:function(e){this.setState({filter:e.target.value.toLowerCase(),searched_playlist:[],load_more:!0},function(){this._refreshScrollbar()}.bind(this))},_onSearchPlaylist:function(){0!==this.state.filter.length&&api.call({method:"deezer.getPlaylistByName",data:{query:this.state.filter,country:this.state.country},success:function(e){if(this.isMounted()){var t=[];e:for(var s=0,a=e.data.length;a>s;s++){for(var i=0,r=this.state.available_playlist.length;r>i;i++)if(e.data[s].PLAYLIST_ID===this.state.available_playlist[i].PLAYLIST_ID)continue e;t.push(e.data[s])}if(0===t.length)return this.setState({load_more:!1}),void alert(n("Aucun résultat"));if(0!==this.state.genre){for(var o=!1,l=0,c=t.length;c>l;l++)t[l].GENRE.indexOf(String(this.state.genre))>-1&&(o=!0);o===!1&&alert(n("Aucun résultat dans ce genre"))}this.setState({searched_playlist:t,load_more:!1})}}.bind(this)})},_onChangeTopPlaylist:function(e,t){var s={};s[e]="genre"===e?Number(t.target.value):t.target.value,s.selected_order=!1,s.filter="",this.setState(s,function(){this._getPlaylist(),this._refreshScrollbar()}.bind(this)),window.storage.set("playlist_"+e+"_curator",{data:t.target.value})},_onChangeSort:function(e){this.setState({sort:e})},_onSave:function(){for(var e=[],t=0,s=this.state.selected_playlist.length;s>t;t++)e.push(this.state.selected_playlist[t].PLAYLIST_ID);api.call({method:"deezer.setPlaylistTopCurated",data:{country:this.state.country,genre_id:this.state.genre,genre_filter:this.state.genre_filter,playlist:e}})},_onClose:function(){Events.trigger(Events.navigation.modal_close)},_hashSelectedPlaylist:{},_filterPlaylistSource:function(){for(var e=[],t=this.state.available_playlist.concat(this.state.searched_playlist),s=0,a=t.length;a>s;s++){var i=t[s].GENRE.length>0&&t[s].GENRE.indexOf(String(this.state.genre))>-1||0===this.state.genre;this._hashSelectedPlaylist[t[s].PLAYLIST_ID]!==!0&&i&&e.push(t[s])}return e.sort(this["_"+this.state.sort])},_getPlaylist:function(){api.call({method:"deezer.getPlaylistTopCurated",data:{genre_id:this.state.genre,genre_filter:this.state.genre_filter,country:this.state.country,top_charts:"charts_playlist"===this.state.source_playlist},success:function(e){if(this.isMounted()){this._hashSelectedPlaylist={};for(var t=0,s=e.PLAYLIST_EDITO.length;s>t;t++)this._hashSelectedPlaylist[e.PLAYLIST_EDITO[t].PLAYLIST_ID]=!0;for(var a=0,i=e.PLAYLIST_ADMIN.length;i>a;a++)this._hashSelectedPlaylist[e.PLAYLIST_ADMIN[a].PLAYLIST_ID]=!0;this.setState({available_playlist:"charts_playlist"===this.state.source_playlist?e.PLAYLIST_CHARTS:this._getUserPlaylist(),selected_playlist:e.PLAYLIST_EDITO})}}.bind(this)})},_getUserPlaylist:function(){var e=userData.data.PLAYLISTS.data.slice(0);return e.concat(userData.data.FAVORITES_PLAYLISTS.data)},_refreshScrollbar:function(){i(this.refs.available_scroll).nanoScroller(),i(this.refs.selected_scroll).nanoScroller()},_sortTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},_sortDate:function(e,t){var s=e.DATE_ADD||"",a=t.DATE_ADD||"";return s===a?0:a>s?1:-1}});t.exports=l},{"../../../../core/i18n":245,"@deezer/components/common/Selectbox":126,jquery:"jquery",react:"react"}],168:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("../../../../core/i18n"),n=r.gettext,o=e("../../../common/Selectbox"),l=a.createClass({displayName:"CuratorEditPlaylistTag",propTypes:{data:a.PropTypes.array},getDefaultProps:function(){return{data:[]}},getInitialState:function(){var e=this._getDefaultGenre(),t=this._splitPlaylistData(e);return{available_playlist:t.available,selected_playlist:t.selected,available_filter:"",selected_filter:"",genre:e,sort:"sortTitle"}},componentDidMount:function(){this._idList={},window.setTimeout(function(){this._refreshScrollbar("available"),this._refreshScrollbar("selected")}.bind(this),0)},componentDidUpdate:function(e,t){this.state.available_playlist.length!==t.available_playlist.length&&this._refreshScrollbar("available"),this.state.selected_playlist.length!==t.selected_playlist.length&&this._refreshScrollbar("selected")},componentWillUnmount:function(){this._idList={}},render:function(){return a.createElement("div",null,a.createElement("div",{className:"modal-header"},n("Taguer par genre et moods")),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"wrapper-table"},a.createElement("div",{className:"cell"},n("Choisis un genre :")),a.createElement("div",{className:"cell"},a.createElement("select",{onChange:this._onChangeGenre,value:this.state.genre},this.props.data.map(function(e,t){return a.createElement("option",{key:"genre_"+t,value:Number(e.GENRE_ID)},e.GENRE_NAME)}),a.createElement("option",{key:"private",value:"private"},n("Playlist privée"))),a.createElement(o,{type:"playlist_curator",position:"center",saveOrder:!1,onChange:this._onChangeSort}))),a.createElement("div",{className:"columns"},a.createElement("div",{className:"column column-left"},a.createElement("div",{className:"curator-title"},n("Playlists disponibles")+" ("+this.state.available_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-inline",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n("Filtrer"),onKeyUp:this._onFilter.bind(this,"available")})),a.createElement("div",{className:"form-group"},a.createElement("span",{className:"icon icon-search"})))),a.createElement("div",{className:"curator-table nano",ref:"available_scroll"},a.createElement("div",{className:"nano-content"},this.state.available_playlist.map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.available_filter)>-1?a.createElement("div",{key:"playlist_available_"+t,className:"line line-blue ellipsis",onClick:this._onMove.bind(this,e.PLAYLIST_ID,"left",t)},a.createElement("span",{className:"icon icon-add pull-right"}),a.createElement("span",null,e.TITLE)):!1}.bind(this))))),a.createElement("div",{className:"column column-right"},a.createElement("div",{className:"curator-title"},n("Playlists par genre")+" ("+this.state.selected_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-inline",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n("Filtrer"),onKeyUp:this._onFilter.bind(this,"selected")})),a.createElement("div",{className:"form-group"},a.createElement("span",{className:"icon icon-search"})))),a.createElement("div",{className:"curator-table nano",ref:"selected_scroll"},a.createElement("div",{className:"nano-content"},this.state.selected_playlist.map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.selected_filter)>-1?a.createElement("div",{key:"playlist_selected_"+t,className:"line line-gray ellipsis",onClick:this._onMove.bind(this,e.PLAYLIST_ID,"right",t)},a.createElement("span",{className:"icon icon-add pull-right icon-cancel"}),a.createElement("span",null,e.TITLE)):!1}.bind(this)))))))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default pull-left",type:"button",onClick:this._onClose},a.createElement("span",{className:"label"},n("Annuler"))),a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._onSave.bind(this,!0)},a.createElement("span",{className:"label"},n("Valider"))))))},_onMove:function(e,t,s){var a="left"===t?"available_playlist":"selected_playlist",i="right"===t?"available_playlist":"selected_playlist",r=this.state[a].slice(0),n=this.state[i].slice(0),o=r.splice(s,1);n.push(o[0]),this.setState({selected_playlist:"available_playlist"===a?n:r,available_playlist:"selected_playlist"===i?r:n.sort(this["_"+this.state.sort])}),this._idList[e]="available_playlist"===a},_onFilter:function(e,t){var s={};s[e+"_filter"]=t.target.value.toLowerCase(),this.setState(s,function(){this._refreshScrollbar(e)}.bind(this))},_onChangeGenre:function(e){var t="object"==typeof e?e.target.value:e;if(window.countObject(this._idList)>0)return void this._onSave(!1,t);var s=this._splitPlaylistData(t);this.setState({genre:t,available_playlist:s.available,selected_playlist:s.selected,selected_filter:"",available_filter:""}),window.storage.set("playlist_edit_curator",{genre:t})},_onChangeSort:function(e){this.setState({sort:e,selected_playlist:this.state.selected_playlist.sort(this["_"+e]),available_playlist:this.state.available_playlist.sort(this["_"+e])})},_onSave:function(e,t){if(0===window.countObject(this._idList))return void(e&&this._onClose());var s=this.state.genre;api.call({method:"deezer.setPlaylistGenre",data:{id_list:this._idList,genre:s},success:function(a){if(a)for(var i in this._idList)if(this._idList.hasOwnProperty(i)){var r={};if("private"===s){if(r.STATUS=Number(this._hashPlaylist[i].STATUS),(1===r.STATUS||3===r.STATUS)&&this._idList[i])continue;if((0===r.STATUS||2===r.STATUS)&&!this._idList[i])continue;r.STATUS+=this._idList[i]?1:-1}else{if(!Array.isArray(this._hashPlaylist[i].GENRE))continue;var n=this._hashPlaylist[i].GENRE.indexOf(s);if(n>-1&&!this._idList[i])this._hashPlaylist[i].GENRE.splice(n,1);else{if(-1!==n||!this._idList[i])continue;this._hashPlaylist[i].GENRE.push(s)}r.GENRE=this._hashPlaylist[i].GENRE}userData.refreshPlaylistData(i,r)}this._idList={},e?this._onClose():this._onChangeGenre(t)}.bind(this)})},_onClose:function(){Events.trigger(Events.navigation.modal_close)},_idList:{},_hashPlaylist:{},_splitPlaylistData:function(e){for(var t=[],s=[],a=function(a){this._hashPlaylist[a.PLAYLIST_ID]=a;var i="private"===e&&(1===Number(a.STATUS)||4===Number(a.STATUS)),r="private"!==e&&Array.isArray(a.GENRE)&&a.GENRE.indexOf(e)>-1;i||r?s.push(a):("private"===e||gatekeeper.isAllowed("curator_edito")||gatekeeper.isAllowed("curator_local")||0===a.GENRE.length)&&t.push(a)}.bind(this),i=0;i<userData.data.PLAYLISTS.total;i++)a(userData.data.PLAYLISTS.data[i]);if(gatekeeper.isAllowed("curator_edito")||gatekeeper.isAllowed("curator_local"))for(var i=0;i<userData.data.FAVORITES_PLAYLISTS.total;i++)a(userData.data.FAVORITES_PLAYLISTS.data[i]);return{available:t,selected:s}},_refreshScrollbar:function(e){i(this.refs[e+"_scroll"]).nanoScroller()},_sortTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},_sortDate:function(e,t){var s=e.DATE_ADD||"0000-00-00 00:00:00",a=t.DATE_ADD||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},_getDefaultGenre:function(){var e="playlist_edit_curator";return window.storage.isset(e)?window.storage.get(e).genre:this.props.data.length>0?this.props.data[0].GENRE_ID:0}});t.exports=l},{"../../../../core/i18n":245,"../../../common/Selectbox":126,jquery:"jquery",react:"react"}],126:[function(e,t,s){"use strict";var a=e("react"),i=e("../../core/i18n"),r=i.gettext,n=e("@deezer/components/common/DropDown"),o=a.createClass({displayName:"Selectbox",propTypes:{type:a.PropTypes.oneOf(["album","playlist","show","playlist_curator"]),position:a.PropTypes.oneOf(["right","left","center"]),saveOrder:a.PropTypes.bool,onChange:a.PropTypes.func},getDefaultProps:function(){return{type:"album",position:"right",saveOrder:!0,onChange:function(){}}},render:function(){var e=a.createElement("span",{className:"icon icon-list"});return a.createElement(n,{style:"mini","default-label":e,position:this.props.position},this._getElement().map(function(e,t){return a.createElement(n.Item,{key:t},a.createElement("a",{href:"#",onClick:this._onChange.bind(this,e.type)},e.label))}.bind(this)))},_onChange:function(e,t){if(t.preventDefault(),this._sortType=e,this.props.onChange(this._sortType),this.props.saveOrder){var s={};s["sort_panel_"+this.props.type]=this._sortType,userSetting.set({site:s})}},_sortType:"",_getElement:function(){var e={album:[{type:"ART_NAME",label:r("A - Z (artiste)")},{type:"ALB_TITLE",label:r("A - Z (album)")},{type:"DATE_CREATE",label:r("Ajoutés récemment")},{type:"TOP_ALBUM",label:r("Les plus écoutés")}],show:[{type:"SHOW_NAME",label:r("A - Z")},{type:"DATE_FAVORITE",label:r("Ajoutés récemment")}],playlist:[{type:"PLAYLIST_TITLE",label:r("A - Z")},{type:"DATE_UPDATE",label:r("Mises à jour récemment")},{type:"DATE_CREATE",label:r("Ajoutées récemment")},{type:"PLAYLIST_TYPE",label:r("Type")},{type:"TOP_PLAYLIST",label:r("Les plus écoutées")}],playlist_curator:[{type:"sortTitle",label:r("A - Z")},{type:"sortDate",label:r("Mises à jour récemment")}]};return e[this.props.type]?e[this.props.type]:[]}});t.exports=o},{"../../core/i18n":245,"@deezer/components/common/DropDown":118,react:"react"}],245:[function(e,t,s){"use strict";var a=e("i18next-client"),i={init:function(){var e=window.SETTING_LOCALE?window.SETTING_LOCALE.toLowerCase().substr(0,2):"en";a.init({debug:!1,resStore:window.translation,lng:e,fallbackLng:!1,useCookie:!1,lowerCaseLng:!0,keyseparator:"::",nsseparator:":::",postProcess:"sprintf"})},gettext:function(e,t){if(!arguments.length||!arguments[0])throw new Error("_() called with empty key");return t=t||{},a.t(e,t)},ngettext:function(e,t,s){if(!arguments.length||arguments.length<3)throw new Error("ngettext() called with incorrect number of arguments",arguments);if("undefined"==typeof s.count)throw new Error('ngettext() called with no "count" attribute',arguments);var i=parseInt(s.count,10);return"undefined"!=typeof s.sprintf?a.t(e,{count:i,postProcess:"sprintf",sprintf:s.sprintf}):a.t(e,{count:i})}};t.exports=i},{"i18next-client":"i18next-client"}],118:[function(e,t,s){"use strict";t.exports=e("./DropDown")},{"./DropDown":116}],116:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("./_elements/Item"),n=a.createClass({displayName:"DropDown",propTypes:{position:a.PropTypes.oneOf(["right","left","center"]),style:a.PropTypes.oneOf(["mini"]),"default-label":a.PropTypes.node,selected:a.PropTypes.number,children:a.PropTypes.arrayOf(a.PropTypes.node).isRequired},getDefaultProps:function(){return{selected:0}},getInitialState:function(){return{label:this.props.children[this.props.selected].props.label||this.props["default-label"],isOpen:!1}},componentWillReceiveProps:function(e){this.setState({label:e.children[e.selected].props.label||e["default-label"]})},render:function(){var e=this._getClasses(),t=e.containerClasses,s=e.buttonClasses,i=e.iconClasses,r=this.state.label;return"object"!=typeof r&&(r=a.createElement("span",{className:"label"},r)),a.createElement("span",{className:t},a.createElement("button",{className:s,type:"button",onClick:this._toggle},r,a.createElement("span",{className:i})),a.createElement("ul",{className:"dropdown-menu"},this.props.children))},_onClose:function(){document.removeEventListener("click",this._onClose),this.setState({isOpen:!1})},_toggle:function(){var e=!this.state.isOpen;this.setState({isOpen:e}),e&&document.addEventListener("click",this._onClose)},_getClasses:function(){return{containerClasses:i({"selectbox dropdown":!0,opened:this.state.isOpen,"pull-right":"right"===this.props.position,"pull-left":"left"===this.props.position}),buttonClasses:i({"btn btn-default dropdown-toggle":!0,"btn-mini":"mini"===this.props.style}),iconClasses:i({"icon icon-sort-desc color-primary":!0,"icon-sort-desc":"mini"===this.props.style,"icon-chevron-down":"mini"!==this.props.style})}}});n.Item=r,t.exports=n},{"./_elements/Item":117,classnames:"classnames",react:"react"}],117:[function(e,t,s){"use strict";var a=e("react"),i=a.createClass({displayName:"Item",propTypes:{children:a.PropTypes.node.isRequired},render:function(){return a.createElement("li",null,this.props.children)}});t.exports=i},{react:"react"}],237:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/keys")["default"];!function(){var e=["image/jpeg","image/png"],s=function(t){this._element=t,this._imgTag=!("IMG"!==this._element.tagName),this._url=this._element.getAttribute(this._imgTag?"src":"data-blurred"),this._mimeType=e[0],this._blurStrength=5,this._imgContainer=null,this._loadError=!1,this._callback=function(){}};s.prototype.setBlurStrength=function(e){return this._blurStrength=parseInt(e,10),this},s.prototype.setMimeType=function(t){return this._mimeType=~e.indexOf(t)?t:this._mimeType,this},s.prototype.setUrl=function(e){return this._url=e,this},s.prototype.setCallback=function(e){return this._callback="function"==typeof e?e:this._callback,this},s.prototype.render=function(){var e=document.createElement("canvas");if(!(!e.getContext||!e.getContext("2d"))==!1)return this._imgTag?this._element.src=this._url:this._element.style.backgroundImage="url("+this._url+")",this._callback();var t=new Image;t.crossOrigin="Anonymous";var s=this;t.onerror=function(){return s._imgContainer=this,s._loadError=!0,e.parentNode&&document.body.removeChild(e),s._imgTag?s._element.src=s._url:s._element.style.backgroundImage="url("+s._url+")",s._callback()},t.onload=function(){s._imgContainer=this;var a=this.width,i=this.height;e.setAttribute("width",a),e.setAttribute("height",i),e.setAttribute("style","image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: optimize-contrast;-ms-interpolation-mode: nearest-neighbor;"),e=document.body.appendChild(e);var r=e.getContext("2d"),n=r.canvas.width,o=r.canvas.height;r.drawImage(t,n/2-a/2,o/2-i/2),r.globalAlpha=.5;for(var l=-s._blurStrength;l<=s._blurStrength;l+=2)for(var c=-s._blurStrength;c<=s._blurStrength;c+=2)r.drawImage(e,c,l),c>=0&&l>=0&&r.drawImage(e,-(c-2.5),-(l-2.5));r.globalAlpha=1;var p;try{p=r.canvas.toDataURL(s._mimeType)}catch(d){p=s._url}return document.body.removeChild(e),s._imgTag?s._element.src=p:s._element.style.backgroundImage="url("+p+")",s._callback()},t.src=this._url},s.prototype.getProps=function(e){if(this._element){e!==Object(e)&&(e=[(e||"").toString()]);var t={};for(var s in e)this.hasOwnProperty("_"+e[s])&&(t[e[s]]=this["_"+e[s]]);return 1===a(t).length&&1===e.length?t[e[0]]:t}},s.prototype.destroy=function(){this._element&&(this._imgTag?this._element.src=this._url:this._element.style.backgroundImage=this._url)},"function"==typeof define&&define.amd?define(function(){return s}):"object"==typeof t&&t&&"object"==typeof t.exports&&t.exports?t.exports=s:window.Blurred=s}()},{"babel-runtime/core-js/object/keys":289}],289:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":302}],302:[function(e,t,s){e("../../modules/es6.object.keys"),t.exports=e("../../modules/$.core").Object.keys},{"../../modules/$.core":307,"../../modules/es6.object.keys":323}],323:[function(e,t,s){var a=e("./$.to-object");e("./$.object-sap")("keys",function(e){return function(t){return e(a(t))}})},{"./$.object-sap":317,"./$.to-object":320}],320:[function(e,t,s){var a=e("./$.defined");t.exports=function(e){return Object(a(e))}},{"./$.defined":309}],309:[function(e,t,s){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],317:[function(e,t,s){var a=e("./$.export"),i=e("./$.core"),r=e("./$.fails");t.exports=function(e,t){var s=(i.Object||{})[e]||Object[e],n={};n[e]=t(s),a(a.S+a.F*r(function(){s(1)}),"Object",n)}},{"./$.core":307,"./$.export":310,"./$.fails":311}],311:[function(e,t,s){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],310:[function(e,t,s){var a=e("./$.global"),i=e("./$.core"),r=e("./$.ctx"),n="prototype",o=function(e,t,s){var l,c,p,d=e&o.F,u=e&o.G,h=e&o.S,m=e&o.P,_=e&o.B,f=e&o.W,g=u?i:i[t]||(i[t]={}),y=u?a:h?a[t]:(a[t]||{})[n];u&&(s=t);for(l in s)c=!d&&y&&l in y,c&&l in g||(p=c?y[l]:s[l],g[l]=u&&"function"!=typeof y[l]?s[l]:_&&c?r(p,a):f&&y[l]==p?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[n]=e[n],t}(p):m&&"function"==typeof p?r(Function.call,p):p,m&&((g[n]||(g[n]={}))[l]=p))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,t.exports=o},{"./$.core":307,"./$.ctx":308,"./$.global":312}],312:[function(e,t,s){var a=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=a)},{}],308:[function(e,t,s){var a=e("./$.a-function");t.exports=function(e,t,s){if(a(e),void 0===t)return e;switch(s){case 1:return function(s){return e.call(t,s)};case 2:return function(s,a){return e.call(t,s,a)};case 3:return function(s,a,i){return e.call(t,s,a,i)}}return function(){return e.apply(t,arguments)}}},{"./$.a-function":304}],304:[function(e,t,s){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],307:[function(e,t,s){var a=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=a)},{}]},{},[]);;
require=function e(t,r,o){function n(s,i){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=r[s]={exports:{}};t[s][0].call(d.exports,function(e){var r=t[s][1][e];return n(r?r:e)},d,d.exports,e,t,r,o)}return r[s].exports}for(var a="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({2:[function(e,t,r){"use strict";var o=e("react"),n=e("react-dom"),a=e("../core/i18n");a.init(),window.gettext=a.gettext,window.ngettext=a.ngettext;var s=e("../tools/monitoring/resources"),i=s.reportSlowResources;Events.subscribe(Events.navigation.page_displayed,i);var c=e("../components/common/HotKeys");Events.ready(Events.user.initialized,function(){var e=document.getElementById("hotkeys_container");e&&n.render(o.createElement(c,null),e)});var l=e("../core/modal"),d=e("../core/context_menu"),p=e("../core/Blurred"),u=e("../core/util"),m=e("../models/track"),y=e("../core/favorite"),_=e("../core/landing"),h=e("../core/sharebox"),f=e("../core/clipboard"),b=e("../core/operator");window.modal=l,window.context_menu=d,window.Blurred=p,window.util=u,window.favorite=y,window.landing=_,window.sharebox=h,window.clipboard=f,window.Track=m,window.operator=b},{"../components/common/HotKeys":122,"../core/Blurred":237,"../core/clipboard":241,"../core/context_menu":242,"../core/favorite":243,"../core/i18n":245,"../core/landing":246,"../core/modal":247,"../core/operator":248,"../core/sharebox":249,"../core/util":250,"../models/track":252,"../tools/monitoring/resources":279,react:"react","react-dom":"react-dom"}],279:[function(e,t,r){"use strict";var o=/^https?:\/\/[^\/]+\.deezer(dev)?\.com\/(?!ajax)/,n=2e3,a=function s(){var e=gatekeeper.isAllowed("performance_monitoring"),t="performance"in window&&"getEntriesByType"in window.performance&&"clearResourceTimings"in window.performance&&window.performance.getEntriesByType("resource")instanceof Array;if(!e||!t)return void Events.unsubscribe(Events.navigation.page_displayed,s);var r=window.performance.getEntriesByType("resource");r=r.filter(function(e){var t=o.test(e.name),r=e.duration>n;return t&&r}),window.performance.clearResourceTimings(),r.length&&(r=r.map(function(e){var t=e.name,r=e.duration;return{name:t,duration:r}}),live.log.send("app_perf_resources",{resources:r}))};t.exports={reportSlowResources:a}},{}],248:[function(e,t,r){"use strict";var o=e("react"),n=e("react-dom"),a=e("jquery"),s=e("../components/operator/AssociationJourney"),i=e("./i18n"),c=i.gettext,l=e("./modal"),d={errorCodes:{"-1":"error","-2":"error_msisdn","-3":"error_email","-4":"error_code","-5":"error_provisionning","-6":"error_quota_security_code","-7":"error_quota_sms","-8":"error_quota_email","-12":"error_invalid_security_code","-53":"error_subscriber_code"},translation:{error:c("Une erreur est survenue, merci de réessayer plus tard."),error_msisdn:c("Numéro de téléphone invalide"),error_email:c("Adresse email invalide"),error_code:c("Code invalide"),error_subscriber_code:c("Code invalide"),error_invalid_security_code:c("Code erroné"),error_provisionning:c("Votre numéro n'est pas reconnu"),error_quota_sms:c("Une erreur est survenue, merci de réessayer plus tard."),error_quota_email:c("Une erreur est survenue, merci de réessayer plus tard."),error_quota_security_code:c("Une erreur est survenue, merci de réessayer plus tard."),error_password:c("Veuillez vérifier votre mot de passe."),association_type_enter_msisdn:c("Entrez votre numéro de téléphone "),association_type_enter_email:c("Entrez votre adresse email"),association_type_msisdn_placeholder:c("Mon numéro de téléphone"),association_type_email_placeholder:c("E-mail")},findSubscriber:function(e,t){sendRequest("/operator/ws/find_subscriber.php","json","subscriber_id="+encodeURIComponent(e),!0,function(e){t(JSON.parse(e.responseText))})},unlinkSubscriber:function(e,t){d.findSubscriber(e,function(e){api.call({method:"operator_unlinkAccount",data:e,success:t})})},unlinkSubscriberFromAccount:function(e){if("off"===a("#password_field_container").data("display"))return a("#password_field_container").show(),a("#password_field_container").data("display","on"),!0;var t=a("#password").val();return t.length<1?(www.drawFormResult("unlink_user_flash_message","form_error",d.translation.error_password),!0):void user.checkPassword(t,function(t){return t!==!0?(www.drawFormResult("unlink_user_flash_message","form_error",d.translation.error_password),!0):void d.unlinkSubscriber(e,function(e){var t,r;e!==!0?(t=c("Les comptes ont bien été dissociés."),r="form_error"):(t=c("Une erreur est survenue, merci de réessayer plus tard."),r="form_success"),www.drawFormResult("unlink_user_flash_message",r,t),a("#unlink_button").hide(),a("#unlink_user_flash_message").delay(3e3).fadeOut(function(){setTimeout(function(){window.location.reload(!0)},1e3)})})})},checkSubscriber:function(){try{var e=a("#subscriber_error"),t=a("#subscriber_id").val();"string"==typeof t&&t.length>0&&sendRequest("/ajax/action.php","text","type=operator_check_subscriber&subscriber_id="+encodeURIComponent(t),!0,function(r){var o=!1;if("undefined"!=typeof r.responseText&&(o=r.responseText),o===!1)return e.html(d.translation.error).show(),!1;var n="";switch(o){case"fail":n="/operator/fail.php?phone="+encodeURIComponent(t);break;case"success_service":n=0!==USER.USER_ID?"/operator/confirm.php":"/operator/login_register.php";break;case"success_msisdn":case"success_email":n="/operator/code.php";break;default:var a=d.translation.error;return"string"==typeof d.translation[o]?a=d.translation[o]:-1===o.indexOf("error_")&&(a=o),e.html(a).show(),!0}return l.open(n,!0),!0})}catch(r){"undefined"!=typeof console&&error.log(r)}},checkCode:function(){try{var e=a("#activation_error"),t=a("#security_code").val();"string"==typeof t&&t.length>0&&sendRequest("/ajax/action.php","text","type=operator_check_activation_code&code="+encodeURIComponent(t),!0,function(t){var r=!1;if("undefined"!=typeof t.responseText&&(r=t.responseText),r===!1)return e.html(d.translation.error).show(),!1;if("success"===r){if(USER.USER_ID>0)var o="/operator/confirm.php";else var o="/operator/login_register.php";l.open(o,!0)}else if(r.indexOf("tnb_subscribe_force")>=0){var n=r.split("_"),a=n[n.length-1];o="/operator/subscribe/"+a+"/billing?force=1",window.location=SETTING_HOST_SITE+o}else if(r.indexOf("tnb_subscribe_link")>=0){var n=r.split("_"),a=n[n.length-1];o="/operator/subscribe/"+a+"/billing?link=1",window.location=SETTING_HOST_SITE+o}else{var s=d.translation.error;"string"==typeof d.translation[r]&&(s=d.translation[r]),e.html(s).show()}return!0})}catch(r){"undefined"!=typeof console&&error.log(r)}},initAssociationJourney:function(e,t,r,a,i){try{if(e>0){var c={operatorId:e,associationType:t,subscriberId:r,code:a,insideApp:i};n.render(o.createElement(s,c),document.getElementById("operator_association"))}}catch(l){"undefined"!=typeof console&&error.log(l)}}};t.exports=d},{"../components/operator/AssociationJourney":184,"./i18n":245,"./modal":247,jquery:"jquery",react:"react","react-dom":"react-dom"}],184:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("./_elements/Form"),s=e("./_elements/ErrorMessage"),i=e("./_elements/Success"),c=o.createClass({displayName:"AssociationJourney",mixins:[n],getDefaultProps:function(){return{operatorId:0,associationType:null,code:"",subscriberId:"",insideApp:!1}},getInitialState:function(){return{operatorId:this.props.operatorId,associationType:this.props.associationType,code:this.props.code,subscriberId:this.props.subscriberId,error:!1,success:!1,message:{label:""},displayBlock:""}},componentDidMount:function(){var e=document.getElementById("operator_association");e.addEventListener("FormUpdate",this._onFormUpdate),e.addEventListener("FormSuccess",this._onFormSuccess),e.addEventListener("FormError",this._onFormError)},componentWillUnmount:function(){var e=document.getElementById("operator_association");e.removeEventListener("FormUpdate",this._onFormUpdate),e.removeEventListener("FormSuccess",this._onFormSuccess),e.removeEventListener("FormError",this._onFormError)},render:function(){return o.createElement("div",null,o.createElement(a,{operatorId:this.state.operatorId,associationType:this.state.associationType,code:this.state.code,subscriberId:this.state.subscriberId,display:this.state.error===!1&&this.state.success===!1,displayBlock:this.state.displayBlock,message:this.state.message}),o.createElement(s,{display:this.state.error}),o.createElement(i,{display:this.state.success,subscriberId:this.state.subscriberId,message:this.state.message,insideApp:this.props.insideApp}))},_onFormUpdate:function(e){var t=e.detail;t.success=!1,this.setState(t)},_onFormSuccess:function(e){this.setState({success:!0,message:e.detail})},_onFormError:function(){this.setState({error:!0})}});t.exports=c},{"./_elements/ErrorMessage":185,"./_elements/Form":186,"./_elements/Success":192,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],192:[function(e,t,r){"use strict";var o=e("react"),n=e("../../../core/CustomEvent"),a=e("../../../core/i18n"),s=a.gettext,i=o.createClass({displayName:"Success",getDefaultProps:function(){return{display:!1,message:{label:""},insideApp:!1,subscriberId:""}},render:function(){var e=SETTING_HOST_SITE,t=SETTING_HOST_SITE,r="",n="";this.props.insideApp===!0?(e+="/lightbox/register.php",t+="/lightbox/login.php"):(e+="/register",t+="/login");var a=this.props.message;return null===a&&(a={label:""}),"object"==typeof a&&"object"==typeof a.termsConditions&&(r=e,n=t,e="#",t="#"),o.createElement("div",{style:{display:this.props.display?"block":"none"}},o.createElement("div",{id:"operator_association_success_logged",style:{display:USER.USER_ID>0?"block":"none"}},o.createElement("div",{className:"modal-header"},a.label)),o.createElement("div",{id:"operator_association_success_unlogged",style:{display:0===USER.USER_ID?"block":"none"}},o.createElement("div",{className:"modal-header"},s("Félicitations ! Voulez-vous utiliser un compte Deezer existant ou en créer un nouveau ?")),o.createElement("div",{className:"modal-body"},o.createElement("div",{className:"wrapper center"},s("J'ai déjà un compte"),o.createElement("br",null),o.createElement("br",null),o.createElement("div",{className:"form-wrapper"},o.createElement("a",{href:t,className:"btn btn-primary btn-large btn-block",onClick:this._displayTermsConditions.bind(this,n)},o.createElement("span",{className:"label"},s("CONNEXION")))),o.createElement("br",null),o.createElement("br",null),s("Pas encore de compte Deezer ?"),o.createElement("br",null),o.createElement("br",null),o.createElement("div",{className:"form-wrapper"},o.createElement("a",{href:e,className:"btn btn-primary btn-large btn-block",onClick:this._displayTermsConditions.bind(this,r)},o.createElement("span",{className:"label"},s("INSCRIPTION"))))))))},_displayTermsConditions:function(e,t){if("string"==typeof e&&""!==e){t.preventDefault(),t.stopPropagation();var r=this.props.message.termsConditions;r.redirect=e;var o=document.getElementById("operator_association"),a=new n("FormUpdate",{detail:{displayBlock:"termsconditions",message:r}});o.dispatchEvent(a)}}});t.exports=i},{"../../../core/CustomEvent":238,"../../../core/i18n":245,react:"react"}],186:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=(a.gettext,e("./FormMixed")),i=e("./FormSubscriber"),c=e("./FormCode"),l=e("./FormCheckCode"),d=e("./FormTermsConditions"),p=o.createClass({displayName:"Form",mixins:[n],getDefaultProps:function(){return{operatorId:0,associationType:null,code:"",subscriberId:"",display:!1,displayBlock:"",message:{label:""}}},render:function(){var e={};return""!==this.props.displayBlock?(e.code=e.subscriber=e.checkCode=e.mixed=e.termsconditions=!1,e[this.props.displayBlock]=!0):(e.code="code"===this.props.associationType,e.subscriber="msisdn"===this.props.associationType||"email"===this.props.associationType||""!==this.props.subscriberId,e.checkCode=""!==this.props.code||""!==this.props.subscriberId,e.mixed="mixed"===this.props.associationType&&e.subscriber===!1&&e.checkCode===!1&&e.code===!1,e.termsconditions=!1),o.createElement("div",{style:{display:this.props.display?"block":"none"}},o.createElement("div",{className:"modal-header",style:{display:e.termsconditions===!1?"block":"none"}},operator.translation.association_type_title),o.createElement("div",{className:"modal-body"},o.createElement("div",{className:"wrapper",style:{display:e.termsconditions===!1?"block":"none"}},o.createElement(c,{operatorId:this.props.operatorId,display:e.code}),o.createElement(i,{operatorId:this.props.operatorId,associationType:this.props.associationType,subscriberId:this.props.subscriberId,display:e.subscriber,disableInput:e.checkCode}),o.createElement(l,{operatorId:this.props.operatorId,subscriberId:this.props.subscriberId,code:this.props.code,error:"",display:e.checkCode}),o.createElement(s,{display:e.mixed})),o.createElement(d,{operatorId:this.props.operatorId,display:e.termsconditions,termsConditions:this.props.message})))}});t.exports=p},{"../../../core/i18n":245,"./FormCheckCode":187,"./FormCode":188,"./FormMixed":189,"./FormSubscriber":190,"./FormTermsConditions":191,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],191:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=a.gettext,i=e("../../../core/modal"),c=e("../../../core/CustomEvent"),l=e("../../_mixins/associationJourney"),d=o.createClass({displayName:"FormTermsConditions",mixins:[l,n],getDefaultProps:function(){return{operatorId:0,subscriberId:"",display:!1,termsConditions:this._termsConditions}},getInitialState:function(){return{error:"",submitButton:{className:"btn btn-primary"}}},render:function(){var e=this.props.termsConditions;if(null===this.props.termsConditions||"object"!=typeof this.props.termsConditions)var e=this._termsConditions;return o.createElement("div",{id:"operator_termsconditions",style:{display:this.props.display===!1?"none":"block"}},o.createElement("div",{className:"modal-header"},e.TITLE),o.createElement("div",{className:"modal-body"},o.createElement("div",{className:"wrapper"},o.createElement("span",{dangerouslySetInnerHTML:{__html:e.TEXT}}),o.createElement("br",null),o.createElement("br",null),o.createElement("u",null,o.createElement("a",{href:e.LINK,target:"_blank"},e.LINK_TEXT))),o.createElement("div",{className:"form-wrapper"},o.createElement("div",{className:"operator-enter-input-false",style:{display:""!==this.state.error?"block":"none"}},o.createElement("span",{className:"icon icon-cancel"})," ",o.createElement("span",{"data-id":"error-label",dangerouslySetInnerHTML:{__html:this.state.error}})))),o.createElement("div",{className:"modal-footer"},o.createElement("div",{className:"action"},o.createElement("button",{className:"btn btn-default",type:"button",onClick:this._discardTermsConditions},o.createElement("span",{className:"label"},s("Plus tard"))),o.createElement("button",{className:this.state.submitButton.className,type:"button",onClick:this._confirmTermsConditions},o.createElement("span",{className:"label"},s("Confirmer"))))))},_termsConditions:{TITLE:"",TEXT:"",LINK:"",LINK_TEXT:"",redirect:SETTING_HOST_SITE,subscriberId:""},_discardTermsConditions:function(e){if(e.preventDefault(),e.stopPropagation(),0===USER.USER_ID){var t=document.getElementById("operator_association"),r=new c("FormSuccess",{detail:{termsConditions:this.props.termsConditions}});t.dispatchEvent(r)}else i.close()},_confirmTermsConditions:function(e){if(this.state.submitButton.className.indexOf("disabled")>0)return!1;this.setState({submitButton:{className:this.state.submitButton.className+" disabled"}}),e.preventDefault(),e.stopPropagation();var t=this;api.call({method:"operator_associationjourney_confirmTermsConditions",data:{SUBSCRIBER_ID:t.props.termsConditions.subscriberId},success:function(e){0===USER.USER_ID?document.location.href=t.props.termsConditions.redirect:document.location.href=e.redirection},error:function(e){return this.isMounted()?(t.setState({submitButton:{className:t.state.submitButton.className.replace(" disabled","")}}),"object"==typeof e.payload&&"string"==typeof e.payload.LABEL&&""!==e.payload.LABEL?t.setState({error:e.payload.LABEL}):t.setState({error:operator.translation.error}),!0):void 0}})}});t.exports=d},{"../../../core/CustomEvent":238,"../../../core/i18n":245,"../../../core/modal":247,"../../_mixins/associationJourney":34,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],190:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=a.gettext,i=e("../../../core/CustomEvent"),c=e("../../_mixins/associationJourney"),l=o.createClass({displayName:"operator/associationjourney/form_subscriber",mixins:[c,n],getDefaultProps:function(){return{operatorId:0,associationType:null,subscriberId:"",display:!1,disableInput:!1}},getInitialState:function(){return{error:"",success:""}},render:function(){var e="text",t=s("Pour modifier votre code, cliquez ici."),r=s("Entrez votre adresse email"),n=s("E-mail");"msisdn"===this.props.associationType&&(e="tel",r=s("Entrez votre numéro de téléphone "),n=s("Mon numéro de téléphone"),t=s("Pour modifier votre numéro de téléphone, cliquez ici.")),"string"==typeof operator.translation.association_type_enter_invite&&""!==operator.translation.association_type_enter_invite&&(r=operator.translation.association_type_enter_invite,n=""),"string"==typeof operator.translation.association_type_enter_edit&&""!==operator.translation.association_type_enter_edit&&(t=operator.translation.association_type_enter_edit);var a="",i="";return""!==this.state.error?a=this.state.error:this.state.success===!0&&(i=operator.translation.association_type_code_info?operator.translation.association_type_code_info:s("msisdn"===this.props.associationType?"Vous allez recevoir un code par SMS afin de valider votre offre.":"Vous allez recevoir un code par email afin de valider votre offre.")),o.createElement("div",null,o.createElement("div",{id:"operator_subscriber",style:{display:this.props.display?"block":"none"}},o.createElement("div",{className:"enter-input",dangerouslySetInnerHTML:{__html:r}}),o.createElement("div",{className:"form-wrapper"},o.createElement("div",{className:"form-group"},o.createElement("form",{className:"form-inline"},o.createElement("div",{className:"control-table"},o.createElement("div",{className:"control-input"},o.createElement("input",{className:"form-control",type:e,placeholder:n,ref:"input_subscriber_id",defaultValue:this.props.subscriberId,disabled:this.props.disableInput})),o.createElement("div",{className:"control-submit",style:{display:this.props.disableInput===!1?"block":"none"}},o.createElement("button",{type:"submit",className:"btn btn-primary btn-large",onClick:this._checkSubscriberActivation},o.createElement("span",{className:"label"},s("OK"))))))),o.createElement("div",{className:"operator-enter-input-edit",style:{display:this.props.disableInput?"block":"none"},onClick:this._editForm},o.createElement("span",{className:"icon icon-chevron-right"})," ",o.createElement("i",null,t)),o.createElement("div",{className:"operator-enter-input-true",style:{display:""!==i?"block":"none"}},o.createElement("span",{className:"icon icon-check"})," ",i),o.createElement("div",{className:"operator-enter-input-false",style:{display:""!==a?"block":"none"}},o.createElement("span",{className:"icon icon-cancel"})," ",o.createElement("span",{"data-id":"error-label",dangerouslySetInnerHTML:{__html:a}})))))},_editForm:function(e){e.preventDefault(),e.stopPropagation(),this.setState({error:"",success:""});var t=document.getElementById("operator_association"),r=new i("FormUpdate",{detail:{displayBlock:"subscriber",subscriberId:this.refs.input_subscriber_id.value.trim(),error:!1,success:!1}});t.dispatchEvent(r)},_checkSubscriberActivation:function(e){e.preventDefault(),e.stopPropagation();var t,r,o=this;api.call({method:"operator_associationjourney_checkActivation",data:{OPERATOR_ID:o.props.operatorId,SUBSCRIBER_ID:o.refs.input_subscriber_id.value.trim(),ACTIVATION_TYPE:this.props.associationType},success:function(e){if(r=document.getElementById("operator_association"),5===e.code&&"object"==typeof e.payload){var n=e.payload;n.subscriberId=o.refs.input_subscriber_id.value.trim(),t=0===USER.USER_ID?new i("FormSuccess",{detail:{termsConditions:n}}):new i("FormUpdate",{detail:{displayBlock:"termsconditions",message:n}}),r.dispatchEvent(t)}else 4===e.code?0===USER.USER_ID?(t=new i("FormSuccess"),r.dispatchEvent(t)):o.linkAssociationJourneyAccount(o.props.operatorId):(t=new i("FormUpdate",{detail:{displayBlock:"",subscriberId:o.refs.input_subscriber_id.value.trim(),code:""}}),r.dispatchEvent(t),o.isMounted()&&o.setState({success:!0,error:""}))},error:function(e){if("object"==typeof e.payload&&"string"==typeof e.payload.LABEL&&""!==e.payload.LABEL)o.setState({error:e.payload.LABEL});else if("string"==typeof operator.errorCodes[e.description]&&"string"==typeof operator.translation[operator.errorCodes[e.description]]){var t=operator.errorCodes[e.description];("error_code"===t||"error"===t)&&("msisdn"===o.props.associationType?t="error_msisdn":"email"===o.props.associationType&&(t="error_email")),o.setState({error:operator.translation[t]})}else o.setState({error:operator.translation.error});return!0}})}});t.exports=l},{"../../../core/CustomEvent":238,"../../../core/i18n":245,"../../_mixins/associationJourney":34,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],189:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=a.gettext,i=e("../../../core/CustomEvent"),c=o.createClass({displayName:"FormMixed",mixins:[n],getDefaultProps:function(){return{display:!1}},render:function(){var e=s("Merci de nous indiquer si vous êtes client mobile ou Internet.");"string"==typeof operator.translation.association_type_mixed_enter_invite&&""!==operator.translation.association_type_mixed_enter_invite&&(e=operator.translation.association_type_mixed_enter_invite);var t=s("Client mobile");"string"==typeof operator.translation.association_type_mixed_enter_mobile&&""!==operator.translation.association_type_mixed_enter_mobile&&(t=operator.translation.association_type_mixed_enter_mobile);var r=s("Client Internet");return"string"==typeof operator.translation.association_type_mixed_enter_email&&""!==operator.translation.association_type_mixed_enter_email&&(r=operator.translation.association_type_mixed_enter_email),o.createElement("div",null,o.createElement("div",{id:"operator_mixed",style:{display:this.props.display===!1?"none":"block"}},o.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),o.createElement("br",null),o.createElement("br",null),o.createElement("div",{className:"form-wrapper"},o.createElement("a",{href:"#",className:"btn btn-primary btn-large btn-block",onClick:this._setAssociationType.bind(this,"msisdn")},t),o.createElement("a",{href:"#",className:"btn btn-primary btn-large btn-block",onClick:this._setAssociationType.bind(this,"email")},r))))},_setAssociationType:function(e,t){t.preventDefault(),t.stopPropagation();var r=document.getElementById("operator_association"),o=new i("FormUpdate",{detail:{associationType:e}});r.dispatchEvent(o)}});t.exports=c},{"../../../core/CustomEvent":238,"../../../core/i18n":245,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],188:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=a.gettext,i=e("../../../core/CustomEvent"),c=e("../../_mixins/associationJourney"),l=o.createClass({displayName:"FormCode",mixins:[c,n],getDefaultProps:function(){return{operatorId:0,associationType:null,display:!1}},getInitialState:function(){return{error:""}},render:function(){var e=s("Introduisez votre numéro de téléphone ou votre code d'activation.");"string"==typeof operator.translation.association_type_enter_invite&&""!==operator.translation.association_type_enter_invite&&(e=operator.translation.association_type_enter_invite);var t="";return""!==this.state.error&&(t=this.state.error),o.createElement("div",null,o.createElement("div",{id:"operator_subscriber",style:{display:this.props.display?"block":"none"}},o.createElement("div",{className:"enter-input",dangerouslySetInnerHTML:{__html:e}}),o.createElement("div",{className:"form-wrapper"},o.createElement("div",{className:"form-group"},o.createElement("form",{className:"form-inline"},o.createElement("div",{className:"control-table"},o.createElement("div",{className:"control-input"},o.createElement("input",{className:"form-control",type:"text",ref:"input_code"})),o.createElement("div",{className:"control-submit"},o.createElement("button",{type:"submit",className:"btn btn-primary btn-large",onClick:this._checkSubscriberActivation},o.createElement("span",{className:"label"},s("OK"))))))),o.createElement("div",{className:"operator-enter-input-false",style:{display:""!==t?"block":"none"}},o.createElement("span",{className:"icon icon-cancel"})," ",o.createElement("span",{"data-id":"error-label",dangerouslySetInnerHTML:{__html:t}})))))},_checkSubscriberActivation:function(e){e.preventDefault(),e.stopPropagation();var t,r,o=this;return api.call({method:"operator_associationjourney_checkActivation",data:{OPERATOR_ID:o.props.operatorId,SUBSCRIBER_ID:o.refs.input_code.value.trim(),ACTIVATION_TYPE:this.props.associationType},success:function(e){if(5===e.code&&"object"==typeof e.payload){r=document.getElementById("operator_association");var n=e.payload;n.subscriberId=o.refs.input_code.value.trim(),t=new i("FormSuccess",{detail:{termsConditions:n}}),r.dispatchEvent(t)}else if(4===e.code)0===USER.USER_ID?(r=document.getElementById("operator_association"),t=new i("FormSuccess"),r.dispatchEvent(t)):o.linkAssociationJourneyAccount(o.props.operatorId);else{if(!o.isMounted())return;o.setState({error:operator.translation.error})}},error:function(e){if("object"==typeof e.payload&&"string"==typeof e.payload.LABEL&&""!==e.payload.LABEL)o.setState({error:e.payload.LABEL});else if("string"==typeof operator.errorCodes[e.description]&&"string"==typeof operator.translation[operator.errorCodes[e.description]]){var t=operator.errorCodes[e.description];"error"===t&&(t="error_code"),o.setState({error:operator.translation[t]})}else o.setState({error:operator.translation.error});return!0}}),!1}});t.exports=l},{"../../../core/CustomEvent":238,"../../../core/i18n":245,"../../_mixins/associationJourney":34,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],187:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=a.gettext,i=e("../../../core/CustomEvent"),c=e("../../_mixins/associationJourney"),l=o.createClass({displayName:"FormCheckCode",mixins:[c,n],getDefaultProps:function(){return{subscriberId:"",code:"",operatorName:"",display:!1,error:""}},getInitialState:function(){return{error:this.props.error}},componentWillReceiveProps:function(e){"string"==typeof e.error&&this.setState({error:e.error})},render:function(){var e="";""!==this.state.error&&(e=this.state.error);var t="";return t=operator.translation.association_type_code_invite?operator.translation.association_type_code_invite:s("Entrez le code que nous venons de vous envoyer pour finaliser votre activation %1$s",{sprintf:[this.props.operatorName]}),o.createElement("div",null,o.createElement("div",{id:"operator_code",style:{display:this.props.display===!1?"none":"block"}},o.createElement("div",{className:"enter-security-code"},t),o.createElement("div",{className:"form-wrapper"},o.createElement("form",{className:"form-inline",role:"form"},o.createElement("div",{className:"control-table"},o.createElement("div",{className:"control-input"},o.createElement("input",{className:"form-control",type:"tel",placeholder:"",defaultValue:this.props.code,ref:"input_code"})),o.createElement("div",{className:"control-submit"},o.createElement("button",{type:"submit",className:"btn btn-primary btn-large",onClick:this._checkActivationCode},o.createElement("span",{className:"label"},s("OK"))))))),o.createElement("div",{className:"operator-enter-input-false",style:{display:""!==e?"block":"none"}},o.createElement("span",{className:"icon icon-cancel"})," ",o.createElement("span",{"data-id":"error-label",dangerouslySetInnerHTML:{__html:e}}))))},_checkActivationCode:function(e){e.preventDefault(),e.stopPropagation();var t,r,o=this;api.call({method:"operator_associationjourney_checkActivationCode",data:{OPERATOR_ID:o.props.operatorId,CODE:o.refs.input_code.value.trim()},success:function(e){if(5===e.code&&"object"==typeof e.payload){r=document.getElementById("operator_association");var n=e.payload;n.subscriberId=o.props.subscriberId,t=0===USER.USER_ID?new i("FormSuccess",{detail:{termsConditions:n}}):new i("FormUpdate",{detail:{displayBlock:"termsconditions",message:n}}),r.dispatchEvent(t)}else 0===USER.USER_ID?(r=document.getElementById("operator_association"),t=new i("FormSuccess"),r.dispatchEvent(t)):o.linkAssociationJourneyAccount(o.props.operatorId)},error:function(e){var t="";return t="object"==typeof e.payload&&"string"==typeof e.payload.LABEL&&""!==e.payload.LABEL?e.payload.LABEL:"string"==typeof operator.errorCodes[e.description]&&"string"==typeof operator.translation[operator.errorCodes[e.description]]?operator.translation[operator.errorCodes[e.description]]:s("Code erroné"),o.setState({error:t}),!0}})}});t.exports=l},{"../../../core/CustomEvent":238,"../../../core/i18n":245,"../../_mixins/associationJourney":34,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],34:[function(e,t,r){"use strict";var o=e("../../core/i18n"),n=o.gettext,a=e("../../core/CustomEvent"),s={getInitialState:function(){return{associationType:""}},linkAssociationJourneyAccount:function(e){var t,r=this;try{if(!(USER.USER_ID>0))return!1;api.call({method:"operator_associationjourney_linkAccount",data:{USER_ID:USER.USER_ID,OPERATOR_ID:e},success:function(e){if(e===!1||"object"!=typeof e.offer||"string"!=typeof e.redirection)t=new a("FormError");else{var r=e.offer.label;""===r&&"string"==typeof e.offer.name&&(r=e.offer.name);var o={};o.label=n("Félicitations ! Votre option a bien été activée. Vous êtes désormais abonné à %1$s.",{sprintf:[r]}),t=new a("FormSuccess",{detail:o}),window.setTimeout(function(){document.location.href=e.redirection},5e3)}var s=document.getElementById("operator_association");s.dispatchEvent(t)},error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){if("object"==typeof e.payload&&"string"==typeof e.payload.LABEL&&""!==e.payload.LABEL)r.setState({error:e.payload.LABEL});else if("string"==typeof operator.errorCodes[e.description]&&"string"==typeof operator.translation[operator.errorCodes[e.description]]){var t=operator.errorCodes[e.description];r.setState({error:operator.translation[t]})}else r.setState({error:operator.translation.error})})})}catch(o){return"undefined"!=typeof console&&error.log(o),!1}}};t.exports=s},{"../../core/CustomEvent":238,"../../core/i18n":245}],238:[function(e,t,r){"use strict";function o(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r}o.prototype=window.Event.prototype,t.exports=o},{}],185:[function(e,t,r){"use strict";var o=e("react"),n=e("react-addons-pure-render-mixin"),a=e("../../../core/i18n"),s=a.gettext,i=o.createClass({displayName:"ErrorMessage",mixins:[n],getDefaultProps:function(){return{display:!1}},render:function(){return o.createElement("div",{style:{display:this.props.display?"block":"none"}},o.createElement("div",{id:"operator_association_error"},o.createElement("div",{className:"modal-header"},s("Une erreur est survenue, merci de réessayer plus tard."))))}});t.exports=i},{"../../../core/i18n":245,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],246:[function(e,t,r){"use strict";var o=e("react"),n=e("react-dom"),a=e("./Blurred"),s=e("../components/common/Thumbnail"),i={init:function(){var e=document.getElementById("track"),t=document.getElementById("page-bg"),r=SETTING_DOMAIN_IMG+"/cover/"+e.getAttribute("data-img")+"/1200x1200-000000-80-0-0.jpg";window.PLATFORM===!1?new a(t).setUrl(r).setBlurStrength(7).render():(t.style.backgroundImage="url("+r+")",t.classList.add("blur-bg"));var i={id:Number(e.getAttribute("data-track-id")),play:!0,type:"track",picture_type:"cover",md5:e.getAttribute("data-img"),display_size:!1,width:250,height:250};n.render(o.createElement(s,i),e);var c=document.getElementById("home_account_fb");c.addEventListener("click",function(){facebook.login({skip_onboarding:!0}),tracking.track("landing_click",{track_id:e.getAttribute("data-track-id"),name:e.getAttribute("data-track-name"),instance:"button"})}),playercontrol.init(),e.addEventListener("click",function(){tracking.track("landing_click",{track_id:e.getAttribute("data-track-id"),name:e.getAttribute("data-track-name"),instance:"track_cover"})});var l=document.getElementById("index-header");l.addEventListener("click",function(t){("login_button"===t.target.id||"signup_button"===t.target.id)&&tracking.track("landing_click",{track_id:e.getAttribute("data-track-id"),name:e.getAttribute("data-track-name"),instance:"login_button"===t.target.id?"login":"register"})})}};t.exports=i},{"../components/common/Thumbnail":130,"./Blurred":237,react:"react","react-dom":"react-dom"}],241:[function(e,t,r){"use strict";var o=e("./sharebox"),n={getUrl:function(e,t,r){"string"==typeof e&&(e=o.typeToId(e)),r="function"==typeof r?r:function(){},api.call("share.getClipboardUrl",{type:e,id:t},r)}};t.exports=n},{"./sharebox":249}],249:[function(e,t,r){"use strict";var o=e("react"),n=e("react-dom"),a=e("./modal"),s=e("../components/modal/sharebox/Render"),i={song:0,album:1,artist:2,playlist:3,radio:4,smart_radio:6,smartradio:6,sradio:6,show:7,episode:8},c=function(){this.type=-1,this.id=0,this.data={},this.options={}};c.prototype.render=function(e,t,r,i){this.type=Math.abs(parseInt(e||0,10)),this.id=Math.abs(parseInt(t||0,10)),this.data=r||{},this.options=i||{};try{this._checkCtorData()}catch(c){return void error.log(c.message)}a.setReactElement("sharebox");var l={id:this.id,type:this.type,data:this.data,options:this.options};n.render(o.createElement(s,l),document.getElementById("modal_sharebox"))},c.prototype.close=function(e){return Boolean(e)===!0?void(window.location.href="dzr://share?action=close"):void a.close()},c.prototype.typeToId=function(e){return e=String(e||""),i[e]},c.prototype.idToType=function(e){for(var t in i)if(i.hasOwnProperty(t)&&i[t]===e)return t;return error.log(new Error("Sharebox :: idToType - Can not match the specified id with a type")),""},c.prototype._checkCtorData=function(){if(this.type<0)throw new Error("Sharebox :: _validateCtorData - type is missing");if(this.id<=0)throw new Error("Sharebox :: _validateCtorData - id is missing");if(this.data!==Object(this.data)||Array.isArray(this.data))throw new Error("Sharebox :: _validateCtorData - data is not a valid object");if(this.options!==Object(this.options)||Array.isArray(this.options))throw new Error("Sharebox :: _validateCtorData - options is not a valid object")};var l=new c,d={load:function(e,t,r){"string"==typeof e&&(e=d.typeToId(e)),e=parseInt(e||0,10),t=parseInt(t||0,10),r=String(r||"");var o="/lightbox/sharebox?type="+e+"&id="+t;return r.length&&(o+="&context="+r),USER.USER_ID?a.open(o):www.goToConnection({redirect_type:"modal",redirect_link:encodeURIComponent(o)})},render:function(e,t,r,o){return l.render(e,t,r,o)},close:function(e){return l.close(e)},typeToId:function(e){return l.typeToId(e)},idToType:function(e){return l.idToType(e)}};t.exports=d},{"../components/modal/sharebox/Render":176,"./modal":247,react:"react","react-dom":"react-dom"}],122:[function(e,t,r){"use strict";var o=e("react"),n=e("classnames"),a=e("mousetrap"),s=e("jquery"),i=e("../../core/i18n"),c=i.gettext,l=o.createClass({displayName:"HotKeys",getInitialState:function(){return{opened:!1}},componentDidMount:function(){this._bindKeys(["0","1","2","3","4","5","6","7","8","9"],this._seekToPosition,{label:c("Aller à la position"),shortcut:"0...9",display_size:"wide"}),this._bindKeys("space",this._togglePlayerPause,{label:c("Lecture/Pause"),shortcut:c("Espace"),display_size:"wide"}),this._bindKeys("enter",this._togglePlayAll,{label:c("Lire les titres présents sur la page"),shortcut:"⏎",display_size:"wide"}),this._bindKeys(["s","shift+s"],this._focusSearchField,{label:c("Rechercher"),shortcut:"S"}),this._bindKeys("left",this._seekBack,{label:c("Reculer"),shortcut:"←"}),this._bindKeys("right",this._seekForward,{label:c("Avancer"),shortcut:"→"}),this._bindKeys("r",this._restartTrack,{label:c("Rejouer le titre"),shortcut:"R"}),this._bindKeys("shift+left",dzPlayer.control.prevSong,{label:c("Lire le titre précédent"),shortcut:"⇧←"}),this._bindKeys("shift+right",dzPlayer.control.nextSong,{label:c("Lire le titre suivant"),shortcut:"⇧→"}),this._bindKeys(["m","shift+m"],this._mute,{label:c("Silence"),shortcut:"M"}),this._bindKeys("shift+up",this._increaseVolume,{label:c("Augmenter le volume"),shortcut:"⇧↑"}),this._bindKeys("shift+down",this._decreaseVolume,{label:c("Baisser le volume"),shortcut:"⇧↓"}),this._bindKeys(["l","shift+l"],this._addToFavorites,{label:c("Ajouter le titre aux Coups de cœur"),shortcut:"L"}),this._bindKeys("shift+r",this._toggleRepeat,{label:c("Mode de répétition"),shortcut:"⇧R"}),this._bindKeys(["h","shift+h"],this._toggleHotKeysPanel,{label:c("Afficher les raccourcis clavier"),shortcut:"H"}),this._bindKeys("up up down down left right left right b a enter",this._konami)},componentWillUnmount:function(){this._keysCache.forEach(function(e){a.unbind(e.keys)})},render:function(){var e=n({opened:this.state.opened});return o.createElement("div",{id:"hotkeys",className:e,"aria-hidden":!this.state.opened},o.createElement("div",{className:"topbar"}),o.createElement("div",{className:"mapping"},this._keysCache.map(function(e,t){return o.createElement("div",{key:"key_"+t},this._renderKeys(e))}.bind(this))))},_renderKeys:function(e){if(!e.label)return null;var t="wide"!==e.display_size?e.shortcut.split(""):[e.shortcut],r=n({"hotkey-icon":!0,wide:"wide"===e.display_size,single:"wide"!==e.display_size&&1===t.length});return o.createElement("div",{className:"hotkey"},t.map(function(e,t){return e?o.createElement("div",{className:r,key:"shortcut"+t},e):null}),o.createElement("div",{className:"hotkey-label"},e.label))},_keysCache:[],_bindKeys:function(e,t,r){r=r||{},a.bind(e,t),this._keysCache.push({keys:e,label:r.label,shortcut:r.shortcut||"",display_size:r.display_size||"small"})},_toggleHotKeysPanel:function(){this.setState({opened:!this.state.opened})},_togglePlayerPause:function(e){e.preventDefault(),dzPlayer.control.togglePause()},_togglePlayAll:function(e){e.preventDefault();var t=s(".datagrid_master");t.length&&datagrid.action(t,["play",s("")])},_focusSearchField:function(e){e.preventDefault(),document.getElementById("menu_search").focus()},_seekBack:function(){dzPlayer.isPlaying()||dzPlayer.control.play();var e=(dzPlayer.getPosition()/dzPlayer.getDuration()-.05).toFixed(3);this._handleSeekPosition(e)},_seekForward:function(){dzPlayer.isPlaying()||dzPlayer.control.play();var e=(dzPlayer.getPosition()/dzPlayer.getDuration()+.05).toFixed(3);this._handleSeekPosition(e)},_seekToPosition:function(e,t){var r=parseFloat(t)/10;return 0===r&&(r=1e-5),this._handleSeekPosition(r)},_restartTrack:function(){this._handleSeekPosition(1e-4)},_mute:function(){dzPlayer.control.mute(!dzPlayer.isMuted())},_addToFavorites:function(){if("ads"!==dzPlayer.getPlayerType()&&"jingle"!==dzPlayer.getPlayerType()&&dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_SONG){var e=dzPlayer.getCurrentSong("SNG_ID"),t=userData.isFavorite("song",e)?"remove":"add";favorite[t]({type:"song",id:e})}},_increaseVolume:function(){var e=(parseFloat(dzPlayer.getVolume())+.1).toFixed(2);e>1&&(e=1),dzPlayer.control.setVolume(e)},_decreaseVolume:function(){var e=(parseFloat(dzPlayer.getVolume())-.1).toFixed(2);0>=e&&(dzPlayer.control.mute(),e=0),dzPlayer.control.setVolume(e)},_handleSeekPosition:function(e){e>0&&1>e&&dzPlayer.control.seek(e)},_toggleRepeat:function(){var e=dzPlayer.getRepeat();dzPlayer.control.setRepeat(2===e?0:e+1)},_konami:function(){document.body.classList&&(document.body.classList.add("konami"),setTimeout(function(){document.body.classList.remove("konami")},1e4))}});t.exports=l},{"../../core/i18n":245,classnames:"classnames",jquery:"jquery",mousetrap:"mousetrap",react:"react"}]},{},[2]);;
if(typeof platform=='undefined'){var platform={init:function(){if(typeof PLATFORM_OBJ!=='object'){PLATFORM_OBJ={name:'web'};}
if(PLATFORM_OBJ.name===false){PLATFORM_OBJ.name='web';}
platform.data=PLATFORM_OBJ;},get:function(){return platform.data;}};};
var error={i:0,not_loged_error:{VALID_TOKEN_REQUIRED:true,NEED_USER_AUTH_REQUIRED:true},display:function(e){console.log('ERROR API:',e);console.log(e.name);},log:function(e){if(typeof e!=='object'){return false;}
if(typeof error.not_loged_error[e.name]!=='undefined'){return false;}
error.i+=1;var err={name:'',message:'',description:'',payload:'',stack:''};if(typeof e.name!=='undefined'){err.name=e.name;}
if(typeof e.message!=='undefined'){err.message=e.message;}
if(typeof e.description!=='undefined'){err.description=e.description;}
if(typeof e.payload!=='undefined'&&e.payload!==null){err.payload=e.payload;}
if(typeof e.stack!=='undefined'){err.stack=e.stack;}
live.log.send('app_error',{error:err,nb:error.i});console.log('Error #'+error.i);console.log(err.name);console.log(err.message);console.log(err.description);console.log(err.payload);console.log(err.stack);console.log('');return true;},handle:function(e){error.log(e);error.display(e);return true;}};function dzError(obj){this.name=obj.name||'dzError';this.message=obj.message||'';this.description=obj.description||'';this.payload=obj.payload||null;var e=new Error();this.stack=e.stack;};
(function(){'use strict';if(typeof window.Handlebars==='undefined'){return;}
var isWebview=window.feed&&window.feed.is_webview;Handlebars.registerHelper('thumbnail',function(options){return thumbnails.draw(options);});Handlebars.registerHelper('placeholder',function(options){return placeholder.draw(options);});Handlebars.registerHelper('thumbnail_unavailable_link',function(a){if(typeof a!=='undefined'&&a==='radio'||isWebview){return'javascript:void(0)';}
if(SETTING_LANG==='fr'){return'http://support.deezer.com/hc/fr/articles/201193812-Pourquoi-est-il-impossible-de-trouver-certains-artistes-sur-Deezer-';}
return'http://support.deezer.com/hc/en-gb/articles/201193812-Why-is-impossible-to-find-certain-artists-on-Deezer-';});Handlebars.registerHelper('buttonAction',function(options){return button_multi_state.draw(options);});Handlebars.registerHelper('ifEqual',function(a,b,options){return(a===b)?options.fn():options.inverse();});Handlebars.registerHelper('ifOrEqual',function(a,b,c,options){return(a===b||a===c)?options.fn():options.inverse();});Handlebars.registerHelper('ifNotEqual',function(a,b,options){return(a!==b)?options.fn():options.inverse();});Handlebars.registerHelper('ifOr',function(resp,width,height,options){return(resp||width||height)?options.fn():options.inverse();});Handlebars.registerHelper('isFavorite',function(type,id){var options=arguments[(arguments.length-1)];if(type==='song'){var regex_key=/^(\d+)_(\d{1})$/;if(!regex_key.test(id)){id+='_0';}}
return(userData.isFavorite(type,id))?options.fn():options.inverse();});Handlebars.registerHelper('isCuratorUser',function(options){return gatekeeper.isAllowed('curator_feature')?options.fn(this):options.inverse(this);});Handlebars.registerHelper('drawStackCovers',function(pic_id,type,options){var display_options={playlist:{width:250,height:250,nb:3,cover:'cover'},artist:{width:120,height:250,nb:2,cover:'artist'}};if(typeof pic_id==='undefined'||typeof pic_id!=='string'||typeof type!=='string'||typeof display_options[type]==='undefined'){return false;}
var picture=pic_id.split('-');var data={};data.height=options.hash.height||display_options[type].height;data.width=options.hash.width||display_options[type].width;data.cover=display_options[type].cover;if(picture.length<=1){data.size='250x360';data.width=360;data.height=250;data.pic_id=picture[0];data.img_url=SETTING_DOMAIN_IMG+'/'+data.cover+'/'+data.pic_id+'/'+data.size+'-000000-80-0-0.jpg';return options.inverse(data);}
var ret='';for(var i=display_options[type].nb;i>=0;i--){data.last_cover=(i<=0&&type==='playlist')?'last':'';data.pic_id=picture[i];data.img_url=SETTING_DOMAIN_IMG+'/'+data.cover+'/'+data.pic_id+'/'+data.height+'x'+data.width+'-000000-80-0-0.jpg';ret+=options.fn(data);}
return ret;});Handlebars.registerHelper('setTracking',function(options){var opt=options.hash;var tracking_attr='';if(typeof opt.tracking!=='undefined'&&(typeof opt.tag!=='string')){return tracking_attr;}
tracking_attr+='data-tracking="'+opt.tracking+'"';tracking_attr+=(opt.tag)?'data-tracking-tag="'+opt.tag+'"':'';tracking_attr+=(opt.tracking_id)?'data-tracking-id="'+opt.tracking_id+'"':'';tracking_attr+=(opt.params)?'data-tracking-params="'+opt.params+'"':'';return new Handlebars.SafeString(tracking_attr);});Handlebars.registerHelper('setRadioTypeShare',function(a,b,options){return(typeof a!=='undefined'&&b==='artist')?options.fn():options.inverse();});Handlebars.registerHelper('convertURLToLink',function(str){return(typeof str==='string')?new Handlebars.SafeString(str.convertURLToLink()):'';});Handlebars.registerHelper('toLowerCase',function(str){return(typeof str==='string')?str.toLowerCase():'';});Handlebars.registerHelper('encodeURIComponent',function(str){return(typeof str==='string')?encodeURIComponent(str):'';});Handlebars.registerHelper('toUpperCase',function(str){return(typeof str==='string')?str.toUpperCase():'';});Handlebars.registerHelper('formatDate',function(str){return(typeof str==='string')?formatDate(str):'';});Handlebars.registerHelper('getYear',function(str){return(typeof str==='string')?str.substr(0,4):'';});Handlebars.registerHelper('formatMessage',function(str){str=Handlebars.Utils.escapeExpression(str);var pos;var nb_line=0;var reg=/(\r\n|\n|\r)/;while((pos=str.search(reg))!==-1){nb_line++;str=str.replace(reg,'<br/>');if(nb_line>=8){return new Handlebars.SafeString(str.substr(0,pos));}}
return new Handlebars.SafeString(str);});Handlebars.registerHelper('getRewritingName',function(name){return rewriting(name).toLowerCase();});Handlebars.registerHelper('breakUpThousands',function(str){return breakUpThousands(str);});Handlebars.registerHelper('badgeCount',function(count){return count<100?count:'99+';});Handlebars.registerHelper('ifGreater',function(a,b,options){return(a>b)?options.fn():options.inverse();});Handlebars.registerHelper('SETTING_STATIC',function(){return SETTING_STATIC;});Handlebars.registerHelper('SETTING_DOMAIN_IMG',function(){return SETTING_DOMAIN_IMG;});Handlebars.registerHelper('gettext',function(key,args){if(args.hash){if(args.hash.context){args.hash.context+='';}
return new Handlebars.SafeString(gettext(key,args.hash));}
return new Handlebars.SafeString(gettext(key));});Handlebars.registerHelper('ngettext',function(singular,plural,args){if(!args.hash||arguments.length<3){throw new Error('ngettext helper called with incorrect number of arguments',args.hash);}
if(typeof args.hash.count==='undefined'){throw new Error('ngettext helper called with no "count" attribute',args.hash);}
if(args.hash.context){args.hash.context+='';}
return new Handlebars.SafeString(gettext(singular,args.hash));});function sprintf(){if(arguments.length===0){return'';}
var regex=/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g;var a=arguments;var i=0;var format=a[i++];var pad=function(str,len,chr,leftJustify){chr=chr||' ';str=String(str);var padding=str.length>=len?'':new Array(len-str.length+1).join(chr);return leftJustify?str+padding:padding+str;};var justify=function(value,prefix,leftJustify,minWidth,zeroPad,customPadChar){var diff=minWidth-value.length;if(diff>0){if(leftJustify||!zeroPad){value=pad(value,minWidth,customPadChar,leftJustify);}else{value=value.slice(0,prefix.length)+pad('',diff,'0',true)+value.slice(prefix.length);}}
return value;};var formatBaseX=function(value,base,prefix,leftJustify,minWidth,precision,zeroPad){var number=value>>>0;prefix=prefix&&number&&{2:'0b',8:'0',16:'0x'}[base]||'';value=prefix+pad(number.toString(base),precision||0,'0',false);return justify(value,prefix,leftJustify,minWidth,zeroPad);};var formatString=function(value,leftJustify,minWidth,precision,zeroPad,customPadChar){if(precision!==null){value=value.slice(0,precision);}
return justify(value,'',leftJustify,minWidth,zeroPad,customPadChar);};var doFormat=function(substring,valueIndex,flags,minWidth,_,precision,type){var number;var prefix;var method;var textTransform;var value;if(substring==='%%'){return'%';}
var leftJustify=false;var positivePrefix='';var zeroPad=false;var prefixBaseX=false;var customPadChar=' ';var flagsl=flags.length;for(var j=0;flags&&j<flagsl;j++){switch(flags.charAt(j)){case' ':positivePrefix=' ';break;case'+':positivePrefix='+';break;case'-':leftJustify=true;break;case'\'':customPadChar=flags.charAt(j+1);break;case'0':zeroPad=true;break;case'#':prefixBaseX=true;break;default:break;}}
if(!minWidth){minWidth=0;}else if(minWidth==='*'){minWidth=Number(a[i++]);}else if(minWidth.charAt(0)==='*'){minWidth=Number(a[minWidth.slice(1,-1)]);}else{minWidth=Number(minWidth);}
if(minWidth<0){minWidth=-minWidth;leftJustify=true;}
if(!isFinite(minWidth)){throw new Error('sprintf: (minimum-)width must be finite');}
if(!precision){if('fFeE'.indexOf(type)>-1){precision=6;}else if(type==='d'){precision=0;}}else if(precision==='*'){precision=Number(a[i++]);}else if(precision.charAt(0)==='*'){precision=Number(a[precision.slice(1,-1)]);}else{precision=Number(precision);}
value=valueIndex?a[valueIndex.slice(0,-1)]:a[i++];switch(type){case's':return formatString(String(value),leftJustify,minWidth,precision,zeroPad,customPadChar);case'c':return formatString(String.fromCharCode(Number(value)),leftJustify,minWidth,precision,zeroPad);case'b':return formatBaseX(value,2,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'o':return formatBaseX(value,8,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'x':return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'X':return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad).toUpperCase();case'u':return formatBaseX(value,10,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case'i':case'd':number=Number(value)||0;number=Math.round(number-number%1);prefix=number<0?'-':positivePrefix;value=prefix+pad(String(Math.abs(number)),precision,'0',false);return justify(value,prefix,leftJustify,minWidth,zeroPad);case'e':case'E':case'f':case'F':case'g':case'G':number=Number(value);prefix=number<0?'-':positivePrefix;method=['toExponential','toFixed','toPrecision']['efg'.indexOf(type.toLowerCase())];textTransform=['toString','toUpperCase']['eEfFgG'.indexOf(type)%2];value=prefix+Math.abs(number)[method](precision);return justify(value,prefix,leftJustify,minWidth,zeroPad)[textTransform]();default:return substring;}};return format.replace(regex,doFormat);}
Handlebars.registerHelper('sprintf',function(){return sprintf.apply(this,Array.prototype.slice.call(arguments));});Handlebars.registerHelper('getPlaylistType',function(user_id,parent_user_id,status){if(Number(parent_user_id)!==user_id){if(Number(status)===2){return'playlist-collaborative';}
return'playlist-favorite';}
return'playlist';});Handlebars.registerHelper('isPersonalPlaylist',function(parent_user_id,options){return(parent_user_id==USER.USER_ID)?options.fn():options.inverse();});Handlebars.registerHelper('addition',function(n1,n2){return Number(n1)+Number(n2);});})();;
(function(){var api_error_handler={'playlist.addSongs':function(e){if(e.name==='ERROR_DATA_EXISTS'){notification.display(null,{message:gettext('Ce titre a déjà été ajouté à la playlist')});return true;}
if(e.name==='QUOTA_ERROR'){modal.open('/lightbox/api_error?type=PLAYLIST_ADDSONGS_QUOTA_ERROR',true);return true;}
return false;},'playlist.create':function(e){if(e.name==='ERROR_QUOTA'){modal.open('/lightbox/api_error?type=PLAYLISTS_ERROR_QUOTA',true);return true;}
return false;}};window.api={uniqId:0,callParameters:{method:'',data:{},success:function(){},error:null,callback_parameters:{},retry:0},getUniqId:function(){if(api.uniqId===0){api.uniqId=util.uniqid();}
return api.uniqId;},call:function(options){if(arguments.length>1){options={method:arguments[0]||'',data:arguments[1]||{},success:arguments[2]||function(){},callback_parameters:arguments[3]||{},retry:arguments[5]||0};}
if(!Array.isArray(options)){options=[options];}
var post_values=[];for(var i=0;i<options.length;i++){options[i]=$.extend({},api.callParameters,options[i]);if(options[i].method===''){throw'Missing method_name in api.call';}
if(options[i].retry>=4){return false;}
post_values.push({method:options[i].method,params:options[i].data});}
var url='/ajax/gw-light.php?api_version=1.0&api_token='+encodeURIComponent(checkForm)+'&input=3&cid='+api.getUniqId();sendRequest(url,'text',JSON.stringify(post_values),true,function(xhr){api.callback(xhr.responseText,options);},null);return true;},callback:function(request,options){try{var methods=[];for(var i=0;i<options.length;i++){methods.push(options[i].method);}
if(request==''){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:{methods:methods.join('|')}});}
request=JSON.parse(request);if(!Array.isArray(request)){throw new dzError({name:'BAD_REQUEST',message:'Api error',description:'BAD_REQUEST',payload:{methods:methods.join('|')}});}
var errors=[];var exception_payload;for(var i=0;i<request.length;i++){exception_payload={method:options[i].method,methods:methods.join('|')};try{var result=api.getResult(request[i],exception_payload);options[i].success(result,options[i].callback_parameters);}catch(e){if(e.name==='VALID_TOKEN_REQUIRED'||e.name==='NEED_USER_AUTH_REQUIRED'){api.ping(options.slice(i));return false;}
if(typeof options[i].error==='function'&&options[i].error(e,options[i].callback_parameters)){continue;}
if(typeof api_error_handler[options[i].method]==='function'&&api_error_handler[options[i].method](e)){continue;}
errors.push(e);}}
for(var i=0;i<errors.length;i++){error.log(errors[i]);if(i===0){error.display(errors[i]);}}
if(errors.length>0){return false;}
return true;}catch(e){error.handle(e);}},getResult:function(request,exception_payload){exception_payload=exception_payload||null;if(typeof request!='object'){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
if(typeof request.results==='undefined'||typeof request.error==='undefined'){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
for(var i in request.error){if(!request.error.hasOwnProperty(i)){continue;}
throw new dzError({name:i,message:'Api error',description:request.error[i],payload:request.payload||null});}
if(countObject(request.results)===0){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
return request.results;},ping:function(options){api.call('deezer.ping',{},function(result){if(typeof result.CHECKFORM!=='undefined'){if(USER.USER_ID>0&&result.USER_ID===0){SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;modal.open('/lightbox/no_session.php');return false;}
USER.USER_ID=result.USER_ID;SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;options.retry+=1;api.call(options);}
return true;},{},'ping',options.retry+1);return true;}};}());;
var auth={login_config:{facebook:true,facebook_flow:'js',ggplus:true,operators:true},init_register:function(options,register_form){if(typeof options.login_config=='object'){auth.login_config=$.extend({},auth.login_config,options.login_config);}
var register_options={};if(typeof options.register_options!='undefined'){register_options=options.register_options;}
auth.register.init(register_options,register_form);},register:{options:{tracking:null},$fbconnect:null,$form:null,init:function(options,register_form){auth.register.$fbconnect=$('#register_fbconnect');auth.register.$form=register_form||$('#form_register');auth.register.options=options;if(!auth.login_config.facebook&&!auth.login_config.ggplus){auth.register.$fbconnect.hide();auth.register.$form.show();}},create_account_fb_click:function(param){if(!auth.login_config.facebook){return false;}
if(typeof auth.register.options.tracking.platform!=='undefined'&&typeof auth.register.options.tracking.context!=='undefined'){tracking.track('register_choice_click',{'registration_type':'facebook','platform':auth.register.options.tracking.platform,'context':auth.register.options.tracking.context});}
if(auth.login_config.facebook_flow==='js'){param=param||{};facebook.login({redirect:{type:String(param.type||''),link:String(param.link||'')}});modal.close();}else{window.location.href=param;}
return false;},create_account_click:function(){if(auth.register.options.tracking!==null){tracking.track('register_choice_click',auth.register.options.tracking);}
auth.register.$fbconnect.slideUp();auth.register.$form.slideDown();if(auth.register.options.tracking!==null){tracking.track('register_form',auth.register.options.tracking);}}}};;
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}
var aArgs=Array.prototype.slice.call(arguments,1);var fToBind=this;var FuncNOOP=function(){};var fBound=function(){return fToBind.apply(this instanceof FuncNOOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};FuncNOOP.prototype=this.prototype;fBound.prototype=new FuncNOOP();return fBound;};}
if(typeof console==='undefined'){console=function(){};console.log=function(msg){};}
$(document).ready(function(){if(ENV!=='DEV'&&typeof gatekeeper!=='undefined'&&!gatekeeper.isAllowed('console_log')){console.log=function(){};}});if(typeof window.onerror==='undefined'){window.onerror=function(){};}
document.write=function(){return false;};document.open=function(){return false;};document.close=function(){return false;};function loadFacebox(page){try{dclk_hide();$('.tipsy').remove();$('#hovercard').hide();$('#sharebox').remove();$('#facebox_overlay').fadeOut();param=page.split('?');var query_param='';if(typeof param[1]!='undefined'){var query_param=param[1];}
var url='/'+param[0]+'?checkForm='+encodeURIComponent(checkForm)+'&'+query_param;if(PLATFORM!='web'){$.get(url,function(data){$('body').html(data);});return true;}
var id=util.uniqid();jQuery.facebox({ajax:url});$('#facebox').data('uniqid',id);return id;}catch(e){error.log(e);}}
function loadBox(page,options){return www.navigate(page,options);}
function displayInterstitial(data){try{var content='';var self_close=false;switch(data.type){case'autopromo_img':if(!www.allowAutoPromo(data)){return false;}
if(data.target=='internal'){data.target='_self';data.click='javascript:'+data.click+'; removeInterstitial(); return false';}else{data.target='_'+data.target;}
content='<img src="'+data.url+'"/>';storage.set('autopromo_intersticiel',true,true,SERVER_TIMESTAMP+86400);break;case'autopromo_video':if(!www.allowAutoPromo(data)){return false;}
content=data.embed;if(data.self_close==='0'){self_close=true;}
storage.set('autopromo_intersticiel',true,true,SERVER_TIMESTAMP+86400);break;case'ads_billboard':if(!USER.OPTIONS.ads_display){return false;}
content='<img src="'+data.url+'"/>';break;case'ads_interstitial':if(!USER.OPTIONS.ads_display){return false;}
var formatSize=data.formatSize.split('x');if(data.format=='image'){content='<img src="'+data.url+'"/>';}else if(data.format=='swf'){ads.setSwf('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],data.clickTagMethod,data.click,'#FFFFFF','opaque');data.click='javascript:void(0)';data.target='_self';}else if(data.format=='redirect'){ads.setRedirect('interstitial_ads',data.redirect.js,data.redirect.clickCommand,formatSize[0],formatSize[1]);data.click='javascript:void(0)';data.target='_self';}else if(data.format=='video'){ads.setVideo('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],'','',0,data.click);data.click='javascript:void(0)';data.target='_self';}else if(data.format==='html5'){ads.setHtmlRedirect('interstitial_ads',data.url,data.click,data.formatId,formatSize[0],formatSize[1]);data.target='_self';}
if(data.pixelAgence){ads.setPixelAgence(data.pixelAgence,'ads_pixel');}
if(data.pixelAgenceScript){$('head').append(unescape(data.pixelAgenceScript));}
break;default:return false;}
if(typeof data.duration==='undefined'){data.duration=3;}
if(content!=''){$('#interstitial_ads').append($(content));}
$('#interstitial_ads').attr({href:data.click,target:data.target});$('#interstitial').show();if(!self_close){setTimeout(function(){removeInterstitial();},parseInt(data.duration)*1000);}}catch(e){error.log(e);}}
function removeInterstitial(){try{$('#interstitial').hide();$('#interstitial_ads').removeAttr('href').empty();}catch(e){error.log(e);}}
function show(id){$('#'+id).css('display','block');}
function hide(id){$('#'+id).css('display','none');}
function inline(id){$('#'+id).css('display','inline');}
var last_asynch_request;var async_groups={};function sendRequest(url,response,post,asynchronous,callback,callback_parameters){try{var post_status='GET';if(post!=''&&typeof post!=='undefined'){post_status='POST';}
if(typeof asynchronous!='boolean'){asynchronous=false;}
if(typeof callback_parameters=='undefined'||callback_parameters==null){callback_parameters=false;}
var ajax=$.ajax({url:url,type:post_status,data:post,async:asynchronous,success:function(data,textStatus,xhr){if(typeof callback==='function'){try{callback(xhr,callback_parameters);}catch(e){error.log(e);}}else{return data;}}});if(response=='xml'){result=ajax.responseXML;}else{result=ajax.responseText;}
return result;}catch(e){error.log(e);}}
function setCookie(name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);var cookie_domain=typeof SETTING_DOMAIN_COOKIE==='undefined'?'':(';domain='+SETTING_DOMAIN_COOKIE);document.cookie=name+'='+escape(value)+cookie_domain+'; path=/'+((expiredays==null)?'':';expires='+exdate.toGMTString());}
function getCookie(name){if(document.cookie.length>0){c_start=document.cookie.indexOf(name+'=');if(c_start!=-1){c_start=c_start+name.length+1;c_end=document.cookie.indexOf(';',c_start);if(c_end==-1){c_end=document.cookie.length;}
return unescape(document.cookie.substring(c_start,c_end));}}
return'';}
function addslashes(string){return string.toString().replace(/([\\"'])/g,'\\$1').replace(/\0/g,'\\0');}
function stripslashes(string){return string.toString().replace(/\\(.?)/g,function(s,n1){switch(n1){case'\\':return'\\';case'0':return'\u0000';case'':return'';default:return n1;}});}
function ucfirst(str){try{var f=str.charAt(0).toUpperCase();return f+str.substr(1);}catch(e){error.log(e);}}
function base64_decode(data){try{var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var o1;var o2;var o3;var h1;var h2;var h3;var h4;var bits;var i=0;var ac=0;var dec='';var tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return dec;}catch(e){error.log(e);}}
function bin2hex(str){var len=str.length;var rv='';var i=0;var c;while(len-->0){c=str.charCodeAt(i++);rv+=_bin2hex[(c&0xf0)>>4];rv+=_bin2hex[(c&0x0f)];}
return rv;}
function hex2bin(str){var len=str.length;var rv='';var i=0;var c1;var c2;while(len>1){h1=str.charAt(i++);c1=h1.charCodeAt(0);h2=str.charAt(i++);c2=h2.charCodeAt(0);rv+=String.fromCharCode((_hex2bin[c1]<<4)+_hex2bin[c2]);len-=2;}
return rv;}
var _bin2hex=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];var _hex2bin=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function analyticsTrackingEvent(category,action,optional_label){try{date=new Date();timestamp=date.getTime();timestamp=Math.round(timestamp/1000)+315622800;if(typeof _gaq!='undefined'){_gaq.push(['_trackEvent',category,action,optional_label]);}}catch(e){error.log(e);}}
function insertAfter(element,node){try{element.parentNode.insertBefore(node,element.nextSibling);}catch(e){error.log(e);}}
function crontab(){if(typeof crontab_timeout==='undefined'){crontab_timeout=window.setInterval(crontab,999);}
update_server_timestamp();try{if((SESSION_DURATION%10)===0){ads.incrementRefreshCounter();friends.updateOnline();}
if((SESSION_DURATION%30)===0){calculeTime();}}catch(e){}
return true;}
function update_server_timestamp(){SERVER_TIMESTAMP+=1;SESSION_DURATION+=1;return true;}
(function(){'use strict';var defaultDiacriticsRemovalap=[{base:'A',letters:'\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F'},{base:'AA',letters:'\uA732'},{base:'AE',letters:'\u00C6\u01FC\u01E2'},{base:'AO',letters:'\uA734'},{base:'AU',letters:'\uA736'},{base:'AV',letters:'\uA738\uA73A'},{base:'AY',letters:'\uA73C'},{base:'B',letters:'\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181'},{base:'C',letters:'\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E'},{base:'D',letters:'\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779'},{base:'DZ',letters:'\u01F1\u01C4'},{base:'Dz',letters:'\u01F2\u01C5'},{base:'E',letters:'\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E'},{base:'F',letters:'\u0046\u24BB\uFF26\u1E1E\u0191\uA77B'},{base:'G',letters:'\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E'},{base:'H',letters:'\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D'},{base:'I',letters:'\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197'},{base:'J',letters:'\u004A\u24BF\uFF2A\u0134\u0248'},{base:'K',letters:'\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2'},{base:'L',letters:'\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780'},{base:'LJ',letters:'\u01C7'},{base:'Lj',letters:'\u01C8'},{base:'M',letters:'\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C'},{base:'N',letters:'\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4'},{base:'NJ',letters:'\u01CA'},{base:'Nj',letters:'\u01CB'},{base:'O',letters:'\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C'},{base:'OI',letters:'\u01A2'},{base:'OO',letters:'\uA74E'},{base:'OU',letters:'\u0222'},{base:'OE',letters:'\u008C\u0152'},{base:'oe',letters:'\u009C\u0153'},{base:'P',letters:'\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754'},{base:'Q',letters:'\u0051\u24C6\uFF31\uA756\uA758\u024A'},{base:'R',letters:'\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782'},{base:'S',letters:'\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784'},{base:'T',letters:'\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786'},{base:'TZ',letters:'\uA728'},{base:'U',letters:'\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244'},{base:'V',letters:'\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245'},{base:'VY',letters:'\uA760'},{base:'W',letters:'\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72'},{base:'X',letters:'\u0058\u24CD\uFF38\u1E8A\u1E8C'},{base:'Y',letters:'\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE'},{base:'Z',letters:'\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762'},{base:'a',letters:'\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250'},{base:'aa',letters:'\uA733'},{base:'ae',letters:'\u00E6\u01FD\u01E3'},{base:'ao',letters:'\uA735'},{base:'au',letters:'\uA737'},{base:'av',letters:'\uA739\uA73B'},{base:'ay',letters:'\uA73D'},{base:'b',letters:'\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253'},{base:'c',letters:'\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184'},{base:'d',letters:'\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A'},{base:'dz',letters:'\u01F3\u01C6'},{base:'e',letters:'\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD'},{base:'f',letters:'\u0066\u24D5\uFF46\u1E1F\u0192\uA77C'},{base:'g',letters:'\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F'},{base:'h',letters:'\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265'},{base:'hv',letters:'\u0195'},{base:'i',letters:'\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131'},{base:'j',letters:'\u006A\u24D9\uFF4A\u0135\u01F0\u0249'},{base:'k',letters:'\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3'},{base:'l',letters:'\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747'},{base:'lj',letters:'\u01C9'},{base:'m',letters:'\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F'},{base:'n',letters:'\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5'},{base:'nj',letters:'\u01CC'},{base:'o',letters:'\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275'},{base:'oi',letters:'\u01A3'},{base:'ou',letters:'\u0223'},{base:'oo',letters:'\uA74F'},{base:'p',letters:'\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755'},{base:'q',letters:'\u0071\u24E0\uFF51\u024B\uA757\uA759'},{base:'r',letters:'\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783'},{base:'s',letters:'\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B'},{base:'t',letters:'\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787'},{base:'tz',letters:'\uA729'},{base:'u',letters:'\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289'},{base:'v',letters:'\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C'},{base:'vy',letters:'\uA761'},{base:'w',letters:'\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73'},{base:'x',letters:'\u0078\u24E7\uFF58\u1E8B\u1E8D'},{base:'y',letters:'\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF'},{base:'z',letters:'\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763'}];var diacriticsMap={};var diacriticsRegExp=/[^\u0000-\u007E]/g;var diacriticsRegExp2=/[^a-z0-9]/gi;for(var i=0;i<defaultDiacriticsRemovalap.length;i++){var letters=defaultDiacriticsRemovalap[i].letters;for(var j=0;j<letters.length;j++){diacriticsMap[letters[j]]=defaultDiacriticsRemovalap[i].base;}}
window.rewriting=function(str){if(typeof str!=='string'){return'';}
return str.replace(diacriticsRegExp,function(a){return diacriticsMap[a]||a;}).replace(diacriticsRegExp2,'-');};})();String.prototype.trim=function(trimChar){return trim(this,typeof trimChar!='undefined'?trimChar:null);};function trim(myString,trimChar){if(typeof trimChar=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');var regexpRight=new RegExp('['+trimChar+']['+trimChar+']*$');}else{var regexpLeft=new RegExp('^\\s\\s*');var regexpRight=new RegExp('\\s\\s*$');}
return myString.replace(regexpLeft,'').replace(regexpRight,'');}
String.prototype.ltrim=function(trimChar){return ltrim(this,typeof trimChar!='undefined'?trimChar:null);};function ltrim(myString,trimChar){if(typeof trimChar=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');}else{var regexpLeft=new RegExp('^\\s\\s*');}
return myString.replace(regexpLeft,'');}
function str_replace(haystack,needle,replacement){var temp=haystack.split(needle);return temp.join(replacement);}
function truncateTxt(txt,max_length){if(txt.length>max_length){txt=txt.substr(0,max_length-4)+' ...';}
return txt;}
function shuffle(a){var j=0;var valI;var valJ;var l=a.length-1;if(l===-1){return a;}
while(l>-1){j=Math.floor(Math.random()*l);valI=a[l];valJ=a[j];a[l]=valJ;a[j]=valI;l=l-1;}
return a;}
function calculeTime(){$('.timestamp').each(function(index){if(typeof $(this).data('timestamp')==='undefined'||isNaN($(this).data('timestamp'))){return;}
var data_timestamp=parseInt($(this).data('timestamp'),10);var timestamp=SERVER_TIMESTAMP-data_timestamp;$(this).text((data_timestamp===0)?'-':getAgoTime(timestamp));if($(this).is('[data-display-title="true"]')&&data_timestamp>0){$(this).prop('title',getAgoTime(timestamp));}});return true;}
function localTimeStamp(){return Math.floor(new Date().getTime()/1000);}
function getAgoTime(timer){try{if(isNaN(timer)||timer<0){timer=0;}
if(timer<60){return gettext('Il y a quelques instants');}else if(timer<3600){timer=Math.round(timer/60);return ngettext('Il y a %s minute','Il y a %s minutes',{sprintf:[timer],count:timer});}else if(timer<86400){timer=Math.round(timer/3600);return ngettext('Il y a %s heure','Il y a %s heures',{sprintf:[timer],count:timer});}else if(timer>86400&&timer<172800){return gettext('Hier');}else if(timer<518400){timer=Math.round(timer/86400);return ngettext('Il y a %s jour','Il y a %s jours',{sprintf:[timer],count:timer});}else if(timer<2592000){timer=Math.round(timer/604800);return ngettext('Il y a %s semaine','Il y a %s semaines',{sprintf:[timer],count:timer});}else{timer=Math.round(timer/2592000);if(timer>12){return gettext('Il y a plus d\'un an');}
return ngettext('Il y a %s mois','Il y a %s mois',{sprintf:[timer],count:timer});}}catch(e){error.log(e);}}
function pad(number,length){var str=number.toString();while(str.length<length){str='0'+str;}
return str;}
function secToMin(seconds){if(isNaN(seconds)){return false;}
seconds=Math.floor(seconds);return pad(Math.floor(seconds/60),2)+':'+pad(seconds%60,2);}
function getTotalDuration(seconds){seconds=seconds||0;var minutes=Math.floor(seconds/60);var hours;var result;if(minutes>59){hours=Math.floor(minutes/60);minutes=minutes-(hours*60);result=ngettext('%s h','%s h',{sprintf:[hours],count:hours});if(minutes>0){result+=' '+ngettext('%s min','%s min',{sprintf:[pad(minutes,2)],count:minutes});}}else{result=' '+ngettext('%s min','%s min',{sprintf:[pad(minutes,2)],count:minutes});}
return result;}
function timestampToDate(timestamp,hours,date_separator,reverse_date){var hours=hours||false;var date_separator=date_separator||'/';var reverse_date=reverse_date||false;var date=new Date();date.setTime(timestamp*1000);var month=parseInt(date.getMonth())+1;var dateString=pad(date.getDate(),2)+date_separator+pad(month,2)+date_separator+date.getFullYear();if(reverse_date){dateString=date.getFullYear()+date_separator+pad(month,2)+date_separator+pad(date.getDate(),2);}
if(hours){dateString+=' '+pad(date.getHours(),2)+':'+pad(date.getMinutes(),2)+':'+pad(date.getSeconds(),2);}
return dateString;}
function serialize(txt){switch(typeof txt){case'string':return's:'+txt.length+':"'+txt+'";';case'number':if(txt>=0&&String(txt).indexOf('.')==-1&&txt<65536){return'i:'+txt+';';}
return'd:'+txt+';';case'boolean':return'b:'+((txt)?'1':'0')+';';case'object':var i=0;var ret='';for(var k in txt){if(!txt.hasOwnProperty(k)){continue;}
if(!isNaN(k)){k=Number(k);}
ret+=serialize(k)+serialize(txt[k]);i++;}
return'a:'+i+':{'+ret+'}';default:return'N;';}}
function unserialize(txt){var level=0;var arrlen=[];var del=0;var result=[];var key=[];var save=txt;while(1){switch(txt.substr(0,1)){case'N':del=2;ret=null;break;case'b':del=txt.indexOf(';')+1;ret=(txt.substring(2,del-1)=='1')?true:false;break;case'i':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case'd':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case's':del=txt.substr(2,txt.substr(2).indexOf(':'));ret=txt.substr(1+txt.indexOf('"'),del);del=txt.indexOf('"')+1+ret.length+2;break;case'a':del=txt.indexOf(':{')+2;ret=new Array();arrlen[level+1]=Number(txt.substring(txt.indexOf(':')+1,del-2))*2;break;case'O':txt=txt.substr(2);var tmp=txt.indexOf(':"')+2;var nlen=Number(txt.substring(0,txt.indexOf(':')));name=txt.substring(tmp,tmp+nlen);txt=txt.substring(tmp+nlen+2);del=txt.indexOf(':{')+2;ret=new Object();arrlen[level+1]=Number(txt.substring(0,del-2))*2;break;case'}':txt=txt.substr(1);if(arrlen[level]!=0){alert('var missed : '+save);return undefined;}
level--;continue;default:if(level==0){return result;}
return undefined;}
if(arrlen[level]%2==0){if(typeof ret=='object'){alert('array index object no accepted : '+save);return undefined;}
if(ret==undefined){alert('syntax invalid(2) : '+save);return undefined;}
key[level]=ret;}else{var ev='';for(var i=1;i<=level;i++){if(typeof key[i]=='number'){ev+='['+key[i]+']';}else{ev+='["'+key[i]+'"]';}}
eval('result'+ev+'= ret;');}
arrlen[level]--;if(typeof ret=='object'){level++;}
txt=txt.substr(del);continue;}}
function countObject(obj){if(typeof obj!=='object'){return false;}
if(typeof Object.keys=='function'){return Object.keys(obj).length;}
var count=0;for(var prop in obj){if(obj.hasOwnProperty(prop)){++count;}}
return count;}
function return_age(date){now=CURRENT_DATE;exp_date=date.split('-');exp_now=now.split('-');date_year=exp_date[0];date_month=exp_date[1];date_day=exp_date[2];now_year=exp_now[0];now_month=exp_now[1];now_day=exp_now[2];years=now_year-date_year;if(now_month<=date_month){if(date_month==now_month){if(date_day>now_day){years-=1;}}else{years-=1;}}
age=years;return age;}
function dateToTimestamp(string_date){if(typeof string_date==='undefined'||typeof string_date!=='string'){return false;}
var rdate=/^\d{4}-\d{1,2}-\d{1,2}$/;var rdatehours=/^\d{4}-\d{1,2}-\d{1,2} \d{2}:\d{2}:\d{2}$/;var total_date=[];if(rdate.exec(string_date)){date=string_date.split('-');time=['0','0','0'];}else if(rdatehours.exec(string_date)){full_date=string_date.split(' ');time=full_date[1].split(':');date=full_date[0].split('-');}else{return SERVER_TIMESTAMP;}
return new Date(date[0],date[1]-1,date[2],time[0],time[1],time[2]).getTime()/1000;}
function getShortMonthName(month){var months_name=[gettext('JAN'),gettext('FEV'),gettext('MAR'),gettext('AVR'),gettext('MAI'),gettext('JUIN'),gettext('JUIL'),gettext('AOU'),gettext('SEP'),gettext('OCT'),gettext('NOV'),gettext('DEC')];return months_name[(month.charAt(0)=='0')?(parseInt(month.charAt(1))-1):(parseInt(month)-1)];}
function getScripts(scripts,finalCallback){_getScript(scripts,0,scripts.length,finalCallback);}
function _getScript(scripts,pos,max,finalCallback){if(pos<0||pos>=max){finalCallback();return;}
if(RESSOURCES.cached[scripts[pos][0]]==true){_getScript(scripts,pos+1,max,finalCallback);}else{if(scripts[pos][1]=='js'){$.ajax({cache:true,url:scripts[pos][0],dataType:'script',success:function(){RESSOURCES.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}});}
if(scripts[pos][1]=='css'){$('head').append($('<link rel="stylesheet" type="text/css" href="'+scripts[pos][0]+'" />'));RESSOURCES.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}}}
function getClientHeight(){if(typeof window.innerHeight==='number'){return window.innerHeight;}else if(typeof document.documentElement.clientHeight!=='undefined'){return document.documentElement.clientHeight;}else if(typeof document.body.clientHeight!=='undefined'){return document.body.clientHeight;}else{return 0;}}
function getClientWidth(){if(typeof document.documentElement.clientWidth!=='undefined'){return document.documentElement.clientWidth;}else if(typeof document.body.clientWidth!=='undefined'){return document.body.clientWidth;}else if(typeof window.innerWidth==='number'){return window.innerWidth;}else{return 0;}}
function timestampToIso8601(ts){if(typeof ts==='undefined'){var ts=Math.floor(new Date().getTime()/1000);}
var aDate=new Date();aDate.setTime(ts*1000);return(aDate.getFullYear()+'-'+pad((aDate.getMonth()+1),2)+'-'+pad(aDate.getDate(),2)+'T'+pad(aDate.getHours(),2)+':'+pad(aDate.getMinutes(),2));}
String.prototype.format=function(){var s=this;var i=arguments.length;while(i--){s=s.replace(new RegExp('\\{'+i+'\\}','gm'),arguments[i]);}
return s;};function formatDate(date,delimiter){if(typeof delimiter==='undefined'){delimiter='-';}
var buffer=[];var format=DATE_FORMAT.split('-');if(date.indexOf('-')==-1&&date.length==8){date=date.substring(0,4)+'-'+date.substring(4,6)+'-'+date.substring(6,8);}
var parts=date.split('-');for(var i=0;i<3;i++){switch(format[i]){case'd':buffer.push(parts[2]);break;case'm':buffer.push(parts[1]);break;case'Y':buffer.push(parts[0]);break;}}
return buffer.join(delimiter);}
function formatedTimeToSecond(time){var format=time.split(':');var seconds=0;if(format.length==3){seconds+=parseInt(format[2]);seconds+=parseInt(format[1])*60;seconds+=parseInt(format[0])*(60*60);}
return seconds;}
function formatDuration(duration,display_hours){display_hours=display_hours||false;duration=parseInt(duration,10)||0;if(duration<=0){return'00:00';}
var hour=Math.floor(duration/(60*60));var min=Math.floor(display_hours?(duration%(60*60)/60):(duration/60));var sec=Math.floor(duration%(60*60)%60);if(hour<10){hour='0'+hour;}
return(display_hours?hour+':':'')+((min<10)?'0'+min:min)+':'+((sec<10)?'0'+sec:sec);}
function breakUpThousands(nStr){nStr+='';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+' '+'$2');}
return x1+x2;}
function loadPayment($this){try{var data=$this.data();data.origin=data.origin||0;var url=SETTING_HOST_SITE+'/payment/go.php?';url+=typeof data.offer_id!=='undefined'?'id='+data.offer_id+'&':'';url+=typeof data.change_mop!=='undefined'?'change_mop='+data.change_mop+'&':'';url+=typeof data.gift!=='undefined'?'gift='+data.gift+'&':'';url+='origin='+data.origin+'&';if(typeof data.gift!=='undefined'){url+='gift='+data.gift+'&';}
loadPaymentProgress=true;tracking.track('offers_subscribe_click',{origin:data.origin},function(){window.location=url;});return true;}catch(e){}}
function stripTags(str){var el=document.createElement('div');el.innerHTML=str;return el.textContent?el.textContent:el.innerText;}
function htmle(str){return encodeHTMLEntities(str);}
function encodeHTMLEntities(str){var el=document.createElement('div');el[typeof el.textContent!=='undefined'?'textContent':'innerText']=str;return el.innerHTML;}
function copyToClipboard(target,data,message){if(!window.ZeroClipboard||!target||!data){return false;}
new ZeroClipboard(target).on('ready',function(){this.on('copy',function(zc){zc.clipboardData.setData('text/plain',data);}).on('aftercopy',function(){if(message){Events.trigger(Events.copy.after,{message:message});}});});}
function isPlainObject(obj){return obj&&obj===Object(obj)&&!Array.isArray(obj);}
function getObjDeepKey(obj,keys){if(!isPlainObject(obj)){return null;}
for(var i=0,keys=keys.split('.'),l=keys.length;i<l;++i){if(typeof obj[keys[i]]==='undefined'||(i!==(keys.length-1)&&!isPlainObject(obj[keys[i]]))){return null;}
obj=obj[keys[i]];}
return obj;}
String.prototype.convertURLToLink=function(){var RexExpURL=/(https?:\/\/|www\.)([a-z0-9-\.]+\.)?([a-z0-9-]+)\.([a-z0-9-]{2,63})((\?|\/)([^\s\r\n@<>!]*))?/gi;return this.toString().replace(RexExpURL,function(matched){if(matched.indexOf('@')===-1){var urlwithHTTP=matched.indexOf('http')===-1?'http://'+matched:matched;var domain=urlwithHTTP.split('/')[2].split('.').reverse().slice(0,2).reverse().join('.');if(domain==document.domain){return'<a href="/'+arguments[7]+'" class="evt-click">'+matched+'</a>';}
return'<a href="http://'+SETTING_HOST+'/l.php?url='+encodeURIComponent(urlwithHTTP)+'" target="_blank">'+matched+'</a>';}
return matched;});};function intersectObject(o1,o2){var r={};for(var p in o1){if(!o1.hasOwnProperty(p)){continue;}
if(typeof o2[p]!=='undefined'){r[p]=o1[p];}}
return r;}
function compareObject(w,x){var p_in_w={};for(var p in w){if(!w.hasOwnProperty(p)){continue;}
if(typeof w[p]!==typeof x[p]){return false;}
if((w[p]===null)!==(x[p]===null)){return false;}
switch(typeof w[p]){case'undefined':if(typeof x[p]!=='undefined'){return false;}
break;case'object':if(w[p]!==null&&x[p]!==null&&(w[p].constructor.toString()!==x[p].constructor.toString()||!compareObject(w[p],x[p]))){return false;}
break;case'function':if(p!='equals'&&w[p].toString()!=x[p].toString()){return false;}
break;default:if(w[p]!==x[p]){return false;}}
p_in_w[p]=true;}
for(var q in x){if(!x.hasOwnProperty(q)){continue;}
if(!p_in_w.hasOwnProperty(q)){return false;}}
return true;};
if(typeof storage=='undefined'){var storage={init:function(){if(document.cookie.indexOf('USER_CHECKSUMS_'+USER.USER_ID)>-1){var c=document.cookie.split('; ');for(var i in c){setCookie(c[i],'',-1);}
window.location='';}},formatKey:function(key){return key+'_'+USER.USER_ID;},get:function(key,default_value){var value;if(!storage.isset(key)){return(typeof default_value!=='undefined'?default_value:false);}
key=storage.formatKey(key);if(Modernizr.localstorage){value=window.localStorage.getItem(key);}else if(getCookie(key)!==''){value=getCookie(key);}else{return false;}
return JSON.parse(value);},set:function(key,value,fallback,expiredays){key=storage.formatKey(key);value=JSON.stringify(value);if(typeof fallback!=='boolean'){fallback=true;}
if(Modernizr.localstorage){try{window.localStorage.setItem(key,value);}catch(e){window.error.log(e);}}else if(fallback){if(typeof expiredays==='undefined'){expiredays=365;}
setCookie(key,value,expiredays);}
return true;},isset:function(key){key=storage.formatKey(key);if(Modernizr.localstorage){if(typeof window.localStorage[key]==='undefined'||window.localStorage[key]===null){return false;}
return true;}
if(getCookie(key)===''){return false;}
return true;}};};
var templating={loaded:{},load:function(name,div){try{div=div||$('#naboo_content');if(typeof templating.loaded[name]!=='undefined'){return templating.display(templating.loaded[name],div);}
var content=false;if(div.children('[data-template="'+name+'"]').length==1){div.children('[data-seo="'+name+'"]').remove();div.children('[data-template="'+name+'"]').show();content=div.html();}else{content=sendRequest('/ajax/template.php?template='+encodeURIComponent(name)+'&v='+STATIC_VERSION+'&l='+SETTING_LANG,'text','');if(OFFLINE&&typeof content==='undefined'){window.location=SETTING_HOST_SITE+'/offline';}
if(content==='error'){return false;}}
if(content===false){return false;}
templating.loaded[name]=content;return templating.display(content,div);}catch(e){error.log(e);}},display:function(content,div){div.html(content);Events.trigger(Events.navigation.page_loaded);return true;}};;
if(typeof Events==='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt,args){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve(args);},subscribe:function(evt,callback,group){if(typeof group==='string'){return Events.addEvent(group,evt,callback);}
$(document).unbind(evt,callback).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof group!=='string'||typeof evt!=='string'||typeof callback!=='function'){return false;}
if(typeof Events.evts[group]==='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof group!=='string'||typeof Events.evts[group]==='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback,group){if(typeof group!=='string'){group=null;}
Events.subscribe(evt,function(event,args){if(typeof callback==='function'){callback(event,args);}
Events.unsubscribe(evt,event.handleObj.handler);},group);},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof args=='undefined'){args=null;}
$(document).trigger(evt,[args]);},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',fading:'EVENT.PLAYER.fading',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',seek:'EVENT.PLAYER.seek',prcPosition:'EVENT.PLAYER.prcPosition',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',track_end:'EVENT.PLAYER.track_end',finish:'EVENT.PLAYER.finish',finishPreview:'EVENT.PLAYER.finishPreview',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',setTrackList:'EVENT.PLAYER.setTrackList',fade:'EVENT.PLAYER.fade',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted',tracklist_changed:'EVENT.PLAYER.tracklist_changed',blind_test_mode_changed:'EVENT.PLAYER.blind_test_mode_changed',seekCompleted:'EVENT.PLAYER.seekCompleted',setBookmark:'EVENT.PLAYER.setBookmark'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer',removeOverlay:'EVENT.PLAYER_WIDGET.removeOverlay'},flow:{playerDisplay:'DEFERRED.FLOW.playerDisplay'},menu:{contextMenu:'EVENT.MENU.contextMenu',contextMenuOpen:'EVENT.MENU.contextMenuOpen',contextMenuClose:'EVENT.MENU.contextMenuClose',resize:'EVENT.MENU.resize',panel_mounted:'EVENT.MENU.panel_mounted',closeAllPanels:'EVENT.MENU.closeAllPanels',openPanel:'EVENT.MENU.openPanel',togglePanel:'EVENT.MENU.togglePanel'},user:{initialized:'DEFERRED.USER.initialized',loaded:'DEFERRED.USER.loaded',clickFavorite:'EVENT.USER.clickFavorite',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',shareClick:'EVENT.USER.shareClick',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChanged:'EVENT.USER.settingChanged',blockFriend:'EVENT.USER.blockFriend',unblockFriend:'EVENT.USER.unblockFriend',updatePicture:'EVENT.USER.updatePicture',uploadPicture:'EVENT.USER.uploadPicture',updateName:'EVENT.USER.updateName',updateSearchHistory:'EVENT.USER.updateSearchHistory',userLoadData:'EVENT.USER.userLoadData',updateEpisodeBookmark:'EVENT.USER.updateEpisodeBookmark',addPersonalSong:'EVENT.USER.addPersonalSong',updatePersonalSong:'EVENT.USER.updatePersonalSong',sendPersonalSong:'EVENT.USER.sendPersonalSong',progressPersonalSong:'EVENT.USER.progressPersonalSong'},genre:{loaded:'EVENT.GENRE.loaded'},live:{connected:'EVENT.LIVE.connected',simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',device_sync:'EVENT.LIVE.device_sync',pagefeed:'EVENT.LIVE.pagefeed',events:'EVENT.LIVE.events'},offline:{reminder:'EVENT.OFFLINE.reminder'},playlist:{addSong:'EVENT.PLAYLIST.addSong',removeSong:'EVENT.PLAYLIST.removeSong',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed',updated:'EVENT.PLAYLIST.updated',trackListUpdated:'EVENT.PLAYLIST.trackListUpdated',seen:'EVENT.PLAYLIST.seen',uploadPicture:'EVENT.PLAYLIST.uploadPicture',updatePicture:'EVENT.PLAYLIST.updatePicture',assistantValidation:'EVENT.PLAYLIST.assistantValidation',assistantSuggestFinish:'EVENT.PLAYLIST.assistantSuggestFinish',assistantSuggestEmpty:'EVENT.PLAYLIST.assistantSuggestEmpty',assistantToggleValidation:'EVENT.PLAYLIST.assistantToggleValidation',assistantAddedTrack:'EVENT.PLAYLIST.assistantAddedTrack'},profile:{allCoverLoaded:'EVENT.PROFILE.allCoverLoaded'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',adsBanner:'EVENT.LAYOUT.adsBanner'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_loaded:'EVENT.NAVIGATION.page_loaded',page_displayed:'EVENT.NAVIGATION.page_displayed',modal_displayed:'EVENT.NAVIGATION.modal_displayed',modal_open:'EVENT.NAVIGATION.modal_open',modal_close:'EVENT.NAVIGATION.modal_close',context_menu_close:'EVENT.NAVIGATION.context_menu_close',tab_displayed:'EVENT.NAVIGATION.tab_displayed',page_updated:'EVENT.NAVIGATION.page_updated',page_initialized:'DEFERRED.NAVIGATION.page_initialized'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',allTracksSelected:'EVENT.DATAGRID.allTracksSelected',removedTrack:'EVENT.DATAGRID.removedTrack',replacedTrack:'EVENT.DATAGRID.replacedTrack',addedItems:'EVENT.DATAGRID.addedItems'},album:{checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},radio:{start:'EVENT.RADIO.start'},lightbox:{close:'EVENT.LIGHTBOX.close'},search:{loaded:'EVENT.SEARCH.loaded',suggestDisplayed:'EVENT.SEARCH.suggestDisplayed',suggestClicked:'EVENT.SEARCH.suggestClicked'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'},facebook:{user_status:'EVENT.FACEBOOK.user_status'},chromecast:{status:'EVENT.CHROMECAST.status',removeFocus:'EVENT.CHROMECAST.removeFocus',closeIntro:'EVENT.CHROMECAST.closeIntro'},lyrics:{load:'EVENT.LYRICS.load',seek:'EVENT.LYRICS.seek'},gigs:{display:'EVENT.GIGS.display'},copy:{after:'EVENT.COPY.after'},tag:{select:'EVENT.TAG.select'},talk:{bookmarkSet:'EVENT.TALK.bookmarkSet'},tips:{close:'EVENT.TIPS.close',draw:'EVENT.TIPS.draw'},tooltip:{show:'EVENT.TOOLTIP.show',hide:'EVENT.TOOLTIP.hide'}};};
if(typeof tracking==='undefined'){var tracking={initialized:false,random_id:0,events_options:{mobile_session:{sampling:5},mobile_install:{sampling:5},unlogged_home_display:{sampling:5},navigation:{sampling:0,websocket:true},search_trigger:{sampling:5},search_results:{sampling:5},add_to_favorite:{sampling:5},headermenu_click:{sampling:5},menu_click:{sampling:5,websocket:true},usermenu_click:{sampling:5},player_click:{sampling:5},context_menu_click:{sampling:5},panel_click:{sampling:5},flow_click:{sampling:5},chromecast_open_menu_click:{sampling:5},chromecast_menu_choice_click:{sampling:5},add_to_playlist:{sampling:5},playlist_create:{sampling:5},upgrade_ui_box_display:{sampling:5},upgrade_ui_box_click:{sampling:5},backstage_landing_elite:{sampling:5},display_page:{sampling:5},landing_display:{sampling:5},unlogged_home_click:{sampling:5},soon_display:{sampling:5},soon_click:{sampling:5},top_playlists_click:{sampling:5},newhome_box_display:{sampling:5},telco_offer_lb_display:{sampling:100,websocket:true},telco_offer_lb_click:{sampling:100,websocket:true},telco_offer_lb_family_checkbox:{sampling:100,websocket:true},sonos_bundle_display:{sampling:100,websocket:true},sonos_bundle_learnmore_click:{sampling:100,websocket:true},sonos_bundle_subscribe_click:{sampling:100,websocket:true},artist_page_click:{sampling:5},discography_click:{sampling:5},family_offer_lb_display:{sampling:5,websocket:true},family_offer_lb_click:{sampling:5,websocket:true}},double_tag:{menu_click:{properties:{type:'offers_subscribe'},tracking:{event_name:'offers_subscribe_click',properties:{origin:'menu_push_subscription'}}}},init:function(){Events.ready(Events.user.loaded,tracking.register);Events.subscribe(Events.user.logout,tracking.unregister);Events.subscribe(Events.user.addFavorite,function(evt,params){if(params.type==='disliked_song'){return false;}
var props={type:params.type,id:params.id};tracking.addFavoriteContext(props,params.context);tracking.track('add_to_favorite',props);mixpanel.people.increment('add_favorite');});Events.subscribe(Events.playlist.created,function(evt,params){tracking.track('playlist_create',{id:params.id});mixpanel.people.increment('playlist_create');});Events.subscribe(Events.playlist.addSong,function(evt,params){var props={id:params.playlist_id,position:params.position||-1};tracking.addFavoriteContext(props,params.context);tracking.track('add_to_playlist',props);});Events.subscribe(Events.navigation.page_changed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{page:params.path}});});Events.subscribe(Events.navigation.modal_displayed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{modal:params.modal}});});Events.subscribe(Events.navigation.tab_displayed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{tab:params.type}});});tracking.random_id=Math.floor(Math.random()*10000);tracking.registerABTest();tracking.initialized=true;return true;},check_mixpanel:function(event_name){if(typeof tracking.events_options[event_name]==='undefined'){return true;}
var sampling_value=tracking.events_options[event_name].sampling;var id=USER.USER_ID===0?tracking.random_id:USER.USER_ID;if(id%100<sampling_value){return true;}
return false;},check_websocket:function(event_name){if(typeof tracking.events_options[event_name]==='undefined'){return false;}
if(typeof tracking.events_options[event_name].websocket!=='undefined'&&tracking.events_options[event_name].websocket){return true;}
return false;},track:function(event_name,properties,callback){if(typeof mixpanel==='undefined'){return false;}
if(typeof callback!=='function'){callback=function(){};}
if(typeof properties==='undefined'){properties={};}
if(tracking.check_websocket(event_name)){live.log.send(event_name,properties);}
if(typeof SESSION_DURATION==='number'){properties.session_duration=SESSION_DURATION;}
if(typeof tracking.double_tag[event_name]==='object'){var intersect_properties=intersectObject(properties,tracking.double_tag[event_name].properties);if(compareObject(intersect_properties,tracking.double_tag[event_name].properties)){var re_track=tracking.double_tag[event_name].tracking;tracking.track(re_track.event_name,re_track.properties);}}
if(tracking.check_mixpanel(event_name)){if(typeof tracking.events_options[event_name]==='object'){if(USER.USER_ID===0){properties.sampled_unique_id=tracking.events_options[event_name].sampling;}else{properties.sampled=tracking.events_options[event_name].sampling;}}
mixpanel.track(event_name,properties,callback);}else{callback();}
return true;},register:function(){try{if(typeof mixpanel==='undefined'){return false;}
var data={USER_ID:USER.USER_ID,USER_AGE:USER.USER_AGE,USER_GENDER:USER.USER_GENDER,FB_USER_ID:USER.FACEBOOK.UID,DZ_COUNTRY:COUNTRY,TWITTER:(typeof USER.TWITTER.TOKEN==='string'),OFFER_ID:OFFER_ID,TRY_AND_BUY:USER.TRY_AND_BUY.ACTIVE};mixpanel.register(data);mixpanel.people.identify(USER.USER_ID.toString());mixpanel.people.set({$last_login:timestampToDate(SERVER_TIMESTAMP,true),$created:USER.INSCRIPTION_DATE,$country_code:COUNTRY,offer_id:[OFFER_ID],age:USER.USER_AGE,gender:USER.USER_GENDER});return true;}catch(e){error.log(e);}},unregister:function(){var data=['USER_ID','USER_AGE','USER_GENDER','FB_USER_ID','TWITTER'];for(var i=0;i<data.length;i++){mixpanel.unregister(data[i]);}
return true;},trackCampaign:function(){try{if(location.search.length===0){return false;}
var query_string=location.search.substr(1);var allowed_tags=['ref','utm_source','utm_medium','utm_term','utm_content','utm_campaign'];var nb_tags=allowed_tags.length;var query_params={};var query_buffer=query_string.split('&');while(typeof query_buffer[0]!=='undefined'){var param=query_buffer.shift().split('=');query_params[param[0]]=param[1];}
for(var i=0;i<nb_tags;i++){var tag=allowed_tags[i];if(typeof query_params[tag]!=='undefined'&&query_params[tag]!==''){var tracking_info={url:location.protocol+'//'+location.hostname+location.pathname,query_string:query_string};var mixpanel_data={};for(var j=0;j<nb_tags;j++){var _tag=allowed_tags[j];if(typeof query_params[_tag]!=='undefined'&&query_params[_tag]!==''){mixpanel_data[_tag]=query_params[_tag];}}
if(countObject(mixpanel_data)>0){mixpanel.register(mixpanel_data);tracking.track('display_page',$.extend(tracking_info,mixpanel_data));}
break;}}
return true;}catch(e){error.log(e);}},registerABTest:function(){try{if(typeof mixpanel==='undefined'){return false;}
var data={};for(var i in USER.ABTEST){if(!USER.ABTEST.hasOwnProperty(i)){continue;}
data[USER.ABTEST[i].id]=USER.ABTEST[i].option;}
mixpanel.register(data);}catch(e){error.log(e);}},addFavoriteContext:function(data,context){try{context=context||naboo.getCurrentClass();if(context==='profile'){context=(profile.tab==='loved')?profile.tab:context;context=(profile.id==USER.USER_ID?'my_':'other_')+context;}
if(context==='playlist'){context=(playlist.isPersonal?'my_':'other_')+context;}
if(context==='artist'&&data.type==='artist'){data.main_artist=(data.id==artist.id);}
data.context=context;}catch(e){error.log(e);}},trackFormEvent:function($element,event,error){var properties=tracking.createFormFieldProperties($element);properties.event='on'+ucfirst(event);if(error){properties.error=error;}
tracking.track('navigation',properties);},createFormFieldProperties:function($field){var properties={};properties.id=$field.attr('id')||'';properties.type=$field.prop('tagName');properties.attributes={};$.each($field.get(0).attributes,function(){properties.attributes[this.name]=this.value;});return properties;}};};
(function(){'use strict';if(typeof window.EventsDelegation!=='undefined'){return;}
var tooltipDelayId;var EventsDelegation={mousedDownFired:false,excludeTracking:{play:true},initMouseClickEvents:function(){try{$(document).on('click','.evt-click',function(e){e.stopPropagation();e.preventDefault();var $this=$(this);var data=$this.data();var event_name='evt-click-'+util.uniqid();if(OFFLINE){if(typeof data.play!=='undefined'){dzoffline.display();}
return false;}
var action_list=['play','playNext','share','favorite','curator','link','close','tabs','deletePicture','changePicture','loginFacebook','registerFacebook','modal','redirect','userBlock','connect','login','register'];if(typeof $this.attr('href')!=='undefined'){data.link=$this.attr('data-link')||1;}
Events.ready(event_name,function(){for(var a in action_list){if(!action_list.hasOwnProperty(a)){continue;}
var action=action_list[a];if(typeof data[action]!=='undefined'&&parseInt(data[action],10)!==0){EventsDelegation[action]($this,data);}}
delete Events.deferredObjects[event_name];});EventsDelegation.tracking($this,data,event_name);});return true;}catch(e){error.log(e);}},initMouseOverEvents:function(){try{$(document).on('mouseenter','.evt-over',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data();if(typeof data.tooltip!=='undefined'&&data.tooltip===1&&!$(this).is('.active')){var tooltip_data={fallback:data.tooltipFallback||$.fn.tipsy.defaults.fallback,gravity:data.tooltipGravity||$.fn.tipsy.defaults.gravity,trigger:data.tooltipTrigger||'manual',offset:(typeof data.tooltipOffset!=='undefined')?parseInt(data.tooltipOffset,10):$.fn.tipsy.defaults.offset,force_top:(typeof data.tooltipForceTop!=='undefined')?Boolean(parseInt(data.tooltipForceTop,10)):$.fn.tipsy.defaults.force_top};$(this).tipsy(tooltip_data);if(typeof data.tooltipDelay!=='undefined'){var element=$(this);tooltipDelayId=setTimeout(function(){element.tipsy('show');},data.tooltipDelay);}else{$(this).tipsy('show');}}
if(typeof data.hovercard!=='undefined'){hovercard.init($(this));}
return true;});return true;}catch(e){error.log(e);}},initMouseOutEvents:function(){try{$(document).on('mouseleave','.evt-out',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data();if(typeof tooltipDelayId!=='undefined'&&tooltipDelayId>0){clearTimeout(tooltipDelayId);tooltipDelayId=0;}
if(typeof data.tooltip!=='undefined'&&data.tooltip===1&&typeof $(this).data('tipsy')!=='undefined'){$(this).tipsy('hide');}
if(typeof data.hovercard!=='undefined'){hovercard.remove();}
if(typeof data.cancelHover!=='undefined'){$(this).removeClass('evt-out evt-over cancel-hover');}
if(typeof data.play!=='undefined'&&data.play===1){clearTimeout(preview.timer);if(preview.active){preview.stop();}}
return true;});return true;}catch(e){error.log(e);}},initMouseDownEvents:function(){try{$(document).on('mousedown','.evt-click',function(e){if(e.button===2){return false;}
var $this=$(this);var data=$this.data();var event_name='evt-click-'+util.uniqid();if(typeof data.play!=='undefined'&&data.play===1&&data.enablePreview){preview.timer=window.setTimeout(function(){if(typeof data.tracking!=='undefined'){data.trackingTag='preview';EventsDelegation.tracking($this,data,event_name);EventsDelegation.mousedDownFired=true;}else{Events.resolve(event_name);}
preview.init($this);if(!$this.is('.active')){$this.tipsy('hide');}},500);}
return false;});return true;}catch(e){error.log(e);}},play:function($this,data){try{if(typeof data.type==='undefined'){return false;}
clearTimeout(preview.timer);if(preview.active){preview.stop();return true;}
if(preview.naturalFinish){preview.naturalFinish=false;return true;}
var params={type:data.type,context:{TYPE:'unknow',ID:0}};if(typeof data.id!=='undefined'){params.id=data.id;}
if(typeof data.playAuto==='boolean'){params.autoplay=data.playAuto;}
if(typeof data.radio==='boolean'){params.radio=data.radio;}
if(typeof data.playIndex==='number'){params.index=data.playIndex;}
if(typeof data.playSongList==='object'){params.data=data.playSongList;}
if(typeof data.playContext==='string'){params.context={TYPE:data.playContext,ID:data.id};}
if(typeof data.playContextId!=='undefined'){params.context.CONTEXT_ID=data.playContextId;}
var currentContext=dzPlayer.getContext();if((currentContext!==null&&LOG_CONTEXT[currentContext.TYPE]===LOG_CONTEXT[params.context.TYPE]&&currentContext.ID==params.context.ID&&typeof params.index==='undefined')||(Number(dzPlayer.getCurrentSong('MEDIA_ID'))===params.id)){EventsDelegation.toggleTrackingStatus(data);dzPlayer.control.togglePause();return true;}
if(params.type==='song'){params.type='track';}
if(typeof window.feed==='object'&&window.feed.is_webview===true){var type=((params.radio===true)?'radio/':'')+data.type;window.location='dzr://'+type+'/'+data.id+'?action=play';return true;}
dzPlayer.play(params);EventsDelegation.setSentToMobile($this,data);return true;}catch(e){error.log(e);}},setSentToMobile:function($this,data){if(data.isSentToMobile){if(thumbnails.push_mobile%3===0){$this.parent().find('[data-sent-to-mobile="1"]').addClass('active');}
thumbnails.push_mobile+=1;}
return true;},toggleTrackingStatus:function(data){if(typeof data.tracking==='undefined'){return false;}
data.tracking=(typeof data.tracking==='string')?'':!data.tracking;},playNext:function($this,data){try{if(typeof data.id==='undefined'){return false;}
api.call('song.getData',{SNG_ID:data.id,COUNTRY:COUNTRY},function(result){dzPlayer.addNextTracks([result]);return true;});return true;}catch(e){error.log(e);}},share:function($this,data){return sharebox.load(data.type,data.id);},favorite:function($this,data){try{if(typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
Events.trigger(Events.user.clickFavorite,$.extend({},data));if(typeof data.favoriteDelegate!=='undefined'){window[data.favoriteDelegate].favoriteAction($this,$.extend({},data));}else{favorite.action($this,$.extend({},data));}
return true;}catch(e){error.log(e);}},changePicture:function($this,data){try{Events.trigger(Events[data.type].uploadPicture);return true;}catch(e){error.log(e);}},userBlock:function($this,data){try{user[(data.blocked===0)?'block':'unblock']($this,data.id,null);return true;}catch(e){error.log(e);}},deletePicture:function($this,data){try{var post={};if(typeof data.id!=='undefined'){post[data.type+'_id']=data.id;}
api.call({method:data.type+'.deletePicture',data:post,success:function(){Events.trigger(Events[data.type].updatePicture,{md5:'',type:''});}});}catch(e){error.log(e);}},curator:function($this,data){try{if(typeof data.curatorAction==='undefined'||typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
switch(data.curatorAction){case'push_album':if(data.type==='album'){modal.open('/lightbox/curators/push_album/'+data.id);}
break;case'genre_album':if(data.type==='album'){modal.open('/lightbox/curators/update_genre/'+data.id);}
break;default:break;}
return true;}catch(e){error.log(e);}},modal:function($this,data){try{if(data.modal==='/close'){modal.close();return true;}
var force=data.modalForce||false;modal.open(data.modal,force);return true;}catch(e){error.log(e);}},connect:function(){www.goToConnection();},login:function(){www.goToLogin();},register:function(){www.goToRegister();},loginFacebook:function($this,data){try{if(typeof data.loginRedirect==='string'&&data.loginRedirect.length>=4&&data.loginRedirect.substr(0,4)==='http'){window.location.href=data.loginRedirect;return true;}
var redirect=data.loginRedirect||'';var login_only=true;if(typeof data.loginOnly!=='undefined'){login_only=Boolean(data.loginOnly);}
tracking.trackFormEvent($this,'click');facebook.login({login_only:login_only,redirect:redirect});if(PLATFORM==='web'){modal.close();}
return true;}catch(e){error.log(e);}},registerFacebook:function($this,data){try{if(typeof data.loginRedirect==='string'&&data.loginRedirect.length>=4&&data.loginRedirect.substr(0,4)==='http'){window.location.href=data.loginRedirect;return true;}
var redirect=((data.loginRedirect)?data.loginRedirect:'')||'';if(PLATFORM!=='web'&&redirect!==''){window.location.href=redirect;return true;}
if(redirect!==Object(redirect)){redirect='';}
tracking.trackFormEvent($this,'click');window.auth.register.create_account_fb_click(redirect);return true;}catch(e){error.log(e);}},redirect:function($this,data){try{var redirect=data.redirect.toString();if(redirect.substr(0,1)==='/'||redirect.substr(0,4)==='http'){window.location.href=redirect;return true;}
var href=$this.attr('href');if(typeof href!=='string'||href.indexOf('javascript:')>-1||href===''){return false;}
window.location.href=href;return true;}catch(e){error.log(e);}},link:function($this,data){try{var href=$this.attr('href');var target=$this.attr('target');var is_webview=(typeof window.feed==='object'&&window.feed.is_webview===true);if(OFFLINE){return false;}
if(href.indexOf('javascript:')>-1||href===''){return false;}
if(href.substr(0,4)==='http'){var in_deezer=href.indexOf(SETTING_HOST)>-1;if(is_webview||in_deezer){if(in_deezer){href=href.replace(RegExp('https?://'+SETTING_HOST+'/'),'');href=is_webview?('dzr://'+href):('/'+href);}else{href='dzr://'+href;}
window.location=href;return true;}
window.open(href);return true;}
if(target==='_blank'){window.open(href);return true;}
if(href.charAt(0)==='/'&&!data.redirect){if(is_webview){window.location='dzr:/'+href;return true;}
loadBox(href);return true;}
return false;}catch(e){error.log(e);}},tabs:function($this){try{return tabs.navClick($this);}catch(e){error.log(e);}},close:function($this){try{$this.parents('[data-target="close"]').remove();return true;}catch(e){error.log(e);}},tracking:function($this,data,event_name){try{if(EventsDelegation.mousedDownFired===true||data.tracking===0||typeof data.trackingTag==='undefined'){EventsDelegation.mousedDownFired=false;Events.resolve(event_name);return false;}
if(typeof data.tracking==='string'&&typeof window[data.tracking]!=='undefined'&&typeof window[data.tracking].tracking==='function'&&typeof data.trackingId!=='undefined'){return window[data.tracking].tracking(data.trackingTag,data.trackingId,function(){Events.resolve(event_name);});}
var tracking_params={};if(typeof data.trackingParams!=='undefined'&&typeof data.trackingParams==='string'){tracking_params=$.extend(tracking_params,JSON.parse(data.trackingParams.replace(/'/g,'"')));}
Events.resolve(event_name);if(typeof EventsDelegation.excludeTracking[data.trackingTag]!=='undefined'){return false;}
tracking.track(data.trackingTag,tracking_params,function(){if(typeof data.trackingCallback==='string'){eval(data.trackingCallback);}});}catch(e){error.log(e);}}};EventsDelegation.initMouseOverEvents();EventsDelegation.initMouseOutEvents();EventsDelegation.initMouseDownEvents();EventsDelegation.initMouseClickEvents();window.EventsDelegation=EventsDelegation;})();;
var ads={smart_site:'deezer',inactivity_count:0,ads_url_prefix:PROTOCOL_HTTP+'ww400.smartadserver.com/call/pubj/',feed_ads_position:0,allow_audio:true,inactivity_duration:240,refresh_duration:240,init:function(){try{if(!USER.OPTIONS.ads_display&&!USER.OPTIONS.ads_audio){return false;}
if(USER.USER_ID>0&&dateToTimestamp(USER.INSCRIPTION_DATE)+172800>SERVER_TIMESTAMP){USER.OPTIONS.ads_display=false;USER.OPTIONS.ads_audio=false;$('body').removeClass('dz_ads');return true;}
if(SETTING_HOST==='orange.deezer.com'||SETTING_HOST.indexOf('orange.deezerdev.com',0)!==-1){ads.smart_site='orange';}
Events.subscribe(Events.navigation.page_changed,function(evt,params){if(naboo.getCurrentPath()===params.path){return false;}
ads.resetRefreshCounter();disableAds();});Events.subscribe(Events.player.play,function(evt,param){startAudioAdsTimer();});return true;}catch(e){error.log(e);}},setMassMotion:function(data){try{if(typeof data.redirect.js!='undefined'&&data.redirect.js.length>0){var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=data.redirect.js;headElement.appendChild(script);}
return true;}catch(e){error.log(e);}},setSwf:function(div,id,content,w,h,clickMethod,clickCommand,bgColor,wmode){try{if($('#'+div).length===0){return false;}
var oldId;if($('[id='+div+']').length>1){oldId=div;var newId=div+'_'+SERVER_TIMESTAMP;$('#'+oldId).attr('id',newId);div=newId;}
var so=new SWFObject(content,id,w,h,'8',bgColor);so.addParam('wmode',wmode);so.addParam('allowScriptAccess','always');so.addVariable(clickMethod,clickCommand);so.write(div);$('#'+div).show();if(typeof oldId!='undefined'){$('#'+div).attr('id',oldId);}
return true;}catch(e){error.log(e);}},setImage:function(div,content,clickCommand,clickCommandTarget){try{if($('#'+div).length===0){return false;}
$('#'+div).html('<a href="'+clickCommand+'" target="'+clickCommandTarget+'"><img src="'+content+'" /></a>').show();}catch(e){error.log(e);}},setText:function(div,str,max_length){try{if($('#'+div).length===0||typeof str==='undefined'||typeof max_length==='undefined'){return false;}
$('#'+div).text(str.substr(0,max_length));}catch(e){error.log(e.message,e.stack);}},setUrl:function(div,url){try{if($('#'+div).length===0||typeof url==='undefined'){return false;}
$('#'+div).prop('href',url);}catch(e){error.log(e.message,e.stack);}},setVideo:function(div,id,content,w,h,startImage,endImage,autoPlayDelay,clickCommand){try{if($('#'+div).length===0){return false;}
var so=new SWFObject(SETTING_STATIC+'/swf/videoAdsPlayer-v'+STATIC_VERSION+'.swf',id,w,h,'9');so.addParam('wmode','opaque');so.addParam('allowScriptAccess','always');so.addVariable('urlContent',content);so.addVariable('urlStartImage',startImage);so.addVariable('urlEndImage',endImage);so.addVariable('autoPlayDelay',autoPlayDelay);so.addVariable('clickTag',clickCommand);so.write(div);return true;}catch(e){error.log(e);}},setRedirect:function(div,js,clickCommand,w,h){try{if($('#'+div).length===0){return false;}
$('#'+div).html('<iframe src="'+SETTING_STATIC+'/ads/iframe-v'+STATIC_VERSION+'.html?tag='+bin2hex(js)+'&clickcommand='+encodeURIComponent(clickCommand)+'" scrolling="no" resizable="no" width="'+w+'" height="'+h+'" frameborder="0"></iframe>').show();return true;}catch(e){error.log(e);}},setHtmlRedirect:function(div,url,clickCommand,formatId,w,h){try{if($('#'+div).length===0||url==undefined||clickCommand==undefined||formatId==undefined||w==undefined||h==undefined){return false;}
var addEvt=function(e,evt,c){if(!e||!evt||!c){return;}
if(e.addEventListener){e.addEventListener(evt,c,false);}else if(e.attachEvent){e.attachEvent('on'+evt,c);}};addEvt(window,'message',function(e){if(!e.data||formatId!=e.data){return;}
e.source.postMessage(clickCommand,'*');});url=url+(url.indexOf('?')<0?'?':'&')+'sasfid='+formatId;$('#'+div).html('<iframe src="'+encodeURI(url)+'" scrolling="no" resizable="no" width="'+w+'" height="'+h+'" frameborder="0"></iframe>').show();return true;}catch(e){error.log(e);}},setPixelAgence:function(url,id){try{if(url===''){return false;}
if($('#'+id).length==0){$('body').append($('<div id="'+id+'"></div>'));}
$('#'+id).html('<img src="'+url+'" onLoad="try {ads.unsetPixelAgence('+'\''+id+'\''+')} catch (e) {}; return true" onError="try {ads.unsetPixelAgence('+'\''+id+'\''+')} catch (e) {}; return true" />');return true;}catch(e){error.log(e);}},unsetPixelAgence:function(id){try{$('#'+id).text('');return true;}catch(e){error.log(e);}},setAlenty:function(data){try{if(typeof data.tracking.alenty!='undefined'&&data.tracking.alenty.length>0){var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=data.tracking.alenty;headElement.appendChild(script);}
return true;}catch(e){error.log(e);}},callAds:function(tags,isAudio){try{if(typeof isAudio=='undefined'){isAudio=false;}
if(typeof USER!='undefined'&&USER.OPTIONS.ads_display===false&&!isAudio){return false;}
if(typeof USER!='undefined'&&USER.OPTIONS.ads_audio===false&&isAudio){return false;}
var urlParams=tags+ads.adsUrlParams();var headElement=document.getElementsByTagName('head')[0];var script=document.createElement('script');script.async=true;script.src=ads.ads_url_prefix+urlParams;headElement.appendChild(script);var tagList=tags.split('/');if(typeof tagList[2]=='undefined'){return false;}
var formatId=tagList[2];if(typeof adsCurrentDisplay[formatId]=='undefined'){if(formatId!='7073'&&formatId!='17992'&&formatId!='19632'){adsCurrentDisplay[formatId]={url:tags,refreshDuration:ads.refresh_duration,refreshCount:0};}}}catch(e){error.log(e);}},adsUrlParams:function(){try{var params=';user_age='+(USER.USER_AGE===0?'unknown':USER.USER_AGE);params+=';user_sexe='+USER.USER_GENDER;params+=';env='+ENV;params+=';pr='+((typeof DZPS==='boolean'&&DZPS===true)?'1':'0');params+=';user_id='+USER.USER_ID;params+=';username='+(typeof USER.BLOG_NAME==='string'?encodeURIComponent(USER.BLOG_NAME):'');params+=';firstname='+(typeof USER.FIRSTNAME==='string'?encodeURIComponent(USER.FIRSTNAME):'');params+=';lastname='+(typeof USER.LASTNAME==='string'?encodeURIComponent(USER.LASTNAME):'');params+=';partners='+encodeURIComponent(USER.PARTNERS);params+=';offer_id='+OFFER_ID;params+=';focus='+ads_focus_value;params+=';site='+ads.smart_site;params+=';user_fc='+(USER.FACEBOOK.UID?'1':'0');params+=';favorite_tag='+USER.FAVORITE_TAG;params+=';lang='+SETTING_LANG;params+=';player_play='+((dzPlayer.playing)?'1':'O');return params+'?';}catch(e){error.log(e);}},incrementRefreshCounter:function(){try{for(var a in adsCurrentDisplay){if(!adsCurrentDisplay.hasOwnProperty(a)){continue;}
adsCurrentDisplay[a].refreshCount+=10;}
if(!ads_focus_value){ads.inactivity_count+=10;}
ads.checkAutoRefresh(false);}catch(e){error.log(e);}},checkAutoRefresh:function(resetInactivity){try{for(var a in adsCurrentDisplay){if(!adsCurrentDisplay.hasOwnProperty(a)){continue;}
if(adsCurrentDisplay[a].refreshCount>=adsCurrentDisplay[a].refreshDuration&&ads_focus_value){var reCallUrl=';automatic_refresh=true';if(ads.inactivity_count>=ads.inactivity_duration){reCallUrl+=';billboard=true';}
if(dzPlayer.getPlayerType()!='ads'){ads.callAds(adsCurrentDisplay[a].url+reCallUrl);}
adsCurrentDisplay[a].refreshCount=0;ads.inactivity_count=0;}}
if(resetInactivity){ads.inactivity_count=0;}
return true;}catch(e){error.log(e);}},resetRefreshCounter:function(){try{ads.inactivity_count=0;adsCurrentDisplay={};}catch(e){error.log(e);}},displayAutopromo:function(data){try{var clickCommandTarget='_'+data.LINKTYPE;var clickCommandUrl=data.LINK;if(clickCommandTarget=='_internal'){clickCommandTarget='_self';clickCommandUrl='javascript:'+clickCommandUrl;}
var adsHeader={format:{formatType:'image',formatSize:'770x120'},content:{urlContent:SETTING_DOMAIN_IMG+'/misc/'+data.BACKGROUND+'/0x0-000000-80-0-0.jpg'},background:{backgroundUrl:SETTING_DOMAIN_IMG+'/misc/'+data.RIGHT_COLUMN+'/0x0-000000-80-0-0.jpg',backgroundColor:'#'+data.COLOR},tracking:{clickCommand:clickCommandUrl,clickCommandTarget:clickCommandTarget,clickTagMethod:'',pixelAgence:'',alenty:'',timestamp:''},options:{repeat:'no-repeat',displayBackground:true}};displayAdsPlayer(adsHeader);return true;}catch(e){error.log(e);}}};var adsCurrentDisplay={};var homepage_end_background='';var timeout_ads_video=null;function dclk_show(){if(typeof expand_data!='undefined'){var ads_expand=$('#ads_expand');if(ads_expand.length==1){ads.setSwf('ads_expand','ads_expand_swf',expand_data.expand.urlContentExpand,expand_data.expand.widthExpand,expand_data.expand.heightExpand,expand_data.tracking.clickTagMethod,expand_data.tracking.clickCommand,'#FFFFFF','transparent');ads_expand.parent().css('position','');var position={left:expand_data.expand.posXExpand,top:expand_data.expand.posYExpand};if(expand_data.format.formatSize=='300x250'){if(position.left=='0'&&position.top=='0'){position.top=$('#ads_300x250').offset().top;position.left=$('#ads_300x250').offset().left+300-expand_data.expand.widthExpand;}else{position.top=$('#ads_300x250').offset().top;position.left=$('#ads_300x250').offset().left-expand_data.expand.widthExpand-20;}}else if(expand_data.format.formatSize=='750x120'||expand_data.format.formatSize=='728x90'){var padding=0;var $source=$('#'+expand_data.div);if(position.left=='0'&&position.top=='0'){position.top=$source.offset().top+((expand_data.div==='ads_banner_bottom')?-100:padding);position.left=$source.children().offset().left;}else{position.top=$source.offset().top+((expand_data.div==='ads_banner_bottom')?-400:(120+(padding*2)));position.left=$source.children().offset().left;Events.subscribeOnce(Events.layout.adsBackground,function(evt,data){if(data.display==='show'){ads_expand.css('left',($source.offset().left+15)+'px');}},'expand_resize');}}
ads_expand.css({top:position.top+'px',left:position.left+'px',display:'block'});}}}
dclk_hide=dclk_hide_overlay=function(){$('#ads_expand').hide().text('');};function open_window(page){window.open(page);}
function encodeClickCommand(str){try{var split_command=str.split('%7Esscs%3D%3f',2);if(typeof split_command[0]!='undefined'&&typeof split_command[1]!='undefined'){split_command2=split_command[1].split('http%3A%2F',2);if(typeof split_command2[0]!='undefined'&&typeof split_command2[1]!='undefined'){str=split_command[0]+'%7Esscs%3D%3f'+split_command2[0]+encodeURIComponent(PROTOCOL_HTTP)+split_command2[1];}else{str=split_command[0]+'%7Esscs%3D%3f'+escape(split_command[1]);}}
return str;}catch(e){error.log(e);}}
function displayAdsHabillage(data){try{if(typeof data.header.url!='undefined'){data.header.url=encodeClickCommand(data.header.url);}
var banner_div;if(data.background.backgroundType=='image'){$('body').addClass('has-ads');$('#ads_banner_left').css('background-color',data.background.color);$('#ads_banner_left > img').attr('src',data.background.backgroundUrl);$('body').addClass('has-ads-full');}else if(typeof data.background.backgroundType!='undefined'&&data.background.backgroundType=='video'&&typeof data.background.url!='undefined'&&typeof data.background.color!='undefined'&&typeof data.header.url!='undefined'&&$('#ads_video').length==1){$('#ads_video').show();var so=new SWFObject(SETTING_STATIC+'/swf/deezerplayer-v'+STATIC_VERSION+'.swf?feed='+data.background.url+'&stretch=fill&smooth=on&volume=0&clickTAG='+data.header.url,'ads_video_swf','100%','100%','9',data.background.color);so.addParam('wmode','opaque');so.addParam('allowScriptAccess','always');so.write('ads_video');if(typeof data.background.urlEndImage!='undefined'){homepage_end_background=data.background.urlEndImage+' no-repeat center 104px';}
if(typeof data.background.videoDuration!='undefined'&&data.background.videoDuration>0){timeout_ads_video=setTimeout(function(){disableAdsVideo();},(data.background.videoDuration*1000));}}else if(data.background.backgroundType=='massmotion'){ads.setMassMotion(data);}else if(data.background.backgroundType=='redirect'&&typeof data.redirect.js!='undefined'&&data.redirect.js.length>0){banner_div='naboo_banner_habillage';ads.setRedirect(banner_div,data.redirect.js,data.header.url,data.header.width,data.header.height);}
if(data.background.backgroundType!='massmotion'&&data.background.backgroundType!='redirect'){var bgColor='#FFFFFF';var wmode='transparent';if(typeof data.header.swfBackgroundColor!='undefined'&&data.header.swfBackgroundColor.length>0){bgColor=data.header.swfBackgroundColor;wmode='opaque';}
banner_div='naboo_banner_habillage';ads.setSwf(banner_div,banner_div+'_swf',data.header.location,data.header.width,data.header.height,data.header.method,data.header.url,bgColor,wmode);$('#'+banner_div).css('height',data.header.height).show();if(data.background.backgroundType=='video'){$('#'+banner_div).css('visibility','hidden');}}
if(typeof data.background.centerColor!='undefined'&&data.background.centerColor!==''){$('#homepage').css('background',data.background.centerColor);}
if(typeof data.header.url!='undefined'&&typeof data.background.url!='undefined'&&data.background.url!==''){$('#naboo > .page-content > .page-ads').attr('onclick','window.open = \''+data.header.url+'\'');}
if(typeof data.tracking.pixelAgence!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,'ads_pixel');}
ads.setAlenty(data);Events.trigger(Events.layout.adsBanner,{display:'show',type:'right'});return true;}catch(e){error.log(e);}}
function disableAdsHabillage(){try{$('body').removeClass('has-ads-full');$('#ads_banner_left > img').removeAttr('src');ads.allow_audio=true;return true;}catch(e){console.log(e.message,e.stack);}}
function hideAdsHabillage(page){try{$('body').removeClass('has-ads-full has-ads');ads.allow_audio=true;Events.trigger(Events.layout.adsBackground,{display:'hide'});return true;}catch(e){error.log(e);}}
function disableAdsVideo(){try{if(timeout_ads_video!==null){clearTimeout(timeout_ads_video);}
$('#ads_video').hide().text('');$('#banner_habillage').css('visibility','visible');if(homepage_end_background!==null&&homepage_end_background!==''){www.displayBackground(homepage_end_background);}
return true;}catch(e){error.log(e);}}
function displayAdsBillboard(data){error.log('displayAdsBillboard:deprecated');}
function displayAdsInterstitial(data){try{var billboard_data={url:data.content.urlContent,click:data.tracking.clickCommand,pixelAgence:data.tracking.pixelAgence,pixelAgenceScript:data.tracking.pixelAgenceScript,clickTagMethod:data.tracking.clickTagMethod,pixelAgence:data.tracking.pixelAgence,target:'_blank',duration:data.options.duration,type:'ads_interstitial',formatId:data.format.formatId,format:data.format.formatType,formatSize:data.format.formatSize,redirect:data.redirect};displayInterstitial(billboard_data);ads.setAlenty(data);}catch(e){error.log(e);}}
var adsTimeoutId=0;var currentAudioAds='';var firstAudioAdsFinish=false;var firstAudioAdsTimer=(ENV==='PROD')?60000:30000;var audioAdsTimer=(ENV==='PROD')?540000:45000;function startAudioAdsTimer(){try{if(typeof USER!=='undefined'&&USER.OPTIONS.ads_audio===false){return false;}
if(adsTimeoutId>0){return false;}
if(dzPlayer.getAudioAds()!==null){return false;}
adsTimeoutId=window.setTimeout(getAudioAds,firstAudioAdsFinish?audioAdsTimer:firstAudioAdsTimer);firstAudioAdsFinish=true;return true;}catch(e){error.log(e);}}
function stopAudioAdsTimer(){try{currentAudioAds='';if(adsTimeoutId>0){window.clearTimeout(adsTimeoutId);}
adsTimeoutId=0;return true;}catch(e){error.log(e);}}
function startDisplayAudioAds(){try{if(currentAudioAds!==''){if(typeof currentAudioAds.tracking.vastImpression!='undefined'){for(var j=0;j<currentAudioAds.tracking.vastImpression.length;j++){var urlImpression=currentAudioAds.tracking.vastImpression[j];if(urlImpression.indexOf('sz=1x1')>-1){ads.setPixelAgence(urlImpression,'ads_pixel');}else{sendRequest(urlImpression,'text','');}}}
if((currentAudioAds.content.urlContent!==''||currentAudioAds.content.htmlContent!==''||(currentAudioAds.format.formatType=='massmotion'&&currentAudioAds.redirect.js!==''))){if(naboo.getCurrentClass()!==null||www.getCurrentPageType()=='radio'){Events.subscribe(Events.player.adsVastPlaying,adsVastPlayingControl);displayAdsPlayer(currentAudioAds,false);}else{countAdsPlayer(currentAudioAds.tracking.pixelAgence);}}}
return true;}catch(e){error.log(e);}}
function adsVastPlayingControl(evt,data){try{if(dzPlayer.getAudioAds()===null){return false;}
if(typeof dzPlayer.getAudioAds().audio=='undefined'){return false;}
var quartile=Math.round(dzPlayer.getAudioAds().audio.duration/4);if(Math.floor(data.position)==1&&typeof dzPlayer.getAudioAds().tracking.trackingStart!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingStart,'text','');delete dzPlayer.getAudioAds().tracking.trackingStart;}else if(Math.floor(data.position)==quartile&&typeof dzPlayer.getAudioAds().tracking.trackingFirstQuartile!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingFirstQuartile,'text','');delete dzPlayer.getAudioAds().tracking.trackingFirstQuartile;}else if(Math.floor(data.position)==quartile*2&&typeof dzPlayer.getAudioAds().tracking.trackingMidpoint!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingMidpoint,'text','');delete dzPlayer.getAudioAds().tracking.trackingMidpoint;}else if(Math.floor(data.position)==quartile*3&&typeof dzPlayer.getAudioAds().tracking.trackingThirdQuartile!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingThirdQuartile,'text','');delete dzPlayer.getAudioAds().tracking.trackingThirdQuartile;}else if(Math.floor(data.position)==dzPlayer.getAudioAds().audio.duration&&typeof dzPlayer.getAudioAds().tracking.trackingComplete!='undefined'){sendRequest(dzPlayer.getAudioAds().tracking.trackingComplete,'text','');delete dzPlayer.getAudioAds().tracking.trackingComplete;}}catch(e){error.log(e);}}
function displayAdsVast(url,defaultSize){try{sendRequest(url,'text','',true,function(xml){var xmlDoc=$.parseXML(xml.responseText);$xml=$(xmlDoc);$ad=$xml.find('Ad');if($ad.length===0){return false;}
$linear=$xml.find('Linear');$companion=$xml.find('CompanionAds');$impressions=[];for(var i=0;i<$xml.find('Impression').length;i++){$impressions.push(str_replace($xml.find('Impression')[i].textContent,'[timestamp]',SERVER_TIMESTAMP));}
for(var i=0;i<$xml.find('CompanionAds [event="creativeView"]').length;i++){$impressions.push(str_replace($xml.find('CompanionAds [event="creativeView"]')[i].textContent,'[timestamp]',SERVER_TIMESTAMP));}
var format='';if($companion.find('StaticResource').text()!==''){format=$companion.find('StaticResource').attr('creativeType');if(format.indexOf('image')>-1){format='image';}else if(format.indexOf('massmotion')>-1){format='massmotion';}else if(format.indexOf('swf')>-1){format='swf';}}else if($companion.find('HTMLResource').text()!==''){format='html';}
var size=(typeof defaultSize!='undefined')?defaultSize:'728x90';if($companion.find('Companion').attr('width')!='0'&&$companion.find('Companion').attr('height')!='0'){size=$companion.find('Companion').attr('width')+'x'+$companion.find('Companion').attr('height');}
currentAudioAds={format:{formatType:format,formatSize:size},content:{urlContent:$companion.find('StaticResource').text(),htmlContent:str_replace($companion.find('HTMLResource').text(),'[timestamp]',SERVER_TIMESTAMP)},audio:{url:$linear.find('MediaFile').text(),duration:formatedTimeToSecond($linear.find('Duration').text())},textlink:{text:$xml.find('AdTitle').text()},tracking:{clickCommand:$companion.find('CompanionClickThrough').text(),vastImpression:$impressions,trackingStart:$linear.find('Tracking[event="start"]').text(),trackingFirstQuartile:$linear.find('Tracking[event="firstQuartile"]').text(),trackingMidpoint:$linear.find('Tracking[event="midpoint"]').text(),trackingThirdQuartile:$linear.find('Tracking[event="thirdQuartile"]').text(),trackingComplete:$linear.find('Tracking[event="complete"]').text()}};dzPlayer.setAudioAds(currentAudioAds);});}catch(e){error.log(e);}}
function displayAudioAds(data){try{if(typeof data.format!='undefined'&&typeof data.format.formatType!='undefined'&&data.format.formatType=='redirect'){displayAdsVast(data.redirect.js,data.format.formatSize);return true;}
dzPlayer.setAudioAds(data);if(typeof data.expand!='undefined'&&typeof data.expand.urlContentExpand!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;}
currentAudioAds=data;}catch(e){error.log(e);}}
function disableAudioAds(){try{$('#ads_banner_audio').hide().empty();if($('#ads_banner_top').children().length===0){$('body').removeClass('has-ads-top');}
if($('#ads_banner_bottom').children().length===0){$('body').removeClass('has-ads-bottom');}
$('#ads_banner_top').show();$('#ads_banner_bottom').show();if(typeof $('#naboo > .page-content > .page-ads > img').attr('src')==='string'||typeof $('#ads_banner_left > img').attr('src')==='string'){$('body').addClass('has-ads has-ads-full');Events.trigger(Events.layout.adsBackground,{display:'show'});}}catch(e){error.log(e);}}
function getAudioAds(){try{var sas_id=0;var ads_page_id={explore:274132,tops:274126,search:115072,result:115072,playlist:115067,album:115066,artist:115069,radio:115070,feed:114873,home:114873,profile:115081,track:487686,talk:555138,show:555137};if(typeof ads_page_id[naboo.getCurrentClass()]==='number'&&ads.allow_audio){sas_id=ads_page_id[naboo.getCurrentClass()];}
if(sas_id>0){var elementType=www.getCurrentPageType();var elementId=www.getCurrentPageId();var elementStyle=0;var ord=parseInt(Math.random()*10000000000000000);ads.callAds('15829/'+sas_id+'/7073/S/'+ord+'/element_type='+elementType+';element_id='+elementId+';element_style='+elementStyle,true);}
stopAudioAdsTimer();}catch(e){error.log(e);}}
histoUrl={adsPlayer:[]};function displayAdsFooter(data){try{if(typeof data=='undefined'){return false;}
if(naboo.getCurrentClass()===null){return false;}
if(menu.MenuComponent&&menu.MenuComponent.isPanelOpen('lyrics')){$('body').addClass('has-lyrics-ads-bottom');displayAdsBanner(data,'lyrics_ads_banner_bottom');}else{$('body').addClass('has-ads-bottom');$('#ads_banner_bottom').parent().removeClass('ads-120');displayAdsBanner(data,'ads_banner_bottom');}}catch(e){error.log(e);}}
function displayAdsPlayer(data,removeHabillage){try{if(typeof data=='undefined'){return false;}
if(naboo.getCurrentClass()===null){return false;}
if(typeof removeHabillage==='undefined'){removeHabillage=true;}
$('body').addClass('has-ads-top');var div_ads;var div_ads_audio='ads_banner_audio';if(typeof data.audio!='undefined'&&typeof data.audio.url!='undefined'){$('body').addClass('has-ads-bottom');div_ads=div_ads_audio;$('#'+div_ads_audio).show();$('#ads_banner_top').hide();$('#ads_banner_bottom').hide();}else{div_ads='ads_banner_top';$('#'+div_ads_audio).hide();}
if(removeHabillage){disableAdsHabillage();}else{hideAdsHabillage();}
if(typeof data.background!='undefined'&&typeof data.background.backgroundUrl!='undefined'&&data.background.backgroundUrl.length>0){$('body').addClass('has-ads has-ads-full');$('#ads_banner_left > img').attr('src',data.background.backgroundUrl);ads.allow_audio=true;if(typeof data.options.allow_audio!=='undefined'){ads.allow_audio=data.options.allow_audio;}
Events.trigger(Events.layout.adsBackground,{display:'show'});}
if(typeof data.background!='undefined'&&typeof data.background.backgroundColor!='undefined'&&data.background.backgroundColor.length>0){$('body').addClass('has-ads has-ads-full');$('#ads_banner_left').css('background-color',data.background.backgroundColor);}
displayAdsBanner(data,div_ads);return true;}catch(e){error.log(e);}}
function displayAdsBanner(data,div_ads){try{if(typeof data.options!='undefined'&&typeof data.options.refresh!='undefined'&&typeof data.format.formatId!='undefined'){if(data.options.refresh===false){delete adsCurrentDisplay[data.format.formatId];}else if(typeof data.options.refreshDuration!=='undefined'&&data.options.refreshDuration!=0){adsCurrentDisplay[data.format.formatId].refreshDuration=data.options.refreshDuration;}}
if(typeof data.format!='undefined'&&typeof data.format.formatSize!='undefined'){formatType=data.format.formatType;formatSize=data.format.formatSize;formatSizes=formatSize.split('x');if((div_ads==='ads_banner_bottom'||div_ads==='ads_banner_audio')&&formatSizes[1]==120){$('#'+div_ads).parent().addClass('ads-120');}else if(div_ads==='ads_banner_top'){$('#'+div_ads).height(formatSizes[1]);}}else{return false;}
if(typeof data.tracking.clickCommand!='undefined'&&formatType=='swf'){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(typeof data.billboard!='undefined'&&typeof data.billboard.billboardUrl!='undefined'&&data.billboard.billboardUrl.length>0){var billboard_data={url:data.billboard.billboardUrl,click:data.tracking.clickCommand,target:'_blank',duration:3,type:'ads_billboard'};displayInterstitial(billboard_data);}
if(formatType=='massmotion'){ads.setMassMotion(data);}else if(formatType=='swf'){var bgColor='#FFFFFF';if(typeof data.content.swfBackgroundColor!='undefined'&&data.content.swfBackgroundColor.length>0){bgColor=data.content.swfBackgroundColor;}
ads.setSwf(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,bgColor,'transparent');}else if(formatType=='image'){if(typeof data.tracking.clickCommandTarget=='undefined'){data.tracking.clickCommandTarget='_blank';}
ads.setImage(div_ads,data.content.urlContent,data.tracking.clickCommand,data.tracking.clickCommandTarget);}else if(formatType=='redirect'&&typeof data.redirect.clickCommand!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}else if(formatType=='html'&&data.content.htmlContent!=''&&currentAudioAds.format.formatSize!=null){ads.setRedirect(div_ads,escape(data.content.htmlContent),'',formatSizes[0],formatSizes[1]);}else if(formatType==='html5'){ads.setHtmlRedirect(div_ads,data.content.urlContent,data.tracking.clickCommand,data.format.formatId,formatSizes[0],formatSizes[1]);}
if(typeof data.tracking.pixelAgence!='undefined'&&typeof data.tracking.timestamp!='undefined'){if(typeof histoUrl.adsPlayer[data.tracking.pixelAgence+'|'+data.tracking.timestamp]=='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,'ads_pixel');histoUrl.adsPlayer[data.tracking.pixelAgence+'|'+data.tracking.timestamp]=true;}}
if(data.tracking.pixelAgenceScript){$('head').append(unescape(data.tracking.pixelAgenceScript));}
if(typeof data.background!='undefined'&&typeof data.tracking.clickCommand!='undefined'&&typeof data.background.backgroundUrl!='undefined'&&data.background.backgroundUrl.length>0){if(typeof data.tracking.clickCommandTarget=='undefined'){data.tracking.clickCommandTarget='_blank';}
$('#ads_banner_left').attr({onclick:'window.'+((data.tracking.clickCommandTarget=='_blank')?'open':'location')+'(\''+data.tracking.clickCommand+'\'); return false;'});}
if(typeof data.expand!='undefined'&&typeof data.expand.urlContentExpand!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;expand_data.div=div_ads;if(expand_data.expand.autoExpand=='Yes'){dclk_show();expand_data=null;}}
ads.setAlenty(data);Events.trigger(Events.layout.adsBanner,{display:'show',type:(div_ads==='ads_banner_top'?'top':'bottom')});return true;}catch(e){error.log(e);}}
function countAdsPlayer(pixelAgence){try{$('#ads_pixel').html('<img src="'+pixelAgence+'"/>');return true;}catch(e){error.log(e);}}
function disableAdsPlayer(){try{$('#ads_banner_top').hide().text('');return true;}catch(e){error.log(e);}}
function disableAds(){try{$('body').removeClass('has-ads-bottom has-ads-top');$('#ads_banner_top').empty();$('#ads_banner_bottom').empty();Events.unsubscribeAll('expand_resize');disableAdsHabillage();Events.trigger(Events.layout.adsBanner,{display:'hide'});return true;}catch(e){error.log(e);}}
var expand_data=null;function displayAdsClassic(data){try{formatSize=data.format.formatSize;formatSizes=formatSize.split('x');formatType=data.format.formatType;if(typeof data.options!='undefined'&&typeof data.options.refresh!='undefined'&&typeof data.format.formatId!='undefined'){if(data.options.refresh===false){delete adsCurrentDisplay[data.format.formatId];}
if(typeof data.options.refreshDuration!='undefined'&&data.options.refreshDuration!=0){adsCurrentDisplay[data.format.formatId].refreshDuration=data.options.refreshDuration;}}
var div_ads;if(formatSize=='300x250'||formatSize=='300x600'||formatSize=='120x600'){div_ads='ads_'+formatSize;}else if(formatSize=='728x90'){div_ads='ads_banner_bottom';}
if(typeof data.tracking.clickCommand!='undefined'&&(formatType=='swf'||formatType=='video')){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(formatType=='massmotion'){ads.setMassMotion(data);}else if(formatType=='swf'){ads.setSwf(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,'#FFFFFF','opaque');}else if(formatType=='image'){if(typeof data.tracking.clickCommandTarget=='undefined'){data.tracking.clickCommandTarget='_blank';}
ads.setImage(div_ads,data.content.urlContent,data.tracking.clickCommand,data.tracking.clickCommandTarget);}else if(formatType=='video'){ads.setVideo(div_ads,div_ads+'_swf',data.content.urlContent,formatSizes[0],formatSizes[1],data.content.urlStartImage,data.content.urlEndImage,data.options.autoPlayDelay,data.tracking.clickCommand);}else if(formatType=='redirect'&&typeof data.redirect.clickCommand!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}
if(typeof data.tracking.pixelAgence!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,div_ads+'_pixel');}
ads.setAlenty(data);if(typeof data.expand!='undefined'&&typeof data.expand.urlContentExpand!='undefined'&&data.expand.urlContentExpand.length>0){expand_data=data;if(data.expand.autoExpand=='Yes'){dclk_show();}}}catch(e){error.log(e);}}
function displayAdsFeed(data){try{var formatSize=data.format.formatSize;var formatSizes=formatSize.split('x');var formatType=data.banFormat.banFormatType;var banUrlContent=data.banFormat.banUrlContent;var banClickCommand=data.banFormat.banClickCommand;var clickCommandTarget=data.tracking.clickCommandTarget||'_blank';var type=data.format.formatType;var div_ads='ads_'+ads.feed_ads_position;if(typeof data.tracking.clickCommand!='undefined'&&(formatType=='swf'||formatType=='video')){data.tracking.clickCommand=encodeClickCommand(data.tracking.clickCommand);}
if(typeof type!=='undefined'&&type==='Card'){var smallFormatType=data.cardFormat.smallAdFormatType;formatSize=data.cardFormat.smallAdFormatSize;formatSizes=formatSize.split('x');if(smallFormatType=='image'){ads.setImage(div_ads+'_small',data.cardFormat.smallAdUrlContent,banClickCommand,clickCommandTarget);}else if(smallFormatType=='swf'){ads.setSwf(div_ads+'_small',div_ads+'_swf',data.cardFormat.smallAdUrlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,data.tracking.clickCommand,'#FFFFFF','transparent');}
ads.setText(div_ads+'_text',data.cardFormat.bigAdText,150);ads.setText(div_ads+'_small_url',data.cardFormat.smallAdText,50);ads.setUrl(div_ads+'_url',banClickCommand);ads.setUrl(div_ads+'_small_url',banClickCommand);formatType=data.cardFormat.bigAdFormatType;formatSize=data.cardFormat.bigAdFormatSize;formatSizes=formatSize.split('x');div_ads+='_big';}
if(formatType=='image'){if(typeof clickCommandTarget=='undefined'){clickCommandTarget='_blank';}
ads.setImage(div_ads,banUrlContent,banClickCommand,clickCommandTarget);}else if(formatType=='video'){ads.setVideo(div_ads,div_ads+'_swf',banUrlContent,formatSizes[0],formatSizes[1],'','','',data.tracking.clickCommand);}else if(formatType=='swf'){ads.setSwf(div_ads,div_ads+'_swf',banUrlContent,formatSizes[0],formatSizes[1],data.tracking.clickTagMethod,banClickCommand,'#FFFFFF','transparent');}else if(formatType=='redirect'&&typeof data.redirect.clickCommand!='undefined'){ads.setRedirect(div_ads,data.redirect.js,data.redirect.clickCommand,formatSizes[0],formatSizes[1]);}else if(formatType==='html5'){ads.setHtmlRedirect(div_ads,data.banFormat.banUrlContent,data.redirect.clickCommand,data.format.formatId,formatSizes[0],formatSizes[1]);}
if(typeof data.tracking.pixelAgence!='undefined'){ads.setPixelAgence(data.tracking.pixelAgence,div_ads+'_pixel');}
ads.setAlenty(data);$('#'+((type==='Card')?'sponsored_':'ads_')+ads.feed_ads_position+'_container').show();ads.feed_ads_position++;}catch(e){error.log(e);}}
function immersive_end(){try{Events.trigger(Events.player.finishAds);disableAudioAds();}catch(e){error.log(e);}};
var dzoffline={init:function(){try{if(!Modernizr.indexeddb||!dzoffline.browserCompatibility()){return false;}
if(USER.USER_ID===0){Events.ready(Events.user.loaded,dzoffline.init);return false;}
dzoffline.downloadAppNotify();if(window.navigator.onLine){dzoffline.createFrame();$('#frame_manifest').attr('src','/appcache/index.php');}else{$('body').addClass('is-offline');}
window.addEventListener('online',dzoffline.changeDisplay);window.addEventListener('offline',dzoffline.changeDisplay);return true;}catch(e){error.log(e);}},createFrame:function(){try{if($('#frame_manifest').length===0){$('body').append('<iframe id="frame_manifest" style="display:none;height:1px;width:1px"></iframe>');}}catch(e){error.log(e);}},downloadAppNotify:function(){try{if(storage.get('offline_reminder')===true&&!OFFLINE){Events.trigger(Events.offline.reminder);}
return true;}catch(e){error.log(e);}},changeDisplay:function(event){try{OFFLINE=(event.type=='offline');if(!OFFLINE){if(www.getCurrentPageType()==='offline'){setTimeout(function(){window.location.href='/';},5000);}else{dzoffline.downloadAppNotify();}}
return true;}catch(e){error.log(e);}},browserCompatibility:function(){try{switch(BrowserDetect.browser){case'Chrome':if(BrowserDetect.version>=15){return true;}
break;}
return false;}catch(e){error.log(e);}},display:function(uri){var params=[];if(!OFFLINE){params.push('offline=0');if(typeof uri==='string'){params.push('uri='+uri);}}
modal.open('/lightbox/offline'+(params.length>0?'?'+params.join('&'):''),true);}};;
(function(){'use strict';var FBApi=function(){this.app_ready=false;this.app_id=0;this.app_namespace='';this.app_scope='';this.api_version='';this.channel='';this.fb_uid='';this.access_token='';this.user_scopes=null;};FBApi.prototype.setFBUid=function(fb_uid){this.fb_uid=String(fb_uid||'');return this;};FBApi.prototype.setAccessToken=function(access_token){this.access_token=String(access_token||'');return this;};FBApi.prototype.getFBUid=function(){return this.fb_uid;};FBApi.prototype.getAccessToken=function(){return this.access_token;};FBApi.prototype.setAppData=function(data){if(this.app_ready){error.log(new Error('FBApi :: setAppData - App is already configured'));return this;}
if(data!==Object(data)||Array.isArray(data)){error.log(new Error('FBApi :: setAppData - data is not a valid object'));return;}
this.app_id=data.id||this.app_id;this.app_namespace=String(data.namespace||this.app_namespace);this.app_scope=String(data.scope||this.app_scope);this.api_version='v'+String(data.version||this.api_version);this.channel=String(data.channel||this.channel);this.app_ready=true;return this;};FBApi.prototype.unsetUserData=function(){this.fb_uid='';this.access_token='';};FBApi.prototype.getAppData=function(){return{id:this.app_id,namespace:this.app_namespace,scope:this.app_scope,version:this.api_version,channel:this.channel};};FBApi.prototype.getUserScopes=function(callback,force){if(typeof FB==='undefined'){error.log(new Error('FBApi :: getUserScopes - FB is undefined'));return;}
if(typeof callback!=='function'){error.log(new Error('FBApi :: getUserScopes - callback is not a valid function'));return;}
if(!this.fb_uid){error.log(new Error('FBApi :: getUserScopes - fb_uid is missing'));return;}
if(!this.access_token){error.log(new Error('FBApi :: getUserScopes - access_token is missing'));return;}
if(this.user_scopes!==null&&!force){setTimeout(callback.bind(this,this.user_scopes),0);return;}
FB.api('/'+this.fb_uid+'/permissions?access_token='+this.access_token,function(res){res=res.data||null;if(res===null){return callback();}
var parsed={};for(var i=0,l=res.length;i<l;++i){parsed[res[i].permission]=res[i].status==='granted';}
this.user_scopes=parsed;callback(this.user_scopes);}.bind(this));};FBApi.prototype.checkUserScopes=function(requested,callback,force){if(typeof callback!=='function'){error.log(new Error('FBApi :: checkUserScopes - callback is not a valid function'));return;}
requested=String(requested||'');force=Boolean(force);if(!requested.length||requested==='*'){requested=this.getAppData().scope;}
requested=requested.split(',');this.getUserScopes(function(scope){if(!scope||scope!==Object(scope)){return callback();}
var res={};for(var i=0,l=requested.length;i<l;++i){var current=requested[i].toLowerCase();res[current]=Boolean(scope[current]);}
callback(res);},force);};FBApi.prototype.isScopeAllowed=function(scope){scope=String(scope||'');if(this.user_scopes===null){return false;}
return Boolean(this.user_scopes[scope]);};FBApi.prototype.allowExternalScope=function(scope){var user_scopes=this.user_scopes===Object(this.user_scopes)?this.user_scopes:{};user_scopes[String(scope||'')]=true;this.user_scopes=user_scopes;};window.FBApi=FBApi;})();;
(function(){'use strict';var FBAuth=function(api){this.api=api;this.login_only=false;this.skip_onboarding=false;this.auto_login=true;this.redirect=null;this.facebook_logged=false;};FBAuth.prototype.setUserStatus=function(status,trigger){this.facebook_logged=Boolean(status);trigger=Boolean(trigger);if(trigger){Events.trigger(Events.facebook.user_status,{status:this.facebook_logged});}
return this;};FBAuth.prototype.setAutoLogin=function(bool){this.auto_login=Boolean(bool);return this;};FBAuth.prototype.isLoginOnly=function(){return this.login_only;};FBAuth.prototype.isAutoLoginAllowed=function(){return this.auto_login;};FBAuth.prototype.login=function(parameters){if(typeof FB==='undefined'){error.log(new Error('FBAuth :: login - FB is undefined'));return;}
parameters=parameters||{};if(parameters!==Object(parameters)||Array.isArray(parameters)){error.log(new Error('FBAuth :: login - parameters is not a valid object'));return;}
var scopes=String(parameters.scopes||'*');var scopes_mandatory=Boolean(parameters.scopes_mandatory);if(scopes==='*'){scopes=this.api.getAppData().scope;}
this.redirect=null;this.login_only=Boolean(parameters.login_only);this.skip_onboarding=Boolean(parameters.skip_onboarding);if(parameters.redirect===Object(parameters.redirect)){this.setRedirect(parameters.redirect.type,parameters.redirect.link);}
FB.login(function(auth){if(!auth.authResponse||auth.status!=='connected'){return;}
if(scopes_mandatory){if(!this.api.getFBUid()){this.api.setFBUid(auth.authResponse.userID);}
if(!this.api.getAccessToken()){this.api.setAccessToken(auth.authResponse.accessToken);}
this.api.checkUserScopes(scopes,function(res){if(!res){return;}
scopes=scopes.split(',');for(var i=0,l=scopes.length;i<l;++i){if(!res[scopes[i]]&&scopes[i]!=='email'){return;}}
this.connect(auth.authResponse.userID,auth.authResponse.accessToken);}.bind(this),true);}else{this.connect(auth.authResponse.userID,auth.authResponse.accessToken);}}.bind(this),{scope:scopes});};FBAuth.prototype.connect=function(fb_uid,access_token){fb_uid=String(fb_uid||'');access_token=String(access_token||'');if(!fb_uid||!access_token){error.log(new Error('FBAuth :: connect - Missing mandatory parameters'));return;}
api.call({method:'facebook.auth',data:{fb_user_id:fb_uid,access_token:access_token,login_only:this.login_only,skip_onboarding:this.skip_onboarding},success:function(res){var status=(!res||!res.status)?null:res.status;switch(status){case'success':user.refreshPageAfterLogin(this.redirect);break;case'link':if(this.redirect===null){this.setRedirect('modal','/lightbox/facebook/link');}
user.refreshPageAfterLogin(this.redirect);break;case'register':user.refreshPageAfterLogin(this.redirect);break;default:modal.open('/lightbox/facebook/error',true);break;}
return true;}.bind(this),error:function(err){var payload=!(err||!err.payload)?{}:err.payload;var status=!payload.status?'error':payload.status;var email=window.getObjDeepKey(payload,'user_data.EMAIL');switch(status){case'missing_email':modal.open('/lightbox/register.php?reason=fb_missing_email',true);break;default:modal.open('/lightbox/facebook/error?reason='+status+(email?'&email='+encodeURIComponent(email):''));break;}
return true;}});};FBAuth.prototype.setRedirect=function(type,link){type=String(type||'page');link=String(link||'/');if(link.charAt(0)!=='/'){link='/'+link;}
this.redirect={type:type,link:link};return this;};window.FBAuth=FBAuth;})();;
(function(){'use strict';var FBMethod=function(api,auth){this.api=api;this.auth=auth;this.fb_ready=false;this.events_ready=false;this.init_get_status=true;};FBMethod.prototype.initFB=function(){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: initFB - FB is undefined'));return;}
try{if(this.fb_ready){error.log(new Error('FBMethod :: initFB - FB was already initialized'));return;}
FB.init({appId:this.api.getAppData().id,channelUrl:this.api.getAppData().channel,version:this.api.getAppData().version,status:true,cookie:true,oauth:true,music:true,xfbml:false});this.fb_ready=true;if(!this.init_get_status){return;}
FB.getLoginStatus(function(res){this.auth.setUserStatus(res.status==='connected'||res.status==='not_authorized',true);if(res.status==='connected'){if(!user.current()){if(this.auth.isAutoLoginAllowed()){this.auth.connect(res.authResponse.userID,res.authResponse.accessToken);}}else{if(this.api.getFBUid()!==String(res.authResponse.userID)){this.api.unsetUserData();}else{this.api.getUserScopes(function(){user.setLogType('facebook');this.initEvents();}.bind(this),true);}}}}.bind(this));}catch(e){error.log(e);}};FBMethod.prototype.shouldGetStatus=function(bool){this.init_get_status=Boolean(bool);return this;};FBMethod.prototype.initEvents=function(){try{if(this.events_ready){error.log(new Error('FBMethod :: initEvents - Events were already initialized'));return;}
Events.subscribe(Events.player.play,function(evt,parameters){this.bridgeAction('play',parameters);}.bind(this));Events.subscribe(Events.player.resume,function(evt,parameters){this.bridgeAction('resume',parameters);}.bind(this));Events.subscribe(Events.player.paused,function(){this.bridgeAction('pause',dzPlayer.getCurrentSong());}.bind(this));Events.subscribe(Events.player.error,function(evt,parameters){this.bridgeAction('error',parameters);}.bind(this));if(typeof FB==='undefined'){error.log(new Error('FBMethod :: initEvents - FB is undefined'));return;}
FB.Event.subscribe('fb.music.PLAY',function(parameters){this.playerCallback('play',parameters);}.bind(this));FB.Event.subscribe('fb.music.RESUME',function(parameters){this.playerCallback('resume',parameters);}.bind(this));FB.Event.subscribe('fb.music.PAUSE',function(parameters){this.playerCallback('pause',parameters);}.bind(this));FB.Event.subscribe('fb.music.STATUS',function(){this.sendStatus();}.bind(this));FB.Event.subscribe('fb.music.USER_MISMATCH',function(){this.bridgeAction('close');}.bind(this));this.events_ready=true;}catch(e){error.log(e);}};FBMethod.prototype.unlinkAccount=function(){if(!confirm(gettext('Êtes-vous sûr de vouloir dissocier vos comptes Deezer et %1$s ?','Facebook'))){return;}
api.call({method:'facebook.unlinkAccount',success:function(status){if(status){this.closeBridge(window.location.reload.bind(window.location));}}.bind(this)});};FBMethod.prototype.isActionEnabled=function(action){action=String(action||'');if(typeof USER.SETTING.facebook==='undefined'){error.log(new Error('FBMethod :: isActionEnabled - Missing facebook key in user\'s settings'));return false;}
return Boolean(USER.SETTING.facebook['share_'+action]);};FBMethod.prototype.closeBridge=function(callback){callback=typeof callback==='function'?callback:function(){return;};this.bridgeAction('close',callback);};FBMethod.prototype.bridgeAction=function(action,parameters,callback){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: bridgeAction - FB is undefined'));return;}
action=String(action||'');if(typeof parameters==='function'){callback=parameters;parameters={};}
if(parameters!==Object(parameters)||Array.isArray(parameters)){parameters={};}
if(typeof callback!=='function'){callback=function(){};}
var status={};var context=null;switch(action){case'close':status={offline:true};break;case'play':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
status={playing:true,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID,created_time:timestampToIso8601(Math.floor(Date.now()/1000)),expires_in:parameters.DURATION};break;case'pause':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
status={playing:false,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID};context=this.getSongContext();if(Object.keys(context).length){status[context.type]=context.url;}
break;case'resume':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
context=this.getSongContext();status={playing:true,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID,created_time:timestampToIso8601(),expires_in:parseInt(parameters.DURATION,10)-parseInt(dzPlayer.getPosition(),10)};if(Object.keys(context).length){status[context.type]=context.url;}
break;case'error':status={playing:false,song:SETTING_HOST_SITE+'/track/'+parameters.songId};switch(parameters.dzErrorCode){case right.NOT_ENCODED:status.error_code=4;break;case right.PREMIUM_ONLY:case NOT_RELEASE_FREE:status.error_code=102;break;case right.MP3_FRIEND:case right.LOCALITY:status.error_code=103;break;default:status.error_code=0;}
break;default:error.log(new Error('FBMethod :: bridgeAction - Unknown "'+action+'" action'));return;}
status.user_id=this.api.getFBUid();FB.Music.send('STATUS',status);return callback();};FBMethod.prototype.playerCallback=function(command,parameters){command=String(command||'');parameters=parameters||{};if(parameters!==Object(parameters)){error.log(new Error('FBMethod :: playerCallback - parameters is not a valid object'));return;}
switch(command){case'resume':dzPlayer.control.play();break;case'pause':dzPlayer.control.pause();break;case'play':var context_keys=['album','radio_station','playlist','musician','song'];var context=null;for(var i=0,l=context_keys.length;i<l;++i){if(typeof parameters[context_keys[i]]!=='undefined'){context=context_keys[i];}}
if(context===null){return;}
var path=parameters[context].split('/').reverse();var ctx_id=parseInt(path[0],10);var ctx_type=String(path[1]);var radio_type=context==='radio_station'?(String(path[2])==='artist'?'artist':'radio'):null;dzPlayer.loadTracks({id:ctx_id,type:radio_type?radio_type:ctx_type,radio:Boolean(radio_type)});if(parameters[context]!==document.location.href){loadBox('/'+(radio_type?String(path[2])+'/':'')+ctx_type+'/'+ctx_id);}
break;default:error.log(new Error('FBMethod :: playerCallback - Unknown "'+command+'" command'));return;}};FBMethod.prototype.sendStatus=function(){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: sendStatus - FB is undefined'));return;}
var status={playing:dzPlayer.isPlaying(),user_id:this.api.getFBUid()};if(!status.user_id){return;}
if(dzPlayer.getCurrentSong()!==null){status.song=SETTING_HOST_SITE+'/track/'+dzPlayer.getCurrentSong('SNG_ID');}
var context=this.getSongContext();if(Object.keys(context).length){status[context.type]=context.url;}
FB.Music.send('STATUS',status);};FBMethod.prototype.getSongContext=function(){var context_keys={album:['album_page','explore_picks_album','explore_region_album','tops_album','feed_album','profile_top_albums','artist_discography','profile_albums','ticker_album','menu_panel_album','suggest_album'],radio_station:['smartradio_page','feed_smartradio','artist_smartradio','profile_radios','radio_page','feed_radio'],playlist:['playlist_page','feed_playlist','tops_playlist','profile_playlists','player_default_playlist','loved_page','ticker_playlist','menu_panel_playlist','suggest_playlist'],musician:['artist_top','search_page']};var context=dzPlayer.getContext();var url=SETTING_HOST_SITE+'/';var type=null;if(context===null||!context.TYPE){return{};}
for(var ctx in context_keys){if(type!==null){break;}
if(!context_keys.hasOwnProperty(ctx)){continue;}
for(var i=0,l=context_keys[ctx].length;i<l;++i){if(context_keys[ctx][i]===context.TYPE){type=ctx;break;}}}
if(type===null){return{};}
url+=type==='radio_station'?'mixes/'+dzPlayer.getRadioType():type;url+='/'+parseInt(context.ID,10);return{type:type,url:url};};window.FBMethod=FBMethod;})();;
(function(){'use strict';var FBWrapper=function(){this.api=new FBApi();this.auth=new FBAuth(this.api);this.method=new FBMethod(this.api,this.auth);};FBWrapper.prototype.setFBUid=function(fb_uid){return this.api.setFBUid(fb_uid);},FBWrapper.prototype.setAccessToken=function(access_token){return this.api.setAccessToken(access_token);},FBWrapper.prototype.isScopeAllowed=function(scope){return this.api.isScopeAllowed(scope);},FBWrapper.prototype.setAppData=function(data){return this.api.setAppData(data);},FBWrapper.prototype.getAppData=function(){return this.api.getAppData();},FBWrapper.prototype.checkUserScopes=function(requested,callback,force){return this.api.checkUserScopes(requested,callback,force);},FBWrapper.prototype.allowExternalScope=function(scope){return this.api.allowExternalScope(scope);},FBWrapper.prototype.setAutoLogin=function(auto_login){return this.auth.setAutoLogin(auto_login);},FBWrapper.prototype.isLoginOnly=function(){return this.auth.isLoginOnly();},FBWrapper.prototype.login=function(parameters){return this.auth.login(parameters);},FBWrapper.prototype.initFB=function(){return this.method.initFB();},FBWrapper.prototype.shouldGetStatus=function(bool){return this.method.shouldGetStatus(bool);},FBWrapper.prototype.unlinkAccount=function(){return this.method.unlinkAccount();},FBWrapper.prototype.isActionEnabled=function(action){return this.method.isActionEnabled(action);},FBWrapper.prototype.closeBridge=function(callback){return this.method.closeBridge(callback);};window.facebook=new FBWrapper();})();;
(function(){'use strict';var GGPlusApi=function(){this.app_ready=false;this.client_id='';this.client_key='';this.app_name='';this.app_scope='';this.app_redirect_uri='';this.app_access_type='';this.app_cookie_policy='';this.app_request_visible_actions='';this.api_version='';this.gg_uid='';this.access_token={};};GGPlusApi.prototype.setGGUid=function(gg_uid){this.gg_uid=String(gg_uid||'');return this;};GGPlusApi.prototype.setAccessToken=function(access_token){this.access_token=window.isPlainObject(access_token)?access_token:{};return this;};GGPlusApi.prototype.getGGUid=function(){return this.gg_uid;};GGPlusApi.prototype.getAccessToken=function(){return this.access_token;};GGPlusApi.prototype.setAppData=function(data){if(this.app_ready){error.log(new Error('GGPlusApi :: setAppData - App is already configured'));return this;}
if(!window.isPlainObject(data)){error.log(new Error('GGPlusApi :: setAppData - data is not a valid object'));return;}
this.client_id=String(data.client_id||this.client_id);this.client_key=String(data.client_key||this.client_key);this.app_name=String(data.name||this.app_name);this.app_scope=String(data.scope||this.app_scope);this.app_redirect_uri=String(data.redirect_uri||this.app_redirect_uri);this.app_access_type=String(data.access_type||this.app_access_type);this.app_cookie_policy=String(data.cookie_policy||this.app_cookie_policy);this.app_request_visible_actions=String(data.request_visible_actions||this.app_request_visible_actions);this.api_version=String(data.version||this.api_version);this.app_ready=true;return this;};GGPlusApi.prototype.unsetUserData=function(){this.gg_uid='';this.access_token={};};GGPlusApi.prototype.getAppData=function(format){format=Boolean(format);var app_data={client_id:this.client_id,client_key:this.client_key,name:this.app_name,scope:this.app_scope,redirect_uri:this.app_redirect_uri,access_type:this.app_access_type,cookie_policy:this.app_cookie_policy,request_visible_actions:this.app_request_visible_actions,version:this.api_version};if(!format){return app_data;}
delete app_data.client_key;var formated={};for(var key in app_data){if(app_data.hasOwnProperty(key)){formated[key.replace(new RegExp('_','g'),'')]=app_data[key];}}
return formated;};window.GGPlusApi=GGPlusApi;})();;
(function(){'use strict';var GGPlusAuth=function(api){this.api=api;this.redirect=null;};GGPlusAuth.prototype.login=function(code,parameters){if(typeof code!=='string'){error.log(new Error('GGPlusAuth :: login - Missing code'));return;}
this.redirect=null;if(window.isPlainObject(parameters.redirect)){this.setRedirect(parameters.redirect.type,parameters.redirect.link);}
gapi.client.load('oauth2',this.api.getAppData().version,function(){var request=gapi.client.oauth2.userinfo.get();request.execute(function(result){this.connect(result.id,code);}.bind(this));}.bind(this));};GGPlusAuth.prototype.connect=function(gg_uid,auth_key){gg_uid=String(gg_uid||'');auth_key=String(auth_key||'');if(!gg_uid||!auth_key){error.log(new Error('GGPlusAuth :: connect - Missing mandatory parameters'));return;}
api.call({method:'googleplus.auth',data:{gg_user_id:gg_uid,auth_key:auth_key},success:function(res){var status=!(res||!res.status)?null:res.status;switch(status){case'success':user.refreshPageAfterLogin(this.redirect);break;case'link':if(this.redirect===null){this.setRedirect('modal','/lightbox/googleplus/link');}
user.refreshPageAfterLogin(this.redirect);break;case'register':user.refreshPageAfterLogin(this.redirect);break;default:modal.open('/lightbox/googleplus/error');break;}
return true;}.bind(this),error:function(err){var payload=!(err||!err.payload)?{}:err.payload;var status=!payload.status?'error':payload.status;var email=window.getObjDeepKey(payload,'user_data.EMAIL');switch(status){case'missing_email':modal.open('/lightbox/register.php?reason=gg_missing_email',true);break;default:modal.open('/lightbox/googleplus/error?reason='+status+(email?'&email='+encodeURIComponent(email):''));break;}
return true;}});};GGPlusAuth.prototype.setRedirect=function(type,link){type=String(type||'page');link=String(link||'/');if(link.charAt(0)!=='/'){link='/'+link;}
this.redirect={type:type,link:link};return this;};window.GGPlusAuth=GGPlusAuth;})();;
(function(){'use strict';var GGPlusMethod=function(api,auth){this.api=api;this.auth=auth;};GGPlusMethod.prototype.renderGGPlus=function(elementId,parameters){if(typeof gapi==='undefined'){error.log(new Error('GGPlusMethod :: renderGGPlus - gapi is undefined'));return;}
var gg_btn=document.getElementById(elementId||'home_account_gp');if(gg_btn===null||gg_btn.getAttribute('data-gapiattached')){return;}
parameters=parameters||{};if(!window.isPlainObject(parameters)){error.log(new Error('GGPlusMethod :: renderGGPlus - parameters is not a valid object'));return;}
var redirect=String(gg_btn.getAttribute('data-redirect')||'');if(redirect.length){parameters.redirect=JSON.parse(redirect);}
var render=this.api.getAppData(true);render.callback=function(result){if(result&&result.code){if(window.getObjDeepKey(result,'status.method')==='PROMPT'){this.auth.login(result.code,parameters);tracking.trackFormEvent($(gg_btn),'click');}}}.bind(this);gapi.signin.render(elementId,render);};GGPlusMethod.prototype.unlinkAccount=function(){if(!confirm(gettext('Êtes-vous sûr de vouloir dissocier vos comptes Deezer et %1$s ?','Google+'))){return;}
api.call({method:'googleplus.unlinkAccount',success:function(status){if(status){window.location.reload();}}});};window.GGPlusMethod=GGPlusMethod;})();;
(function(){'use strict';var GGPlusWrapper=function(){this.api=new GGPlusApi();this.auth=new GGPlusAuth(this.api);this.method=new GGPlusMethod(this.api,this.auth);};GGPlusWrapper.prototype.setGGUid=function(gg_uid){return this.api.setGGUid(gg_uid);},GGPlusWrapper.prototype.setAccessToken=function(access_token){return this.api.setAccessToken(access_token);},GGPlusWrapper.prototype.setAppData=function(data){return this.api.setAppData(data);},GGPlusWrapper.prototype.getAppData=function(){return this.api.getAppData();},GGPlusWrapper.prototype.login=function(parameters){return this.auth.login(parameters);},GGPlusWrapper.prototype.renderGGPlus=function(elementId,parameters){return this.method.renderGGPlus(elementId,parameters);},GGPlusWrapper.prototype.unlinkAccount=function(){return this.method.unlinkAccount();},window.googleplus=new GGPlusWrapper();})();;
(function(){'use strict';var playercontrol={blindTestMode:false,initContent:{},smartRadioCounter:3600000,smartRadioIntervalId:0,smartRadioSkipCount:0,heightPlayer:105,fadingProgress:false,init:function(data){try{if(typeof PLAYER_INIT==='object'){data=PLAYER_INIT;}
restrict.init();playercontrol.initContent={type:data.type,data:data.data,index:data.index,id:data.element_id,autoplay:data.auto_play};Events.subscribeOnce(Events.player.playerLoaded,function(){dzPlayer.initRestriction();dzPlayer.restoreSetting(USER.SETTING);playercontrol.setFirstContent();});Events.subscribe(Events.player.changePlayerType,function(evt,param){if(param==='ads'){startDisplayAudioAds();}});Events.subscribe(Events.live.simultaneousAccess,function(){if(dzPlayer.isPlaying()===false||dzPlayer.getPlayerType()!=='mod'){return false;}
dzPlayer.control.pause();modal.open('/lightbox/limitation.php');});Events.subscribe(Events.player.finish,playercontrol.finish);Events.subscribe(Events.player.finishAds,playercontrol.finishAds);Events.subscribe(Events.player.finishJingle,playercontrol.finishJingle);Events.subscribe(Events.player.fading,playercontrol.fading);Events.subscribe(Events.radio.start,playercontrol.smartRadioStopCounter);dzPlayer.initSoPlayer('core_player');if(BrowserDetect.browser==='Explorer'&&BrowserDetect.version<=8){notificationBar.display(BrowserDetect.version===8?'ie8_support':'ie_warning');}
if(data.show_lyrics){Events.ready(Events.player.playerReady,function(){Events.trigger(Events.menu.openPanel,'lyrics');});}}catch(e){error.log(e);}},setFirstContent:function(){try{if(playercontrol.initContent.type===''||playercontrol.initContent.data===''){return false;}
if(OFFLINE){return false;}
var params={type:'playlist',id:PLAYLIST_WELCOME_ID};if(playercontrol.initContent.data.count>0){params=$.extend({},playercontrol.initContent);params.data=playercontrol.initContent.data.data;params.type=LOG_CONTEXT[playercontrol.initContent.type];params.radio=(playercontrol.initContent.type==='smartradio_page'||playercontrol.initContent.type==='radio_page'||playercontrol.initContent.type==='profile_user_radio');params.context={TYPE:playercontrol.initContent.type,ID:playercontrol.initContent.id};params.callbackTrack=function(data){if(data.length===0){dzPlayer.play({type:'playlist',id:PLAYLIST_WELCOME_ID,autoplay:false});}};}
dzPlayer.play(params);Events.resolve(Events.player.playerReady);return true;}catch(e){error.log(e);}},setBlindTestMode:function(active){if(typeof active!=='boolean'){active=true;}
playercontrol.blindTestMode=active;Events.trigger(Events.player.blind_test_mode_changed,dzPlayer.getCurrentSong());return true;},finish:function(){try{if(!playercontrol.fadingProgress){dzPlayer.control.nextSong(true);}
playercontrol.fadingProgress=false;return true;}catch(e){error.log(e);}},fading:function(){if(USER.OPTIONS.ads_audio&&dzPlayer.getAudioAds()!==null){return false;}
playercontrol.fadingProgress=true;dzPlayer.control.nextSong(true);},finishAds:function(){try{if(dzPlayer.getAudioAds()!==null){Events.trigger(Events.player.adsVastPlaying,{position:dzPlayer.getAudioAds().audio.duration});}
if(dzPlayer.getPlayerType()==='ads'){dzPlayer.setAudioAds(null);}
dzPlayer.setPlayerType(dzPlayer.previousPlayerType);dzPlayer.control.nextSong(true);setTimeout(disableAudioAds,10000);return true;}catch(e){error.log(e);}},finishJingle:function(){try{dzPlayer.setPlayerType(dzPlayer.previousPlayerType);dzPlayer.control.nextSong(true);return true;}catch(e){error.log(e);}}};window.playercontrol=playercontrol;})();;
(function($){function maybeCall(thing,ctx){return(typeof thing=='function')?(thing.call(ctx)):thing;}
function isElementInDOM(ele){while(ele=ele.parentNode){if(ele==document)return true;}
return false;}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;this.fixTitle();}
Tipsy.prototype={show:function(){var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).prependTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
$tip.css(tp).addClass('tipsy-'+gravity);if(this.options.hasOwnProperty('z_index')){tp.zIndex=parseInt(this.options.z_index,10);$tip.css(tp);}
$tip.find('.tipsy-arrow')[0].className='tipsy-arrow tipsy-arrow-'+gravity.charAt(0);if(this.options.className){$tip.addClass(maybeCall(this.options.className,this.$element[0]));}
if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},fixTitle:function(){var $e=this.$element;if($e.attr('title')||typeof $e.attr('original-title')!='string'){$e.attr('original-title',$e.attr('title')||'').removeAttr('title');}},getTitle:function(){var title,$e=this.$element,o=this.options;this.fixTitle();var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,'');return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');this.$tip.data('tipsy-pointee',this.$element[0]);}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){var tipsy=this.data('tipsy');if(tipsy)tipsy[options]();return this;}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{tipsy.fixTitle();setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}}
function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}}
if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:1,title:'title',trigger:'hover'};$.fn.tipsy.revalidate=function(){$('.tipsy').each(function(){var pointee=$.data(this,'tipsy-pointee');if(!pointee||!isElementInDOM(pointee)){$(this).remove();}});};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:(prefer.length>1?prefer[1]:false)},boundTop=$(document).scrollTop()+margin,boundLeft=$(document).scrollLeft()+margin,$this=$(this);if($this.offset().top<boundTop)dir.ns='n';if($this.offset().left<boundLeft)dir.ew='w';if($(window).width()+$(document).scrollLeft()-$this.offset().left<margin)dir.ew='e';if($(window).height()+$(document).scrollTop()-$this.offset().top<margin)dir.ns='s';return dir.ns+(dir.ew?dir.ew:'');};};})(jQuery);;
(function(){var _dzPlayer={trackList:[],trackListOriginal:[],trackListIndex:0,trackListDuration:0,lyrics:{}};var _dzPlayerEvents={queue:[],delayed:null,trigger:function(evt_name,arg){if(_dzPlayerEvents.delayed!==null){window.clearTimeout(_dzPlayerEvents.delayed);}
_dzPlayerEvents.queue.push({evt_name:evt_name,arg:arg});_dzPlayerEvents.delayed=window.setTimeout(_dzPlayerEvents.triggerAll,0);},triggerAll:function(){for(var i=0;i<_dzPlayerEvents.queue.length;i++){Events.trigger(_dzPlayerEvents.queue[i].evt_name,_dzPlayerEvents.queue[i].arg);}
_dzPlayerEvents.queue=[];window.clearTimeout(_dzPlayerEvents.delayed);_dzPlayerEvents.delayed=null;}};var _trackList={setIndex:function(index){if(index<0||index>_dzPlayer.trackList.length-1){index=0;}
_dzPlayer.trackListIndex=index;},calculeDuration:function(){try{_dzPlayer.trackListDuration=0;for(var t=0;t<_dzPlayer.trackList.length;t++){_dzPlayer.trackListDuration+=parseInt(_dzPlayer.trackList[t].data.DURATION,10);}
return _dzPlayer.trackListDuration;}catch(e){error.log(e);}},reIndexWithSngId:function(sng_id){var i;for(i=0;i<_dzPlayer.trackList.length;i++){if(_dzPlayer.trackList[i].data.SNG_ID===sng_id){_dzPlayer.trackListIndex=i;break;}}
return i<_dzPlayer.trackList.length;},getOriginalIndexWithSngId:function(sng_id){var index=0;for(var i=0;i<_dzPlayer.trackListOriginal.length;i++){if(_dzPlayer.trackListOriginal[i].data.SNG_ID===sng_id){index=i;break;}}
return index;},order:function(order){if(_dzPlayer.trackList.length!==order.length){return false;}
var current_song_id=dzPlayer.getCurrentSong('SNG_ID');var newTrackList=[];for(var o=0;o<order.length;o++){var sng_id=order[o];for(var i=0;i<_dzPlayer.trackList.length;i++){if(_dzPlayer.trackList[i].data.SNG_ID==sng_id){newTrackList.push(_dzPlayer.trackList[i]);}}}
if(newTrackList.length!==_dzPlayer.trackList.length){return false;}
_dzPlayer.trackList=newTrackList.slice();_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'order'});return true;},remove:function(index){if(index<0||index>_dzPlayer.trackList.length-1){return false;}
if(index<_dzPlayer.trackListIndex){_dzPlayer.trackListIndex--;}
var removed_track=_dzPlayer.trackList.splice(index,1);if(removed_track.length!==0){var removed_track_id=removed_track[0].data.SNG_ID;var original_index=_trackList.getOriginalIndexWithSngId(removed_track_id);_dzPlayer.trackListOriginal.splice(original_index,1);}
_trackList.calculeDuration();_trackList.emitChange({type:'remove',song:removed_track});return true;},shuffle:function(index_first_track){index_first_track=typeof index_first_track==='number'?index_first_track:_dzPlayer.trackListIndex;_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();var current_song_id=dzPlayer.getCurrentSong('SNG_ID');var first_track=null;if(index_first_track!==-1){first_track=_dzPlayer.trackList.splice(index_first_track,1);first_track=first_track.length===0?null:first_track[0];}
shuffle(_dzPlayer.trackList);if(first_track!==null){_dzPlayer.trackList.unshift(first_track);}
_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'shuffle'});return true;},unShuffle:function(){var current_song_id=dzPlayer.getCurrentSong('SNG_ID');_dzPlayer.trackList=_dzPlayer.trackListOriginal.slice();_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'unShuffle'});return true;},addNext:function(new_tracklist){if(new_tracklist.length===0){return false;}
if(dzPlayer.isRadio()){return false;}
Array.prototype.splice.apply(_dzPlayer.trackList,[_dzPlayer.trackListIndex+1,0].concat(new_tracklist));var current_song_id=dzPlayer.getCurrentSong('SNG_ID');if(current_song_id===0){_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();}else{var tracklistoriginal_index=_trackList.getOriginalIndexWithSngId(current_song_id);Array.prototype.splice.apply(_dzPlayer.trackListOriginal,[tracklistoriginal_index+1,0].concat(new_tracklist));}
_trackList.calculeDuration();_trackList.emitChange({type:'addNext',song:new_tracklist});return true;},addToQueue:function(new_tracklist){if(new_tracklist.length===0){return false;}
_dzPlayer.trackList=_dzPlayer.trackList.concat(new_tracklist);_dzPlayer.trackListOriginal=_dzPlayer.trackListOriginal.concat(new_tracklist);_trackList.calculeDuration();var change_evt={type:'addToQueue',song:new_tracklist};if(dzPlayer.isRadio()){change_evt.type='lazyLoad';}
_trackList.emitChange(change_evt);return true;},set:function(new_tracklist,options){options=typeof options==='undefined'?{}:options;if(typeof options.addNext==='boolean'&&options.addNext){return _trackList.addNext(new_tracklist);}
if(typeof options.addQueue==='boolean'&&options.addQueue){return _trackList.addToQueue(new_tracklist);}
_dzPlayer.trackList=new_tracklist;_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();_trackList.calculeDuration();_trackList.emitChange({type:'set'});return true;},save:function(options){if(options.addQueue||options.addNext){return false;}
if(options.id==dzPlayer.getContext('ID')&&options.type===LOG_CONTEXT[dzPlayer.getContext('TYPE')]){return false;}
_trackList.backup={trackList:dzPlayer.getTrackList(false),trackListIndex:_dzPlayer.trackListIndex,trackOffset:dzPlayer.position,radio:dzPlayer.getPlayerType()==='radio',context:dzPlayer.getContext()};},restore:function(){if(countObject(_trackList.backup)===0){return false;}
if(dzPlayer.getPlayerType()==='ads'){Events.subscribeOnce(Events.player.finishAds,dzPlayer.restoreTrackList);return false;}
dzPlayer.play({data:_trackList.backup.trackList,index:_trackList.backup.trackListIndex,offset:_trackList.backup.trackOffset,context:_trackList.backup.context,autoplay:_trackList.backup.trackOffset>0,radio:_trackList.backup.radio,saveCurrentTrackList:false});_trackList.backup={};},first_list_already_set:false,emitChange:function(data){if(data.type==='set'&&!_trackList.first_list_already_set){_trackList.first_list_already_set=true;data.first=true;}
_dzPlayerEvents.trigger(Events.player.tracklist_changed,data);}};var dzPlayer={MEDIA_TYPE_TALK:'talk',MEDIA_TYPE_SONG:'song',MEDIA_TYPE_EXTERNAL:'external',MEDIA_TYPE_LIVE_STREAM:'live_stream',minimumFlashVersion:10.1,volume:0.5,cover:'',songId:0,muted:false,paused:false,playing:false,loading:false,lastPosition:0,position:0,duration:0,fade:0,repeat:0,shuffle:false,pourcentLoaded:0,nextSongInfo:[],playerType:'mod',previousPlayerType:'mod',fadeOutProgress:false,fadeInProgress:false,hq:false,numSong:-1,nbSongs:-1,playerLoaded:false,audioAds:null,previousSkipAction:'',appId:0,appType:'',radioType:'',radioSkipInterval:3600000,radioSkipIntervalId:0,radioSkipCounter:0,cached:{},context:{},logTrackTemplate:{media:{id:0,type:0},type:0,stat:{seek:0,pause:0},lt:0,ctxt:{},dev:{v:STATIC_VERSION,t:0},ls:[]},logTrack:{},user_status:{},_play:function(autoPlay,naturalEnd){try{if(dzPlayer.getCurrentSong()===null){return false;}
if(dzPlayer.getAudioAds()!=null&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.isAdvertisingAllowed()&&USER.OPTIONS.ads_audio){_dzPlayer.trackListIndex--;dzPlayer._playAudioAds();return false;}
if(dzPlayer.getCurrentSong('TYPE')=='JINGLE'){dzPlayer._playAudioJingle();return false;}
if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){var mark=bookmark.getEpisodeBookmark(_dzPlayer.trackList[_dzPlayer.trackListIndex].data.EPISODE_ID);if(typeof naturalEnd!=='undefined'&&mark.IS_HEARD==='1'){if(dzPlayer.isLastSong()){dzPlayer.control.pause();}else{dzPlayer.control.nextSong();}}
_dzPlayer.trackList[_dzPlayer.trackListIndex].data.OFFSET=mark.OFFSET;}
if(dzPlayer.getNbSongs()===0){return false;}
if(typeof autoPlay!=='boolean'){autoPlay=true;}
if(typeof naturalEnd!=='boolean'){naturalEnd=false;}
if(dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'||dzPlayer.getPlayerType()==='chromecast'){return false;}
if(autoPlay){dzPlayer.logManager();dzPlayer.trigger('audioPlayer_'+((naturalEnd&&dzPlayer.fade>0)?'appendTracks':'playTracks'),[[dzPlayer.getCurrentSong()],0,autoPlay]);Events.trigger(Events.player.notify,'start');Events.trigger(Events.player.play,{value:dzPlayer.getCurrentSong()});dzPlayer.duration=(dzPlayer.isLimited())?30:dzPlayer.getCurrentSong('DURATION');Events.trigger(Events.player.duration,dzPlayer.duration);}else{dzPlayer.trigger('audioPlayer_stop',[]);}
delete _dzPlayer.trackList[_dzPlayer.trackListIndex].data.OFFSET;_dzPlayerEvents.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());if(dzPlayer.isRadio()&&_dzPlayer.trackList.length-_dzPlayer.trackListIndex==4&&_dzPlayer.trackListIndex>0){dzPlayer.loadTracks({id:dzPlayer.getContext('ID'),type:dzPlayer.getRadioType(),radio:true,addQueue:true,context:dzPlayer.getContext()});}}catch(e){error.log(e);}},_playAudioJingle:function(){try{dzPlayer.previousPlayerType=dzPlayer.getPlayerType();dzPlayer.trigger('setAudioJingle',[{audio:{url:SETTING_STATIC+'/'+dzPlayer.getCurrentSong('URL'),duration:dzPlayer.getCurrentSong('DURATION')},format:{formatType:'',formatType:''},content:{urlContent:''},tracking:{clickCommand:'',clickTagMethod:'',pixelAgence:''},textlink:{text:''}}]);_dzPlayerEvents.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());dzPlayer.setPlayerType('jingle');}catch(e){error.log(e);}},_playAudioAds:function(){try{dzPlayer.previousPlayerType=dzPlayer.getPlayerType();dzPlayer.trigger('setAudioAds',[dzPlayer.getAudioAds()]);dzPlayer.setPlayerType('ads');}catch(e){error.log(e);}},initSoPlayer:function(div_id){try{var path='swf/coreplayer3-v'+STATIC_VERSION+'.swf';if(typeof RESSOURCES==='object'){path=RESSOURCES.coreplayer3;}
var so;so=new SWFObject(SETTING_STATIC+'/'+path,'audioPlayerSWF','1','1',dzPlayer.minimumFlashVersion.toString(),'#3a3a3a');so.addVariable('host_stream_cdn',HOST_STREAM_CDN);so.addVariable('host_stream',HOST_STREAM);so.addVariable('host_preview',HOST_PREVIEW);so.addVariable('cdn_ratio',CDN_RATIO);so.addVariable('range_qs','x-bits-range');so.addVariable('allow_range','true');so.addVariable('offline',OFFLINE);so.addVariable('token',PLAYER_TOKEN);so.addVariable('server_timestamp',SERVER_TIMESTAMP);so.addParam('wmode','transparent');so.addParam('allowScriptAccess','always');so.addParam('menu','false');so.addParam('hasPriority','true');so.write(div_id);return true;}catch(e){error.log(e);}},initRestriction:function(){try{dzPlayer.setOffline(OFFLINE);return true;}catch(e){error.log(e);}},setUserLogged:function(userId,md5,blogName,sid,gender,age,player_token){try{dzPlayer.trigger('audioPlayer_setToken',[player_token]);return true;}catch(e){error.log(e);}},setUserUnlogged:function(){try{dzPlayer.trigger('audioPlayer_setToken',['']);return true;}catch(e){error.log(e);}},setEmptyPlayer:function(){try{if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
_dzPlayer.trackList=[];_dzPlayer.trackListOriginal=[];_dzPlayer.trackListIndex=0;dzPlayer.trigger('audioPlayer_playTracks',[[],0,false]);_dzPlayerEvents.trigger(Events.player.displayEmptyPlayer);return false;}catch(e){error.log(e);}},play:function(options){try{if(dzPlayer.getPlayerType()==='chromecast'){if(typeof options.data==='undefined'||options.data.length===0){return dzPlayer.loadTracks(options);}
if(options.context.TYPE==='suggest_track'||options.context.TYPE.length===0){options.context.TYPE='album_page';options.context.ID=parseInt(options.data[0].ALB_ID,10);}
return chromecast.doAction('playFromList',{track_id:parseInt(options.id||0,10),type:(options.type||'').toString(),data:(options.data||[]),context:options.context,index:options.index});}
options=$.extend(true,{},{type:'',id:0,radio:false,index:0,autoplay:true,context:{ID:'',TYPE:'',CONTEXT_ID:''},data:[],offset:0,addNext:false,addQueue:false,saveCurrentTrackList:true,callbackTrack:function(){}},options);if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
if(options.data.length===0){dzPlayer.loadTracks(options);return false;}
if(Number(dzPlayer.appId)>0&&dzPlayer.appType==='inapp'){options.context.ID=dzPlayer.appId;options.context.TYPE=dzPlayer.appType;}
if(options.saveCurrentTrackList){_trackList.save(options);}
if(options.index>options.data.length){options.index=0;}
dzPlayer.setPlayerType(options.radio?'radio':'mod');if(options.radio===true&&options.addQueue===false){dzPlayer.radioStartListen(options.id,options.type);}
dzPlayer.radioSkipSetTimer();dzPlayer.setTrackList(options,options.addQueue,options.addNext);}catch(e){error.log(e);}},loadTracks:function(options){try{if(options.id===0){throw new dzError({name:'DZPLAYER',message:'Player error - dzplayer.loadTracks: play without id (=== 0)'});}
if(options.type===''){throw new dzError({name:'DZPLAYER',message:'Player error - dzplayer.loadTracks: play without type (=== "")'});}
if(options.type==='track'&&!$.isArray(options.id)){options.id=[options.id];}
var loader={playlist:{api_method:'playlist.getSongs',api_param:{playlist_id:options.id,start:0,nb:1000}},album:{api_method:'song.getListByAlbum',api_param:{alb_id:options.id,start:0,nb:500}},track:{api_method:'song.getListData',api_param:{sng_ids:options.id}},radio:{api_method:'radio.getSongs',api_param:{radio_id:options.id}},artist:{api_method:options.radio===true?'smart.getSmartRadio':'song.getTopArtist',api_param:{art_id:options.id}},user:{api_method:'radio.getUserRadio',api_param:{user_id:options.id}},show:{api_method:'episode.getListByShow',api_param:{show_id:options.id}},episode:{api_method:'episode.getData',api_param:{episode_id:options.id}},loved:{api_method:'favorite_song.getList',api_param:{user_id:options.id,start:0,nb:1000}},history:{api_method:'user.getSongsHistory',api_param:{start:0,nb:1000}},personal_song:{api_method:'personal_song.getList',api_param:{start:0,nb:1000}},downloads:{api_method:'store.getList',api_param:{start:0,nb:1000,order:7}},search:{api_method:'search.music',api_param:{query:options.id,start:0,nb:1000,filter:/^\/tags\//.test(window.location.pathname)?'TAG':'ALL',output:'TRACK'}},artistTopTracks:{api_method:'artist.getTopTrack',api_param:{art_id:options.id,start:0,nb:100}}};loader.talkShow=loader.show;loader.personalPlaylist=loader.playlist;loader.topArtist=loader.artistTopTracks;if(options.type==='talkEpisodes'){var latestEpisodes=userData.data.FAVORITES_SHOWS.data.map(function(show){return show.LATEST_EPISODE.data[0];});dzPlayer.onLoadedTracks({data:latestEpisodes},options);}else if(typeof loader[options.type]==='object'){api.call(loader[options.type].api_method,loader[options.type].api_param,dzPlayer.onLoadedTracks,options);}}catch(e){error.log(e);}},onLoadedTracks:function(result,options){try{options.data=result.data||[result];if(options.offset>0&&options.data.length>0){options.data[0].OFFSET=options.offset;}
dzPlayer.play(options);}catch(e){error.log(e);}},playTrackAtIndex:function(index){try{_trackList.setIndex(index);dzPlayer._play(true);}catch(e){error.log(e);}},setIndexSong:function(index){try{_trackList.setIndex(index);}catch(e){error.log(e);}},restoreTrackList:function(){_trackList.restore();},setTrackList:function(options,addQueue,addNext){try{addQueue=addQueue||false;addNext=addNext||false;var futur_index=(options.index===-1)?0:options.index;if(options.chromecast===true){_trackList.set(options.data);_trackList.setIndex(0);return true;}
var filteredTrack=[];for(var d=0;d<options.data.length;d++){if(typeof options.data[d]!=='object'){continue;}
if(dzPlayer.getMediaType(options.data[d])===dzPlayer.MEDIA_TYPE_TALK){options.data[d].OFFSET=parseInt(bookmark.getEpisodeBookmark(options.data[d].EPISODE_ID).OFFSET,10);filteredTrack.push({data:options.data[d],context:options.context});continue;}
var is_readable=false;var songAvailable=right.checkSongAvailable(options.data[d]);if(songAvailable==right.READABLE||(dzPlayer.isRadio()&&songAvailable!=right.EXPLICIT_LYRICS)){filteredTrack.push({data:options.data[d],context:options.context});is_readable=true;}else if(typeof options.data[d].FALLBACK==='object'&&right.checkSongAvailable(options.data[d].FALLBACK)==right.READABLE){options.data[d].SNG_ID_ORIGIN=options.data[d].SNG_ID;filteredTrack.push({data:$.extend({},options.data[d],options.data[d].FALLBACK),context:options.context});is_readable=true;}
if(d==futur_index){futur_index=is_readable?(filteredTrack.length-1):filteredTrack.length;}}
if(typeof options.callbackTrack==='function'){options.callbackTrack(filteredTrack);}
if(filteredTrack.length===0){return false;}
if(addQueue||addNext){_trackList.set(filteredTrack,{addQueue:addQueue,addNext:addNext});return true;}
_trackList.set(filteredTrack);_trackList.setIndex(futur_index);options.index=futur_index;if(options.offset>0){options.data[options.index].OFFSET=options.offset;}
if(dzPlayer.isShuffle()&&dzPlayer.getPlayerType()==='mod'){var index_first_track=options.index;if(index_first_track===-1){index_first_track=Math.round(Math.random()*(_dzPlayer.trackList.length-1));_trackList.setIndex(index_first_track);}
_trackList.shuffle(index_first_track);}
if(dzPlayer.isMuted()){dzPlayer.control.mute(false);}
dzPlayer._play(options.autoplay);return true;}catch(e){error.log(e);}},getTrackList:function(with_ctx){try{if(with_ctx===true){return _dzPlayer.trackList;}
var data=[];for(var t=0;t<_dzPlayer.trackList.length;t++){data.push(_dzPlayer.trackList[t].data);}
return data;}catch(e){error.log(e);}},getTrackListIndex:function(){return _dzPlayer.trackListIndex;},getTrackListDuration:function(){return _dzPlayer.trackListDuration;},enqueueTracks:function(songs,context){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.setTrackList({data:songs,context:context},true,false);}catch(e){error.log(e);}},addNextTracks:function(songs,context){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.setTrackList({data:songs,context:context},false,true);}catch(e){error.log(e);}},setAudioAds:function(data){try{dzPlayer.audioAds=data;}catch(e){error.log(e);}},getAudioAds:function(){try{if(typeof ads!=='undefined'&&ads.allow_audio===false){return null;}
return dzPlayer.audioAds;}catch(e){error.log(e);}},isStoreTrack:function(isrc){try{if(typeof userData==='object'&&typeof userData.dataStore==='object'){return(typeof userData.dataStore[isrc]==='boolean'&&isrc!='');}
return false;}catch(e){error.log(e);}},isRadio:function(){return(dzPlayer.getPlayerType()==='radio');},getIndexSong:function(){return _dzPlayer.trackListIndex;},getNbSongs:function(){return _dzPlayer.trackList.length;},isLastSong:function(){if(dzPlayer.getRepeat()>0){return false;}
if(_dzPlayer.trackListIndex>=dzPlayer.getNbSongs()-1){return true;}
return false;},getTotalDuration:function(){var totalDuration=0;for(var j=0;j<_dzPlayer.trackList.length;j++){if(!isNaN(_dzPlayer.trackList[j].data.DURATION)){totalDuration+=parseInt(_dzPlayer.trackList[j].data.DURATION,10);}}
return totalDuration;},getNextSong:function(){if(dzPlayer.repeat==0||dzPlayer.isRadio()){return(_dzPlayer.trackListIndex+1<dzPlayer.getNbSongs())?_dzPlayer.trackList[_dzPlayer.trackListIndex+1].data:null;}else if(dzPlayer.repeat==1){var index=(_dzPlayer.trackListIndex==_dzPlayer.trackList.length-1)?0:_dzPlayer.trackListIndex+1;return _dzPlayer.trackList[index].data;}else if(dzPlayer.repeat==2){return dzPlayer.getCurrentSong();}},getPrevSong:function(){if(dzPlayer.getRepeat()==0||dzPlayer.isRadio()){return _dzPlayer.trackListIndex!=0?_dzPlayer.trackList[_dzPlayer.trackListIndex-1].data:null;}else if(dzPlayer.getRepeat()==1){var index=(_dzPlayer.trackListIndex==0)?_dzPlayer.trackList.length-1:_dzPlayer.trackListIndex-1;return _dzPlayer.trackList[index].data;}else if(dzPlayer.getRepeat()==2){return dzPlayer.getCurrentSong();}},getCurrentSong:function(prop){try{if(typeof prop==='string'&&prop==='MEDIA_ID'){if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){prop='EPISODE_ID';}else if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_EXTERNAL||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_LIVE_STREAM){return 0;}else{prop='SNG_ID';}}
var trackList=_dzPlayer.trackList[_dzPlayer.trackListIndex];var playerType=dzPlayer.getPlayerType();if(typeof trackList!=='undefined'&&typeof trackList.data!=='undefined'&&playerType!=='ads'&&playerType!=='jingle'){return(typeof prop!=='string')?new Track(trackList.data):trackList.data[prop];}
var defaut={SNG_ID:0,ART_ID:0,ALB_ID:0,ALB_PICTURE:'',URL:'',DURATION:0};return(typeof prop!=='string')?null:defaut[prop];}catch(e){error.log(e);}},isAdvertisingAllowed:function(){if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK&&!Number(dzPlayer.getCurrentSong('SHOW_IS_ADVERTISING_ALLOWED'))){return false;}
return true;},getMediaType:function(data){data=data||dzPlayer.getCurrentSong();if(data===null){return false;}
if(typeof data.EPISODE_ID!=='undefined'){return dzPlayer.MEDIA_TYPE_TALK;}
if(data.LIVE_STREAM){return dzPlayer.MEDIA_TYPE_LIVE_STREAM;}
if(data.EXTERNAL){return dzPlayer.MEDIA_TYPE_EXTERNAL;}
return dzPlayer.MEDIA_TYPE_SONG;},getContext:function(prop){try{if(typeof _dzPlayer.trackList[_dzPlayer.trackListIndex]!='undefined'&&typeof _dzPlayer.trackList[_dzPlayer.trackListIndex].context!='undefined'&&dzPlayer.getPlayerType()!=='ads'&&dzPlayer.getPlayerType()!=='jingle'){return(typeof prop!=='string')?_dzPlayer.trackList[_dzPlayer.trackListIndex].context:_dzPlayer.trackList[_dzPlayer.trackListIndex].context[prop];}
var defaut={ID:'',TYPE:'',CONTEXT_ID:''};return(typeof prop!=='string')?null:defaut[prop];}catch(e){error.log(e);}},getRepeat:function(){if(dzPlayer.isRadio()||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return 0;}
if(typeof dzPlayer.repeat==='string'&&dzPlayer.repeat.length>1){dzPlayer.repeat=0;}
return parseInt(dzPlayer.repeat,10);},getPosition:function(){return dzPlayer.position;},getExactPosition:function(){return dzPlayer.trigger('audioPlayer_getPosition',[]);},getDuration:function(){return dzPlayer.duration;},getVolume:function(){return dzPlayer.volume;},isShuffle:function(){if(dzPlayer.isRadio()||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
return dzPlayer.shuffle;},removeTracks:function(index){if(dzPlayer.getIndexSong()==index){if(_dzPlayer.trackList.length===1){return false;}
dzPlayer.playTrackAtIndex(index+((_dzPlayer.trackList.length-1==index)?-1:1));}
return _trackList.remove(index);},orderTracks:function(order){return _trackList.order(order);},isMuted:function(){return dzPlayer.muted;},isPlaying:function(){return dzPlayer.playing;},isPaused:function(){return dzPlayer.paused;},getArtistName:function(){return dzPlayer.getCurrentSong('ART_NAME');},getAlbumTitle:function(){return dzPlayer.getCurrentSong('ALB_TITLE');},getSongTitle:function(){return dzPlayer.getCurrentSong('SNG_TITLE');},getPlayerType:function(){return dzPlayer.playerType;},getPlayerTypeId:function(){if(dzPlayer.playerType=='radio'){return 1;}
return 0;},setPlayerType:function(type){if(dzPlayer.getPlayerType()!=type){dzPlayer.playerType=type;dzPlayer.trigger('audioPlayer_setType',[type]);}
_dzPlayerEvents.trigger(Events.player.changePlayerType,dzPlayer.playerType);},getSongId:function(){return dzPlayer.getCurrentSong('MEDIA_ID');},isLoading:function(){return dzPlayer.loading;},getCover:function(){return dzPlayer.getCurrentSong('ALB_PICTURE');},isFadeInProgress:function(){return dzPlayer.fadeInProgress;},isFadeOutProgress:function(){return dzPlayer.fadeOutProgress;},isHq:function(){return dzPlayer.hq;},setOffline:function(status){dzPlayer.trigger('audioPlayer_setOffline',[status]);},sendFile:function(file){dzPlayer.trigger('audioPlayer_sendFile',[file]);},isLimited:function(){if(countObject(dzPlayer.user_status)>0){return dzPlayer.user_status.limited;}
return false;},getRadioType:function(){return dzPlayer.radioType;},skipRadioAllowed:function(){if(dzPlayer.user_status.radio_skips===0){return true;}
if(dzPlayer.helper.isPlayingFlow()&&USER.OPTIONS.web_hq){return true;}
return(dzPlayer.radioSkipCounter<dzPlayer.user_status.radio_skips);},radioStartListen:function(id,type){dzPlayer.radioType=type;_dzPlayerEvents.trigger(Events.radio.start,{type:type,id:id});},radioSkipSetTimer:function(){clearTimeout(dzPlayer.radioSkipIntervalId);dzPlayer.radioSkipIntervalId=0;dzPlayer.radioSkipCounter=0;if(dzPlayer.isRadio()){dzPlayer.radioSkipIntervalId=window.setTimeout(dzPlayer.radioSkipSetTimer,dzPlayer.radioSkipInterval);}},helper:{isPlayingFlow:function(){var context=dzPlayer.getContext();return(context!==null)&&(context.TYPE==='home_user_radio'||context.TYPE==='feed_user_radio'||context.TYPE==='profile_user_radio');},isPlayingUserFlow:function(){var context=dzPlayer.getContext();return(context!==null)&&(context.TYPE==='home_user_radio'||context.TYPE==='feed_user_radio'||context.TYPE==='profile_user_radio')&&(dzPlayer.getContext().ID==USER.USER_ID);}},control:{canSeek:function(){if(dzPlayer.isRadio()&&USER.OPTIONS.web_hq){return true;}
if(dzPlayer.getPlayerType()==='chromecast'&&!chromecast.isRadio()){return true;}
if(dzPlayer.getPlayerType()==='mod'){return true;}
return false;},play:function(){try{if(dzPlayer.isPlaying()===false&&dzPlayer.isPaused()===false){if(dzPlayer.getCurrentSong('SNG_ID')!==0){dzPlayer._play(true);}}else{_dzPlayerEvents.trigger(Events.player.resume,{value:dzPlayer.getCurrentSong()});dzPlayer.trigger('audioPlayer_play');}}catch(e){error.log(e);}},pause:function(){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
dzPlayer.trigger('audioPlayer_pause');if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(countObject(dzPlayer.logTrack)>0&&dzPlayer.logTrack.stat){dzPlayer.logTrack.stat.pause++;}}catch(e){error.log(e);}},stop:function(){if(dzPlayer.getPlayerType()==='ads'){return false;}
if(dzPlayer.getMediaType()!==dzPlayer.MEDIA_TYPE_LIVE_STREAM){return false;}
dzPlayer.trigger('audioPlayer_stop');dzPlayer.logManager(false);},nextSong:function(naturalEnd){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
if(typeof naturalEnd==='undefined'){naturalEnd=false;}
if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction('next');}
if(dzPlayer.isRadio()&&!dzPlayer.skipRadioAllowed()&&!naturalEnd){return false;}
if(!naturalEnd){if(countObject(dzPlayer.logTrack)===0){dzPlayer.logManager(false);}
dzPlayer.logTrack.stat.next=true;if(dzPlayer.isRadio()){dzPlayer.radioSkipCounter++;}}
dzPlayer.previousSkipAction='next';if(dzPlayer.getRepeat()==0&&_dzPlayer.trackListIndex<_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex++;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex<_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex++;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex==_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex=0;}else if(dzPlayer.getRepeat()!=2){dzPlayer.playing=false;dzPlayer.logManager(false);_dzPlayer.trackListIndex=0;dzPlayer._play(false,true);_dzPlayerEvents.trigger(Events.player.finishTrackList);return false;}
var autoPlay=true;if(naturalEnd&&dzPlayer.playerType=='mod'){autoPlay=!dzPlayer.isLimited();}
dzPlayer._play(autoPlay,naturalEnd);}catch(e){error.log(e);}},prevSong:function(){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.isRadio()?false:chromecast.doAction('prev');}
if(dzPlayer.isRadio()){return false;}
if(typeof dzPlayer.logTrack.stat!=='undefined'){dzPlayer.logTrack.stat.prev=true;}
dzPlayer.previousSkipAction='prev';if(dzPlayer.getRepeat()==0&&_dzPlayer.trackListIndex>0){_dzPlayer.trackListIndex--;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex>0){_dzPlayer.trackListIndex--;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex==0){_dzPlayer.trackListIndex=_dzPlayer.trackList.length-1;}else if(dzPlayer.getRepeat()==2){_dzPlayer.trackListIndex=_dzPlayer.trackListIndex;}else{return false;}
dzPlayer._play(true);}catch(e){error.log(e);}},togglePause:function(){try{if(dzPlayer.isPlaying()){dzPlayer.control.pause();}else{dzPlayer.control.play();}}catch(e){error.log(e);}},setRepeat:function(repeat){try{if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
dzPlayer.repeat=repeat;Events.trigger(Events.player.repeat_changed,dzPlayer.repeat);if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction('setRepeat',{value:dzPlayer.repeat});}
userSetting.set({site:{player_repeat:dzPlayer.repeat}});}catch(e){error.log(e);}},setVolume:function(volume,save){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
if(dzPlayer.isMuted()&&volume>0){dzPlayer.control.mute(false);}
save=save||false;dzPlayer.volume=volume;dzPlayer.trigger('audioPlayer_setVolume',[volume]);Events.trigger(Events.player.volume_changed,Math.round(volume*100));if(dzPlayer.getPlayerType()==='chromecast'&&chromecast.isOwner()===false){save=false;}
if(save){storage.set('volume',dzPlayer.volume);}}catch(e){error.log(e);}},setShuffle:function(status){try{if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
if(_dzPlayer.trackList.length===0){return false;}
dzPlayer.shuffle=status;var save=true;if(dzPlayer.getPlayerType()==='chromecast'){chromecast.doAction('setShuffle',{value:dzPlayer.isShuffle()});if(!chromecast.isOwner()){save=false;}}else{if(dzPlayer.shuffle){_trackList.shuffle();}else{_trackList.unShuffle();}}
if(save){userSetting.set({site:{player_shuffle:dzPlayer.shuffle}});}
_dzPlayerEvents.trigger(Events.player.shuffle_changed,dzPlayer.shuffle);}catch(e){error.log(e);}},mute:function(bMute){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
dzPlayer.muted=!dzPlayer.muted;dzPlayer.trigger('audioPlayer_mute',[bMute]);Events.trigger(Events.player.mute_changed,dzPlayer.muted);}catch(e){error.log(e);}},setSmartNotLike:function(){try{api.call('smart_notLikeSong',{sng_id:dzPlayer.getCurrentSong('SNG_ID')});dzPlayer.control.nextSong();}catch(e){error.log(e);}},seek:function(position){try{if(!dzPlayer.control.canSeek()){return false;}
dzPlayer.trigger('audioPlayer_seek',[position]);if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(countObject(dzPlayer.logTrack)>0){dzPlayer.logTrack.stat.seek++;}
Events.trigger(Events.player.seek,position);}catch(e){error.log(e);}},changeFadeValue:function(fade){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.trigger('audioPlayer_changeFadeValue',[fade]);dzPlayer.fade=fade;userSetting.set({site:{player_fade:dzPlayer.fade}});Events.trigger(Events.player.fade,dzPlayer.fade);return true;}catch(e){error.log(e);}},setHq:function(status){try{dzPlayer.hq=status;dzPlayer.trigger('audioPlayer_setHq',[status]);userSetting.set({site:{player_hq:dzPlayer.hq}});Events.trigger(Events.player.hq,dzPlayer.hq);}catch(e){error.log(e);}},loadLyrics:function(){if(!dzPlayer.hasLyrics()){return;}
if(dzPlayer.hasLoadedLyrics()){Events.trigger(Events.lyrics.load);}else{var sngID=dzPlayer.getCurrentSong('SNG_ID');var lyricsID=dzPlayer.getCurrentSong('LYRICS_ID');api.call({method:'song.getLyrics',data:{SNG_ID:sngID},success:function(data){if(data.LYRICS_TEXT){data.LYRICS_TEXT=data.LYRICS_TEXT.split(/\r\n|\r|\n/g);}
_dzPlayer.lyrics['LYRICS_'+lyricsID]=data;Events.trigger(Events.lyrics.load);}});}}},getLyrics:function(){if(dzPlayer.hasLoadedLyrics()){var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');if(dzPlayer.hasSyncLyrics()){return _dzPlayer.lyrics[key].LYRICS_SYNC_JSON;}
var textLyrics=_dzPlayer.lyrics[key].LYRICS_TEXT;if(textLyrics&&textLyrics.length){return textLyrics;}}
return null;},getLyricsMetadata:function(){if(dzPlayer.hasLoadedLyrics()){var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');return{copyrights:_dzPlayer.lyrics[key].LYRICS_COPYRIGHTS,writers:_dzPlayer.lyrics[key].LYRICS_WRITERS};}
return null;},hasLyrics:function(){var lyricsID=dzPlayer.getCurrentSong('LYRICS_ID');return typeof lyricsID!=='undefined'&&lyricsID!==0;},hasLoadedLyrics:function(){if(!dzPlayer.hasLyrics()){return false;}
var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');return(typeof _dzPlayer.lyrics[key]!=='undefined');},hasSyncLyrics:function(){if(!dzPlayer.hasLoadedLyrics()){return false;}
var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');var syncLyrics=_dzPlayer.lyrics[key].LYRICS_SYNC_JSON;return(typeof syncLyrics!=='undefined'&&syncLyrics.length!==0);},logManager:function(sendNextSong){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(typeof sendNextSong=='undefined'){sendNextSong=true;}
if(countObject(dzPlayer.logTrack)>0){if(OFFLINE){dzPlayer.logTrack.force_timestamp=SERVER_TIMESTAMP;Events.trigger(Events.player.log_offline,dzPlayer.logTrack);}else{var logNextSong={};if(sendNextSong&&countObject(dzPlayer.logStartedTrack())>0){logNextSong=dzPlayer.logStartedTrack();}
if(typeof dzPlayer.user_status.timestamp!='undefined'){dzPlayer.logTrack.timestamp=dzPlayer.user_status.timestamp;}
if(dzPlayer.logTrack.sng_id>0&&dzPlayer.getPlayerType()=='mod'){Events.trigger(Events.player.updateRestrictTime,dzPlayer.logTrack.lt);}
dzPlayer.sendLog(dzPlayer.logTrack,logNextSong);if(!sendNextSong){dzPlayer.logTrack={};return false;}}}else{if(countObject(dzPlayer.logStartedTrack())&&sendNextSong){dzPlayer.sendLog(dzPlayer.logTrack,dzPlayer.logStartedTrack());}}
dzPlayer.logTrack=$.extend(true,{},dzPlayer.logTrackTemplate);if(dzPlayer.isLimited()){dzPlayer.logTrack.l_30sec=1;}
dzPlayer.logTrack.media.id=dzPlayer.getCurrentSong('MEDIA_ID');dzPlayer.logTrack.media.type=dzPlayer.getMediaType();if(dzPlayer.getContext('TYPE')==='inapp'){dzPlayer.logTrack.app={id:dzPlayer.getContext('ID'),t:dzPlayer.getContext('TYPE')};}else if(Number(dzPlayer.appId)!==0){dzPlayer.logTrack.app={id:dzPlayer.appId,t:dzPlayer.appType};}
if(dzPlayer.getContext('TYPE')!=''){dzPlayer.logTrack.ctxt.t=dzPlayer.getContext('TYPE');}
if(dzPlayer.getContext('ID')!=''){dzPlayer.logTrack.ctxt.id=dzPlayer.getContext('ID');}
if(dzPlayer.getContext('CONTEXT_ID')!=''){dzPlayer.logTrack.ctxt.c=dzPlayer.getContext('CONTEXT_ID');}
dzPlayer.logTrack.type=dzPlayer.getPlayerTypeId();}catch(e){error.log(e);}},logStartedTrack:function(){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
var liveTrack={};if(dzPlayer.getCurrentSong()!==null&&USER.USER_ID>0){liveTrack={id:dzPlayer.getCurrentSong('MEDIA_ID'),type:dzPlayer.getMediaType()};}
return liveTrack;}catch(e){error.log(e);}},sendLog:function(logSong,logNextSong){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
Events.trigger(Events.player.setBookmark,$.extend(false,logSong,{offset:dzPlayer.getPosition(),duration:dzPlayer.getDuration()}));var songsParams={};if(countObject(logSong)>0){songsParams.params=logSong;}
if(countObject(logNextSong)>0){songsParams.next_media={media:logNextSong};}
api.call('log.listen',songsParams,function(result){dzPlayer.token=result;if(dzPlayer.token!==false){dzPlayer.trigger('audioPlayer_setToken',[dzPlayer.token]);}});return true;}catch(e){error.log(e);}},restoreSetting:function(settings){try{if(countObject(settings)==0){return false;}
dzPlayer.hq=(typeof settings.site.player_hq=='undefined'||settings.site.player_hq==null)?(typeof USER!='undefined'&&USER.OPTIONS.web_hq):(settings.site.player_hq&&DZPS);dzPlayer.volume=storage.get('volume',0.5);if(typeof settings.site.player_fade!=='undefined'){dzPlayer.fade=settings.site.player_fade;}
if(typeof settings.site.player_repeat!=='undefined'){dzPlayer.repeat=settings.site.player_repeat;}
if(typeof settings.site.player_shuffle!=='undefined'){dzPlayer.shuffle=(typeof settings.site.player_shuffle==='string')?Boolean(parseInt(settings.site.player_shuffle,10)):settings.site.player_shuffle;}
Events.trigger(Events.player.hq,dzPlayer.hq);Events.trigger(Events.player.volume,dzPlayer.volume);Events.trigger(Events.player.shuffle_changed,dzPlayer.shuffle);Events.trigger(Events.player.repeat_changed,dzPlayer.repeat);dzPlayer.control.changeFadeValue(dzPlayer.fade);dzPlayer.control.setVolume(dzPlayer.volume);dzPlayer.control.setHq(dzPlayer.hq);return true;}catch(e){error.log(e);}},setAppId:function(app_id){try{dzPlayer.appId=app_id;}catch(e){error.log(e);}},setApp:function(app){try{dzPlayer.appId=app.id;dzPlayer.appType=app.type;}catch(e){error.log(e);}},setPropValue:function(propName,value){try{if(dzPlayer.getPlayerType()==='chromecast'){if(propName=='trackList'){return dzPlayer.setTrackList({index:0,data:value,chromecast:true});}}
if(propName=='loadError'){return false;}
if(propName==='preloadComplete'||propName==='preloadAborted'){Events.trigger(Events.player[propName],value);if(propName==='preloadComplete'){dzPlayer.cached[value]=true;}else{delete dzPlayer.cached[value];}
return false;}
if(propName=='duration'&&value==0){return false;}
if(propName=='loadingStats'){if(value.partIndex<=2&&value.sngId>0&&value.sngId==dzPlayer.getCurrentSong('SNG_ID')){dzPlayer.logTrack.ls[value.partIndex]={duration:value.loadingTime,size:value.size,host:value.hostname};}
return false;}
if(dzPlayer.getPlayerType()!=='chromecast'&&propName=='position'&&value>0){if(dzPlayer.lastPosition!=Math.floor(value)){dzPlayer.logTrack.lt+=1;}
dzPlayer.lastPosition=Math.floor(value);if(dzPlayer.getPlayerType()=='ads'){Events.trigger(Events.player.adsVastPlaying,{position:value});}
if(Math.floor(value)==dzPlayer.getDuration()-20&&!dzPlayer.isLimited()&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.getPlayerType()!='jingle'){var nextSong=dzPlayer.getNextSong();if(nextSong!=null&&nextSong.DURATION>60&&typeof dzPlayer.cached[nextSong.SNG_ID]==='undefined'){dzPlayer.cached[nextSong.SNG_ID]=false;dzPlayer.trigger('audioPlayer_preloadTrack',[[dzPlayer.getNextSong()]]);}}}
if(propName=='finish'){Events.trigger(Events.player.track_end,value);}
dzPlayer[propName]=value;if(propName==='user_status'&&dzPlayer.user_status.limited&&USER.USER_ID>0){throw new dzError({name:'DZPLAYER',message:'user_status limited:'+dzPlayer.token});}
if(dzPlayer.getPlayerType()==='chromecast'){if(propName=='repeat'){propName='repeat_changed';}
if(propName==='shuffle'){propName='shuffle_changed';}
if(propName==='volume'){propName='volume_changed';value=Math.round(value*100);}}
if(typeof Events.player[propName]!=='string'){throw new dzError({name:'DZPLAYER',message:'Unknown Event : '+JSON.stringify(arguments)});}
Events.trigger(Events.player[propName],value);}catch(e){error.log(e);}},trigger:function(methodName,params){try{if(dzPlayer.user_status.preview===false){return false;}
if(params==null){params=[];}
if(dzPlayer.playerLoaded){if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction(methodName,params);}
executeActionscriptMethod('audioPlayerSWF',methodName,params);}}catch(e){error.log(e);}}};window.dzPlayer=dzPlayer;})();function setDzPlayerProp(prop,value){try{dzPlayer.setPropValue(prop,value);}catch(e){error.log(e);}}
function setDzPlayerProps(keyValueObject){try{for(var key in keyValueObject){if(!keyValueObject.hasOwnProperty(key)){continue;}
dzPlayer.setPropValue(key,keyValueObject[key]);}}catch(e){error.log(e);}}
function executeActionscriptMethod(swfId,method,params){try{if(document.getElementById(swfId)===null||typeof document.getElementById(swfId).callAS!=='function'){error.log({message:'swf not accessible',description:'executeActionscriptMethod: / swfId '+swfId});return false;}
document.getElementById(swfId).callAS(method,params);}catch(e){error.log(e);}};
(function($){facebox_interval_id=0;$.facebox=function(data,klass){$.facebox.loading();if(data.ajax)fillFaceboxFromAjax(data.ajax);else if(data.image)fillFaceboxFromImage(data.image);else if(data.div)fillFaceboxFromHref(data.div);else if($.isFunction(data))data.call($);else $.facebox.reveal(data,klass);};$.extend($.facebox,{settings:{opacity:0.7,overlay:true,loadingImage:SETTING_STATIC+'/img/popin/loading.gif',imageTypes:['png','jpg','jpeg','gif'],faceboxHtml:' <div id="facebox" style="display:none;" class="absolute"> <div class="popup relative"> <table> <tbody> <tr> <td class="tl main"/><td class="b_t"/><td class="tr main"/> </tr> <tr> <td class="b_l"/><td class="body"> <a href="#" class="close_popin sprite_others"> </a> <div class="content"> </div> </td> <td class="b_r"/> </tr> <tr> <td class="bl main"/><td class="b_b"/><td class="br main"/> </tr> </tbody> </table> </div> </div>'},loading:function(){init();if($('#facebox .loading').length==1){return true;}
showOverlay();$('#facebox').addClass('lightbox_old');$('#facebox .content').empty();facebox_interval_id=setTimeout(function(){$('#facebox').show();$('#facebox .body').children().hide().end().append('<div class="loading"><br /><br /><img src="'+$.facebox.settings.loadingImage+'"/><br /><br /><br /></div>');facebox_interval_id=0;},200);$('#facebox').stop();$('#facebox').css({top:getPageScroll()[1]+50,left:$(window).width()/2-186});$(document).trigger('loading.facebox');},reveal:function(data,klass){clearInterval(facebox_interval_id);$(document).trigger('beforeReveal.facebox');if(klass)$('#facebox .content').addClass(klass);$('#facebox').show();$('#facebox .content').html(data);$('#facebox .loading').remove();$('#facebox .body').children().fadeIn('normal');$('#facebox').css('left',$(window).width()/2-($('#facebox table').width()/2));$(document).trigger('reveal.facebox').trigger('afterReveal.facebox');},close:function(arg){if(typeof arg=='undefined'){arg=false;}
$(document).trigger('close.facebox',arg);return false;},showOverlay:function(){showOverlay();},hideOverlay:function(){hideOverlay();}});$.fn.facebox=function(settings){init(settings);function clickHandler(){$.facebox.loading(true);var klass=this.rel.match(/facebox\[?\.(\w+)\]?/);if(klass)klass=klass[1];fillFaceboxFromHref(this.href,klass);return false;}
return this.click(clickHandler);};function init(settings){clearInterval(facebox_interval_id);if($.facebox.settings.inited)return true;else $.facebox.settings.inited=true;$(document).trigger('init.facebox');makeCompatible();var imageTypes=$.facebox.settings.imageTypes.join('|');$.facebox.settings.imageTypesRegexp=new RegExp('\.'+imageTypes+'$','i');if(settings)$.extend($.facebox.settings,settings);$('body').append($.facebox.settings.faceboxHtml);var preload=[new Image(),new Image()];preload[0].src=$.facebox.settings.loadingImage;$('#facebox').find('.b:first, .bl, .br, .tl, .tr').each(function(){preload.push(new Image());preload.slice(-1).src=$(this).css('background-image').replace(/url\((.+)\)/,'$1');});$('#facebox .close_popin').click($.facebox.close);}
function getPageScroll(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
return new Array(xScroll,yScroll);}
function getPageHeight(){var windowHeight;if(self.innerHeight){windowHeight=self.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){windowHeight=document.documentElement.clientHeight;}else if(document.body){windowHeight=document.body.clientHeight;}
return windowHeight;}
function makeCompatible(){var $s=$.facebox.settings;$s.loadingImage=$s.loading_image||$s.loadingImage;$s.closeImage=$s.close_image;$s.imageTypes=$s.image_types||$s.imageTypes;$s.faceboxHtml=$s.facebox_html||$s.faceboxHtml;}
function fillFaceboxFromHref(href,klass){if(href.match(/#/)){var url=window.location.href.split('#')[0];var target=href.replace(url,'');$.facebox.reveal($(target).clone().show(),klass);}else if(href.match($.facebox.settings.imageTypesRegexp)){fillFaceboxFromImage(href,klass);}else{fillFaceboxFromAjax(href,klass);}}
function fillFaceboxFromImage(href,klass){var image=new Image();image.onload=function(){$.facebox.reveal('<div class="image"><img src="'+image.src+'" /></div>',klass);};image.src=href;}
function fillFaceboxFromAjax(href,klass){$.get(href,function(data){$.facebox.reveal(data,klass);});}
function skipOverlay(){return $.facebox.settings.overlay==false||$.facebox.settings.opacity===null;}
function showOverlay(){if(skipOverlay()){return;}
if($('#facebox_overlay').length==0){$('body').append('<div id="facebox_overlay" class="facebox_hide"></div>');$('#facebox_overlay').hide().addClass('facebox_overlayBG').css('opacity',$.facebox.settings.opacity);}
$('#facebox_overlay').stop();$('#facebox_overlay').fadeIn(200);return false;}
function hideOverlay(){if(skipOverlay()){return;}
$('#facebox_overlay').fadeOut(function(){});return false;}
$(document).bind('close.facebox',function(evt,arg){clearInterval(facebox_interval_id);Events.trigger(Events.lightbox.close+'_'+$('#facebox').data('uniqid'),arg);$('#facebox').hide();$('#facebox .content').removeClass().addClass('content').html('');$('#facebox .loading').remove();hideOverlay();});})(jQuery);;
var hovercard={loading:false,template:false,timeout:null,delayIn:800,delayOut:100,cacheCard:new Array(),current:null,mouseX:null,cache:true,gravity:'',offset:0,arrow:12,init:function(div,delayIn,cache,gravity,callback){try{if(typeof callback!='function'){callback=function(){};}
hovercard.callback=callback;if(OFFLINE){return false;}
if(typeof delayIn!='undefined'||delayIn!=null){hovercard.delayIn=delayIn;}else{hovercard.delayIn=800;}
if(hovercard.current!=null){hovercard.delayIn=0;}
if(typeof cache!='undefined'||delayIn!=null){hovercard.cache=cache;}else{hovercard.cache=true;}
if(typeof gravity!='undefined'||gravity!=null){hovercard.gravity=gravity;}else{hovercard.gravity='';}
div.mousemove(function(event){hovercard.mouseX=event.pageX;hovercard.mouseY=event.pageY;});clearInterval(hovercard.timeout);if(!hovercard.loading&&hovercard.template==false){hovercard.loading=true;$('body').append('<div id="load_temp"></div>');$('#load_temp').load('/ajax/hovercard/page.php?card=template',function(response,status,xhr){hovercard.template=true;if($('#hovercard #content').length===0){$('#hovercard').append('<div id="content" class="box-shadow"></div>');}
$('body').append($('#hovercard'));hovercard.$hovercard=$('#hovercard');hovercard.$hovercard_arrow=$('#hovercard #arrow');$('#load_temp').remove();hovercard.timeout=setTimeout(function(){hovercard.load(div);},hovercard.delayIn);});}else{if(hovercard.delayIn>0){hovercard.timeout=setTimeout(function(){hovercard.load(div);},hovercard.delayIn);}else{hovercard.load(div);}}
return true;}catch(e){error.log(e);}},load:function(div){try{data=div.attr('data-hovercard');if(data==null||data==''){return false;}
if(hovercard.current==data){hovercard.display(div);return false;}
hovercard.current=data;if(hovercard.cacheCard[data]){$('#content',hovercard.$hovercard).html(hovercard.cacheCard[data]);hovercard.display(div);hovercard.callback(div);}else{$('#content',hovercard.$hovercard).load(data,function(response,status,xhr){hovercard.display(div);hovercard.callback(div);if(hovercard.cache==true){hovercard.cacheCard[data]=response;}});}
return true;}catch(e){error.log(e);}},display:function(div){try{if(div.attr('id')==undefined){div.attr('id','tmp_for_hovercard');}
var hc_width=hovercard.$hovercard.width();var hc_height=hovercard.$hovercard.height();obj=document.getElementById(div.attr('id'));coord=util.findPos(div.get(0));objParent=obj.parentNode;coordParent=util.findPos(objParent);objNext=obj.nextSibling;coordNext=util.findPos(objNext);div_offset=div.offset();div_width=div.width();div_height=div.height();divTop=div_offset.top;posLeft=coord[0];sectionWidth=coordNext[0]-coord[0];sectionWidth=0;if(div.attr('id')=='tmp_for_hovercard'){div.removeAttr('id');}
if(sectionWidth<0){sectionWidth=div.width();}
if(hovercard.gravity==''){if(div.css('line-height').indexOf('px')>-1){lineHeight=div.css('line-height').replace('px','');if(div.height()>lineHeight){if((hovercard.mouseY-coord[1])>14){divTop=divTop+14;posLeft=div_offset.left;sectionWidth=coordNext[0]-div_offset.left;}else{sectionWidth=obj.offsetWidth-(coord[0]-coordParent[0]);}}}else{lineHeight=0;}
var arrowPos={};if(hc_width>(client_width-hovercard.mouseX)){arrowPos.right='25px';arrowPos.left='';paddingLeft=-hc_width+sectionWidth;if(sectionWidth>0&&sectionWidth<60){posLeft-=-30+(sectionWidth/2);}}else{arrowPos.left='25px';arrowPos.right='';paddingLeft=0;if(sectionWidth>0&&sectionWidth<60){posLeft+=-30+(sectionWidth/2);}}
posLeft+=paddingLeft;if(hc_height>(div_offset.top-$(window).scrollTop())){posTop=parseInt(divTop)+parseInt(lineHeight);hovercard.$hovercard_arrow.removeClass().addClass('hovercard_arrow arrow_n');arrowPos.top='-10px';arrowPos.bottom='';}else{posTop=divTop-$('#hovercard').height()-14;hovercard.$hovercard_arrow.removeClass().addClass('hovercard_arrow arrow_s');arrowPos.bottom='-5px';arrowPos.top='';}
hovercard.$hovercard.css('margin-top','11px');hovercard.$hovercard_arrow.css(arrowPos);}
if(DIRECTION==='rtl'&&hovercard.gravity==='e'){hovercard.gravity='w';}
switch(hovercard.gravity.charAt(0)){case'n':break;case's':break;case'e':if(hc_height>(client_height-(div_offset.top-$(window).scrollTop()))){posTop=divTop-(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))-10;arrowTop=(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))+(div_height/2)+hovercard.arrow;}else{posTop=divTop;arrowTop=(div_height/2-hovercard.arrow/2);}
posLeft=div_offset.left-hc_width-hovercard.offset-hovercard.arrow;hovercard.$hovercard.css('margin-top','0px');hovercard.$hovercard_arrow.removeClass().addClass('hovercard_arrow arrow_e');hovercard.$hovercard_arrow.css({'left':hc_width,'top':arrowTop+'px'});break;case'w':if(hc_height>(client_height-(div_offset.top-$(window).scrollTop()))){posTop=divTop-(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))-10;arrowTop=(hc_height-(client_height-(div_offset.top-$(window).scrollTop())))+(div_height/2)+hovercard.arrow;}else{posTop=divTop;arrowTop=(div_height/2-hovercard.arrow/2);}
posLeft=div.width()+hovercard.arrow;hc_width=-hovercard.$hovercard_arrow.width();hovercard.$hovercard.css('margin-top','0px');hovercard.$hovercard_arrow.removeClass().addClass('hovercard_arrow arrow_w');hovercard.$hovercard_arrow.css({'left':hc_width,'top':arrowTop+'px'});break;}
if(hovercard.gravity.length==2){if(hovercard.gravity.charAt(1)=='w'){}else{}}
hovercard.$hovercard.show().css({'top':posTop,'left':posLeft}).mouseenter(function(){div.off('mouseleave');clearInterval(hovercard.timeout);});hovercard.$hovercard.mouseleave(function(){hovercard.remove();});return true;}catch(e){error.log(e);}},remove:function(){try{clearInterval(hovercard.timeout);if(hovercard.current!=null){hovercard.timeout=setTimeout(function(){hovercard.hide();},hovercard.delayOut);}
return true;}catch(e){error.log(e);}},hide:function(){try{hovercard.current=null;$('#hovercard').hide();return true;}catch(e){error.log(e);}}};;
var notification={delayTimeOut:0,delayDefault:5000,content:null,notifyTrad:{no_log:gettext('L\'écoute est limitée à 30 secondes. Pour écouter en illimité, connectez-vous ou inscrivez-vous gratuitement.'),discovery_used_tb:gettext('Il vous reste moins d\'1 heure d\'écoute gratuite. Abonnez-vous ! '),discovery_with_tb:gettext('Offre spéciale : la musique illimitée gratuite. Essayez ! '),expired_cc:gettext('Votre carte est sur le point d\'expirer. Modifiez vos coordonnées bancaires dès aujourd\'hui pour continuer à profiter de votre abonnement.'),flash_update:gettext('Téléchargez la dernière version de Flash Player pour pouvoir utiliser Deezer.'),limit30sec:gettext('L\'écoute est limitée à 30 secondes. Découvrez Deezer Premium !'),mobile_only:gettext('Votre offre Deezer Mobile ne vous donne pas accès à l\'écoute illimité à la demande sur le site Deezer.'),facebook_publish_action:gettext('Cliquez ici pour partager vos découvertes musicales avec vos amis !'),ie8_support:gettext('Votre navigateur internet est trop ancien pour profiter pleinement de l\'experience Deezer. Cliquez ici pour le mettre à jour.'),ie_warning:gettext('Deezer n\'est pas compatible avec Internet Explorer 7. Cliquez ici pour mettre à jour votre navigateur.'),win8_push:gettext('Téléchargez l\'appli Deezer pour Windows 8 et accédez directement à votre musique !'),flow_skip_push:gettext('Abonnez-vous à Premium+ pour pouvoir zapper en illimité.'),limit0s_free:gettext('Vous ne profitez pas de cette fonctionnalité, abonnez-vous pour en profiter'),flash_not_installed:gettext('Flash Player n\'est pas installé ou désactivé. Veuillez installer puis activer la version la plus récente de Flash Player pour pouvoir utiliser Deezer.'),flash_blocked:gettext('Il semble qu\'un paramètre ou une extension bloque Flash Player. Veuillez le ou la désactiver pour pouvoir utiliser Deezer.')},init:function(){Events.subscribe(Events.playlist.addSong,function(evt,data){if(data.notify===true){notification.display(evt,data);}});Events.subscribe(Events.user.settingChanged,function(evt,data){if(data.notify===true){notification.display(evt,data);}});Events.subscribe(Events.player.tracklist_changed,function(evt,data){if(data.type==='addNext'||data.type==='addToQueue'){notification.display(evt,data);}});Events.subscribe(Events.copy.after,function(evt,data){notification.display(evt,data);});Events.subscribe(Events.user.shareClick,function(evt,data){notification.display(evt,data);});Events.subscribe(Events.playlist.created,notification.display);Events.subscribe(Events.playlist.assistantSuggestFinish,notification.display);},display:function(evt,data){if(notification.content===null){notification.content=$('#notification');}
evt=evt||{};var delay=data.delay||notification.delayDefault;var wording=data.message;switch(evt.namespace){case'USER.settingChanged':wording=gettext('Sauvegardé');break;case'PLAYLIST.addSong':wording=ngettext('Le titre a bien été ajouté à la playlist.','Les titres ont bien été ajoutés à la playlist.',{count:data.song.length});break;case'PLAYER.tracklist_changed':wording=ngettext('Le titre a bien été ajouté à la file d\'attente.','Les titres ont bien été ajoutés à la file d\'attente.',{count:data.song.length});break;case'PLAYLIST.assistantSuggestFinish':wording=ngettext('Le titre a bien été ajouté à la playlist.','Les titres ont bien été ajoutés à la playlist.',{count:data.count});break;case'PLAYLIST.created':wording=gettext('La playlist "%s" a bien été créée.',{sprintf:[data.TITLE]});break;}
$('h2',notification.content).text(wording);notification.content.show();setTimeout(function(){$('> div',notification.content).addClass('active');},0);if(notification.delayTimeOut>0){window.clearTimeout(notification.delayTimeOut);}
notification.delayTimeOut=setTimeout(notification.hide,delay);},hide:function(){notification.content.hide().children('div').removeClass('active');}};var notificationBar={init:function(){Events.subscribe(Events.player.notify,function(){notificationBar.check('start');});Events.subscribe(Events.player.finish,function(){notificationBar.check('end');});Events.subscribe(Events.offline.reminder,function(){notificationBar.display('drive_download_push',{replaceText:BrowserDetect.OS});});},check:function(type){try{if(typeof USER==='undefined'||dzPlayer.getPlayerType()!=='mod'){return false;}
if(www.getCurrentPageType()==='landing'){return false;}
if(type==='start'){if(USER.USER_ID===0&&dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_SONG){notificationBar.display('no_log',{origin:'no_log'});}
if(USER.USER_ID>0&&!DZPS){if(USER.OPTIONS.web_streaming===false){notificationBar.display('limit30sec',{origin:'limit30sec'});}
if(dzPlayer.isLimited()){if(dzPlayer.user_status.preview===false){notificationBar.display('limit0s_free',{origin:'headband_30sec'});}else{notificationBar.display('discovery_limited',{origin:'headband_30sec',replaceText:(restrict.object.time_left+restrict.object.time_used)/3600});}}}}
if(type==='end'){if(USER.USER_ID===0){if(USER.OPTIONS.web_streaming===true){if(dzPlayer.isLimited()&&$('#facebox:visible').length===0){www.goToConnection();}}else if($('#facebox:visible').length===0){www.goToConnection();}}}}catch(e){error.log(e);}},notifyAllreadyDisplayed:{},display:function(msg,param){param=param||{};try{if(typeof notificationBar.notifyAllreadyDisplayed[msg]!=='undefined'){return false;}
if(storage.isset('NOTIFY_'+msg)){return false;}
var message;if(msg==='discovery_limited'){message=gettext('Vous avez écouté vos %s heures gratuites ce mois-ci. L\'écoute est limitée à 30 secondes.',{sprintf:[param.replaceText]});}else if(msg==='drive_download_push'){message=gettext('Maintenant que vous êtes de retour, cliquez ici pour télécharger Deezer pour %s.',{sprintf:[param.replaceText]});}else{message=notification.notifyTrad[msg];}
var link='';var save_already_displayed=true;switch(msg){case'expired_cc':return false;case'facebook_publish_action':link='facebook.login("publish_actions");';break;case'ie_warning':tracking.track('header_dld_ie7_display');link='modal.open("/lightbox/browser_update.php");tracking.track("header_dld_ie7_click");';break;case'ie8_support':tracking.track('header_dld_ie8_display');link='modal.open("/lightbox/browser_update.php");tracking.track("header_dld_ie8_click");';break;case'no_log':link='www.goToConnection();';break;case'win8_push':link='window.open("http://apps.microsoft.com/windows/app/deezer/e48b595e-b20a-4eb3-968c-c20b2cadaa1e");';storage.set('NOTIFY_'+msg,true);break;case'flow_skip_push':link='window.open("/offers");';save_already_displayed=false;break;case'drive_download_push':link='window.location.href = "'+(BrowserDetect.OS==='Windows'?WIN8_APP_DOWNLOAD:DEEZER_DRIVE_DOWNLOAD)+'";';storage.set('offline_reminder',false);break;default:link='window.open("/offers"); tracking.track("offers_subscribe_click", {origin: "'+(param.origin||1)+'"});';}
$('#notify').show().children('.message').attr('onClick',link+'notificationBar.hide(); return false;').text(message);if(save_already_displayed){notificationBar.notifyAllreadyDisplayed[msg]=true;}
return true;}catch(e){error.log(e);}},hide:function(){$('#notify').hide();}};;
var premium={drawPlaylistInapp:function(obj){try{if(typeof obj.country==='undefined'||typeof obj.offer_id==='undefined'){return false;}
api.call('operator.getPlaylistInappsData',{COUNTRY:obj.country,OFFER_ID:obj.offer_id},function(result){if(result===false){return false;}
if(result.playlist_id!=0){api.call('playlist.getData',{PLAYLIST_ID:result.playlist_id},function(result){userData.addFavorite({type:'playlist',id:result.PLAYLIST_ID,PLAYLIST_ID:result.PLAYLIST_ID,TITLE:result.TITLE,PARENT_USERNAME:result.PARENT_USERNAME});});}
$.each(result.inapps,function(idx){api.call('application.getData',{APP_ID:result.inapps[idx]},function(result){userData.addFavorite({type:'application',id:result.APP_ID,APP_ID:result.APP_ID,NAME:result.NAME,INAPP_ALIAS:result.INAPP_ALIAS,APP_PICTURE_16x16:result.APP_PICTURE_16x16});});});});}catch(e){error.log(e);}},checkCodeValidity:function(){try{$('#input_subscribe_confirm').hide();$('#href_register_submit > .img_loading').show();var errorMsg=gettext('Votre code n\'est pas reconnu. Merci de réessayer ou contacter le fournisseur du code.');var gift_code=$('#gift_code').val();if(gift_code==''){$('#gift_error').html(errorMsg).show();return false;}
var gift_previous_store=$('#gift_previous_store').val();if(gift_previous_store!=null&&gift_previous_store!=''){gift_previous_store_url='&previous_store='+gift_previous_store;}else{var gift_previous_store_url='';}
api.call({method:'premium.checkCodeValidity',data:{CODE:gift_code},success:function(result){var pathname=document.location.pathname;if(pathname.match(/\/gift/gi)===null){pathname='/gift';}
var link=pathname+'?screen=connect&connect='+$('#gift_connect').val()+'&code='+gift_code+gift_previous_store_url;if(USER.USER_ID>0){window.location.href=link;}else{modal.open(link,true);}
return true;},error:function(error){if('GIFT_CODE_ERROR'in error.payload){errorMsg=error.payload['GIFT_CODE_ERROR'];}
$('#gift_error').html(errorMsg).show();$('#input_subscribe_confirm').show();$('#href_register_submit > .img_loading').hide();return true;}});}catch(e){error.log(e);}},test_phone:function(tracking_params,successCallback,errorCallback){var errorMsg=gettext('Une erreur est survenue. Merci de vous assurer de la validité de votre numéro avant de réitérer votre demande.');try{var trackingTag='senttomobile_lb_click';var tracking_params=tracking_params||{type:'smssubmit'};if(typeof tracking_params.type==='undefined'){tracking_params.type='smssubmit';}
$input=$('#tester_phone_number');if(typeof $input=='undefined'||$input.length==0){return false;}
phone_number=$input.val().trim();if(phone_number==''){if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:'empty_phone'});}else{premium.displayMobileMessage(errorMsg,'error');}
return false;}
$input.val('');api.call({method:'sms.sendAppUrl',data:{PHONE:phone_number},success:function(){if(USER.USER_ID===0){premium.testPhoneSuccess(trackingTag,tracking_params,successCallback);return true;}
api.call({method:'user.update',data:{USER_DATA:{PHONE:phone_number}},success:function(){premium.testPhoneSuccess(trackingTag,tracking_params,successCallback);},error:function(error){if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:'error'});}else{premium.displayMobileMessage(errorMsg,'error');}
return true;}});},error:function(error){var error_status='error';var type='error';if(error.message=='already_send'){errorMsg=gettext('Un SMS vous a déjà été envoyé à ce numéro. Vous pouvez néanmoins vous rendre via le navigateur de votre mobile sur %s pour tester la compatibilité de votre mobile.',{sprintf:['http://www.deezer.com']});error_status='already_send';type='';}
if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:error_status});}else{premium.displayMobileMessage(errorMsg,type);}
if(typeof tracking_params==='object'){tracking_params.status=error_status;tracking.track(trackingTag,tracking_params);}
return true;}});}catch(e){error.log(e);}},displayMobileMessage:function(text,type){var type=type||false;$('#tester_phone_msg').removeClass('alert-danger').addClass('alert-success').html(text).fadeIn();if(type=='error'){$('#tester_phone_msg').removeClass('alert-success').addClass('alert-danger');}},testPhoneSuccess:function(trackingTag,tracking_params,successCallback){try{if(typeof successCallback==='function'){successCallback();}else{premium.displayMobileMessage(gettext('Le SMS a bien été envoyé. Vous allez le recevoir d\'ici quelques instants.'));}
if(typeof tracking_params==='object'){tracking_params.status='success';tracking.track(trackingTag,tracking_params);}
return true;}catch(e){error.log(e);}}};;
tokenizer.prototype.hideHint=function(){this.dom_hint.style.display='none';this.dom_hint.className='hint hint_help';this.dom_input.value='';this.dom_input.focus();};tokenizer.prototype.selectToken=function(){var in_array=false;for(var i=0;i<this.list_token_selected.length;i++){if(this.list_token_selected[i]==this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'])in_array=true;}
if(this.token_active!='none'&&!in_array){this.addToken();this.list_token_selected[this.list_token_selected.length]=this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'];this.dom_input_hidden.value=this.list_token_selected.join('|');this.input_old_value=0;this.hideHint();}};tokenizer.prototype.highlightToken=function(direction){var old_position=this.token_active;if(direction=='down'){if(old_position=='none')position=0;else if(old_position==this.nb_proposition-1)position=this.token_active;else position=old_position+1;if(old_position!='none')this.dom_hint.firstChild.childNodes[old_position].className='';this.dom_hint.firstChild.childNodes[position].className='selected';this.token_active=position;}else if(direction=='up'){if(old_position==0)position=0;else if(old_position!='none')position=old_position-1;else position=this.nb_proposition-1;if(old_position!='none')this.dom_hint.firstChild.childNodes[old_position].className='';this.dom_hint.firstChild.childNodes[position].className='selected';this.token_active=position;}};tokenizer.prototype.contactSearch=function(){var that=this;var ul=document.createElement('ul');var out=0;for(var i=0;i<this.list_token.length;i++){var rg=new RegExp('^'+this.dom_input.value,'gi');if(this.list_token[i]['data'].search(rg)!=-1){var li=document.createElement('li');var texte=document.createTextNode(this.list_token[i]['data']);li.token_pointer=i;li.onmouseover=function(){if(that.token_active!='none'){that.dom_hint.firstChild.childNodes[that.token_active].className='';}
this.className='selected';for(var i=0;i<that.dom_hint.firstChild.childNodes.length;i++){if(that.dom_hint.firstChild.childNodes[i].className=='selected'){that.token_active=i;}}};li.onmouseout=function(){that.token_active='none';this.className='';};li.onclick=function(){that.selectToken();};li.appendChild(texte);ul.appendChild(li);out=out+1;}}
this.nb_proposition=out;this.dom_hint.removeChild(this.dom_hint.firstChild);this.dom_hint.appendChild(ul);if(this.nb_proposition>0){this.dom_hint.className='hint hint_overflow';this.dom_hint.style.display='block';this.token_active=0;this.dom_hint.firstChild.firstChild.className='selected';}else this.dom_hint.style.display='none';};tokenizer.prototype.addToken=function(){var that=this;var img=document.createElement('img');img.src='http://cdn-files.deezer.com/img/common/delete.png';var p=document.createElement('p');var texte=document.createTextNode(this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['data']);p.appendChild(texte);var li=document.createElement('li');li.className='token';li.token_id=this.list_token[this.dom_hint.firstChild.childNodes[this.token_active].token_pointer]['id'];li.appendChild(p);li.appendChild(img);img.onclick=function(){for(var i=0;i<that.dom_ul_token.childNodes.length-1;i++){if(that.dom_ul_token.childNodes[i].token_id==this.parentNode.token_id)node=i;}
that.deleteToken(node);};this.dom_input.parentNode.parentNode.insertBefore(li,this.dom_input.parentNode.parentNode.lastChild);};tokenizer.prototype.deleteToken=function(node){var array=new Array();for(var i=0;i<this.list_token_selected.length;i++){if(this.list_token_selected[i]!=this.dom_ul_token.childNodes[node].token_id)array[array.length]=this.list_token_selected[i];}
this.dom_ul_token.removeChild(this.dom_ul_token.childNodes[node]);this.list_token_selected=array;this.dom_input_hidden.value=this.list_token_selected.join('|');};tokenizer.prototype.press=function(ns){if(document.all)keycode=event.keyCode;else keycode=ns.which;if(keycode==8&&this.input_old_value==0){if(this.dom_ul_token.childNodes.length>=2){this.deleteToken(this.dom_ul_token.childNodes.length-2);}}
else if(keycode==38&&this.nb_proposition>0)this.highlightToken('up');else if(keycode==40&&this.nb_proposition>0)this.highlightToken('down');else if(keycode==13&&this.nb_proposition>0){if(this.token_active!='none')this.selectToken();}
else if(keycode==27)this.hideHint();else{this.contactSearch();}
this.input_old_value=this.dom_input.value.length;};function tokenizer(id,list_token,hint,token){var that=this;this.token_active='none';this.nb_proposition=0;this.input_old_value=0;this.list_token=eval(list_token);this.list_token_selected=new Array();var width=document.getElementById(id).style.width;var div_general=document.createElement('div');div_general.className='tokenizer';var input_hidden=document.createElement('input');input_hidden.type='hidden';input_hidden.id=id;input_hidden.name=id;var div_hint=document.createElement('div');div_hint.className='hint hint_help';div_hint.style.width=width;var input=document.createElement('input');input.onkeyup=function(ns){that.press(ns);};var ul_token_list=document.createElement('ul');ul_token_list.className='token_list';ul_token_list.style.width=width;ul_token_list.onclick=function(){this.lastChild.firstChild.focus();div_hint.innerHTML=hint;div_hint.className='hint hint_help';div_hint.style.display='block';};var li_for_input=document.createElement('li');li_for_input.appendChild(input);ul_token_list.appendChild(li_for_input);div_general.appendChild(ul_token_list);div_general.appendChild(div_hint);div_general.appendChild(input_hidden);var node=document.getElementById(id);insertAfter(node,div_general);node.parentNode.removeChild(node);this.dom_node=div_general;this.dom_hint=div_hint;this.dom_input=input;this.dom_input_hidden=input_hidden;this.dom_ul_token=ul_token_list;if(token){var img=document.createElement('img');img.src='http://cdn-files.deezer.com/img/common/delete.png';var p=document.createElement('p');var texte=document.createTextNode(token['data']);p.appendChild(texte);var li=document.createElement('li');li.className='token';li.token_id=token['id'];li.appendChild(p);li.appendChild(img);img.onclick=function(){for(var i=0;i<that.dom_ul_token.childNodes.length-1;i++){if(that.dom_ul_token.childNodes[i].token_id==this.parentNode.token_id)node=i;}
that.deleteToken(node);};this.dom_input.parentNode.parentNode.insertBefore(li,this.dom_input.parentNode.parentNode.lastChild);this.list_token_selected[this.list_token_selected.length]=token['id'];this.dom_input_hidden.value=this.list_token_selected.join('|');}};
if(typeof userData==='undefined'){var userData={data:{},dataStore:{},isLoaded:false,isLoadedRadio:false,checksums:{},searchHistoryLimit:10,conf:{FAVORITES_ARTISTS:{primary_key:'ART_ID',hash:true},FAVORITES_ALBUMS:{primary_key:'ALB_ID',hash:true},FAVORITES_PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:true},FAVORITES_APPLICATIONS:{primary_key:'APP_ID',hash:true},FAVORITES_RADIOS:{primary_key:'RADIO_ID',hash:true},FAVORITES_SONGS:{primary_key:'SNG_ID',hash:true},FAVORITES_DISLIKED_SONGS:{primary_key:'SNG_ID',hash:true},FAVORITES_GENRES:{primary_key:'GENRE_ID',hash:true},PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:false,clear:true},FAVORITES_SHOWS:{primary_key:'SHOW_ID',hash:true},EPISODE_BOOKMARKS:{primary_key:'EPISODE_ID',hash:true},TOP_PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:true},TOP_ALBUMS:{primary_key:'ALB_ID',hash:true},TOP_GENRES:{skip:false,hash:true},TOP_TAGS:{skip:false,hash:false},USER_TAGS:{skip:false,hash:false},FRIENDS:{primary_key:'USER_ID',hash:true},MESSAGE_UNREAD:{primary_key:'AUTHOR',hash:true},TOTAL_STORE_TRACKS:{skip:true,hash:false},MARKETING_PUSH:{skip:false,hash:false},SEARCH_HISTORY:{skip:false,hash:false},DEFAULT_APPLICATIONS:{skip:false,primary_key:'APP_ID',hash:true}},init:function(){try{if(USER.USER_ID===0){Events.ready(Events.user.loaded,userData.init);Events.resolve(Events.user.initialized,{authenticated:false});return false;}
if(PLATFORM!='web'){return true;}
try{if(storage.isset('USER_CHECKSUMS')){userData.checksums=storage.get('USER_CHECKSUMS');for(var c in userData.checksums){if(!userData.checksums.hasOwnProperty(c)){continue;}
if(!storage.isset(c)){console.log(c,' : localStorage not found');delete userData.checksums[c];}}}}catch(e){error.log(e);}
api.call({method:'deezer.userMenu',data:{checksum:true,checksums:userData.checksums},success:userData.loadCallbackInit});return true;}catch(e){error.log(e);}},fillData:function(key,result,conf){if(typeof result==='undefined'){result={data:[],total:0,count:0};}
if(result==='Not modified'){if(storage.isset(key)){result=storage.get(key);}}
if(conf.clear){for(var j=result.count;j>=0;j--){if(typeof result.data[j]==='object'&&parseInt(result.data[j].TYPE,10)===4){result.data.splice(j,1);}}
result.count=result.total=result.data.length;}
return result;},fillDataHashes:function(result,conf){var hashes={};if(conf.hash!==false){for(var j=0;j<result.count;j++){var id=result.data[j][conf.primary_key];hashes[id]=j;}}
return hashes;},store:function(key,data){storage.set(key,data,false);},refreshData:function(key,result){var conf=userData.conf[key];var data=userData.fillData(key,result,conf);var hashes=userData.fillDataHashes(data,conf);userData.data[key]=data;userData.data[key+'_HASH']=hashes;if(typeof userData.data[key].checksum!=='undefined'){userData.store(key,userData.data[key]);userData.checksums[key]=userData.data[key].checksum;}},loadCallbackInit:function(result){try{for(var key in userData.conf){if(!userData.conf.hasOwnProperty(key)||userData.conf[key].skip){continue;}
userData.refreshData(key,result[key]);}
if(typeof result.TOTAL_STORE_TRACKS!=='undefined'){userData.dataStore={};if(storage.isset('storeTrack')){userData.dataStore=storage.get('storeTrack');}
if(countObject(userData.dataStore)<result.TOTAL_STORE_TRACKS){api.call('store.getList',{start:countObject(userData.dataStore),nb:result.TOTAL_STORE_TRACKS-countObject(userData.dataStore)},userData.storeListCallback);}else{Events.resolve(Events.user.dataStoreReady);}}
if(typeof result.MARKETING_PUSH!=='undefined'&&typeof result.MARKETING_PUSH==='string'&&result.MARKETING_PUSH!==''){setTimeout(function(){modal.open(result.MARKETING_PUSH);},500);}
userData.isLoaded=true;userData.saveChecksums(userData.checksums);Events.resolve(Events.user.userReady);Events.resolve(Events.user.initialized,{authenticated:true,userData:userData});return true;}catch(e){error.log(e);}},saveChecksums:function(checksums){userData.store('USER_CHECKSUMS',checksums);},loadData:function(type){try{var key=(type==='friend')?'FRIENDS_HASH':'FAVORITES_'+type.toUpperCase()+'S';if(typeof userData.conf[key]==='undefined'){return;}
api.call({method:'favorite.'+type+'_getList',success:function(results){if(results.count===0){return false;}
userData.refreshData(key,results);userData.saveChecksums(userData.checksums);Events.trigger(Events.user.userLoadData,{type:type});}});}catch(e){error.log(e);}},isFavorite:function(type,id){try{if(!userData.isLoaded){return false;}
var key=(type==='friend')?'FRIENDS_HASH':'FAVORITES_'+type.toUpperCase()+'S_HASH';return typeof userData.data[key]!=='undefined'&&typeof userData.data[key][id]!=='undefined';}catch(e){error.log(e);}},isDisliked:function(id){try{return userData.isFavorite('disliked_song',id);}catch(e){error.log(e);}},getTopGenre:function(){return!userData.isLoaded||userData.data.TOP_GENRES.count==0?0:userData.data.TOP_GENRES.data[0];},getUnseenPlaylistCount:function(){var unseenPlaylistCount=0;userData.data.FAVORITES_PLAYLISTS.data.forEach(function(playlist){if(playlist.UNSEEN_TRACK_COUNT>0){++unseenPlaylistCount;}});return unseenPlaylistCount;},getUnseenTrackCount:function(playlist_id){var data=userData.data.FAVORITES_PLAYLISTS.data;for(var i=0,length=data.length;i<length;++i){if(data[i].PLAYLIST_ID==playlist_id){return data[i].UNSEEN_TRACK_COUNT||0;}}},setPlaylistSeen:function(playlist_id){userData.data.FAVORITES_PLAYLISTS.data.forEach(function(playlist){if(playlist.PLAYLIST_ID==playlist_id){playlist.UNSEEN_TRACK_COUNT=0;}});},addFavorite:function(data){try{if(PLATFORM!=='web'){Events.trigger(Events.user.addFavorite,data);return true;}
if(typeof data!=='object'){return false;}
var key=(data.type==='friend')?'FRIENDS':'FAVORITES_'+data.type.toUpperCase()+'S';userData.data[key+'_HASH'][data.id]=true;if(countObject(userData.data[key])===0){userData.data[key]={data:[],total:0,count:0};}
data.DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);data.DATE_FAVORITE=timestampToDate(SERVER_TIMESTAMP,true,'-',true);userData.data[key].data.push(data);userData.data[key].count++;userData.data[key].total++;Events.trigger(Events.user.addFavorite,data);return true;}catch(e){error.log(e);}},deleteFavorite:function(data){try{if(typeof data!=='object'){return false;}
var id_name={album:'ALB_ID',show:'SHOW_ID',playlist:'PLAYLIST_ID',artist:'ART_ID',radio:'RADIO_ID',friend:'USER_ID',application:'APP_ID',song:'SNG_ID',disliked_song:'SNG_ID'};var id=id_name[data.type];var key=(data.type==='friend')?'FRIENDS':'FAVORITES_'+data.type.toUpperCase()+'S';delete userData.data[key+'_HASH'][data.id];for(var a=0;a<userData.data[key].count;a++){if(userData.data[key].data[a][id]==data.id){userData.data[key].data.splice(a,1);userData.data[key].total-=1;userData.data[key].count-=1;break;}}
Events.trigger(Events.user.deleteFavorite,data);return true;}catch(e){error.log(e);}},createPlaylist:function(data,callback){try{data=$.extend(true,{},{title:'',description:'',status:0,songs:false,tags:[]},data);api.call({method:'playlist.create',data:data,success:function(id){if(typeof id==='number'){var current_date=timestampToDate(SERVER_TIMESTAMP,true,'-',true);var newPlaylist={CHECKSUM:'',PARENT_USER_ID:USER.USER_ID.toString(),PLAYLIST_ID:id.toString(),STATUS:data.status,TITLE:data.title,PLAYLIST_PICTURE:'',PICTURE_TYPE:'cover',NB_SONG:Array.isArray(data.songs)?data.songs.length:0,DATE_ADD:current_date,DATE_CREATE:current_date,GENRE:[]};if(countObject(userData.data.PLAYLISTS.data)===0){userData.data.PLAYLISTS={count:0,total:0,data:[]};}
userData.data.PLAYLISTS.data.push(newPlaylist);userData.data.PLAYLISTS.count+=1;userData.data.PLAYLISTS.total+=1;if(typeof callback==='function'){callback(newPlaylist.PLAYLIST_ID);}
Events.trigger(Events.playlist.created,newPlaylist);}}});}catch(e){error.log(e);}},updatePlaylist:function(data,callback){api.call({method:'playlist.update',data:data,success:function(){userData.refreshPlaylistData(data.playlist_id,{TITLE:data.title,STATUS:data.status,DATE_ADD:timestampToDate(SERVER_TIMESTAMP,true,'-',true)});Events.trigger(Events.playlist.updated,data);if(typeof callback==='function'){callback(data);}}});},refreshPlaylistData:function(playlist_id,data){for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==playlist_id){for(var key in data){userData.data.PLAYLISTS.data[p][key]=data[key];}
break;}}},removePlaylist:function(data){try{api.call({method:'playlist.delete',data:{playlist_id:data.id},success:function(result){if(result){for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==data.id){userData.data.PLAYLISTS.data.splice(p,1);userData.data.PLAYLISTS.count-=1;userData.data.PLAYLISTS.total-=1;break;}}
if(naboo.getCurrentPath()==='/playlist/'+data.id){loadBox('/');}
Events.trigger(Events.playlist.removed,{type:'playlist',id:data.id});}}});}catch(e){error.log(e);}},addPlaylistSong:function(playlist_id,song_list,data){try{api.call({method:'playlist.addSongs',data:{playlist_id:playlist_id,songs:song_list},success:function(result){if(result===true){var all_playlist=$.merge($.merge([],userData.data.PLAYLISTS.data),userData.data.FAVORITES_PLAYLISTS.data);for(var p=0;p<all_playlist.length;p++){if(all_playlist[p].PLAYLIST_ID==playlist_id){all_playlist[p].DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);all_playlist[p].NB_SONG+=song_list.length;break;}}
Events.trigger(Events.playlist.addSong,{playlist_id:playlist_id,song:song_list,context:data.context,position:data.position,notify:typeof data.notify==='boolean'?data.notify:true});}}});}catch(e){error.log(e);}},removePlaylistSong:function(playlist_id,song_list){try{for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==playlist_id){userData.data.PLAYLISTS.data[p].NB_SONG-=song_list.length;break;}}
Events.trigger(Events.playlist.removeSong,{playlist_id:playlist_id,song:song_list});}catch(e){error.log(e);}},storeListCallback:function(result){try{for(var j=0;j<result.count;j++){userData.dataStore[result.data[j].ISRC]=true;}
storage.set('storeTrack',userData.dataStore,false);Events.resolve(Events.user.dataStoreReady);}catch(e){error.log(e);}},storeList:function(isrcList){try{if(typeof isrcList!=='object'){return false;}
for(var j=0;j<isrcList.length;j++){userData.dataStore[isrcList[j]]=true;}}catch(e){error.log(e);}},addEpisodeBookmark:function(bookmark){if(typeof bookmark!=='object'||USER.USER_ID===0){return false;}
try{if(countObject(userData.data.EPISODE_BOOKMARKS)===0){userData.data.EPISODE_BOOKMARKS={data:[],total:0,count:0};}
bookmark={EPISODE_ID:bookmark.EPISODE_ID,OFFSET:bookmark.OFFSET.toString(),IS_HEARD:bookmark.ISHEARD};userData.data.EPISODE_BOOKMARKS.data.push(bookmark);userData.data.EPISODE_BOOKMARKS_HASH[bookmark.EPISODE_ID]=userData.data.EPISODE_BOOKMARKS.count;userData.data.EPISODE_BOOKMARKS.count++;userData.data.EPISODE_BOOKMARKS.total++;Events.trigger(Events.user.updateEpisodeBookmark,bookmark);}catch(e){error.log(e);}},addSearchHistory:function(query,result,index){var types={song:'SNG_ID',album:'ALB_ID',artist:'ART_ID',playlist:'PLAYLIST_ID',show:'SHOW_ID'};if(query===''){return;}
var entry={query:query,result:result||null};api.call({method:'user.addEntryInSearchHistory',data:{ENTRY:{query:query,type:result?result.__TYPE__:'query',id:result?result[types[result.__TYPE__]]:null,rank:(typeof index!=='undefined')?index:null}}});userData._insertSearchHistoryEntry(userData.data.SEARCH_HISTORY,entry);Events.trigger(Events.user.updateSearchHistory);},clearSearchHistory:function(){api.call({method:'user.clearSearchHistory',data:{USER_ID:USER.USER_ID}});userData.data.SEARCH_HISTORY.data.length=0;userData.data.SEARCH_HISTORY.total=0;Events.trigger(Events.user.updateSearchHistory);return true;},_insertSearchHistoryEntry:function(searchHistory,entry){var types={song:'SNG_ID',album:'ALB_ID',artist:'ART_ID',playlist:'PLAYLIST_ID',show:'SHOW_ID'};var i;var storedEntry;var storedResult;var result=entry.result;for(i=0;i<searchHistory.data.length;i++){storedEntry=searchHistory.data[i];storedResult=storedEntry.result;if((result&&storedResult&&result.__TYPE__===storedResult.__TYPE__&&result[types[result.__TYPE__]]===storedResult[types[result.__TYPE__]])||(entry.query===storedEntry.query&&!storedResult)){searchHistory.data.splice(i,1);break;}}
searchHistory.data.unshift(entry);searchHistory.data.splice(userData.searchHistoryLimit);searchHistory.total=searchHistory.data.length;}};};
(function($){$.tiny=$.tiny||{};$.tiny.scrollbar={options:{axis:'y',wheel:40,scroll:true,size:'auto',sizethumb:'auto',extremePosition:false,extremePreventDefault:true}};$.fn.tinyscrollbar=function(options){var options=$.extend({},$.tiny.scrollbar.options,options);this.each(function(){$(this).data('tsb',new Scrollbar($(this),options));});return this;};$.fn.scrollPosition=function(){return $(this).data('tsb').scrollPosition();};$.fn.tinyscrollbar_update=function(sScroll){if(typeof $(this).data('tsb')=='undefined'){return false;}
return $(this).data('tsb').update(sScroll);};$.fn.scrollTo=function(arg){return $(this).data('tsb').scrollTo(arg);};function Scrollbar(root,options){var oSelf=this;var oWrapper=root;var oViewport={obj:$('.tinyscroll_viewport',root)};var oContent={obj:$('.tinyscroll_overview',root)};var oScrollbar={obj:$('.tinyscroll_scrollbar',root)};var oTrack={obj:$('.tinyscroll_track',oScrollbar.obj)};var oThumb={obj:$('.tinyscroll_thumb',oScrollbar.obj)};var sAxis=options.axis=='x',sDirection=sAxis?'left':'top',sSize=sAxis?'Width':'Height';var iScroll,iPosition={start:0,now:0},iMouse={};function initialize(){oSelf.update();setEvents();return oSelf;}
this.scrollPosition=function(){return iScroll;};this.update=function(sScroll){oViewport[options.axis]=oViewport.obj[0]['offset'+sSize];oContent[options.axis]=oContent.obj[0]['scroll'+sSize];oContent.ratio=oViewport[options.axis]/oContent[options.axis];oScrollbar.obj.toggleClass('tinyscroll_disabled',oContent.ratio>=1);oTrack[options.axis]=options.size=='auto'?oViewport[options.axis]:options.size;oThumb[options.axis]=Math.min(oTrack[options.axis],Math.max(0,(options.sizethumb=='auto'?(oTrack[options.axis]*oContent.ratio):options.sizethumb)));oScrollbar.ratio=options.sizethumb=='auto'?(oContent[options.axis]/oTrack[options.axis]):(oContent[options.axis]-oViewport[options.axis])/(oTrack[options.axis]-oThumb[options.axis]);iScroll=(sScroll=='relative'&&oContent.ratio<=1)?Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll)):0;iScroll=(sScroll=='bottom'&&oContent.ratio<=1)?(oContent[options.axis]-oViewport[options.axis]):isNaN(parseInt(sScroll))?iScroll:parseInt(sScroll);setSize();if(options.extremePosition)isExtremePosition(iScroll);};this.scrollTo=function(position){iScroll=position;var oThumbAnimate={};oThumbAnimate[sDirection]=iScroll/oScrollbar.ratio;var oContentAnimate={};oContentAnimate[sDirection]=-iScroll;oThumb.obj.stop(true).animate(oThumbAnimate);oContent.obj.stop(true).animate(oContentAnimate);if(options.extremePosition)isExtremePosition(iScroll);};function setSize(){oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);iMouse['start']=oThumb.obj.offset()[sDirection];var sCssSize=sSize.toLowerCase();oScrollbar.obj.css(sCssSize,oTrack[options.axis]);oTrack.obj.css(sCssSize,oTrack[options.axis]);oThumb.obj.css(sCssSize,oThumb[options.axis]);};function setEvents(){oThumb.obj.bind('mousedown',start);oThumb.obj[0].ontouchstart=function(oEvent){oEvent.preventDefault();oThumb.obj.unbind('mousedown');start(oEvent.touches[0]);return false;};oTrack.obj.bind('mouseup',drag);if((options.scroll)&&this.addEventListener){oWrapper[0].addEventListener('DOMMouseScroll',wheel,false);oWrapper[0].addEventListener('mousewheel',wheel,false);}
else if(options.scroll){oWrapper[0].onmousewheel=wheel;}};function start(oEvent){iMouse.start=sAxis?oEvent.pageX:oEvent.pageY;var oThumbDir=parseInt(oThumb.obj.css(sDirection));iPosition.start=oThumbDir=='auto'?0:oThumbDir;$(document).bind('mousemove',drag);document.ontouchmove=function(oEvent){$(document).unbind('mousemove');drag(oEvent.touches[0]);};$(document).bind('mouseup',end);oThumb.obj.bind('mouseup',end);oThumb.obj[0].ontouchend=document.ontouchend=function(oEvent){$(document).unbind('mouseup');oThumb.obj.unbind('mouseup');oTrack.obj.unbind('mouseup');end(oEvent.touches[0]);};oTrack.obj.bind('mouseup',end);oTrack.obj[0].ontouchend=document.ontouchend=function(oEvent){$(document).unbind('mouseup');oThumb.obj.unbind('mouseup');oTrack.obj.unbind('mouseup');end(oEvent.touches[0]);};return false;};function wheel(oEvent){if(!(oContent.ratio>=1)){var oEvent=oEvent||window.event;var iDelta=oEvent.wheelDelta?oEvent.wheelDelta/120:-oEvent.detail/3;iScroll-=iDelta*options.wheel;iScroll=Math.min((oContent[options.axis]-oViewport[options.axis]),Math.max(0,iScroll));oThumb.obj.css(sDirection,iScroll/oScrollbar.ratio);oContent.obj.css(sDirection,-iScroll);root.trigger('jsp-scrolling',iScroll);var is_extreme_position=false;if(parseInt(iScroll)==(oContent[options.axis]-oViewport[options.axis])||parseInt(iScroll)==0){is_extreme_position=true;}
if(options.extremePreventDefault||!is_extreme_position){oEvent=$.event.fix(oEvent);oEvent.preventDefault();}
if(options.extremePosition)isExtremePosition(iScroll);};};function end(oEvent){$(document).unbind('mousemove',drag);$(document).unbind('mouseup',end);oThumb.obj.unbind('mouseup',end);oTrack.obj.unbind('mouseup',end);document.ontouchmove=oThumb.obj[0].ontouchend=oTrack.obj[0].ontouchend=document.ontouchend=null;return false;};function drag(oEvent){if(!(oContent.ratio>=1)){iPosition.now=Math.min((oTrack[options.axis]-oThumb[options.axis]),Math.max(0,(iPosition.start+((sAxis?oEvent.pageX:oEvent.pageY)-iMouse.start))));iScroll=iPosition.now*oScrollbar.ratio;oContent.obj.css(sDirection,-iScroll);oThumb.obj.css(sDirection,iPosition.now);if(options.extremePosition)isExtremePosition(iScroll);}
return false;};function isExtremePosition(iScroll){if(parseInt(iScroll)==(oContent[options.axis]-oViewport[options.axis])){root.trigger('jsp-scroll-y',['bottom']).trigger('scroll');}else if(parseInt(iScroll)==0){root.trigger('jsp-scroll-y',['top']).trigger('scroll');}};return initialize();};})(jQuery);;
(function($){$.fn.searchBar=function(method){var params={suggest_id:'',instance:'header',types:{'ARTIST':true,'ALBUM':true,'TRACK':true},result_ids:{'ARTIST':[],'ALBUM':[],'TRACK':[]},nb_suggestion:4,label:gettext('Rechercher un titre, un album, un artiste'),tracking_event:'search_trigger',tracking:true,timer:null,query:null,div:null,selected:0,block:false,autofocus:false,cache_expire:(3600*1000),add_to_favorite:false,add_to_favorite_delegate:null,hide_artist:false,hide_album:false,hide_track:false,submit_disable:false,tracking_params_extend:false,href_enabled:true}
var suggest={cache:new Object()}
var methods={init:function(options){params=$.extend(params,options);params.div=this;params.div_suggest=$('.suggest',this);params.div_input=$('input:first',this);params.div_submit_container=$('.search_button_container',this);params.div_submit=$('[type="submit"]',params.div_submit_container);params.suggestion_type=0;params.suggestion_index=0;params.suggestion_id=0;params.suggestion_label='';$('.cross',params.div).unbind('click').click(function(){params.query='';params.div_input.val('');params.div_input.focus();$(this).hide();helpers.hideLoading();}).hide();params.div_submit.unbind('click').click(function(){if(params.div_input.val()!=params.label&&params.div_input.val()!=''){methods.search(params.div_input.val(),'click');}else{params.div_input.val('');};});if(params.autofocus){params.div_input.focus();}else{params.div_input.val(params.label);}
params.div_input.attr('placeholder',params.label);params.div_input.unbind('blur').blur(function(){helpers.hideSuggest();});params.div_input.unbind('click').click(function(){params.div_input.focus();});params.div_input.unbind('focus').focus(function(){if(this.value==params.label){this.value='';}
if(this.value!=''&&params.query!=this.value){params.query=this.value;}
helpers.over($('#search_link',params.div_suggest));params.timer=setTimeout(function(){methods.completion();},200);});params.div_suggest.unbind('mouseover').mouseover(function(e){params.block=true;});params.div_suggest.unbind('mouseout').mouseout(function(e){params.block=false;});params.div_input.unbind('keyup').keyup(function(event){if(params.timer!=null){clearTimeout(params.timer);}
if(event.keyCode!=38&&event.keyCode!=40&&event.keyCode!=13){params.query=this.value;$('#search_link',params.div_suggest).addClass('selected');params.timer=setTimeout(function(){methods.completion();},200);}
var first=$('.suggestion',params.div_suggest).first();var last=$('.suggestion',params.div_suggest).last();var selected=$('.suggestion.selected',params.div_suggest);var first_id=$(first).attr('data-i');var last_id=$(last).attr('data-i');var selected_id=0;if($(selected).length>0){var selected_id=parseInt($(selected).attr('data-i'));}
if(event.keyCode==38){if(selected_id==1){params.div_input.focus();return true;}
var prev_id=last_id;if(selected_id>0){prev_id=parseInt(selected_id)-1;if(prev_id<first_id){prev_id=last_id;}}
helpers.over($('[class~="suggestion"][data-i="'+prev_id+'"]',params.div_suggest));}
if(event.keyCode==40){if(selected_id==last_id){params.div_input.focus();return true;}
var next_id=first_id;if(selected_id>0){next_id=parseInt(selected_id)+1;if(next_id>last_id){next_id=first_id;}}
helpers.over($('li[class~="suggestion"][data-i="'+next_id+'"]',params.div_suggest));}
if(event.keyCode==13){if(params.submit_disable===true){if($(selected).length>0){$('a.result_link',selected).click();}
return false;}
params.block=false;params.div_input.val(params.query).blur();if($(selected).length>0){methods.trackingSuggestion('enter',selected);$('a.result_link',selected).click();}else{params.timer=setTimeout(function(){methods.search(params.div_input.val(),'enter');},200);}}});$(document).click(function(event){if($(event.target).attr('id')!=$(params.div_input).attr('id')){params.block=false;helpers.hideSuggest();}});methods.registerHandlebarsHelpers();},registerHandlebarsHelpers:function(){Handlebars.registerHelper('addslashes',function(str){return addslashes(str);});Handlebars.registerHelper('highlight',function(str,substr){var query_filter=substr.replace(/([^a-zA-Z0-9])/g,'\\$1');return new Handlebars.SafeString(str.replace(new RegExp("("+query_filter+")","gi"),function(matched){return"<strong class=\"highlight\">"+matched+"</strong>";}));});Handlebars.registerHelper('formatTime',function(seconds){return formatDuration(seconds);});Handlebars.registerHelper('getDay',function(_date){var d=new Date(dateToTimestamp(_date)*1000);return d.getDate();});Handlebars.registerHelper('getMonthLabel',function(_date){var d=new Date(dateToTimestamp(_date)*1000);var month=d.getMonth();var months=[gettext('JAN'),gettext('FEV'),gettext('MAR'),gettext('AVR'),gettext('MAI'),gettext('JUIN'),gettext('JUIL'),gettext('AOU'),gettext('SEP'),gettext('OCT'),gettext('NOV'),gettext('DEC')];if(typeof months[month]==='undefined'){return'';}
return months[month];});Handlebars.registerHelper('ifDateFuture',function(_date,options){return(dateToTimestamp(_date)>SERVER_TIMESTAMP)?options.fn(this):options.inverse(this);});Handlebars.registerHelper('add',function(num1,num2){return parseFloat(num1+num2);});return true;},completion:function(){if(params.query!=params.div_input.val()){params.query=params.div_input.val();}
if(params.query==null||params.query==''||params.query==params.label){$('.cross',params.div).hide();}else if($('.cross',params.div).css('display')=='none'){$('.cross',params.div).show();}
if(params.query==null||params.query==''){params.block=false;helpers.hideSuggest();helpers.hideLoading();return false;}
helpers.showLoading();params.query=$.trim(params.query);if(suggest.cache[params.query]!=null){methods.completionCallBack(suggest.cache[params.query]);}else{sendRequest('/suggest?q='+encodeURIComponent(addslashes(params.query))+'&c='+encodeURIComponent(COUNTRY)+'&limit='+params.nb_suggestion,'text','',true,methods.completionCallBack,false,'suggest_request');}},completionCallBack:function(request){helpers.hideLoading();params.selected=0;suggest.cache[params.query]=request;setTimeout(function(){suggest.cache[params.query]=null;},params.cache_expire);if(typeof request.responseText=='undefined'){return false;}
request=request.responseText;if(request==false||request.length==0||request=='error'){return false;}
request=eval('('+request+')');if(addslashes(params.query)!=request.query){return false;}
if((params.hide_artist===true||(typeof request['ARTIST']=='undefined'||request['ARTIST'].length==0))&&(params.hide_album===true||(typeof request['ALBUM']=='undefined'||request['ALBUM'].length==0))&&(params.hide_track===true||(typeof request['TRACK']=='undefined'||request['TRACK'].length==0))){helpers.hideSuggest();return false;}
if(params.hide_artist===true){request['ARTIST']=false;}
if(params.hide_album===true){request['ALBUM']=false;}
if(params.hide_track===true){request['TRACK']=false;}
params.result_ids={'ARTIST':[],'ALBUM':[],'TRACK':[]};for(var i in request){if(!request.hasOwnProperty(i)){continue;}
for(var j in request[i]){if(!request[i].hasOwnProperty(j)){continue;}
if(i=='ARTIST'&&typeof request[i][j].ART_ID!='undefined'){params.result_ids[i].push(request[i][j].ART_ID);}
if(i=='ALBUM'&&typeof request[i][j].ALB_ID!='undefined'){params.result_ids[i].push(request[i][j].ALB_ID);}
if(i=='TRACK'&&typeof request[i][j].SNG_ID!='undefined'){params.result_ids[i].push(request[i][j].SNG_ID);}}}
if(params.add_to_favorite==true){request['ARTIST']=request['ARTIST'].filter(function(result){return!userData.isFavorite('artist',result.ART_ID);});}
var template=Handlebars.templates['suggest'];$(params.div_suggest).html(template({suggest_id:params.suggest_id,query:params.query,artist:request['ARTIST'],album:request['ALBUM'],track:request['TRACK'],context:params.instance,href_enabled:params.href_enabled,add_to_favorite:params.add_to_favorite,add_to_favorite_delegate:params.add_to_favorite_delegate}));helpers.showSuggest();helpers.over($('#search_link',params.div_suggest));$('.suggestion',params.div_suggest).unbind('click').click(function(){methods.trackingSuggestion('click',this);params.block=false;helpers.hideSuggest();Events.trigger(Events.search.suggestClicked);});$('.suggestion',params.div_suggest).unbind('mouseover').mouseover(function(){helpers.over($(this));});$('#search_link',params.div_suggest).unbind('click').click(function(){methods.trackingSuggestion('click');params.block=false;helpers.hideSuggest();});$('#search_link',params.div_suggest).unbind('mouseover').mouseover(function(){helpers.over($(this));});helpers.tipsy();return true;},search:function(query,event_type){if(params.timer!=null){clearTimeout(params.timer);}
if(query==''){return false;}
params.block=false;helpers.hideSuggest();query=query.replace(/\//g,' ');if(params.tracking){methods.trackingSuggestion(event_type);}
loadBox('/search/'+addslashes(query));return true;},trackingSuggestion:function(){if(params.query==params.label||params.query==''){return false;}
var event_type='';if(arguments[0]!='undefined'){event_type=arguments[0];}
if(typeof arguments[1]=='undefined'){params.suggestion_index=0;params.suggestion_id=0;params.suggestion_type='all';params.suggestion_label='';}else{var obj=arguments[1];params.suggestion_index=$(obj).attr('data-i');params.suggestion_id=$(obj).attr('data-id');params.suggestion_type=$(obj).attr('type');params.suggestion_label=$(obj).attr('label');}
if(params.tracking){var tracking_params={'instance':params.instance,'event_type':event_type,'suggestion_index':params.suggestion_index,'suggestion_type':params.suggestion_type,'suggestion_id':params.suggestion_id,'suggestion_label':params.suggestion_label,'query':addslashes(params.query)};if(params.tracking_params_extend!==false&&typeof params.tracking_params_extend==='object'){$.extend(tracking_params,params.tracking_params_extend);}
tracking.track(params.tracking_event,tracking_params);tracking_params.syslog='search_suggest';tracking_params.user_id=USER.USER_ID;tracking_params.result_ids=params.result_ids;tracking_params.version=params.version;api.call('search.suggest_log',tracking_params);return true;}
return false;}}
var helpers={showSuggest:function(){params.div_suggest.show();Events.trigger(Events.search.suggestDisplayed);return true;},hideSuggest:function(){if(!params.block){params.div_suggest.hide();}
return true;},showLoading:function(){$('.search_button',params.div_submit_container).hide();$('.loading',params.div_submit_container).show();},hideLoading:function(){$('.search_button',params.div_submit_container).show();$('.loading',params.div_submit_container).hide();},over:function(obj){params.selected=0;if(typeof $(obj).attr('data-i')!='undefined'){params.selected=parseInt($(obj).attr('data-i'));}
$('.suggestion',params.div_suggest).removeClass('selected');$('#search_link',params.div_suggest).removeClass('selected');$(obj).addClass('selected');return true;},tipsy:function(){$('a.result_link.soon',params.div_suggest).each(function(index){$(this).tipsy({trigger:'hover',gravity:'s',fallback:gettext('Ce titre n\'est pas encore disponible.'),force_top:true});});}}
if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method "'+method+'" does not exist in DeezerSearch plugin!');}}})(jQuery);;
(function($){var params={type:0,nb:10,start:0,element_id:0,content_id:0,limit_comment:true,infinite_scroll:false,display:true,facebook_share:false,twitter_share:false,publish_on_enter:false,publish_on_progress:false,publish_button:null,adjust_onscroll:false,show_more:null,min_comment_char:10,max_comment_char:250,counter:null,loadComplete:false,limit_comment:true,addCallback:false,displayCallback:false,events_group:'comment'};var flagged=[];var Comment=function(root,options){var div=root;var self=this;var init=function(){if(options.type===0||options.element_id===0){return false;}
options.list=$('.comment-list',div);options.input=($('input',div).length>0)?$('input',div):$('textarea',div);options.error=$('.alert',div);options.show_more=$('.show-comments',div);options.count=$('.comment-count',options.counter);$(options.list).on('click','.trash',function(){deleteComment($(this));});$(options.list).on('click','.abuse',function(){flag($(this));});if(options.limit_comment===true){$(options.input).on('keyup keydown',function(){limitComment(options.min_comment_char,options.max_comment_char);});}
if(options.publish_on_enter===true){$(options.input).on('keypress',function(e){if(e.which===13){postComment();}});}
if(options.twitter_share===true){options.twitter_share_element=$('#tw_perms_comment');options.twitter_share_element.on('click',function(e){try{if(typeof USER.TWITTER.TOKEN=='undefined'){twitter.link();}else{userSetting.set({twitter:{share_comment:$(this).toggleClass('active').is('.active')}},true);}
return true;}catch(e){error.log(e);}});}
if(options.facebook_share===true){options.facebook_share_element=$('#fb_perms_comment');options.facebook_share_element.on('click',function(e){try{var $this=$(this);var data=$this.data();if(data.type==='comment-share-set'){userSetting.set({facebook:{share_comment:$this.toggleClass('active').is('.active')}},true);}else if(data.type==='comment-share-init'){facebook.login({scope_mandatory:true});}
return true;}catch(e){error.log(e);}});}
if(options.publish_button!==null){$(options.publish_button).on('click',function(e){postComment();});}
if(options.show_more!=null){$(options.show_more).on('click',function(){display();});if(options.adjust_onscroll===true){Events.subscribe(Events.navigation.tab_displayed,adjustScroll);}}
$(options.input).on('focus',function(e){self.getInstance();});if(options.display===true){display();};};var adjustScroll=function(evt,param){try{if(param.id!=options.element_id){return false;}
var added_content_height=options.list.outerHeight()-(options.show_more.offset().top-options.list.offset().top);var comment_div_height=added_content_height+options.show_more.offset().top+options.show_more.parent().prev().outerHeight();if(comment_div_height>client_height){$('#page_content').animate({'scrollTop':feed.current_yscroll+comment_div_height-client_height+(feed.is_webview?160:30)},'slow',function(){if(typeof options.displayCallback==='function'){options.displayCallback(options.content_id);}});}
if(options.loadComplete===true){options.show_more.remove();}
options.start+=options.nb;return true;}catch(e){error.log(e);}}
var display=function(){try{comment.display({element_id:options.element_id,type:options.type,start:options.start,nb:options.nb},displayCallback);return true;}catch(e){error.log(e);}};var displayCallback=function(result){try{if(typeof USER.USER_ID!=='undefined'&&USER.USER_ID>0&&typeof USER.BLOG_NAME!=='undefined'&&USER.BLOG_NAME!==null&&typeof USER.USER_PICTURE!=='undefined'&&USER.USER_PICTURE!==null){$('#naboo_comment_new').show();$('#naboo_comment_new_not_logged').hide();}else{$('#naboo_comment_new').hide();$('#naboo_comment_new_not_logged').show();}
if(result.data!=null&&result.count!=null&&result.count>0){var length=result.data.length;var html='';for(var i=0;i<length;i++){html+=createBlockComment(result.data[i]);}
options.list.append(html);options.start+=result.count;options.loadComplete=options.start>=result.total;}
if(options.loadComplete===true){options.show_more.remove();}
if(result.total>result.count){activeScroll();}
calculeTime();if(USER.FACEBOOK.UID&&options.facebook_share===true){if(facebook.isScopeAllowed('publish_actions')){if(facebook.isActionEnabled('comment')){options.facebook_share_element.addClass('active');}
options.facebook_share_element.data('type','comment-share-set');}else{options.facebook_share_element.data('type','comment-share-init');}}
if(options.twitter_share===true&&twitter.commentEnable()){options.twitter_share_element.addClass('active');}
Events.trigger(Events.navigation.tab_displayed,{type:options.type,id:options.id});return true;}catch(e){error.log(e);}};var postComment=function(){try{var comment_txt=$.trim(options.input.val());if(comment_txt==''||!isValid(options.min_comment_char,options.max_comment_char)||options.publish_on_progress){return false;}
options.publish_on_progress=true;comment.post({comment_txt:comment_txt,element_id:options.element_id,type:options.type},postCommentCallback);return true;}catch(e){error.log(e);}};var postCommentCallback=function(result){try{options.input.blur().val('');options.publish_on_progress=false;comment.getData({comment_id:result},function(result){try{var comment_data={BLOG_NAME:USER.BLOG_NAME,DISPLAY:0,USER_PICTURE:USER.USER_PICTURE,COMMENT_ID:result.COMMENT_ID,USER_ID:USER.USER_ID,SETTING_LANG:SETTING_LANG,DATE:dateToTimestamp(result.DATE),COMMENT:result.COMMENT};options.list.prepend(createBlockComment(comment_data));var added_comment=$('[data-target="comment-row"]:first',options.list);var highlighted_comment=(options.template==='feed')?added_comment:$('.message',added_comment);added_comment.fadeIn(function(){highlighted_comment.removeClass('user-publish',{duration:2000})});if(typeof options.addCallback==='function'){options.addCallback(options.content_id,comment_data);}
updateCount(1);calculeTime();tracking.track('comment_publish_click',{'context':((options.template==='feed')?'card':'page'),'content':options.type,'id':options.element_id});}catch(e){error.log(e);}});return true;}catch(e){error.log(e);}};var deleteComment=function(element){try{var data=element.data();if(typeof data.id==='undefined'||typeof data.type==='undefined'||typeof data.elementId==='undefined'){return false;}
if(confirm(gettext('Souhaitez-vous définitivement supprimer votre commentaire ?'))){comment.remove(data,function(result){try{element.parents('[data-target="comment-row"]').fadeOut('slow',function(){updateCount(-1);$(this).remove();});return true;}catch(e){error.log(e);}});}
return true;}catch(e){error.log(e);}};var flag=function(element){try{var data=element.data();if(data.id==''||typeof data.id==='undefined'||jQuery.inArray(data.id,flagged)>-1){return false;}
comment.flag(data,function(result){try{alert(gettext('Merci, ce commentaire sera vérifié dans les plus brefs délais.'));flagged.push(data.id);return true;}catch(e){error.log(e);}});return true;}catch(e){error.log(e);}};var activeScroll=function(){try{if(!options.infinite_scroll){return true;}
if(options.loadComplete){infinite_scroll.disable();return true;}
Events.subscribeOnce(Events.layout.infiniteScroll,function(){display();},options.events_group);infinite_scroll.active($('#tab_comment_content'));return true;}catch(e){error.log(e);}};var createBlockComment=function(item){try{item.FLAG_BUTTON=(options.template==='feed'&&item.USER_ID!=USER.USER_ID);item.TYPE=options.type;item.ELEMENT_ID=(item.USER_ID==USER.USER_ID)?options.element_id:false;item.COMMENT=$('<div/>').text(item.COMMENT).html();var template;if(options.template==='feed'){template=Handlebars.partials[(feed.is_webview)?'webview_feed_partial_comment_block':'feed_partial_comment_block'];}else if(options.template==='catalog'){template=Handlebars.templates['catalog_components_comment'];}else{template=Handlebars.templates['comment'];}
return template(item);}catch(e){error.log(e);}};var isValid=function(min,max){try{if(trim(options.input.val()).length<min){if(!options.error.is(":visible")){options.error.fadeIn();}
return false;}
return true;}catch(e){error.log(e);}};var updateCount=function(val){try{if(options.count==null){return false;}
options.count.text(parseInt(options.count.text())+val);return true;}catch(e){error.log(e);}};var limitComment=function(min,max){try{var comment_length=options.input.val().length;$("#naboo_comment_new .nb").text(max-comment_length);if(comment_length>=min&&options.error.is(":visible")){options.error.fadeOut();return true;}
return true;}catch(e){error.log(e);}};this.getInstance=function(){return self;};return init();};$.fn.commentbox=function(param){if(typeof param==='object'&&typeof $(this).data('cmt')==='undefined'){var options=$.extend({},params,param);this.each(function(){$(this).data('cmt',new Comment($(this),options));});return this;}else if(typeof param==='string'){var comment_div_inst=$(this).data('cmt').getInstance();if(comment_div_inst[param]){return comment_div_inst[param]();}else{$.error('Method "'+param+'" does not exist on jQuery.commentbox');}}}})(jQuery);;
var js_init={init:function(){if(typeof window.JS_INIT==='undefined'){return false;}
var index_of_jqueryaddress=window.JS_INIT.indexOf('_jqueryAddress');if(index_of_jqueryaddress!==-1){js_init.initLibs(['_jqueryAddress']);window.JS_INIT.splice(index_of_jqueryaddress,1);}
$(document).ready(function(){if(typeof window.JS_INIT==='object'){js_init.initLibs(window.JS_INIT);}});return true;},initLibs:function(js_init){if(typeof js_init!=='object'){return false;}
for(var i=0;i<js_init.length;i++){var _f=js_init[i];if(typeof window[_f]==='undefined'){continue;}
if(typeof window[_f].init==='function'){window[_f].init();continue;}
if(typeof window[_f]==='function'){window[_f]();}}
return true;}};;
var dzform={blogname_min_length:2,blogname_max_length:50,password_min_length:6,password_max_length:50,checkEmail:function($key,callback){callback=callback||function(){};var str=$key.val();str=str.trim();if(!str.match(/^[_\.0-9a-z-+]+@([0-9a-z-]+\.)+[a-z]{2,13}$/i)||(!Modernizr.input.placeholder&&str===$key.attr('placeholder'))){throw new dzError({name:'FORM_ERROR_EMAIL_NOT_VALID',message:gettext('Le format de votre adresse email n\'est pas valide.'),payload:{evt:(str.length===0)?'over':''}});}
callback(true);},checkEmailuniq:function($key,callback){callback=callback||function(){};dzform.checkEmail($key);var str=$key.val();str=str.trim();api.call('deezer.emailCheck',{EMAIL:str},function(result){var arg=true;if(result.domain_validity===false){arg=new dzError({message:gettext('Le nom de domaine \'%s\' n\'est pas autorisé.',{sprintf:[result.domain]}),name:'FORM_ERROR_EMAIL_DOMAIN_NOT_VALID'});callback(arg);return;}
if(result.availability===false){arg=new dzError({message:gettext('Cette adresse email est déjà associée à un compte.'),name:'FORM_ERROR_EMAIL_ALREADY_USED'});}
callback(arg);});},checkEmailuniqAndSuggest:function($key,onSuccess,onError,onSuggest,onNoSuggest){try{dzform.checkEmail($key);}catch(error){onError($key,error);onNoSuggest($key);return;}
var str=$key.val();str=str.trim();api.call({method:'deezer.emailCheck',data:{EMAIL:str},success:function(result){if($key.val()!==str){return;}
if(result.availability===true){onSuccess($key);if(result.suggestion!==''){onSuggest($key,gettext('Vous vouliez sans doute dire %s ?',{sprintf:[result.suggestion]}),result.suggestion);}else{onNoSuggest($key);}}else if(result.domain_validity===false){onError($key,{message:gettext('Le nom de domaine \'%s\' n\'est pas autorisé.',{sprintf:[result.domain]}),name:'FORM_ERROR_EMAIL_DOMAIN_NOT_VALID'});onNoSuggest($key);}else{onError($key,{message:gettext('Cette adresse email est déjà associée à un compte.'),name:'FORM_ERROR_EMAIL_ALREADY_USED'});onNoSuggest($key);}}});},checkPassword:function($key,callback){var str=$key.val();str=str.trim();if(str.length<dzform.password_min_length||(!Modernizr.input.placeholder&&str===$key.attr('placeholder'))){throw new dzError({name:'FORM_ERROR_PASSWORD_TOO_SHORT',message:gettext('Votre mot de passe doit comporter au moins 6 caractères.'),payload:{evt:(str.length===0)?'over':''}});}
if(str.length>dzform.password_max_length){throw new dzError({name:'FORM_ERROR_PASSWORD_TOO_LONG',message:gettext('Votre mot de passe ne doit pas dépasser 50 caractères.'),payload:{evt:''}});}
callback(true);},checkBlogname:function($key,callback){var str=$key.val();str=str.trim();if(str.length<dzform.blogname_min_length||(!Modernizr.input.placeholder&&str===$key.attr('placeholder'))){throw new dzError({name:'FORM_ERROR_BLOGNAME_TOO_SHORT',message:gettext('Votre pseudo doit comporter au moins 2 caractères.'),payload:{evt:(str.length===0)?'over':''}});}
if(str.length>dzform.blogname_max_length){throw new dzError({name:'FORM_ERROR_BLOGNAME_TOO_LONG',message:gettext('Votre pseudo ne doit pas dépasser 50 caractères.'),payload:{evt:''}});}
callback(true);},checkGender:function($key,callback){if($key.val()==0){throw new dzError({name:'FORM_ERROR_SEX_NOT_VALID',message:gettext('Merci de préciser votre sexe.'),payload:{evt:'over'}});}
callback(true);},checkAge:function($key,callback){if(parseInt($key.val(),10)<MIN_LEGAL_AGE){throw new dzError({name:'FORM_ERROR_AGE_NOT_VALID',message:gettext('Vous devez avoir au moins %s ans pour créer un compte.',{sprintf:[MIN_LEGAL_AGE]}),payload:{evt:'over'}});}
callback(true);},canSubmit:function($form,datas,onError,onSuccess,event){var error=false;onError=Array.isArray(onError)?onError:[onError];datas.each(function(index){if(typeof $(this).data('val')==='undefined'||$(this).data('val')===false){error=new dzError({message:'',name:'form_input_empty'});if($form.children('form').data('type')==='form-page'){dzform.checkField($(this),onError,onSuccess);}else{for(var i=0;i<onError.length;i++){onError[i]($(this),error,event);}}}});if(error){return false;}
return true;},checkField:function($key,onError,onSuccess,event){var check=$key.data('check');onError=Array.isArray(onError)?onError:[onError];onSuccess=Array.isArray(onSuccess)?onSuccess:[onSuccess];if($key.data('insert-value')===true){var optionSelected=$('option:selected',$key);var optionLabel=$key.prev('.form-control');optionLabel.text(optionSelected.text());optionLabel.toggleClass('active',(optionSelected.val()!=='0'));}
try{window.dzform['check'+ucfirst(check)]($key,function(check){if(check===true){for(var i=0;i<onSuccess.length;i++){onSuccess[i]($key,check,event);}
return check;}
for(var j=0;j<onError.length;j++){onError[j]($key,check,event);}
return check;});}catch(error){for(var i=0;i<onError.length;i++){onError[i]($key,error,event,error.payload.evt);}}},placeholder:function($key){if(Modernizr.input.placeholder){return true;}
$key.each(function(index){if($(this).is('input')&&$(this).val().length===0){$(this).val($(this).attr('placeholder')).addClass('has-placeholder');}});$key.focus(function(){if($(this).attr('placeholder')!==''&&$(this).val()===$(this).attr('placeholder')){$(this).val('').removeClass('has-placeholder');}}).blur(function(){if(($(this).attr('placeholder')!==''&&($(this).val()===''||$(this).val()===$(this).attr('placeholder')))){$(this).val($(this).attr('placeholder')).addClass('has-placeholder');}});}};;
var infinite_scroll={state:false,status:false,div:'',percent:95,active:function(div,percent){try{infinite_scroll.state=true;infinite_scroll.status=false;infinite_scroll.percent=95;if(typeof percent=='number'){infinite_scroll.percent=percent;}
if(BrowserDetect.browser==='Explorer'&&BrowserDetect.version===8){return false;}
infinite_scroll.checkPosition();return;}catch(e){error.log(e);}},disable:function(){try{infinite_scroll.state=false;infinite_scroll.status=false;}catch(e){error.log(e);}},checkPosition:function(evt){try{if(!infinite_scroll.state){return;}
if(infinite_scroll.status){return;}
var $page_content=$('#page_content');var content_height=$page_content.height();var content_scroll_height=$page_content.get(0).scrollHeight;var current_percent=(yscroll+content_height)*100/content_scroll_height;if(current_percent>=infinite_scroll.percent){infinite_scroll.status=true;Events.trigger(Events.layout.infiniteScroll,Math.min(100,Math.round(current_percent)));}
return;}catch(e){error.log(e);}}};;
(function(){'use strict';var naboo={initialized:false,current_config:null,pages:{'':{class_name:'feed',regex:/^\/?/i,args:{},need_login:true},page:{class_name:'page',regex:/^\/page\/(.+)/i,args:{type:1}},feed:{class_name:'feed',regex:/^\/feed\/?/i,args:{},need_login:true},album:{class_name:'album',regex:/^\/album\/([0-9]+)/i,args:{alb_id:1}},app:{class_name:'app',regex:/^\/app\/(login)?([a-z0-9_-]+)?(\/(.+)?)?/i,root:/^\/app\/[a-z0-9_-]+/i,args:{action:1,app_id:2,deep_link:3}},appstudio:{class_name:'appstudio',regex:/^\/appstudio/i,args:{}},artist:{class_name:'artist',regex:/^\/artist\/([0-9]+)/i,args:{art_id:1}},explore:{class_name:'explore',regex:/^\/explore(\/([a-z_]+)?)?(\/([a-z0-9\-]+)?)?/i,args:{tab:2,id:4},root:/^\/explore?/i,need_login:true},pro:{class_name:'pro',regex:/^\/pro/i,args:{},root:/^\/pro?/i,need_login:true},offline:{class_name:'offline',regex:/^\/offline/i,args:{}},playlist:{class_name:'playlist',regex:/^\/playlist\/([0-9]+)/i,args:{playlist_id:1}},profile:{class_name:'profile',regex:/^\/profile\/([0-9a-z]+)(\/([a-z_]+)?)?/i,args:{user_id:1,tab:3},root:/^\/profile\/([0-9a-z]+)/i},mixes:{class_name:'radio',regex:/^\/mixes(\/([a-z]+)?)?(\/([0-9]+)?)?/i,args:{type:2,id:4}},search:{class_name:'search',regex:/^\/search(\/(.+)?)?/i,args:{query:2}},tags:{class_name:'search',regex:/^\/tags(\/(.+)?)?/i,args:{query:2,tags:2}},shows:{class_name:'talk',regex:/^\/shows(\/([a-z_]+)?)?(\/([a-z0-9\-]+)?)?/i,args:{tab:2,id:4},root:/^\/shows?/i,need_login:true},show:{class_name:'talkshow',regex:/^\/show\/([0-9]+)/i,args:{show_id:1}},charts:{class_name:'tops',regex:/^\/charts(\/([a-z]+)?)?(\/([^-]+)\/([0-9]+)?)?/i,args:{type:2,genre_id:5}},track:{class_name:'track',regex:/^\/track\/([0-9]+)/i,args:{sng_id:1}},episode:{class_name:'episode',regex:/^\/episode\/([0-9]+)/i,args:{episode_id:1}},episodes:{class_name:'latestEpisodes',regex:/^\/episodes/i},moods:{class_name:'moods',regex:/^\/moods(\/([0-9]+))?/i,args:{genre_id:2}}},init:function(){menu.load();Events.subscribe(Events.navigation.page_loaded,www.updateContentBackground);naboo.initialized=true;Events.resolve(Events.navigation.page_initialized);return true;},getCurrentClass:function(){if(naboo.current_config===null){return null;}
return naboo.current_config.class_name;},getCurrentPath:function(){if(naboo.current_config===null){return null;}
return naboo.current_config.full_path;},dispatchPath:function(path){var path_splitted=naboo.splitPath(path);var base=path_splitted.base;if(typeof naboo.pages[base]==='undefined'){return null;}
var class_config=naboo.pages[base];var dispatch={base:base,class_name:class_config.class_name,path_name:path_splitted.path_name,full_path:path_splitted.full_path,args:{},root:null};if(path_splitted.query_string!==null){var get_params=path_splitted.query_string.split('&');get_params.map(function(a){a=a.split('=');dispatch.args[a[0]]=a[1];});}
var regex=class_config.regex;var regex_args=regex.exec(path_splitted.path_name);for(var key in class_config.args){if(!class_config.args.hasOwnProperty(key)){continue;}
dispatch.args[key]=regex_args[class_config.args[key]]||null;}
if(typeof class_config.root!=='undefined'){var root=class_config.root.exec(path_splitted.path_name);if(root!==null){dispatch.root=root[0];}}
return dispatch;},splitPath:function(path){var splitted={base:null,path_name:null,full_path:path,query_string:null,hash:null};path=path.split('#');if(path.length>1){splitted.hash=path[1];}
path=path[0];path=path.split('?');if(path.length>1){splitted.query_string=path[1];}
path=path[0];splitted.path_name=path;path=path.split('/');splitted.base=path[1];return splitted;},getClass:function(path){var base_path=path.split('/')[1];return(naboo.isAllowed(base_path)?naboo.pages[base_path].class_name:null);},isAllowed:function(class_name){return(typeof naboo.pages[class_name]!=='undefined');},needLogin:function(base){return naboo.pages[base].need_login===true;},display:function(path,seo_data,options){try{options=options||{};if(path.charAt(0)!=='/'){error.log({message:'path not valid',description:'naboo.display: / is missing in your path '+path});path='/'+path;}
if(naboo.initialized===false){Events.ready(Events.navigation.page_initialized,function(){naboo.display(path,seo_data);});return false;}
if(!options.force&&naboo.current_config!==null&&naboo.current_config.full_path===path){Events.trigger(Events.navigation.page_displayed,{path:path});return false;}
var path_config=naboo.dispatchPath(path);if(path_config===null){error.log({message:'path not valid',description:'naboo.display: wrong path '+path});return false;}
if(USER.USER_ID===0&&naboo.needLogin(path_config.base)){www.goToConnection();return false;}
var internal_change=false;if(naboo.current_config!==null){if(path_config.root!==null&&path_config.root===naboo.current_config.root){internal_change=true;}
if(!internal_change){naboo.leave();}}
if(naboo.current_config===null){$('body').attr('data-layout','naboo');}
if(typeof seo_data==='object'){path_config.args.data=seo_data;}
path_config.class_name=path_config.path_name==='/'?'home':path_config.class_name;naboo.current_config=path_config;infinite_scroll.disable();var current_class_name=naboo.current_config.class_name;if(internal_change){if(typeof window[current_class_name].onPageChanged==='function'){window[current_class_name].onPageChanged(naboo.current_config.args);}}else{window[current_class_name].display(naboo.current_config.args);}
return true;}catch(e){error.log(e);}},leave:function(){var leaveClass=naboo.getCurrentClass();if(leaveClass===null){return false;}
Events.unsubscribeAll(leaveClass);window[leaveClass].initialized=false;if(typeof window[leaveClass].leave==='function'){window[leaveClass].leave();}
tabs.destroy();naboo.current_config=null;return true;},adblockDetected:function(){if(typeof USER!=='undefined'&&USER.OPTIONS.ads_display===true){var currentClass=naboo.getCurrentClass();live.log.send('adblock',{event:'onDisplay',properties:{adsClass:currentClass==='home'?'feed':currentClass}});}},afterLoad:function(scrolling){try{if(typeof scrolling==='undefined'||scrolling===null){scrolling=false;}
if(scrolling===true){$('#page_content').scrollTop(0);yscroll=0;}
var current_class=naboo.getCurrentClass();if(typeof window[current_class].getLiveFeed==='function'){live.deleteChannel(live.lastFeed);window.clearTimeout(live.timeoutConnect);live.lastFeed=window[current_class].getLiveFeed();live.timeoutConnect=window.setTimeout(function(){live.addChannel(live.lastFeed);},3000);}
Events.trigger(Events.navigation.page_displayed,{path:naboo.getCurrentPath()});if(typeof blockAdBlock==='undefined'){naboo.adblockDetected();}else{window.blockAdBlock.onDetected(naboo.adblockDetected);}
$(document).ready(function(){if(typeof advertising==='undefined'){return true;}
var adsClass=current_class;if(typeof window[adsClass].getAdsArgs==='function'){if(adsClass==='profile'&&window[adsClass].getAdsArgs().element_data==='loved'){adsClass='loved';}
advertising.call(adsClass,window[current_class].getAdsArgs());}else{advertising.call(adsClass,{element_id:window[adsClass].id});}});return true;}catch(e){error.log(e);}},liveEvent:function(data){try{var currentNumber=1;switch(data.ACTION){case'ALBUM_COMMENT':case'ARTIST_COMMENT':case'PLAYLIST_COMMENT':if($('#tab_comment_content').is(':hidden')){if(!isNaN(parseInt($('#tab_comment_link .badge').text(),10))){currentNumber=parseInt($('#tab_comment_link .badge').text(),10)+1;}
$('#tab_comment_link .badge').text('+'+currentNumber).show();}
break;case'ARTIST_FAN':case'PLAYLIST_FAN':if($('#tab_fan_content').is(':hidden')){if(!isNaN(parseInt($('#tab_fan_link .badge').text(),10))){currentNumber=parseInt($('#tab_fan_link .badge').text(),10)+1;}
$('#tab_fan_link .badge').text('+'+currentNumber).show();}else{window.fan.liveFan();}
break;default:break;}
return true;}catch(e){error.log(e);}}};Events.subscribe(Events.live.pagefeed,function(evt,params){naboo.liveEvent(params[0]);});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=naboo;}else{window.naboo=naboo;}})();;
var orange={unlink:function(){var unlinkConfirmText=gettext('Êtes-vous certain de vouloir dissocier votre compte Orange de votre compte Deezer ?');try{if(confirm(unlinkConfirmText)){var unlinkIntroText=gettext('Afin de dissocier vos comptes, veuillez saisir votre mot de passe et soumettre le formulaire suivant :');$('#init_disable_orange_password').html(unlinkIntroText);$('#span_disable_orange_password').show();$('#div_disable_orange_password').show();}}catch(e){error.log(e);}},unlinkConfirm:function(){try{var password='';if($('#disable_orange_password').length==1){password=$('#disable_orange_password').val();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='password='+encodeURIComponent(password)+'&checkForm='+encodeURIComponent(checkForm);request=sendRequest('/ajax/action.php','text','type=orange_unlink&'+data);if(request==false){return;}
var result=eval('('+request+')');if(result.error.length>0){www.drawFormResult('disable_orange_result','form_error',gettext('Veuillez vérifier votre mot de passe.'));$('#disable_orange_result').delay(3000).fadeOut();}else{www.drawFormResult('disable_orange_result','form_success',gettext('Les comptes ont bien été dissociés.'));$('#disable_orange_result').delay(3000).fadeOut();setTimeout(function(){user.refreshPageAfterLogin({type:'page',link:'account/subscription'});},3000);}}catch(e){error.log(e);}},checkPremium4Orange:function(){try{window.location.href='/orange/login.php';}catch(e){error.log(e);}},uk_test_number:function(){try{if(($('#ouk_test_phone')!=null)&&($('#ouk_test_phone').val().length>0)){var request=sendRequest('/ajax/action.php','text','type=orange_uk_test_number&phone='+encodeURIComponent($('#ouk_test_phone').val()));if(request=='error'){$('#ouk_error').html(gettext('Numéro invalide. Merci de vérifier.')).show();}else if(request=='fail'){modal.open('/orange_uk/fail.php?phone='+encodeURIComponent($('#ouk_test_phone').val()),true);return true;}else if(request=='error_soap'){$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.')).show();}else{modal.open('/orange_uk/final.php',true);}}else{$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.'));}}catch(e){error.log(e);}},uk_check_code:function(){try{if(($('#ouk_code')!=null)&&($('#ouk_code').val().length>0)){var request=sendRequest('/ajax/action.php','text','type=orange_uk_check_code&code='+encodeURIComponent($('#ouk_code').val()));if(request=='error'){$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.')).show();}else if(request=='error_check'){$('#ouk_error').html(gettext('Votre code est erroné. Merci de vérifier le SMS que vous avez reçu.')).show();}else{modal.open('/orange_uk/confirm.php',true);return true;}}else{$('#ouk_error').html(gettext('Une erreur est survenue, merci de réitérer dans quelques instants.'));}}catch(e){error.log(e);}},uk_check_code_promo:function(){try{var code_promo='';if($('#code_promo').length==1)code_promo=$('#code_promo').val();check=sendRequest('/ajax/action.php','text','type=orange_uk_check_code_promo&code='+encodeURIComponent(code_promo));if((check===false)||(check=='error')){$('#orange_code_promo_error').css('display','block');return false;}
modal.open('/orange_uk/confirm.php',true);}catch(e){error.log(e);}}};;
var operatorAutolinker={autolink_url:null,subscriber:null,cookie_name:'auto_linked_subscriber',cookie_value:'1',cookie_life:30,init:function(autolink_url){if(operatorAutolinker._subscriberHasAlreadyChosenToLink()){return false;}
operatorAutolinker.autolink_url=autolink_url;var scriptEl=document.createElement('script');scriptEl.src=operatorAutolinker.autolink_url;document.body.appendChild(scriptEl);},process:function(json){if(!operatorAutolinker._isValidJson(json)){return null;}
operator.findSubscriber(json.userInfos.ise2,operatorAutolinker._findValidSubscriberCallback);},doLink:function(){api.call('operator_linkAccount',operatorAutolinker.subscriber,operatorAutolinker._afterLink);},doNotLink:function(){operatorAutolinker._afterLink();},_afterLink:function(){storage.set(operatorAutolinker.cookie_name,operatorAutolinker.cookie_value,operatorAutolinker.cookie_life);window.location.reload(true);},_isValidJson:function(json){return typeof json.status!='undefined'&&typeof json.status.code!='undefined'&&json.status.code==200&&typeof json.userInfos.ise2!='undefined'&&json.userInfos.accountStatus==0;},_findValidSubscriberCallback:function(subscriber){if(typeof subscriber!='undefined'&&subscriber!==null&&typeof subscriber.result_code!='undefined'&&subscriber.result_code==1&&subscriber.linked==0){operatorAutolinker.subscriber=subscriber;}
if(operatorAutolinker.subscriber==null){return null;}
modal.open('/operator/autolink.php',true,operatorAutolinker.subscriber);},_subscriberHasAlreadyChosenToLink:function(){return storage.get(operatorAutolinker.cookie_name)==operatorAutolinker.cookie_value;}};;
if(typeof(right)=='undefined'){var right={READABLE:0,NOT_ENCODED:1,LOCALITY:2,MP3_FRIEND:3,PREMIUM_ONLY:4,NOT_RELEASE_FREE:5,NOT_RELEASE_PREMIUM:6,EXPLICIT_LYRICS:7,FAN_ONLY:8,checkSongAvailable:function(currentData){try{if(typeof(currentData)!=='object'){return right.READABLE;}
if(typeof(currentData.ISRC)!='undefined'&&currentData.ISRC!=''&&userData.dataStore[currentData.ISRC]==true){return right.READABLE;}
if(typeof(currentData.EXTERNAL)!='undefined'){return right.READABLE;}
if(typeof(currentData.RIGHTS)=='undefined'){currentData.RIGHTS={};}
if(parseInt(currentData.SNG_ID,10)<0){if(countObject(currentData.RIGHTS)==0){return(parseInt(currentData.ART_ID,10)==0)?right.MP3_FRIEND:right.LOCALITY;}
if(parseInt(currentData.FAN_ONLY,10)==1&&(!userData.isLoaded||!userData.isFavorite('artist',currentData.ART_ID))){return right.FAN_ONLY;}}
if(USER.USER_ID>0&&typeof(USER.SETTING.global.filter_explicit_lyrics)!=='undefined'&&typeof(currentData.RIGHTS.EXPLICIT_LYRICS)==='boolean'&&currentData.RIGHTS.EXPLICIT_LYRICS===true){return right.EXPLICIT_LYRICS;}else if(!DZPS&&typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='string'){return right.PREMIUM_ONLY;}else if(typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='undefined'){return right.LOCALITY;}else if(!DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_ADS)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_FREE;}else if(DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_SUB)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_PREMIUM;}else if(currentData.MD5_ORIGIN==''||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&!DZPS&&parseInt(currentData.SNG_ID,10)>0)||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&DZPS&&parseInt(currentData.SNG_ID,10)>0&&USER.SETTING.site.player_hq==false)||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&parseInt(currentData.FILESIZE_MP3_256,10)===0&&parseInt(currentData.FILESIZE_MP3_320,10)===0&&DZPS&&parseInt(currentData.SNG_ID,10)>0)||(parseInt(currentData.SNG_ID,10)===0&&parseInt(currentData.FILESIZE_MP3_MISC,10)===0)){return right.NOT_ENCODED;}
return right.READABLE;}catch(e){error.log(e);}},getMessage:function(unavailable_code){try{switch(unavailable_code){case right.NOT_ENCODED:return gettext('Ce titre n\'est pas encore encodé');case right.LOCALITY:return gettext('Ce titre n\'est pas disponible dans votre pays.');case right.MP3_FRIEND:return gettext('Ce titre est un mp3 perso d\'un autre utilisateur');case right.PREMIUM_ONLY:return gettext('A la demande des ayants droit, ce titre est disponible uniquement pour les abonnés Premium et Premium+.');case right.NOT_RELEASE_FREE:return gettext('Ce titre n\'est pas encore disponible.');case right.NOT_RELEASE_PREMIUM:return gettext('Ce titre n\'est pas encore disponible.');case right.EXPLICIT_LYRICS:return gettext('Ce titre contient des paroles pouvant choquer.');case right.FAN_ONLY:return gettext('Ajoutez l\'artiste à vos favoris pour écouter ce titre');default:return'';}}catch(e){error.log(e);}}};};
if(typeof restrict=='undefined'){var restrict={statusExclamationMark:80,object:null,type:'no_restriction',init:function(){try{if(USER.USER_ID<=0||DZPS){return false;}
if(USER.OPTIONS.web_streaming&&USER.OPTIONS.web_streaming_duration===0){return false;}
api.call('restriction.get',{},function(result){if(result==false){return;}
restrict.object=result;var now=Math.round(new Date().getTime()/1000);if(now<restrict.object.date_end_discover){restrict.type='discovery_unlimited';}else{restrict.type='discovery';Events.subscribe(Events.player.updateRestrictTime,restrict.updateRestrictTime);}});return true;}catch(e){error.log(e);}},updateRestrictTime:function(e,time){try{restrict.object.time_left-=time;restrict.object.time_used+=time;restrict.object.percent=((restrict.object.time_used*100)/(restrict.object.time_used+restrict.object.time_left));restrict.object.percent=Math.min(restrict.object.percent,100);restrict.gaugeUpdatePercent(restrict.object.percent);return true;}catch(e){error.log(e);}},gaugeUpdatePercent:function(percent){try{percent=parseFloat(percent).toFixed(3);percent=Math.min(percent,100);if(percent>=restrict.statusExclamationMark){$('#header_content_restriction > a > .warning').css('display','inline-block');}
$('#header_content_restriction > a > .progress > .bar').css('width',percent+'%');return true;}catch(e){error.log(e);}},gaugeEnable:function(){try{$('#push_abo').hide();$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');$('#header_content_restriction').show().bind('mouseover',restrict.gaugeMouseOver).bind('mouseout',restrict.gaugeMouseOut);}catch(e){error.log(e);}},gaugeDisable:function(){try{$('#push_abo').show();$('#header_content_profil_user_data').removeClass('limit_on').addClass('limit_off');$('#header_content_restriction').hide().unbind('mouseover',restrict.gaugeMouseOver).unbind('mouseout',restrict.gaugeMouseOut);}catch(e){error.log(e);}},gaugeMouseOver:function(){try{if($('#header_content_restriction_hovercard').is(':visible')==false){sendRequest('/lightbox/hovercard_restriction.php','text','type='+restrict.type+'&time_used='+restrict.object.time_used+'&time_left='+restrict.object.time_left,true,restrict.gaugeMouseOverCallback);}}catch(e){error.log(e);}},gaugeMouseOverCallback:function(response){try{response=response.responseText;$('#header_content_restriction_hovercard').html(response).show();}catch(e){error.log(e);}},gaugeMouseOut:function(e){try{if($(e.relatedTarget).parents('#header_content_restriction').length==1){return false;}
$('#header_content_restriction_hovercard').hide();}catch(e){error.log(e);}}};};
(function(){'use strict';var user={check_username_active:false,createChild:function(new_user,cb){cb=(typeof cb==='function'?cb:function(){});if(!window.isPlainObject(new_user)){return cb(false);}
api.call({method:'user.createChild',data:{blog_name:new_user.blog_name,is_kid:new_user.is_kid},success:function(result){cb(null,result);return true;},error:function(err){cb(err,null);return true;}});},deleteChild:function(child_id,cb){child_id=Number(child_id);cb=(typeof cb==='function'?cb:function(){});api.call({method:'user.deleteChild',data:{child_id:child_id},success:function(result){cb(null,result);return true;},error:function(err){cb(err,null);return true;}});},setKidStatus:function(e){if(!user.getMultiAccountOptions().PARENT){e.preventDefault();return;}
api.call({method:'user.setKidStatus',data:{parent_id:user.getParentId(),is_kid:!user.getMultiAccountOptions().IS_KID},success:function(result){window.location.href=SETTING_HOST_SITE;}});},loginMulti:function(user_id,cb){user_id=Number(user_id);cb=(typeof cb==='function'?cb:function(){});if(user_id===user.current()){cb(null,{});return;}
api.call({method:'user.loginMulti',data:{account_id:user_id},success:function(){cb(null,{});return true;},error:function(err){cb(err,null);return true;}});},getMultiAccountOptions:function(){return USER.MULTI_ACCOUNT||{};},getParentId:function(){var opt=user.getMultiAccountOptions();return window.getObjDeepKey(opt,'PARENT.id')||0;},isKid:function(){return this.getMultiAccountOptions().IS_KID||false;},getOfferEligibilities:function(){var eligibilities=(window.OFFER_ELIGIBILITIES||[])[0];eligibilities=window.isPlainObject(eligibilities)?eligibilities:{};return{id:window.getObjDeepKey(eligibilities,'offer.id')||0,name:window.getObjDeepKey(eligibilities,'offer.name')||'Deezer',uri:window.getObjDeepKey(eligibilities,'cta.subscribe_uri')||(SETTING_HOST_SITE+'/offers')};},getFacebookUID:function(){return window.getObjDeepKey(window.USER,'FACEBOOK.UID');},getGooglePlusUID:function(){return window.getObjDeepKey(window.USER,'GOOGLEPLUS.UID');},current:function(){var user_id=Number(USER.USER_ID);return user_id>0?user_id:0;},login:function(email,password){var response={success:0,instant_auth:0,has_multi_account:0};try{if(typeof email!=='string'||typeof password!=='string'){return response;}
email=email.trim();password=password.trim();if(email===''||password===''){return response;}
var res=sendRequest('/ajax/action.php','text','type=login&mail='+encodeURIComponent(email)+'&password='+encodeURIComponent(password));if(res==='error_and_instant_auth'){response.instant_auth=1;}else if(res==='success'){response.success=1;}else if(res==='success_multi_account'){response.success=1;response.has_multi_account=1;}}catch(e){error.log(e);}
return response;},getDisplayName:function(fallback){return USER.FIRSTNAME&&USER.LASTNAME?(USER.FIRSTNAME+' '+USER.LASTNAME):(Boolean(fallback)?user.getBlogName():'');},getBlogName:function(){return USER.BLOG_NAME||'Anonymous';},getLogType:function(){return LOG_TYPE;},setLogType:function(type){LOG_TYPE=String(type||'internal');},ping:function(){try{api.call('deezer.ping',{},function(result){if(typeof result.CHECKFORM!=='undefined'){if(USER.USER_ID>0&&result.USER_ID===0){modal.open('/lightbox/no_session.php');}else{USER.USER_ID=result.USER_ID;}
SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;}});return true;}catch(e){error.log(e);}},refreshSession:function(){return sendRequest('/ajax/action.php','text','type=refresh_session');},refreshPageAfterLogin:function(redirect){try{if(Object(redirect)!==redirect){window.location.reload();return true;}
var url=document.location.protocol+'//'+SETTING_HOST;if(redirect.link.charAt(0)!=='/'&&redirect.link.substr(0,4)!=='http'){error.log({message:'path not valid',description:'user.refreshPageAfterLogin: / is missing in your path'+redirect.link});redirect.link='/'+redirect.link;}
if(redirect.type=='refresh'){return document.location.href=redirect.link;}
if(redirect.type=='modal'){return document.location.href=url+www.getCurrentPath()+'?lb='+encodeURIComponent(redirect.link);}
if(redirect.type=='facebox'){return document.location.href=url+www.getCurrentPath()+'?lb='+encodeURIComponent(redirect.link);}
if(redirect.type=='page'){return document.location.href=url+unescape(redirect.link);}
if(redirect.type=='link'){return document.location.href='/?lb='+encodeURIComponent(redirect.link);}
return false;}catch(e){error.log(e);}},logout:function(redirect){try{redirect=redirect||null;if(typeof dzPlayer!=='undefined'&&dzPlayer.getPlayerType()==='chromecast'){chromecast.stopReceiver();}
Events.trigger(Events.user.logout);window.location='//'+SETTING_HOST+'/logout.php'+(redirect?'?redirect='+encodeURIComponent(redirect):'');return true;}catch(e){error.log(e);}
return false;},register:function(redirect,data){try{if(typeof data.tracking_data==='undefined'){data.tracking_data={};}
if(typeof data.validButton!='undefined'&&data.validButton!==''){$(data.validButton).hide();$(data.validButton).next().show();}
var blogname='';if(typeof data.blogname!='undefined'&&data.blogname!==''){blogname=data.blogname;}
var email='';if(typeof data.email!='undefined'&&data.email.trim()!==''){email=data.email.trim();}
var password='';if(typeof data.password!='undefined'&&data.password!==''){password=data.password;}
var birthday_day='';if(typeof data.birthday_day!='undefined'&&data.birthday_day!==''){birthday_day=data.birthday_day;}
var birthday_month='';if(typeof data.birthday_month!='undefined'&&data.birthday_month!==''){birthday_month=data.birthday_month;}
var birthday_year='';if(typeof data.birthday_year!='undefined'&&data.birthday_year!==''){birthday_year=data.birthday_year;}
var gender='';if(typeof data.gender!='undefined'){gender=data.gender;}
var checkForm='';if($('#checkForm').val()){checkForm=$('#checkForm').val();}else if(typeof window.checkForm!=='undefined'){checkForm=window.checkForm;}
var request=sendRequest('/ajax/action.php','text','type=register&email='+encodeURIComponent(email)+'&password='+encodeURIComponent(password)+'&blogname='+encodeURIComponent(blogname)+'&gender='+encodeURIComponent(gender)+'&birthday_day='+encodeURIComponent(birthday_day)+'&birthday_month='+encodeURIComponent(birthday_month)+'&birthday_year='+encodeURIComponent(birthday_year)+'&checkForm='+encodeURIComponent(checkForm));if(request=='error'){register.track(data.tracking_data,'error_checkform');user.ping();return false;}
var result=JSON.parse(request);if(typeof result[0]=='number'||result[0]>0){var login_result=user.login(email,password);if(login_result.success==true){register.track(data.tracking_data,'success',function(){user.refreshPageAfterLogin(redirect);});}
return true;}else{register.track(data.tracking_data,'error_input');}
if(typeof data.callBackError!='undefined'&&data.callBackError!==''){data.callBackError(result);}
if(typeof data.validButton!='undefined'&&data.validButton!==''){$(data.validButton).show();$(data.validButton).next().hide();}
return false;}catch(e){error.log(e);}},checkPassword:function(password,callback){api.call({method:'user_checkPassword',data:{password:password},success:callback});},resetPassword:function(email){try{if(typeof email!=='string'||email.trim()===''){return false;}
email=email.trim();var request=sendRequest('/ajax/action.php','text','type=reset_password&reset_mail='+encodeURIComponent(email));if(request=='success'){$('#reset_error').hide();$('#reset_first').hide();$('#reset_second').show();$('#reset_second_mail').html(email);$('#foot_step3').show();$('#foot_step2').hide();return true;}else if(request=='error'){$('#reset_error').html(gettext('<b>Adresse e-mail invalide</b><br />Merci de vérifier le format de votre adresse e-mail.'));$('#reset_error').show();return false;}else{$('#reset_error').html(gettext('<b>Adresse email inconnue</b><br />Cette adresse email ne correspond à aucun compte.<br />Merci de saisir votre email à nouveau.'));$('#reset_error').show();return false;}}catch(e){error.log(e);}},resetPasswordConfirm:function(){try{var password='';if($('#reset_new_password').length==1){password=$('#reset_new_password').val();password=password.trim();}
var password_confirm='';if($('#reset_new_confirm').length==1){password_confirm=$('#reset_new_confirm').val();password_confirm=password_confirm.trim();}
var key='';if($('#key').length==1){key=$('#key').val();}
var email='';if($('#email').length==1){email=$('#email').val();email=email.trim();}
var request=sendRequest('/ajax/action.php','text','type=reset_passwordConfirm&password='+encodeURIComponent(password)+'&password_confirm='+encodeURIComponent(password_confirm)+'&key='+encodeURIComponent(key)+'&email='+encodeURIComponent(email)+'&checkForm='+encodeURIComponent(checkForm));if(request!=='success'){$('#reset_error').show();return false;}
$('#reset_error').hide();$('#reset_first').hide();$('#foot_step2').hide();$('#reset_confirm').show();$('#foot_step2_login').show();return true;}catch(e){error.log(e);}},deleteAccountConfirm:function(md5){try{var password='';if($('#delete_account_password').length==1){password=$('#delete_account_password').val();password=password.trim();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='&password='+encodeURIComponent(password)+'&md5='+encodeURIComponent(md5)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=user_deleteConfirm'+data);var result=JSON.parse(request);if(result.error.length>0){www.drawFormResult('delete_result','form_error',gettext('Veuillez vérifier votre mot de passe.'));}else{www.drawFormResult('delete_result','form_success',gettext('Votre compte vient d\'être supprimé.'));user.logout();}
return true;}catch(e){error.log(e);}},block:function($div,friend_id,data){if(USER.USER_ID===0){modal.open('/lightbox/login.php');}
api.call('friend.block',{friend_id:friend_id},function(result){if(result===true){if($div){$div.data('blocked',1).text(gettext('Débloquer'));}
Events.trigger(Events.user.blockFriend,{id:friend_id});}});return true;},unblock:function($div,friend_id,data){api.call('friend.unblock',{friend_id:friend_id},function(result){if(result===true){if($div){$div.data('blocked',0).text(gettext('Bloquer'));}
Events.trigger(Events.user.unblockFriend,{id:friend_id});}});return true;}};window.user=user;})();;
if(typeof userSetting=='undefined'){var userSetting={set:function(data,notify){try{if(USER.USER_ID==0){return false;}
var newSetting=$.extend(true,{},USER.SETTING,data);if(JSON.stringify(newSetting)!=JSON.stringify(USER.SETTING)){var notify=notify||false;USER.SETTING=newSetting;api.call({method:'user.setSettings',data:{settings:data},success:function(){Events.trigger(Events.user.settingChanged,{notify:notify});}});}
return true;}catch(e){error.log(e);}}};};
var twitter={isLinked:function(){if(typeof USER.TWITTER.TOKEN!='undefined'&&USER.TWITTER.TOKEN!=''){return true;}
return false;},link:function(redirect){redirect=redirect||'';document.location.href='http://'+SETTING_HOST+'/twitter.php?callback_url='+encodeURIComponent('http://'+SETTING_HOST+'/'+redirect);return true;},unlink:function(){if(confirm(gettext('Êtes-vous sûr de vouloir dissocier vos comptes Deezer et %1$s ?',{sprintf:['Twitter']}))){api.call('twitterapi.unlinkAccount',{},function(result){if(result==true){delete USER.TWITTER.TOKEN;if(www.getCurrentPageType()=='account'){$('#page_account_share_twitter').removeClass('active');$('#page_account_share_twitter_title > div > span').removeClass('active');$('#page_account_share_twitter_title > div > a').css('display','none');}}});}
return true;},shareEnable:function(){if(USER.USER_ID==0)return false;if(typeof USER.TWITTER.TOKEN=='undefined'||USER.TWITTER.TOKEN=='')return false;if(typeof USER.SETTING.twitter=='undefined')return true;if(typeof USER.SETTING.twitter.share_share=='undefined')return true;if(!USER.SETTING.twitter.share_share)return false;return true;},commentEnable:function(){if(USER.USER_ID==0)return false;if(typeof USER.TWITTER.TOKEN=='undefined'||USER.TWITTER.TOKEN=='')return false;if(typeof USER.SETTING.twitter=='undefined')return true;if(typeof USER.SETTING.twitter.share_comment=='undefined')return true;if(!USER.SETTING.twitter.share_comment)return false;return true;}};;
var lastfm={isLinked:function(){if(typeof USER.LASTFM.TOKEN!='undefined'&&USER.LASTFM.TOKEN!=''){return true;}
return false;},link:function(){document.location.href='http://www.last.fm/api/auth/?api_key=049131564a8f161381fc0da711a69a16';return true;},unlink:function(){try{api.call('lastfm.unlinkAccount',{},function(result){if(result==true){delete USER.LASTFM.TOKEN;if(www.getCurrentPageType()=='account'){$('#page_account_share_lastfm').removeClass('active');$('#page_account_share_lastfm_title > div > span').removeClass('active');$('#page_account_share_lastfm_title > div > a').css('display','none');}}});return true;}catch(e){error.log(e);}}};;
if(typeof im=='undefined'){var im={isInit:false,loading:false,start:0,nb:10,allLoaded:false,last:false,init:function(){im.isInit=true;im.$modele_message=$('#tpl_instant_messenger');Events.subscribe(Events.live.newMessage,function(evt,params){var data=new Array();data.push({'MESSAGE_ID':params.MESSAGE_ID,'AUTHOR':{'USER_ID':params.USER_ID_FROM,'USER_PICTURE':params.USER_PICTURE_FROM,'BLOG_NAME':params.USER_NAME_FROM},'MESSAGE':params.MESSAGE,'READ':0,'DATE':Math.floor(new Date().getTime()/1000)});if(im.friend_id==params.USER_ID_FROM){im.drawMessage(data,false);}});return true;},chat:function(friend_id){if(USER.USER_ID===0){www.goToConnection();return false;}
if(!im.isInit){im.init();}
im.friend_id=friend_id;im.start=0;im.nb=25;im.allLoaded=false;im.last=false;im.$modal=$('#modal_instant_messenger');im.$form=$('#form_instant_messenger');im.$panel=$('.tinyscroll_container',im.$modal);im.$list_messenger=$('.list-messages',im.$modal);im.$input=$('#instant_messenger_input');im.$panel.bind('jsp-scrolling',function(event,pos){if(pos==0&&!im.loading&&!im.allLoaded){im.start+=10;im.loadMessage(im.start,im.nb);}}).tinyscrollbar();im.loadMessage(im.start,im.nb);im.$input.focus();return true;},loadMessage:function(start,nb){im.loading=true;api.call('message.getList',{'friend_id':im.friend_id,'start':start,'nb':nb},function(result){if((im.start+im.nb)>result.total){im.allLoaded=true;}
im.drawMessage(result.data.reverse(),true);});return true;},drawMessage:function(data,prepend){var $display_line=$('<div></div>');for(var i=0;i<data.length;i++){if((i>0&&(data[i].DATE-data[(i-1)].DATE)<1000&&data[i].AUTHOR.USER_ID==data[(i-1)].AUTHOR.USER_ID)||(!prepend&&(data[i].DATE-im.last.DATE)<1000&&data[i].AUTHOR.USER_ID==im.last.AUTHOR.USER_ID)){if(prepend){$('.message',$display_line).last().html($('.message',$display_line).last().html()+'<br>'+data[i].MESSAGE);}else{$('.message',im.$list_messenger).last().html($('.message',im.$list_messenger).last().html()+'<br>'+data[i].MESSAGE);}}else{$display_line.append(im.appendMessage(data[i]));}
im.last=data[i];}
var $line=$display_line.clone().children();if(prepend){im.$list_messenger.prepend($line);}else{im.$list_messenger.append($line);}
setTimeout(function(){im.$panel.tinyscrollbar_update('bottom');},300);im.loading=false;api.call('message.markAsRead',{'friend_id':im.friend_id});im.$input.focus();return true;},appendMessage:function(message){$item=im.$modele_message.clone().attr('id','im_'+message.MESSAGE_ID).show();if(message.AUTHOR.USER_ID!=USER.USER_ID){$item.removeClass('author').addClass('friend');}
$('img',$item).attr('src',SETTING_DOMAIN_IMG+'/user/'+message.AUTHOR.USER_PICTURE+'/80x80-000000-80-0-0.jpg');$('.message',$item).text(message.MESSAGE);return $item;},post:function(message){if(USER.USER_ID==0){return false;}
if(message==''){return false;}
api.call('message.post',{'friend_id':im.friend_id,'message':message},function(result){var data=[];data.push({'MESSAGE_ID':result,'AUTHOR':{'USER_ID':USER.USER_ID,'USER_PICTURE':USER.USER_PICTURE,'BLOG_NAME':USER.BLOG_NAME},'MESSAGE':message,'READ':0,'DATE':Math.floor(new Date().getTime()/1000)});im.drawMessage(data,false);});return true;}};};
(function($){$.cover=$.cover||{};$.cover.pane={options:{cover_size:null,ratio:1,padding:5,between:10,max_line:null,onresize:function(){}}}
$.fn.coverPane_resize=function(){return $(this).data('cpane').onResize();};$.fn.coverPane_update=function(){return $(this).data('cpane').refresh();};$.fn.coverPane_destroy=function(){return $(this).data('cpane').destroy();}
$.fn.coverPane=function(options){var options=$.extend({},$.cover.pane.options,options);this.each(function(){$(this).data('cpane',new coverPane($(this),options));});return this;}
function coverPane(root,options){var oSelf=this;function init(){oSelf.refresh();Events.subscribe(Events.layout.resize,oSelf.onResize);return true;}
this.onResize=function(){if(!root.is(':visible')){return;}
if(root.closest('body').length==0){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return false;}
var content_w=root.width();nb=Math.ceil(content_w/options.cover_size);if(nb>options.covers.length){nb=options.covers.length;}
size=Math.floor(content_w/nb)-(((nb-1)*options.between)/nb)-((2*options.padding)/nb);if(size>options.cover_size){size=options.cover_size;}
size=Math.floor(size);var size_h=Math.floor(size*options.ratio);options.img.css({'width':size,'height':size_h,'box-sizing':'border-box'});var top=options.padding;var left=options.padding;var line=0;options.covers.each(function(i,item){i=i+1;if(line==options.max_line){$(item).hide();return;}
$(item).css({'top':top,'left':left,'width':size}).show();left+=size+options.between;if(((i)%nb)==0&&i<options.covers.length){line+=1;if(line==options.max_line){return;}
left=options.padding;top+=size_h+options.between+options.label_size;}});root.css('height',top+size_h+options.padding+options.label_size);options.onresize();}
this.refresh=function(){options.covers=$('.block_cover',root);options.img=$('.block_cover .img_main',root);oSelf.onResize();return true;}
this.destroy=function(){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return true;}
return init();}})(jQuery);;
(function($){$.responsiveCover=$.responsiveCover||{};$.responsiveCover={options:{cover_width:null,cover_height:null,ratio:1,gap:5,max_line:null,full_last_line:false,onresize:function(){}}}
$.fn.responsiveCover_resize=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').onResize():false;};$.fn.responsiveCover_update=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').refresh():false;};$.fn.responsiveCover_destroy=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').destroy():false;}
$.fn.responsiveCover_display_status=function(){return($(this).data('cpane')!=null)?$(this).data('cpane').displayStatus():false;}
$.fn.responsiveCover=function(options){var options=$.extend({},$.responsiveCover.options,options);this.each(function(){$(this).data('cpane',new ResponsiveCover($(this),options));});return this;}
function ResponsiveCover(root,options){var oSelf=this;function init(){root.css({'margin-left':'-'+options.gap+'px','margin-top':'-'+options.gap+'px','height':'auto','overflow':'visible'});if(options.cover_width>options.cover_height){options.ratio=options.cover_width/options.cover_height;}
if(options.cover_height>options.cover_width){options.ratio=options.cover_height/options.cover_width;}
if(typeof options.max_line==='number'){root.css('overflow','hidden');}
oSelf.refresh();Events.subscribe(Events.layout.resize,oSelf.onResize);return true;}
this.onResize=function(){if(!root.is(':visible')){return;}
if(root.closest('body').length==0){Events.unsubscribe(Events.layout.resize,oSelf.onResize);return false;}
var root_w=root.width();var nb_per_row=Math.ceil(root_w/options.cover_width);var cover_w=root_w/nb_per_row;var columns_width=null;if(cover_w>options.cover_width){cover_w=options.cover_width;}
if(typeof oSelf.nb_per_row==='undefined'||oSelf.nb_per_row!==nb_per_row){oSelf.nb_per_row=nb_per_row;columns_width=(cover_w/root_w)*100;options.covers.css('width',columns_width+'%');}
if(options.ratio>0){options.covers.each(function(){$(this).find('.thumbnail').first().css({'height':Math.round(((cover_w-options.gap)*options.ratio)-2)});if(typeof options.max_line==='number'){if($(this).index()>=(nb_per_row*options.max_line)){$(this).addClass('hidden');}else{$(this).removeClass('hidden');}}});if(typeof options.max_line==='number'){root.css({'height':Math.ceil(options.covers.first().outerHeight()*options.max_line)+'px','paddingBottom':options.gap});}}
if(options.full_last_line&&options.max_line===null){var crop_height='auto';var overflow='visible';if(options.covers.length%nb_per_row>0&&options.covers.length>nb_per_row){crop_height=(options.covers.first().outerHeight()*Math.floor(options.covers.length/nb_per_row))+'px';overflow='hidden';}
root.css({'height':crop_height,'overflow':overflow});}
options.onresize({'columns':options.covers,'columnsWidth':columns_width});}
this.displayStatus=function(){var data={};data.overflow=root.css('overflow');data.hiddenCover=0;if(data.overflow=='hidden'){if(options.max_line!==null){data.hiddenCover=options.covers.length-(oSelf.nb_per_row*options.max_line);}else if(options.full_last_line){data.hiddenCover=options.covers.length%oSelf.nb_per_row;}}
return data;}
this.refresh=function(){options.covers=root.children(':visible');options.covers.css({'padding-left':options.gap+'px','padding-top':options.gap+'px','max-width':options.cover_width+'px'});oSelf.nb_per_row=0;oSelf.onResize();return true;}
this.destroy=function(){root.css({'margin-left':'','margin-top':'','overflow':'','height':''}).empty();Events.unsubscribe(Events.layout.resize,oSelf.onResize);return true;}
return init();}})(jQuery);;
var gigs={init:function(){try{if(USER.USER_ID===0){Events.ready(Events.user.userReady,gigs.init);return false;}
Events.subscribe(Events.navigation.page_displayed,function(evt,params){if(params.path.substring(0,7)!=='/artist'){return;}
gigs.checkOnTour('artist_page');});return true;}catch(e){error.log(e);}},load:function(callback){try{api.call('songkick.getGeoEvents',{USER_ID:USER.USER_ID},function(data){USER.ON_TOUR=data;callback();});}catch(e){error.log(e);}},checkOnTour:function(){try{if(typeof USER.ON_TOUR==='undefined'){gigs.load(function(){gigs.checkOnTour();});return false;}
var art_id=artist.id;Events.trigger(Events.gigs.display,{art_id:art_id,display:(typeof USER.ON_TOUR[art_id]!=='undefined')});return true;}catch(e){error.log(e);}},goToEvents:function(art_id){try{if(typeof art_id==='undefined'){return false;}
var context='artist_page';tracking.track('ontour_click',{art_id:art_id,type:context});window.open('/events/'+art_id);return true;}catch(e){error.log(e);}}};;
if(typeof preview==='undefined'){var preview={timer:0,active:false,naturalFinish:false,$el:null,init:function($el){try{var data=$el.data();var type;var id;if(typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
if(dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'){return false;}
if(OFFLINE){return false;}
preview.$el=$el.addClass('preview');type=data.type;id=data.id;if(typeof data.preview!=='undefined'&&data.preview!=1){preview.play(data.preview,id);return true;}
switch(type){case'album':api.call('song.getListByAlbum',{ALB_ID:id,NB:1},function(result){if(typeof result.data==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'song':api.call('song.getData',{SNG_ID:id,COUNTRY:COUNTRY},function(result){if(result.MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result,id);});break;case'playlist':api.call('playlist.getSongs',{PLAYLIST_ID:id,COUNTRY:COUNTRY,NB:1},function(result){if(typeof result.data==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'radio':api.call('radio.getSongs',{RADIO_ID:id,NB:1},function(result){if(typeof result.data==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'artist':api.call('smart.getSmartRadio',{ART_ID:id,LIMIT:1},function(result){if(typeof result.data==='undefined'||typeof result.data.length==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;case'show':api.call('episode.getListByShow',{SHOW_ID:id,LIMIT:1},function(result){if(typeof result.data==='undefined'||typeof result.data.length==='undefined'||result.data.length==0||typeof result.data[0].MD5_ORIGIN==='undefined'){preview.$el.removeClass('preview');return false;}
preview.play(result.data[0],id);});break;}
return true;}catch(e){error.log(e);}},play:function(data,context_id){try{var md5=data;if(typeof data==='object'){if(right.checkSongAvailable(data)!=right.READABLE&&dzPlayer.getMediaType(data)===dzPlayer.MEDIA_TYPE_SONG){preview.$el.removeClass('preview');return false;}
md5=data.MD5_ORIGIN;}
preview.$el.data('preview',md5);if(dzPlayer.isPlaying()&&thumbnails.current_context_id===context_id){preview.stop();return false;}
dzPlayer.trigger('audioPlayer_startPreview',[md5]);preview.active=true;return true;}catch(e){error.log(e);}},finish:function(){try{if(preview.$el!==null){preview.active=false;preview.naturalFinish=true;preview.$el.removeClass('preview');}
return true;}catch(e){error.log(e);}},stop:function(){try{dzPlayer.trigger('audioPlayer_endPreview');preview.active=false;preview.$el.removeClass('preview');return true;}catch(e){error.log(e);}}};Events.subscribe(Events.player.finishPreview,preview.finish);};
(function(){'use strict';function _getContextName(type){var contextName={playlist:'playlist_page',search:'search_page',personal_song:'personalsong_page',downloads:'downloads_page',album:'album_page',artist_top:'artist_top',artist_exclu:'artist_exclu',discography_album:'artist_discography',loved:'loved_page',lovedpersonal:'loved_page',history:'history_page',radio:'radio_page',show:'show_page',episode:'episode_page'};if(typeof contextName[type]!=='undefined'){return contextName[type];}
return type;}
var thumbnails={push_mobile:0,init:function(){try{$(document).on('click','.thumbnail .options',function(e){if($(e.currentTarget).hasClass('options-react')){return;}
var data=$(e.currentTarget).data();var targetData=$(e.target).data();switch(targetData.action){case'options':var figure=$(e.currentTarget).parents('figure');figure.addClass('has-contextmenu');window.context_menu.open({target:e.target,id:data.id,type:data.type,is_thumbnail:true,position:data.position||'bottom',cover_type:targetData.cover_type,image:targetData.image,private_status:targetData.private_status,zoom_on_cover:targetData.zoom_on_cover,excludes:(targetData.excludes)?targetData.excludes.split(','):'',data:{PARENT_USER_ID:targetData.parent_user_id,ART_ID:targetData.art_id,SHOW_ID:targetData.show_id,SONG:{ART_ID:targetData.art_id,ALB_ID:(data.type==='album')?data.id:targetData.alb_id,LYRICS_ID:targetData.lyrics_id}},listen_context:{TYPE:_getContextName(data.type),ID:data.id}});break;case'playlist':window.context_menu.open({target:e.target,position:'bottom',type:data.type,view:'playlist',is_thumbnail:true,id:data.id});break;case'favorite':var action=(userData.isFavorite(data.type,data.id))?'remove':'add';favorite[action](data);break;case'lyrics':Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong();Events.trigger(Events.menu.togglePanel,'lyrics');});var params={type:'track',id:data.id,radio:false,context:{TYPE:_getContextName(data.type),ID:data.id}};if(dzPlayer.getPlayerType()!=='radio'){params.addNext=true;}
dzPlayer.play(params);break;default:break;}});return true;}catch(e){error.log(e);}},sentToMobileTracking:function($elt){try{if(typeof $elt!=='object'||$elt.children('.sent-to-mobile.active').length===0){return false;}
tracking.track('senttomobile_banner_display',{type:www.getCurrentPageType()});}catch(e){error.log(e);}},draw:function(options){if(typeof options!=='object'){return false;}
var returnFormat='object';if(typeof options.hash==='undefined'){returnFormat='string';options={hash:options};}
if(typeof options.hash.play!=='undefined'&&(typeof options.hash.id==='undefined'||typeof options.hash.type==='undefined')){return false;}
var data={id:options.hash.id||false,art_id:options.hash.art_id||false,alb_id:options.hash.alb_id||false,show_id:options.hash.show_id||false,lyrics_id:(typeof options.hash.lyrics_id!=='undefined')?options.hash.lyrics_id:0,parent_user_id:(typeof options.hash.parent_user_id!=='undefined')?Number(options.hash.parent_user_id):false,user_id:USER.USER_ID,type:options.hash.type||false,cover_play:options.hash.cover_play||false,play_context_id:options.hash.play_context_id||false,height:options.hash.height||false,height_img:options.hash.height_img||false,width:options.hash.width||false,width_img:options.hash.width_img||false,card:options.hash.card||false,pic_id:options.hash.pic_id,smartradio:options.hash.smartradio||'0',radio:options.hash.radio||false,stack_covers:options.hash.stack_covers||false,rights:options.hash.rights||false,play:options.hash.play||false,preview:options.hash.preview||false,play_context:options.hash.play_context||false,dropdown_align:options.hash.dropdown_align||'right',tracking:options.hash.tracking||false,tracking_tag:options.hash.tracking_tag||false,tracking_params:options.hash.tracking_params||false,border:options.hash.border||false,rounded:options.hash.rounded||false,responsive:options.hash.responsive||false,shadow:options.hash.shadow||false,ribbon:options.hash.ribbon||false,release_date:options.hash.release_date||false,play_force:options.hash.play_force||false,edit:options.hash.edit||false,unavailable:false,unavailable_message:false,closed:options.hash.closed||false,blocked:options.hash.blocked||'0',sent_to_mobile_banner:false,tooltip:options.hash.tooltip||false,overlay:(typeof options.hash.overlay!=='undefined')?options.hash.overlay:true,eventClick:options.hash.eventClick||false,private_status:options.hash.private_status||'0',enable_preview:(typeof options.hash.enable_preview!=='undefined')?options.hash.enable_preview:true,available:(typeof options.hash.available!=='undefined')?options.hash.available:true,cover_link:(typeof options.hash.cover_link!=='undefined')?options.hash.cover_link:true,context_menu_excludes:[],context_menu_hide:options.hash.context_menu_hide||false,favorite_hide:options.hash.favorite_hide||false,image:options.hash.image||false,zoom_on_cover:options.hash.zoom_on_cover||false};var cover={smartradio:{cover_path:'artist',url_type:'radio',url_id:'artist/'+data.id},user:{url_type:'profile'},song:{cover_path:'cover',url_type:'track',url_id:data.id},album:{cover_path:'cover'},radio:{cover_path:'misc',url_type:'mixes',url_id:'genre/'+data.id},show:{cover_path:'talk',url_type:'show',url_id:data.pic_id},episode:{cover_path:'talk',url_type:'episode',url_id:data.id},episodes:{cover_path:'misc',url_type:'episodes',url_id:'',href_type:'episodes'}};if(data.id&&data.type){data.is_favorite=userData.isFavorite(data.type,data.id);}
if(typeof options.hash.context_menu_excludes!=='undefined'){data.context_menu_excludes=(typeof options.hash.context_menu_excludes==='string')?JSON.parse((options.hash.context_menu_excludes).replace(/'/g,'"')):options.hash.context_menu_excludes;}
if(options.hash.cover_type){if(options.hash.cover_type==='cover'&&options.hash.pic_id===''){data.cover_type='playlist';}else{data.cover_type=options.hash.cover_type;}}else{data.cover_type=(typeof cover[data.type]!=='undefined'&&typeof cover[data.type].cover_path!=='undefined')?cover[data.type].cover_path:data.type;}
if(data.cover_play===true||data.cover_link===true){data.href_id=(typeof cover[data.type]!=='undefined'&&typeof cover[data.type].url_id!=='undefined')?cover[data.type].url_id:data.id;data.href_type=(typeof cover[data.type]!=='undefined'&&typeof cover[data.type].url_type!=='undefined')?cover[data.type].url_type:data.type;}
if(data.type==='show'){data.href_id=data.id;}
if(USER.DEVICES_COUNT===0){data.sent_to_mobile_banner=options.hash.sent_to_mobile_banner||false;}
if(data.release_date!==false){var releaseDate=new Date(data.release_date);data.ribbon=((releaseDate.getTime()/1000)+(30*86400)>SERVER_TIMESTAMP);}
if(data.rights){data.rights.RIGHTS=data.rights.DATA.RIGHTS||data.rights.RIGHTS;if(right.checkSongAvailable(data.rights)!==right.READABLE){data.play=false;data.unavailable=true;data.unavailable_message=right.getMessage(right.checkSongAvailable(data.rights));}}
if(data.available===false){data.play=false;data.unavailable=true;}
var img_size=(data.height_img===false?data.height:data.height_img)+'x'+(data.width_img===false?data.width:data.width_img);data.img_url=SETTING_DOMAIN_IMG+'/'+(data.stack_covers?data.cover:data.cover_type)+'/'+data.pic_id+'/'+img_size+'-000000-80-0-0.jpg';var generateThumbnail=new Handlebars.SafeString(Handlebars.templates.thumbnail(data));return(returnFormat==='string')?generateThumbnail.string:generateThumbnail;}};window.thumbnails=thumbnails;})();;
(function($){$.selectbox=$.selectbox||{};$.selectbox.options={data:[],label:'NAME',id:'ID',selectedIndex:-1,selectedId:-1,defaultLabel:'',align:'left',useHandlebarTemplate:true};$.fn.createSelectbox=function(opt){if($(this).prop('id')===''){return false;}
var options=$.extend({},$.selectbox.options,opt);if(options.data.length===0&&options.useHandlebarTemplate){return false;}
this.each(function(){$(this).data('stb',new Select($(this),options));});return this;};$.fn.selectItem=function(id){if(!$(this).data('stb')){return false;}
$(this).data('stb').selectItem(id);return this;};function Select(root,options){var oRoot=root;var label='';var item='';var list='';var currentSelectedId='';function create(){oRoot.addClass('selectbox dropdown');Handlebars.registerHelper('getSelectboxData',function(item_data,type){return item_data[options[type]];});if(options.selectedIndex>-1&&typeof options.data[options.selectedIndex]!='undefined'){options.defaultLabel=options.data[options.selectedIndex][options.label];currentSelectedId=options.data[options.selectedIndex][options.id];}
if(options.selectedId>-1){for(var d in options.data){if(!options.data.hasOwnProperty(d)){continue;}
if(options.data[d][options.id]==options.selectedId){options.defaultLabel=options.data[d][options.label];currentSelectedId=options.data[d][options.id];break;}}}
if(options.defaultLabel===''){options.defaultLabel=options.data[0][options.label];currentSelectedId=options.data[0][options.id];}
if(options.useHandlebarTemplate){var hbTemplate=Handlebars.templates['selectbox'];var content=hbTemplate(options);oRoot.html(content);}
toggle=$('> .dropdown-toggle',oRoot);list=$('> .dropdown-menu',oRoot);label=toggle.find('> .label');item=list.find('> li > a');if(options.align==='right'){list.addClass('pull-right');}
toggle.on('mousedown',openSelect);toggle.on('mouseup',clickBox);item.on('mousedown',clickSelect);}
function openSelect(){try{if(!oRoot.hasClass('opened')){oRoot.addClass('opened');list.bind("mouseup",clickBox);$('body').trigger("mouseup");$('body').bind("mouseup",clickSelect);}else{closeSelect();}}catch(e){error.log(e);}}
function closeSelect(){try{if(oRoot.hasClass('opened')){oRoot.removeClass('opened');list.unbind("mouseup",clickBox);$('body').unbind("mouseup",clickSelect);}}catch(e){error.log(e);}}
function clickBox(){return false;}
function clickSelect(btn){try{var elt=$(btn.currentTarget);if(elt.parents('#'+oRoot.prop('id')).length===0){closeSelect();return false;}
if(currentSelectedId!=elt.data('id')){var data=options.data[elt.data('index')];if(typeof data==='object'){label.text(data[options.label]);currentSelectedId=data[options.id];}else{data=elt.data();}
if(typeof options.callback==='string'){Event.trigger(options.callback,data);}
if(typeof options.callback==='function'){options.callback(data);}}
closeSelect();}catch(e){error.log(e);}}
this.selectItem=function(id){for(var d=0;d<options.data.length;d++){if(options.data[d][options.id]==id){label.text(options.data[d][options.label]);currentSelectedId=id;break;}}}
return create();}})(jQuery);;
(function(){'use strict';var register={init:function($form,redirect,tracking){try{if(typeof $form!=='object'){return false;}
redirect=redirect||false;tracking=tracking||{};var $register_form_age_input=$('#register_form_age_input',$form);var $register_form_gender_input=$('#register_form_gender_input',$form);var $input_to_check=$('[data-check]',$form);dzform.placeholder($input_to_check);$('#register_form_submit',$form).on('click',function(e){e.preventDefault();$('#register_form_submit',$form).attr('disabled','disabled');_register.onSubmit($form);if(dzform.canSubmit($form,$input_to_check,[_register.trackError,_register.showError],e)===false){_register.callbackError($form);return;}
user.register(redirect,{blogname:$('#register_form_username_input',$form).val(),email:$('#register_form_mail_input',$form).val(),password:$('#register_form_password_input',$form).val(),gender:$register_form_gender_input.val(),birthday_day:'01',birthday_month:'01',birthday_year:new Date().getFullYear()-$register_form_age_input.val(),callBackError:function(){_register.callbackError($form);},tracking_data:tracking});});$input_to_check.on('focus blur',function(e){dzform.checkField($(this),[_register.trackError,_register.showError],[_register.trackSuccess,_register.hideError],e);});var checkEmailDebounce=(window.debounce(function($key){dzform.checkEmailuniqAndSuggest($key,_register.hideError,_register.showError,_register.addSuggestion,_register.hideTipster);},50));$input_to_check.on('change input',function(){if($(this).data('check')==='emailuniq'){var $key=$(this);checkEmailDebounce($key);}else{dzform.checkField($(this),_register.showError,_register.hideError);}});$input_to_check.each(function(){var val=$(this).val().trim();if(!$(this).hasClass('has-placeholder')&&($(this).is('select')&&parseInt(val,10)!==0||!$(this).is('select')&&val.length!==0)){dzform.checkField($(this),_register.showError,_register.hideError);}});auth.init_register({register_options:{tracking:{tracking_data:{registration_type:tracking.registration_type||'deezer',platform:PLATFORM,context:'deezer'}}}},$form);Events.ready(Events.googleplus.ready,function(){googleplus.renderGGPlus('home_account_gp');});$('#home_account_fb').data('registerFacebook',1);}catch(e){error.log(e);}},track:function(data,status,callback){try{if(typeof callback!=='function'){callback=function(){};}
if(typeof data.tag!=='undefined'&&typeof data.properties!=='undefined'){data.properties.result=status;tracking.track(data.tag,data.properties,callback);return true;}}catch(e){error.log(e);}
return false;}};var _register={callbackError:function($form){try{$('#register_form_global_error',$form).show();$('#register_form_submit',$form).removeAttr('disabled').addClass('shake').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',function(){$(this).removeClass('shake');});}catch(e){error.log(e.message,e.stack);}},onSubmit:function($form){$('#register_form_global_error',$form).hide();},trackError:function($key,error,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType,error);},showError:function($key,error,evt,action){var message=error.message||'';action=action||'';evt=evt||{};if(evt.type==='focus'||evt.type==='blur'){return false;}
$key.data('val',false).off('mouseout mouseover');$key.parent().removeClass('has-success').addClass('has-error has-feedback');if($key.parents('form').data('type')==='form-page'){if(action==='over'){$('.form-control-error',$key.parent()).remove();$key.on('mouseover',function(){_register.showError($key,error,evt,'out');});return;}
if(action==='out'){$key.on('mouseout',function(){_register.showError($key,error,evt,'over');});}}
if($('.form-control-error',$key.parent()).length===1){$('.form-control-error',$key.parent()).text(message);}else{$key.parent().append('<div class="form-control-error">'+message+'</div>');}},trackSuccess:function($key,check,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType);},hideError:function($key){$key.data('val',true).off('mouseout mouseover');$key.parent().removeClass('has-error').addClass('has-success');$('.form-control-error',$key.parent()).remove();},showTipster:function($key,message,action){if(message===''){return;}
if($('.form-control-tipster',$key.parent()).length===1){$('.form-control-tipster',$key.parent()).text(message);}else{$key.parent().append('<div class="form-control-tipster">'+message+'</div>');}
if(action){$('.form-control-tipster',$key.parent()).off('click').on('click',action);}},hideTipster:function($key){$('.form-control-tipster',$key.parent()).remove();},addSuggestion:function($key,message,suggestion){var action=function(){this.val(suggestion);_register.hideTipster(this);dzform.checkField(this,_register.showError,_register.hideError);};_register.showTipster($key,message,action.bind($key));}};window.register=register;})();;
(function(){'use strict';var login={init:function($form,redirect,isModal){try{if(typeof $form!=='object'){return false;}
redirect=redirect||false;var $input_to_check=$('[data-check]',$form);$input_to_check.each(function(){if($(this).val()!==''){dzform.checkField($(this),_login.showError,_login.hideError);}});dzform.placeholder($input_to_check);$('#login_form_submit',$form).on('click',function(e){e.preventDefault();$('#login_form_submit',$form).attr('disabled','disabled');_login.onSubmit();if(dzform.canSubmit($form,$input_to_check,_login.showError,_login.hideError)===false){_login.callbackGenericError($form);return;}
var email=$('#login_mail',$form).val();var login_result=user.login(email,$('#login_password',$form).val());if(login_result.success){window.storage.set('last_login_used',email,true,30);user.refreshPageAfterLogin(redirect);return true;}
var error=new dzError({name:'login_failed'});tracking.trackFormEvent($form,e.type,error);if(login_result.instant_auth){if(!isModal){modal.open('/lightbox/instant_auth?email='+encodeURIComponent(email));}else{_login.callbackInstantAuthError($form);return true;}}
_login.callbackGenericError($form);});$input_to_check.on('focus blur',function(e){dzform.checkField($(this),[_login.trackError,_login.showError],[_login.trackSuccess,_login.hideError],e);});$input_to_check.on('change input',function(e){dzform.checkField($(this),_login.showError,_login.hideError,e);});var lastLogin=window.storage.get('last_login_used');if(lastLogin){$('#login_mail',$form).val(lastLogin).trigger('change');}
if(!isModal){$('#login_forgot_password').on('click',_login.forgetPassword);}
Events.ready(Events.googleplus.ready,function(){googleplus.renderGGPlus('home_account_gp');});$('#home_account_fb').data('loginFacebook',1);$('#home_account_fb').data('loginOnly',0);}catch(e){error.log(e);}}};var _login={onSubmit:function($form){$('#login_error',$form).hide();},callbackError:function($form){$('#login_form_submit',$form).removeAttr('disabled').addClass('shake').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',function(){$(this).removeClass('shake');});$('#login_error',$form).show();$('#login_password',$form).val('');$('#login_error, #login_error_and_instant_auth',$form).hide();},callbackGenericError:function($form){_login.callbackError($form);$('#login_error',$form).show();},callbackInstantAuthError:function($form){_login.callbackError($form);$('#login_error_and_instant_auth',$form).show();},trackError:function($key,error,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType,error);},showError:function($key,error,evt,action){var message=error.message||'';evt=evt||{};action=action||'';if(evt.type==='focus'||evt.type==='blur'){return false;}
$key.data('val',false).off('mouseout mouseover');$key.parent().removeClass('has-success').addClass('has-error');if($key.parents('form').data('type')==='form-page'){if(action==='over'){$('.form-control-error',$key.parent()).remove();$key.on('mouseover',function(){_login.showError($key,error,evt,'out');});return;}
if(action==='out'){$key.on('mouseout',function(){_login.showError($key,error,evt,'over');});}}
if($('.form-control-error',$key.parent()).length===1){$('.form-control-error',$key.parent()).text(message);}else{$key.parent().append('<span class="form-control-error '+(typeof $key.data('class-error')==='string'?$key.data('class-error'):'')+'">'+message+'</span>');}},trackSuccess:function($key,check,event){var eventType=event?event.type:'unknown';tracking.trackFormEvent($key,eventType);},hideError:function($key){$key.data('val',true).off('mouseout mouseover');$key.parent().removeClass('has-error').addClass('has-success');$('.form-control-error',$key.parent()).remove();},forgetPassword:function(){var email=$('#login_mail').data('val')===true?encodeURIComponent($('#login_mail').val()):'';modal.open('/password/reset?default_email='+email,true);tracking.track('unlogged_home_click',{type:'forgot_password'});}};window.login=login;})();;
(function(){'use strict';var signout={init:function($form){try{if(typeof $form!=='object'){return false;}
$('#signout_form_submit',$form).on('click',function(e){e.preventDefault();e.stopPropagation();$('#signout_form_submit',$form).attr('disabled','disabled');if($('#tester_phone_number').val()===''){return _signout.showError({text:gettext('Une erreur est survenue. Merci de vous assurer de la validité de votre numéro avant de réitérer votre demande.')});}
premium.test_phone({context:'loggedout'},_signout.showSuccess,_signout.showError);});}catch(e){error.log(e);}}};var _signout={showError:function(error){$('#signout_form_submit').removeAttr('disabled');var $key=$('#tester_phone_number');$key.parent().addClass('has-error').children('.form-control-error').remove();if(error.text!==''){$key.parent().append('<span id="tester_phone_number_msg" class="form-control-error">'+error.text+'</span>');}
return false;},showSuccess:function(result){$('#index_form').toggleClass('hidden');$('#index_confirm').toggleClass('hidden');setTimeout(function(){window.location.href='/login';},10000);}};window.signout=signout;})();;
(function(){'use strict';var soon={init:function($form){try{if(typeof $form!=='object'){return false;}
var $input_to_check=$('[data-check]',$form);$input_to_check.each(function(){if($(this).val()!==''){dzform.checkField($(this),_soon.showError,_soon.hideError);}});dzform.placeholder($input_to_check);$('#soon_form_submit',$form).on('click',function(e){e.preventDefault();e.stopPropagation();$('#soon_form_submit',$form).attr('disabled','disabled');if(dzform.canSubmit($form,$input_to_check,_soon.showError,_soon.hideError)===false){_soon.callbackError($form);return false;}
$('#soon_form_post').submit();});$input_to_check.on('change input',function(){dzform.checkField($(this),_soon.showError,_soon.hideError);});}catch(e){error.log(e);}}};var _soon={callbackError:function($form){$('#soon_form_submit',$form).removeAttr('disabled');},showError:function($key,message,evt){message=message||'';evt=evt||'';$key.data('val',false).off('mouseout mouseover');$key.parent().removeClass('has-success').addClass('has-error');if($key.parents('form').data('type')==='form-page'){if(evt==='over'){$('.form-control-error',$key.parent()).remove();$key.on('mouseover',function(){_soon.showError($key,message,'out');});return;}
if(evt==='out'){$key.on('mouseout',function(){_soon.showError($key,message,'over');});}}
if($('.form-control-error',$key.parent()).length===1){$('.form-control-error',$key.parent()).text(message);}else{$key.parent().append('<span class="form-control-error '+(typeof $key.data('class-error')==='string'?$key.data('class-error'):'')+'">'+message+'</span>');}},hideError:function($key){$key.data('val',true).off('mouseout mouseover');$key.parent().removeClass('has-error').addClass('has-success');$('.form-control-error',$key.parent()).remove();}};window.soon=soon;})();;
(function(){'use strict';var button_multi_state={trad:{full:{active:gettext('Ajouté à Ma musique'),active_favorite_friend:gettext('Suivi'),active_favorite_song:gettext('Ajouté aux Coups de cœur'),active_play:gettext('À l\'écoute'),active_play_artist:gettext('Mix'),active_play_user:gettext('FLOW'),add:gettext('Ajouter à Ma musique'),add_favorite_friend:gettext('Suivre'),add_favorite_song:gettext('Ajouter aux Coups de cœur'),add_play:gettext('Écouter'),add_play_artist:gettext('Mix'),add_play_user:gettext('FLOW'),default:gettext('Ajouter à Ma musique'),default_favorite_friend:gettext('Suivre'),default_favorite_song:gettext('Ajouter aux Coups de cœur'),default_play:gettext('Écouter'),default_play_artist:gettext('Mix'),default_play_user:gettext('FLOW'),hover:gettext('Retirer de Ma musique'),hover_favorite_friend:gettext('Ne plus suivre'),hover_favorite_song:gettext('Retirer des Coups de cœur'),hover_play:gettext('Pause'),hover_play_artist:gettext('Mix'),hover_play_user:gettext('FLOW'),paused_play:gettext('Pause'),paused_play_artist:gettext('Mix'),paused_play_user:gettext('FLOW'),resume_play:gettext('Reprendre'),resume_play_artist:gettext('Mix'),resume_play_user:gettext('FLOW')},standard:{active:gettext('Ajouté'),add:gettext('Ajouter'),default:gettext('Ajouter'),hover:gettext('Retirer')}},draw:function(options){try{if(typeof options!=='object'){return false;}
var returnFormat='object';if(typeof options.hash==='undefined'){returnFormat='string';options={hash:options};}
var generatedButton=false;var data={status:'',icon:'favorite',icon_align:options.hash.icon_align||'left',elId:options.hash.elId||false,type:options.hash.type||'',action:options.hash.action||'favorite',display:options.hash.display||'',color:options.hash.color||'default',color_equalizer:options.hash.color_equalizer||'default',id:options.hash.id||'',size:options.hash.size||'',wording:options.hash.wording||'standard',play_context:options.hash.play_context||false,cancel_hover:options.hash.cancel_hover||false,radio:options.hash.radio||false,context:options.hash.context||false,tracking:options.hash.tracking||false,tracking_tag:options.hash.tracking_tag||options.hash.trackingTag||false,tracking_id:options.hash.tracking_card_id||options.hash.trackingId||false,tracking_params:options.hash.tracking_params||options.hash.trackingParams||false,enable_delegation:(typeof options.hash.enable_delegation==='boolean')?options.hash.enable_delegation:true};data.txtDefault=button_multi_state.getWording(data,'add');data.txtActive=button_multi_state.getWording(data,'active');data.txtHover=button_multi_state.getWording(data,'hover');data.txtPaused=button_multi_state.getWording(data,'paused');data.txtResume=button_multi_state.getWording(data,'resume');data.txtTooltip=button_multi_state.getWording(data,'add','full');data.tooltip=(data.wording==='standard'||data.wording==='none');if(data.action==='favorite'){var icon_custom={friend:'follow',song:'favorite'};if(typeof icon_custom[data.type]!=='undefined'){data.icon=icon_custom[data.type];}}else{data.icon=data.action;}
if(data.action==='play'&&data.color===false){data.icon_align='right';}
Events.ready(Events.user.userReady,function(){if(data.action!=='favorite'){return false;}
data.tracking_tag=(data.tracking==='feed')?'add_to_favorite':data.tracking_tag;if(userData.isFavorite(data.type,data.id)){data.tracking_tag=(data.tracking==='feed')?'click_item':data.tracking_tag;data.status='active';if(data.tooltip){data.txtTooltip=button_multi_state.getWording(data,'hover','full');}
if(generatedButton===false){return true;}
var updateButton=$('button[data-id="'+data.id+'"][data-type="'+data.type+'"][data-action="'+data.action+'"]');if(updateButton.length>0){updateButton.addClass('active');if(data.tooltip){updateButton.prop('title',button_multi_state.getWording(data,'hover','full'));}}}});generatedButton=new Handlebars.SafeString(Handlebars.templates.button_multi_state(data));return(returnFormat==='string')?generatedButton.string:generatedButton;}catch(e){error.log(e);}},getWording:function(data,state,force_wording){try{var wording=force_wording||data.wording;if(wording==='none'){return'';}
if(button_multi_state.trad[wording][state+'_'+data.action+'_'+data.type]){return button_multi_state.trad[wording][state+'_'+data.action+'_'+data.type];}
if(button_multi_state.trad[wording][state+'_'+data.action]){return button_multi_state.trad[wording][state+'_'+data.action];}
return button_multi_state.trad[wording][state];}catch(e){error.log(e);}}};window.button_multi_state=button_multi_state;})();;
var onair={current_context_type:'track',current_context_id:0,push_mobile:0,init:function(){try{onair.$naboo_content=$('#naboo_content');onair.$selected_elements=[];Events.subscribe(Events.player.displayCurrentSong,onair.onTrackOnAir);Events.subscribe(Events.player.finish,onair.onFinish);Events.subscribe(Events.player.playing,onair.onPlay);Events.subscribe(Events.player.paused,onair.onPaused);Events.subscribe(Events.navigation.page_displayed,onair.onPageUpdate);Events.subscribe(Events.navigation.page_updated,onair.onPageUpdate);}catch(e){error.log(e);}},onFinish:function(){try{var nextSongInfo=dzPlayer.getNextSong();if(nextSongInfo==null){$.each(onair.$selected_elements,function(){if($(this).is('figure')){$('.play, .sent-to-mobile',$(this)).removeClass('active');}
if($(this).is('button')){$(this).removeClass('active resume cancel-hover evt-out');}});}
return true;}catch(e){error.log(e);}},onTrackOnAir:function(){try{if(dzPlayer.getContext()==null){return false;}
onair.current_context_type=dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK?'talkShow':'track';onair.current_context_id=dzPlayer.getContext('ID');if(dzPlayer.getContext('TYPE')!==''){onair.current_context_type=LOG_CONTEXT[dzPlayer.getContext('TYPE')];}
return true;}catch(e){error.log(e);}},onPlay:function(evt,playing){try{var currentSong=dzPlayer.getCurrentSong();if(!dzPlayer.isPaused()&&!dzPlayer.isPlaying()){playing=false;}
$.each(onair.$selected_elements,function(){if($(this).is('figure')){$('.play, .sent-to-mobile',$(this)).removeClass('active');}
if($(this).is('button')){$(this).removeClass('active paused cancel-hover evt-out');if(!playing){$(this).data('cancelHover',false);}else if($(this).is('[data-type="'+onair.current_context_type+'"][data-id="'+onair.current_context_id+'"]')&&$(this).data('cancelHover')){$(this).addClass('cancel-hover evt-out').data('cancelHover',false);}}});if(playing===false||currentSong===null||(typeof currentSong.SNG_ID==='undefined'&&typeof currentSong.EPISODE_ID==='undefined')||(Number(currentSong.SNG_ID)===0&&Number(currentSong.EPISODE_ID)===0)||dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'){return false;}
var media_id=(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK?currentSong.EPISODE_ID:currentSong.SNG_ID);var media_parent_id=(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK?currentSong.SHOW_ID:currentSong.ALB_ID);var selector='.thumbnail[data-type="'+onair.current_context_type+'"][data-id="'+onair.current_context_id+'"]';if(onair.current_context_type==='album'||onair.current_context_type==='track'){selector='.thumbnail[data-type="song"][data-id="'+media_id+'"], .thumbnail[data-type="album"][data-id="'+media_parent_id+'"]';}
if(onair.current_context_type==='show'||onair.current_context_type==='episode'){selector='.thumbnail[data-type="episode"][data-id="'+media_id+'"], .thumbnail[data-type="show"][data-id="'+media_parent_id+'"]';}
onair.$selected_elements=$(selector,onair.$naboo_content);$('.play',onair.$selected_elements).removeClass('paused').addClass('active');var $btn_play=$('button[data-play="1"][data-type="'+onair.current_context_type+'"][data-id="'+onair.current_context_id+'"]',onair.$naboo_content);if($btn_play.length===1){onair.$selected_elements.push($btn_play.removeClass('paused').addClass('active'+(($btn_play.data('cancelHover'))?' cancel-hover evt-out':'')));}
thumbnails.sentToMobileTracking(onair.$selected_elements);return true;}catch(e){error.log(e);}},onPaused:function(){$.each(onair.$selected_elements,function(){if($(this).is('button')){if(dzPlayer.isPaused()){$(this).addClass('paused');}}});},onPageUpdate:function(){try{if(dzPlayer.isPlaying()){onair.onPlay(null,true);}
return true;}catch(e){error.log(e);}}};;
var chromecast={initialize:function(){if(typeof chrome==='undefined'||!chrome.cast||!chrome.cast.extensionId){return false;}
Events.ready(Events.user.loaded,function(){if(!chromecast.canCast()){return false;}
var request=new chrome.cast.SessionRequest(CHROMECAST.ID);var config=new chrome.cast.ApiConfig(request,function(session){return chromecast.setSession(session);},function(status){if(status===chrome.cast.ReceiverAvailability.AVAILABLE){chromecast.setStatus('show');}else{chromecast.setStatus('hide');}});chrome.cast.initialize(config,function(){},function(err){return;});});},launch:function(){if(!chromecast.canCast()){return false;}
var status=chromecast.getStatus();if(status==='connected'||status==='disconnected'){window.tracking.track('chromecast_open_menu_click',{chromecast_status:status==='connected'?1:0});}
Events.trigger(Events.chromecast.closeIntro,true);chrome.cast.requestSession(function(session){return chromecast.setSession(session);},function(err){return;});},setSession:function(session,reset){chromecast._session=session;if(reset===true){return false;}
chromecast.setStatus('loading');chromecast._session.addUpdateListener(function(alive){return!alive&&!OFFLINE?chromecast.stopReceiver(true):true;});Events.ready(Events.player.playerReady,function(){return chromecast.startReceiver();});},startReceiver:function(){if(chromecast._session===null){return false;}
window.tracking.track('chromecast_menu_choice_click',{type:'connect'});var current_ctx=dzPlayer.getContext();chromecast._dzPlayer.ctx=countObject(current_ctx)?current_ctx:{ID:PLAYLIST_WELCOME_ID,TYPE:'player_default_playlist',CONTEXT_ID:''};chromecast.setCCPlayer();chromecast._session.addMessageListener(CHROMECAST.NAMESPACE,function(namespace,message){var message=JSON.parse(message);if(message.status){var type=message.status.type;var parameters=message.status.parameters;if(parameters.hasOwnProperty('owner_id')&&parameters.owner_id!==chromecast._ownerId){chromecast.setOwner(parameters.owner_id);}
if(!chromecast._ping){return false;}
if(!chromecast._initialized){chromecast._initialized=true;chromecast.setStatus('connected');if(type==='idle'){return chromecast.doAction('playHello',{media_time:chromecast._dzPlayer.position});}}
if(type==='idle'){chromecast.setLoading(false);return chromecast.resetAutoSeek();}
if(type==='queue_changed'&&countObject(parameters.tracks)){var tracks=[];var current_track;var context=parameters.context||{};var dzr_ctx_id=parseInt(context.properties[chromecast.getContextIndexByType(context.type)]);var dzr_ctx_type=chromecast.getOriginalContextType(context.type);if(chromecast._ccPlayer.ctx.ID!==dzr_ctx_id){chromecast.resetAutoSeek();}
for(var i=0;i<countObject(parameters.tracks);++i){current_track={data:parameters.tracks[i],context:{ID:context.type==='top_charts'?parameters.tracks[i].ALB_ID:dzr_ctx_id,TYPE:dzr_ctx_type==='track_page'?'album_page':dzr_ctx_type,CONTEXT_ID:context.type==='top_charts'?dzr_ctx_id:''}};if(context.type==='search_results'&&www.getCurrentPageType()==='search'){var path=www.getCurrentPath().split('/');current_track.context.ID=path.length===2?path[1]:'';}else if(context.type==='track'){current_track.context.ID=parameters.tracks[i].ALB_ID;}else if(context.type==='playlist'&&parseInt(getObjDeepKey(profile,'data.TAB.loved.favorite_playlist_id'),10)===dzr_ctx_id){current_track.context.TYPE='loved_page';}
if(!current_track.data.hasOwnProperty('ALB_ID')){current_track.data.ALB_ID=context.properties.ALB_ID;}
if(i===0){current_track.LOCAL_AVAILABLE=false;chromecast._ccPlayer.ctx={ID:current_track.context.ID,TYPE:current_track.context.TYPE,CONTEXT_ID:current_track.context.CONTEXT_ID};}
tracks.push(current_track);}
chromecast._ccPlayer.list=tracks;setDzPlayerProp('trackList',tracks);if(chromecast.isRadioContextType(context.type)){setDzPlayerProp('shuffle',false);setDzPlayerProp('repeat',0);chromecast.setRadio(true);}else{setDzPlayerProp('shuffle',parameters.shuffle);setDzPlayerProp('repeat',parameters.repeat);chromecast.setRadio(false);}
return false;}
if(!countObject(chromecast._ccPlayer.list)){return false;}
var current_track=parameters.current_track||{};var context=parameters.context||{};var media_time=Math.floor(current_track.media_time/1000);if(!current_track.hasOwnProperty('properties')){current_track.properties={SNG_ID:current_track.id};}
if(type==='track_changed'){chromecast.resetAutoSeek();var tracks=dzPlayer.getTrackList();for(var i=0;i<tracks.length;++i){if(parseInt(tracks[i].SNG_ID)===parseInt(current_track.properties.SNG_ID)){dzPlayer.setIndexSong(i);}}
setDzPlayerProp('duration',dzPlayer.getCurrentSong('DURATION'));setDzPlayerProp('pourcentLoaded',100);Events.trigger(Events.player.play,{value:dzPlayer.getCurrentSong()});Events.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());return false;}else if(type==='playing'||type==='paused'){chromecast.setLoading(false);setDzPlayerProp('playing',(type==='playing'));setDzPlayerProp('paused',(type==='paused'));chromecast._ccPlayer.position=media_time;setDzPlayerProp('position',chromecast._ccPlayer.position);return type==='playing'?chromecast.startAutoSeek():chromecast.resetAutoSeek(false);}else if(type==='time_updated'){chromecast.setLoading(false);if(dzPlayer.getDuration()===0){setDzPlayerProp('duration',dzPlayer.getCurrentSong('DURATION'));}
chromecast._ccPlayer.position=media_time;chromecast._autoSeek===null?chromecast.startAutoSeek():setDzPlayerProp('position',chromecast._ccPlayer.position);setDzPlayerProp('volume',parseFloat(chromecast._session.receiver.volume.level).toFixed(2));}else if(type==='loading'){chromecast.setLoading(true);var reset=parseInt(dzPlayer.getCurrentSong('SNG_ID'))===parameters.track_id;return chromecast.resetAutoSeek(!reset);}else if(type==='goodbye'){return chromecast.stopReceiver();}else if(type==='repeat_changed'){return setDzPlayerProp('repeat',parameters.repeat||0);}}});return chromecast.doAction('sayHello');},stopReceiver:function(skip){if(skip===false){chromecast._session.removeUpdateListener(CHROMECAST.NAMESPACE);chromecast._session.removeMessageListener(CHROMECAST.NAMESPACE);return chromecast._session.stop(function(){chromecast.setDZPlayer();});}
return chromecast.setDZPlayer();},setRadio:function(bool){return chromecast._radio=bool;},isRadio:function(){return chromecast._radio?true:false;},isRadioContextType:function(type){return type==='user_flow'||type==='sradio'||type==='radio'?true:false;},setLoading:function(bool){return chromecast._loading=bool;},isLoading:function(){return chromecast._loading;},setOwner:function(id){return chromecast._ownerId=parseInt(id);},isOwner:function(){return chromecast._ownerId===parseInt(USER.USER_ID)?true:false;},isCasting:function(){return dzPlayer.getPlayerType()==='chromecast'?true:false;},canCast:function(){if(BrowserDetect.browser!=='Chrome'){return false;}
if(OFFLINE||typeof CHROMECAST!=='object'){return false;}
return USER.OPTIONS.mobile_offline&&USER.OPTIONS.mobile_streaming?true:false;},doAction:function(method,parameters){if(chromecast.isLoading()){return false;}
var parameters=parameters===Object(parameters)?parameters:{};var action=method.split('_').length===2?method.split('_')[1]:method;var allowed_actions=['play','seek','pause','prev','next','sayHello','playHello','playFromList','setVolume','mute','setRepeat','setShuffle'];if(allowed_actions.indexOf(action)===-1){return false;}
if(action==='setVolume'||action==='mute'||action==='playHello'){var level=dzPlayer.getVolume();if(action==='mute'){if(parameters[0]===true){level=0;}}
chromecast._session.setReceiverVolumeLevel(parseFloat(level));if(action!=='playHello'){return false;}}
if(action==='sayHello'){chromecast._ping=true;return chromecast.setMessage('hello');}
if(action==='playHello'||action==='play'){if(chromecast._ping===false){return false;}
var current_track=dzPlayer.getCurrentSong();var context=chromecast.getParsedContext();return chromecast.setMessage('play',{context:context,current_track:{id:parseInt(current_track.SNG_ID),isrc:(current_track.ISRC||'').toString(),media_time:Math.floor(parameters.media_time*1000)}});}
if(action==='playFromList'){var index=isNaN(parameters.index)||parameters.index===-1?0:parameters.index;var context=chromecast.getParsedContext(parameters.context);var action='play';if(countObject(parameters.data)===0){parameters.data=[{SNG_ID:0}];}
chromecast._ccPlayer.ctx.ID=context.type==='top_charts'?parseInt(parameters.context.ID):context.id;if(context.type==='top_charts'&&chromecast._ccPlayer.ctx.TYPE==='tops_track'||context.id===chromecast._ccPlayer.ctx.ID&&chromecast._ccPlayer.ctx.ID===parseInt(dzPlayer.getContext().ID)){action='skip_to';}
if(context.type==='search_results'){context.id=Math.floor(Math.random()*1000);context.name=parameters.context.ID;}
if(context.type==='track'){context.type==='album';}
chromecast._ccPlayer.ctx.TYPE=parameters.context.TYPE;return chromecast.setMessage(action,{context:context,current_track:{id:parseInt(parameters.data[index].SNG_ID),isrc:(parameters.data[index].ISRC||'').toString(),media_time:0}});}
if(action==='prev'||action==='next'||action==='pause'){return chromecast.setMessage(action);}
if(action==='seek'){var position=parameters[0];var duration=dzPlayer.getCurrentSong('DURATION');position=duration*position;return chromecast.setMessage(action,{media_time:Math.floor(position*1000)});}
if(action==='setRepeat'||action==='setShuffle'){action=action==='setRepeat'?'toggle_repeat':'toggle_shuffle';return chromecast.setMessage(action,{value:parameters.value});}},setMessage:function(type,obj,callback){if(typeof type!=='string'){return false;}
if(typeof obj==='function'){callback=obj;obj={};}else{callback=typeof callback==='function'?callback:false;obj=obj===Object(obj)?obj:{};}
chromecast.getUserAccessToken(function(response){var message={session:{user_id:USER.USER_ID,live_token:USER_TOKEN,access_token:response},command:{type:type}};if(type==='play'){chromecast.setLoading(true);var shuffle=dzPlayer.isShuffle();var repeat=dzPlayer.getRepeat();if(chromecast.isRadioContextType(obj.context.type)){shuffle=false;repeat=0;}
message.command.parameters={current_track:{id:obj.current_track.id,media_time:obj.current_track.media_time,isrc:obj.current_track.isrc},context:obj.context,shuffle:shuffle,repeat:repeat,hq:dzPlayer.isHq()};}else if(type==='skip_to'){chromecast.setLoading(true);message.command.parameters={track_id:obj.current_track.id};}else if(type==='toggle_repeat'||type==='toggle_shuffle'){message.command.parameters={value:obj.value};}else if(type==='seek'){chromecast.setLoading(true);message.command.parameters={media_time:obj.media_time};}else if(type==='prev'||type==='next'){chromecast.setLoading(true);}
return chromecast._session.sendMessage(CHROMECAST.NAMESPACE,message);});},getContextIndexByType:function(type){var index=type;var format_keys={ART_ID:['top_artist','sradio'],GENRE_ID:['top_charts'],RADIO_ID:['radio'],ALB_ID:['album','track','search_results'],PLAYLIST_ID:['playlist'],USER_ID:['top_user','user_history','user_personal_tracks','user_flow']};for(var key in format_keys){for(var i=0;i<format_keys[key].length;++i){if(format_keys[key][i]!==type){continue;}
index=key;}}
return index;},getOriginalContextType:function(type){var format_keys={sradio:'smartradio_page',radio:'radio_page',top_artist:'artist_top',top_user:'profile_top_tracks',top_charts:'tops_track',user_history:'history_page',user_personal_tracks:'personalsong_page',user_flow:'profile_user_radio',playlist:'playlist_page',album:'album_page',search_results:'search_page',track:'track_page'};return format_keys[type];},getParsedContext:function(ctx){var dz_context=ctx===Object(ctx)?ctx:dzPlayer.getContext();var cb_context;var context_type=dz_context.TYPE;var context_id=dz_context.ID;if(!context_type||!context_id){return false;}
var format_keys={sradio:['smartradio_page','feed_smartradio','artist_smartradio'],radio:['profile_radios','radio_page','feed_radio','unknown'],top_artist:['artist_top'],top_user:['profile_top_tracks'],top_charts:['tops_track'],user_history:['history_page'],user_personal_tracks:['personalsong_page'],user_flow:['profile_user_radio','home_user_radio','feed_user_radio'],playlist:['playlist_page','feed_playlist','tops_playlist','profile_playlists','player_default_playlist','loved_page','ticker_playlist','menu_panel_playlist','suggest_playlist'],album:['album_page','explore_picks_album','explore_region_album','tops_album','feed_album','profile_top_albums','artist_discography','profile_albums','ticker_album','menu_panel_album','suggest_album'],search_results:['search_page'],track:['feed_track','track_page','ticker_track','suggest_track']};for(var key in format_keys){for(var i=0;i<format_keys[key].length;++i){if(key!==context_type&&format_keys[key][i]!==context_type){continue;}
if(format_keys[key][i]==='loved_page'){context_id=chromecast._page.lpid;if(www.getCurrentTab()==='loved'){context_id=profile.data.TAB.loved.favorite_playlist_id;chromecast._page.lpid=context_id;}}else if(format_keys[key][i]==='history_page'){context_id=chromecast._page.hpid;if(www.getCurrentTab()==='history'){context_id=www.getCurrentPath().split('/')[1];chromecast._page.hpid=context_id;}}else if(format_keys[key][i]==='tops_track'){context_id=dz_context.CONTEXT_ID;}
cb_context=key;}}
if(context_type==='personalsong_page'){context_id=USER.USER_ID;}
var context={type:cb_context,id:isNaN(context_id)?context_id:parseInt(context_id)};return context;},setCCPlayer:function(){if(dzPlayer.getPlayerType()==='chromecast'){return false;}
chromecast._dzPlayer.position=dzPlayer.getPosition();dzPlayer.trigger('audioPlayer_stop',null);dzPlayer.setPlayerType('chromecast');},setDZPlayer:function(){if(dzPlayer.getPlayerType()!=='chromecast'){return false;}
dzPlayer.setPlayerType('mod');chromecast.setStatus('disconnected');window.tracking.track('chromecast_menu_choice_click',{type:'disconnect'});if(chromecast.isOwner()===false){chromecast.setDefaultTrackList();}else{if(countObject(chromecast._ccPlayer.ctx)){dzPlayer.play({type:LOG_CONTEXT[chromecast._ccPlayer.ctx.TYPE],id:chromecast._ccPlayer.ctx.ID,autoplay:false,radio:chromecast.isRadio(),index:dzPlayer.getTrackListIndex(),context:{ID:chromecast._ccPlayer.ctx.ID,TYPE:chromecast._ccPlayer.ctx.TYPE,CONTEXT_ID:chromecast._ccPlayer.ctx.CONTEXT_ID}});}else{chromecast.setDefaultTrackList();}}
Events.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());dzPlayer.trigger('audioPlayer_stop',null);chromecast._dzPlayer={ctx:{},list:{},position:0};chromecast._ccPlayer={ctx:{},list:{},position:0};chromecast._page={lpid:0,hpid:0};chromecast._initialized=false;chromecast._ping=false;chromecast.setOwner(null);chromecast.setRadio(false);chromecast.setLoading(false);chromecast.setSession(null,true);chromecast.resetAutoSeek();},setDefaultTrackList:function(){dzPlayer.play({type:'playlist',id:PLAYLIST_WELCOME_ID,autoplay:false,context:{ID:PLAYLIST_WELCOME_ID,TYPE:'player_default_playlist',CONTEXT_ID:''}});},getUserAccessToken:function(callback){var access_token=sessionStorage.getItem('CCToken_'+USER.USER_ID);if(access_token){return callback(access_token);}
api.call('application.authChromecast',{},function(response){if(!response){return false;}
sessionStorage.setItem('CCToken_'+USER.USER_ID,response);return callback(response);});},startAutoSeek:function(){chromecast._autoSeek=setInterval(function(){setDzPlayerProp('position',++chromecast._ccPlayer.position);},1000);},resetAutoSeek:function(trigger){if(typeof trigger==='undefined'||trigger!==false){trigger=true;}
clearInterval(chromecast._autoSeek);if(trigger){chromecast._ccPlayer.position=0;setDzPlayerProp('position',chromecast._ccPlayer.position);}
chromecast._autoSeek=null;},getStatus:function(){return chromecast._status;},setStatus:function(status){chromecast._status=status;Events.trigger(Events.chromecast.status,chromecast._status);},_dzPlayer:{ctx:{},list:{},position:0},_ccPlayer:{ctx:{},list:{},position:0},_page:{lpid:0,hpid:0},_autoSeek:null,_ownerId:null,_session:null,_status:'hide',_initialized:false,_loading:false,_radio:false,_ping:false};window.__onGCastApiAvailable=function(ready,error){return ready?chromecast.initialize():false;};;
(function(){function toDashed(name){return name.replace(/([A-Z])/g,function(u){return'-'+u.toLowerCase();});}
function toCamelCase(input){return input.toLowerCase().replace(/-(.)/g,function(match,group1){return group1.toUpperCase();});}
var fn;if(document.head&&document.head.dataset){fn={set:function(node,attr,value){node.dataset[attr]=value;},get:function(node,attr){return node.dataset[attr];},del:function(node,attr){delete node.dataset[attr];},getAll:function(node){return node.dataset;}};}else{fn={set:function(node,attr,value){node.setAttribute('data-'+toDashed(attr),value);return value;},get:function(node,attr){var value=node.getAttribute('data-'+toDashed(attr));return value===null?undefined:value;},del:function(node,attr){node.removeAttribute('data-'+toDashed(attr));return true;},getAll:function(node){var dataset={};var attr_name;for(var i=0;i<node.attributes.length;i++){attr_name=node.attributes[i].name;if(attr_name.substr(0,5)!=='data-'){continue;}
dataset[toCamelCase(attr_name.substr(5))]=node.attributes[i].value;}
return dataset;}};}
function dataset(node,attr,value){var self={set:set,get:get,del:del};function set(attr,value){fn.set(node,attr,value);return self;}
function del(attr){fn.del(node,attr);return self;}
function get(attr){return fn.get(node,attr);}
function getAll(){return fn.getAll(node);}
if(arguments.length===3){return set(attr,value);}
if(arguments.length==2){return get(attr);}
return getAll();}
window.dom={addEventListener:function(html_element,event_name,event_function,use_capture){if(typeof use_capture!=='boolean'){use_capture=false;}
if(html_element.addEventListener){html_element.addEventListener(event_name,event_function,use_capture);}else if(html_element.attachEvent){html_element.attachEvent('on'+event_name,event_function);}},removeEventListener:function(html_element,event_name,event_function,use_capture){if(typeof use_capture!=='boolean'){use_capture=false;}
if(html_element.removeEventListener){html_element.removeEventListener(event_name,event_function,use_capture);}else if(html_element.detachEvent){html_element.detachEvent('on'+event_name,event_function);}},dataset:dataset};})();;
(function(){'use strict';var timeouts=[];var timeouts_cleared={};var nextHandle=1;var unshiftAllTimeouts=function(){if(timeouts.length===0){return;}
var i;var cb_to_call;cb_to_call=timeouts.slice(0);timeouts=[];for(i=0;i<cb_to_call.length;i++){if(typeof timeouts_cleared[cb_to_call[i][1]]!=='undefined'){delete timeouts_cleared[cb_to_call[i][1]];continue;}
cb_to_call[i][0].apply();}};var _clearZeroTimeout=function(handle){timeouts_cleared[handle]=true;};var timeout_received=true;var _setZeroTimeoutOne=function(cb){var thisHandle=nextHandle++;timeouts.push([cb,thisHandle]);if(!timeout_received){return thisHandle;}
timeout_received=false;function addTimeout(){window.setTimeout(function(){timeout_received=true;unshiftAllTimeouts();},0);}
addTimeout();addTimeout();return thisHandle;};window.setZeroTimeout=_setZeroTimeoutOne;window.clearZeroTimeout=_clearZeroTimeout;var hasPostmessage=typeof window.postMessage==='function';if(!hasPostmessage||(BrowserDetect.browser==='Explorer'&&BrowserDetect.version<=8)){return;}
var messageName='zero-timeout-message';var postmessage_received=true;var _setZeroTimeoutPostMessage=function(cb){var thisHandle=nextHandle++;timeouts.push([cb,thisHandle]);if(!postmessage_received){return thisHandle;}
postmessage_received=false;window.postMessage(messageName,'*');return thisHandle;};var handleMessage=function(event){if(event.source==window&&event.data==='defineSetZeroTimeoutPostMessage'){window.setZeroTimeout=_setZeroTimeoutPostMessage;return;}
if(event.source==window&&event.data===messageName){event.stopPropagation();postmessage_received=true;unshiftAllTimeouts();}};window.dom.addEventListener(window,'message',handleMessage,true);window.postMessage('defineSetZeroTimeoutPostMessage','*');})();;
if(typeof bookmark==='undefined'){var bookmark={init:function(){try{Events.subscribe(Events.player.paused,this._onPlayerChange,'bookmark');Events.subscribe(Events.player.seekCompleted,this._onPlayerChange,'bookmark');Events.subscribe(Events.player.track_end,this._onPlayerChange,'bookmark');Events.subscribe(Events.player.setBookmark,this._onPlayerChange,'bookmark');}catch(e){error.log(e);}},setEpisodeBookmark:function(mark,eventNamespace){try{if(typeof mark!=='object'||mark.OFFSET>mark.DURATION||USER.USER_ID===0){return false;}
var heard=bookmark.calculateIsHeard(mark.EPISODE_ID,mark.OFFSET,mark.duration,eventNamespace);if((mark.OFFSET>(mark.DURATION*0.9)&&(mark.DURATION-mark.OFFSET)<=120)||eventNamespace==='PLAYER.track_end'){mark.OFFSET='0';heard='1';}
mark.ISHEARD=heard;userData.addEpisodeBookmark(mark);Events.trigger(Events.talk.bookmarkSet,mark);if((mark.OFFSET+5)>=mark.DURATION){mark.OFFSET='0';}
mark.ISHEARD=Math.floor(heard).toString();api.call({method:'episode.bookmarkSet',data:mark,success:function(){}});return true;}catch(e){error.log(e);}},calculateIsHeard:function(eid,offset,duration,eventNamespace){var heard=bookmark.getEpisodeBookmark(eid).IS_HEARD;if(heard!=='1'){if((offset>(duration*0.9)&&(duration-offset)<=120)||eventNamespace==='PLAYER.track_end'){return'1';}else if(offset>9){return'0.5';}}
return heard;},getEpisodeBookmark:function(episode_id,duration){if(USER.USER_ID===0||typeof userData.data.EPISODE_BOOKMARKS_HASH==='undefined'){return{OFFSET:'0',IS_HEARD:'0'};}
var index=(typeof userData.data.EPISODE_BOOKMARKS_HASH[episode_id]!=='undefined')?userData.data.EPISODE_BOOKMARKS_HASH[episode_id]:false;if(index!==false){var obj=userData.data.EPISODE_BOOKMARKS.data[index];var result={OFFSET:obj.OFFSET,IS_HEARD:obj.IS_HEARD};if(duration){result.IS_HEARD=bookmark.calculateIsHeard(episode_id,obj.OFFSET,obj.duration);}
return result;}
return{OFFSET:'0',IS_HEARD:'0'};},_onPlayerChange:function(e,d){var offset;var eid;if(dzPlayer.getMediaType()!==dzPlayer.MEDIA_TYPE_TALK&&(d.media&&d.media.type!=='talk')){return false;}
if(dzPlayer.getPosition()<10&&e.namespace!=='PLAYER.track_end'){return false;}
var currentEpisode=dzPlayer.getCurrentSong();var duration=currentEpisode.DURATION;if(d.media){offset=d.offset;eid=d.media.id;}else if(dzPlayer.getMediaType(currentEpisode)===dzPlayer.MEDIA_TYPE_TALK){offset=dzPlayer.getPosition();eid=currentEpisode.EPISODE_ID;}else{return false;}
if(e.namespace==='PLAYER.seekCompleted'){offset=d;}
var mark={OFFSET:offset,DURATION:duration,EPISODE_ID:eid};mark.OFFSET=parseInt(mark.OFFSET,10);bookmark.setEpisodeBookmark(mark,e.namespace);}};};
if(typeof live==='undefined'){var live={initialized:false,socket:null,channels:[],connected:false,ticker_nb:0,server_timestamp:0,online_count:0,lastFeed:'',ws_close_codes:{normal:1000},ws_ready_state:{connecting:0,open:1,closing:2,closed:3},init:function(){if(Modernizr.websockets===false){return true;}
live.initialized=true;live.checkConnectionScheduler();limitation.init();live.log.init();return true;},checkConnectionScheduler:function(){live.checkConnection();window.setTimeout(live.checkConnectionScheduler,1000);},checkConnection:function(){if(typeof USER_TOKEN==='undefined'){return;}
if(live.socket!==null&&live.socket.readyState!=live.ws_ready_state.closed){return;}
live.connect();},connect:function(){if(live.socket!==null){live.close();delete live.socket;}
live.socket=new WebSocket(PROTOCOL_WS+SETTING_HOST_LIVE+'/ws/'+USER_TOKEN+'?version='+STATIC_VERSION);live.socket.onopen=function(evt){live.connected=true;for(var channel in live.channels){if(!live.channels.hasOwnProperty(channel)){continue;}
live.subscribe(channel);}
Events.trigger(Events.live.connected);};live.socket.onclose=function(evt){live.connected=false;};live.socket.onmessage=function(evt){live.onMsg(evt.data);};live.socket.onerror=function(evt){};return true;},disconnect:function(){if(!live.connected){return true;}
live.channels=[];live.connected=false;live.close();return true;},close:function(){try{live.socket.close(live.ws_close_codes.normal);}catch(e){error.log(e);}},addChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
live.addInternalChannel(channel);live.subscribe(channel);return true;},addInternalChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
live.channels[channel]=true;return true;},deleteChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
if(typeof live.channels[channel]==='undefined'){return false;}
delete live.channels[channel];return live.unsubscribe(channel);},subscribe:function(channel){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['sub',channel]));},unsubscribe:function(channel){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['unsub',channel]));},publish:function(channel,data){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['send',channel,data]));},sendlog:function(data){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['sendlog',data]));},onMsg:function(data){try{if(typeof data==='undefined'||data.length===0){return false;}
data=JSON.parse(data);if(data[0]!=='msg'){return false;}
live.dispatch([data[2],0]);return true;}catch(e){error.log(e);}},dispatch:function(message){try{if(typeof message!=='object'||message.length===0||typeof message[0].APP==='undefined'){error.log({message:'live.dispatch: Message not valid',description:message||null});return false;}
var app=message[0].APP.toLowerCase();if(typeof Events.live[app]!=='string'){return false;}
Events.trigger(Events.live[app],message);return true;}catch(e){error.log(e);}}};};
live.log={data:[],init:function(){Events.subscribe(Events.live.connected,function(){for(var line in live.log.data){if(!live.log.data.hasOwnProperty(line)){continue;}
live.sendlog(live.log.data[line]);}
live.log.data=[];});},send:function(event_name,properties){var data={event_name:event_name,properties:properties,platform:platform.get(),usr:USER.USER_ID,uniq_id:getCookie('dzr_uniq_id'),cty:COUNTRY,path:live.log.getPath(),session_duration:typeof SESSION_DURATION==='number'?SESSION_DURATION:null};if(!live.connected){live.log.data.push(data);return true;}
try{live.sendlog(data);}catch(e){live.log.data.push(data);}
return;},getPath:function(){var path=window.location.href;if(window.location.pathname==='/'){path+='homepage';}
return path;}};;
if(typeof limitation=='undefined'){var limitation={chan:null,uniqid:0,init:function(){Events.ready(Events.user.loaded,function(){limitation.uniqid=new Date().getTime();limitation.chan=USER.USER_ID+'_'+USER.USER_ID+'_STREAM';live.addInternalChannel(limitation.chan);Events.subscribe(Events.player.play,function(evt,params){if(typeof params.value=='undefined'){return false;}
limitation.sendAction('PLAY',params.value.SNG_ID);});Events.subscribe(Events.player.resume,function(evt,params){if(typeof params.value=='undefined'){return false;}
limitation.sendAction('PLAY',params.value.SNG_ID);});Events.subscribe(Events.player.seek,function(evt,params){limitation.sendAction('PLAY',dzPlayer.getCurrentSong('MEDIA_ID'));});Events.subscribe(Events.live.limitation,function(evt,params){limitation.execAction(params);});});},reset:function(){limitation.chan=null;limitation.uniqid=0;return true;},sendAction:function(action,value){if(USER.USER_ID===0||(typeof dzPlayer!=='undefined'&&dzPlayer.getPlayerType()==='chromecast')){return false;}
if(action!='PLAY'){return false;}
var param={APP:'LIMITATION',ACTION:action,VALUE:{USER_ID:USER.USER_ID,UNIQID:limitation.uniqid,SNG_ID:value}};live.publish(limitation.chan,param);return true;},execAction:function(message){if(typeof message!='object'||countObject(message)!=2){return false;}
var data=message[0];var time=message[1];if(data.VALUE.USER_ID===0){return false;}
if(data.VALUE.USER_ID==USER.USER_ID&&data.VALUE.UNIQID==limitation.uniqid){return false;}
if((live.server_timestamp-time)>5){return false;}
if(data.ACTION!='PLAY'){return false;}
Events.trigger(Events.live.simultaneousAccess,{});return true;}};};
var www={tabs:{},display_languages:false,layout_state_width:null,layoutDetectSize:function(){var layout_state_width;if(client_width<=1170){layout_state_width='small';}else if(client_width>1170){layout_state_width='big';}
if(www.layout_state_width!=layout_state_width){www.layout_state_width=layout_state_width;Events.trigger(Events.layout.width_type,www.layout_state_width);}
return www.layout_state_width;},drawFormResult:function(id,classname,data){try{$('#'+id).html(data).removeClass().addClass(classname).show();}catch(e){error.log(e);}},hideFormResult:function(id){try{$('#'+id).hide();}catch(e){error.log(e);}},openDemo:function(url){try{var params='width=820, height=550, resizable=no, scrollbars=no, toolbars=no, location=no, directories=no, status=no, menubar=no, copyhistory=no';var fwin=window.open(url,'demoWin',params);if(fwin&&window.focus){fwin.focus();}}catch(e){error.log(e);}},displayBackground:function(body){try{$('body').css('background',body);}catch(e){error.log(e);}},getAbsoluteTop:function(objectId){try{o=document.getElementById(objectId);oTop=o.offsetTop;return oTop;}catch(e){error.log(e);}},getAbsoluteTopParent:function(objectId){try{var o=document.getElementById(objectId);oTop=o.offsetTop;while(o.offsetParent!==null){oParent=o.offsetParent;oTop+=oParent.offsetTop;o=oParent;}
return oTop;}catch(e){error.log(e);}},displayLanguages:function(){try{if(www.display_languages===false){$('#languages-list').fadeIn('slow');www.display_languages=true;scrollTo(0,$(document).height());}else{$('#languages-list').fadeOut('slow');www.display_languages=false;}}catch(e){error.log(e);}},goto_anchor:function(id){try{$('#page_content').scrollTop(www.getAbsoluteTopParent(id));return false;}catch(e){error.log(e);}},operator_form:function(form){try{if(form=='login'){$('#operator_form_login').show();$('#operator_form_register').hide();}else if(form=='register'){$('#operator_form_login').hide();$('#operator_form_register').show();}}catch(e){error.log(e);}},orange_form:function(form){try{if(form=='login'){$('#orange_form_login').show();$('#orange_form_register').hide();}else if(form=='register'){$('#orange_form_login').hide();$('#orange_form_register').show();}}catch(e){error.log(e);}},scrollOffersPage:function($el){try{$el.parent().siblings().removeClass('active');$el.parent().addClass('active');var target_id=$el.attr('href');var $target=$(target_id);var offset_y=(PLATFORM==='web')?$target.position().top:$target.offset().top;var $scroller=(PLATFORM==='web')?$('#page_content'):$('html,body');$scroller.animate({scrollTop:offset_y},'slow');}catch(e){error.log(e);}},getCurrentPageType:function(){try{var current_path=www.getCurrentPath();var naboo_class=naboo.dispatchPath(current_path);if(naboo_class!==null){return naboo_class.class_name;}
return current_path.split('/')[1];}catch(e){error.log(e);}},getCurrentPageId:function(){try{if(typeof naboo==='object'){return window[naboo.getCurrentClass()].id;}
return 0;}catch(e){error.log(e);}},getCurrentTab:function(){try{var path='';if(www.getCurrentPath()!=''&&www.getCurrentPath()!='index.php'){var currentPath=www.getCurrentPath().split('/');if(typeof currentPath[2]!=='undefined'){path=currentPath[2];}}
return path;}catch(e){error.log(e);}},allowAutoPromo:function(data){try{if(data.FILTERS=='free'&&DZPS){return false;}
if(data.FILTERS=='premium'&&!DZPS){return false;}
if(data.LOGGED_FILTERS=='notlogged'&&USER.USER_ID>0){return false;}
if(data.LOGGED_FILTERS=='logged'&&USER.USER_ID===0){return false;}
return true;}catch(e){error.log(e);}},updateContentBackground:function(){try{var $page=$('#naboo_content').children().first();var bg=$page.attr('data-bg');if(typeof bg!=='string'){$(page_content).removeAttr('data-bg');return false;}
$(page_content).attr('data-bg',bg);return true;}catch(e){error.log(e);}},navigate:function(page,options){try{if(page.charAt(0)!=='/'){error.log(new dzError({name:'NAVIGATION',message:'path not valid',description:'loadBox: / is missing in your path'+page}));page='/'+page;}
if(typeof options!=='object'){options={};}
if(page.substr(0,10)=='/login.php'||page.substr(0,13)=='/register.php'||page=='/payment/paypal_unsubscribe.php'||page=='/confirm.php'||page=='/facebook.php'){return loadFacebox(page);}
dclk_hide();infinite_scroll.disable();$('.tipsy').remove();$('#hovercard').hide();if(options.forceFaceboxClose!==false){$('#sharebox').remove();$('#facebox_overlay').fadeOut();$.facebox.close();}
if(www.getCurrentPath()!==page){www.setCurrentPath(page,true);}
Events.trigger(Events.navigation.page_changed,{path:page});var class_name=page.split('/')[1];if(naboo.isAllowed(class_name)){return naboo.display(page,undefined,options);}
naboo.leave();var getParam=page.split('?');var get_query_param='';if(typeof getParam[1]!=='undefined'){get_query_param=getParam[1];}
sendRequest('/ajax/loader.php?checkForm='+encodeURIComponent(checkForm)+'&'+get_query_param,'text','page='+encodeURIComponent(page)+'&full=1',true,www.loadBoxCallback,{'page':page},'major_pages');return true;}catch(e){error.log(e);}},loadBoxCallback:function(request,callback_parameters){try{if(request==false||request==null||typeof request.responseText=='undefined'){return false;}
request=request.responseText;var page='';if(callback_parameters['page']!=null){page=callback_parameters['page'];}
if(DZPS||page!=''){disableAdsHabillage();}
$('#naboo_content').html(request);Events.trigger(Events.navigation.page_loaded);Events.trigger(Events.navigation.page_displayed,{path:page});$('#page_content').scrollTop(0);return true;}catch(e){error.log(e);}},goToLogin:function(redirect){window.location.href='/login'+www.parseRedirectParams(redirect);},goToRegister:function(redirect){window.location.href='/register'+www.parseRedirectParams(redirect);},goToConnection:function(redirect){window.location.href='/'+www.parseRedirectParams(redirect);},parseRedirectParams:function(options){if(window.location.search.indexOf('redirect_link')>-1&&window.location.search.indexOf('redirect_type')>-1){return window.location.search;}
var redirect='';if(typeof options==='object'){if(typeof options.redirect_type==='string'){redirect+='?redirect_type='+options.redirect_type;}
if(typeof options.redirect_link==='string'){redirect+='&redirect_link='+options.redirect_link;}}else if(www.getCurrentPath()!=='/'&&!/(login|register|signout)/.test(www.getCurrentPath())){redirect='?redirect_type=page&redirect_link='+encodeURIComponent(www.getCurrentPath());}
return redirect;},getCurrentPath:function(){if(!_jqueryAddress.initialized){return window.location.pathname;}
return $.address.value();},setCurrentPath:function(path,with_history){with_history=(typeof with_history==='boolean')?with_history:false;if(!with_history){$.address.history(false);}
$.address.value(path);if(!with_history){$.address.history(true);}}};_onScroll=function(){window.page_content=$('#page_content').get(0);if(typeof window.page_content==='undefined'){return false;}
page_content.onscroll=function(){try{yscroll=page_content.scrollTop;infinite_scroll.checkPosition();clearInterval(hovercard.timeout);if(hovercard.current!=null){hovercard.hide();}
Events.trigger(Events.layout.scroll,{yscroll:yscroll});return true;}catch(e){error.log(e);}};};_onResize=function(){client_height=getClientHeight();client_width=getClientWidth();window.onresize=document.onresize=function(){try{var prev_client_height=client_height;var prev_client_width=client_width;client_height=getClientHeight();client_width=getClientWidth();if(prev_client_height==client_height&&prev_client_width==client_width){return false;}
www.layoutDetectSize();if(typeof menu!='undefined'){menu.adjustUserMenu();}
infinite_scroll.checkPosition();Events.trigger(Events.layout.resize,{'client_width':client_width,'client_height':client_height});return true;}catch(e){error.log(e);}};};_onBlur=function(){window.onblur=function(){ads_focus_value=false;ads.checkAutoRefresh(true);return true;};};_onFocus=function(){window.onfocus=function(){ads_focus_value=true;ads.checkAutoRefresh(true);return true;};};_onBeforeUnload=function(){window.onbeforeunload=function(){if(dzPlayer.playing&&USER.USER_ID>0&&(typeof USER.SETTING.global.popup_unload=='undefined'||!USER.SETTING.global.popup_unload)&&(typeof loadPaymentProgress=='undefined')){return gettext('En quittant cette page, votre musique s\'arrêtera. Dommage.');}};window.onunload=function(){if(dzPlayer.getCurrentSong()!==null){dzPlayer.logManager(false);facebook.closeBridge();}};};_jqueryAddress=function(){if(typeof $.address==='undefined'){return false;}
if(typeof Modernizr!='undefined'&&Modernizr.history&&typeof $.address!=='undefined'){$.address.state('/');var init_address=window.location.pathname.split('/');if(typeof init_address[1]!='undefined'&&init_address[1].length===2){$.address.history(false);$.address.value(window.location.pathname.substr(3));$.address.history(true);}}
this.initialized=true;$.address.init(function(event){}).externalChange(function(event){try{var aPaths=event.value.split('/');if(aPaths[1]!=='app'&&event.value.indexOf('?')!=-1){return false;}
loadBox(event.value);}catch(e){error.log(e);}}).internalChange(function(event){});};try{$(document).ready(function(){document.write=function(){return false;};document.open=function(){return false;};document.close=function(){return false;};if(window.ZeroClipboard){ZeroClipboard.config({swfPath:SETTING_STATIC+'/swf/ZeroClipboard.swf'});}});js_init.init();$(document).ready(function(){var current_path=www.getCurrentPath();Events.trigger(Events.navigation.page_changed,{path:current_path});if(typeof naboo!=='undefined'&&naboo.dispatchPath(current_path)===null){Events.trigger(Events.navigation.page_loaded);Events.trigger(Events.navigation.page_displayed,{path:current_path});}});}catch(e){error.log(e);};